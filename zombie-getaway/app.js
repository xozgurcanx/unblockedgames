function initSplash(){gameState="splash",resizeCanvas(),splash=new Elements.Splash(assetLib.getData("splash"),canvas.width,canvas.height),previousTime=(new Date).getTime(),updateSplashScreenEvent()}function initStartScreen(){gameState="start",levelScore=0,totalScore=0,levelNum=0,fruitScore=0,aLevelUps=new Array(1,1,1),bgType="bg"+Math.ceil(3*Math.random()),atmosType="atmos"+Math.ceil(3*Math.random()),userInput.addHitArea("mute",butEventHandler,null,{type:"rect",aRect:[281,0,canvas.width,40]},!0);var a=new Array(canvas.width/2,380);screens=new Elements.Screens({startImageData:assetLib.getData(bgType),atmosImageData:assetLib.getData(atmosType)},{play:{imageData:assetLib.getData("playBut"),pos:a}},assetLib.getData("title"),canvas.width,canvas.height),screens.setRenderFunc("start"),userInput.addHitArea("startGame",butEventHandler,a,{type:"image",oImageData:assetLib.getData("playBut"),aCentrePos:a}),previousTime=(new Date).getTime(),updateStartScreenEvent()}function initPreGame(){gameState="tutorial",background=new Elements.Background(assetLib.getData(bgType),canvas.width,canvas.height),atmos=new Elements.Atmos(assetLib.getData(atmosType),canvas.width,canvas.height);for(var a=0;a<aTutorials.length;a++)if(aTutorials[a].level==levelNum&&!aTutorials[a].shown)return userInput.addHitArea("continue",butEventHandler,null,{type:"rect",aRect:[100,265,220,345]}),background.render(ctx),atmos.render(ctx),panel=new Elements.Panel(assetLib.getData("panels"),assetLib.getData("levelUp"),assetLib.getData("numbers"),aLevelUps,canvas.width,canvas.height),panelFrame=aTutorials[a].panelFrame,panel.startTween(),previousTime=(new Date).getTime(),updateTutorialEvent(),void 0;initGame()}function initGame(){gameState="game",allowSound&&music.volume(.5),background=new Elements.Background(assetLib.getData(bgType),canvas.width,canvas.height),atmos=new Elements.Atmos(assetLib.getData(atmosType),canvas.width,canvas.height),userInput.addHitArea("pause",butEventHandler,null,{type:"rect",aRect:[245,0,281,40]},!0),userInput.addHitArea("moveRightEvent",butEventHandler,{multiTouch:!0},{type:"rect",aRect:[83,350,160,canvas.height]},!0),userInput.addHitArea("moveLeftEvent",butEventHandler,{multiTouch:!0},{type:"rect",aRect:[0,350,83,canvas.height]},!0),userInput.addHitArea("dashEvent",butEventHandler,{multiTouch:!0},{type:"rect",aRect:[230,368,canvas.width,canvas.height]},!0),userInput.addHitArea("jumpEvent",butEventHandler,{multiTouch:!0},{type:"rect",aRect:[230,290,canvas.width,368]},!0),userInput.addKey("moveRightEvent",butEventHandler,null,39),userInput.addKey("moveLeftEvent",butEventHandler,null,37),userInput.addKey("dashEvent",butEventHandler,null,32),userInput.addKey("jumpEvent",butEventHandler,null,38),levelDist=Math.min(250+30*levelNum,700),hud=new Elements.Hud(assetLib.getData("hud"),assetLib.getData("overlay"),assetLib.getData("marker"),assetLib.getData("numbers"),canvas.width,canvas.height,levelNum,levelDist),hud.updateScore(fruitScore,totalScore),hero=new Elements.Hero(assetLib.getData("hero"),canvas.width,canvas.height,initLevelComplete,levelNum,aLevelUps),hero.x=canvas.width/2,hero.y=320,trackX=0,trackY=-hero.speedY,obstacleFreq=Math.max(200-10*levelNum,100),obstacleReleaseInc=background.offsetY,lastZombieKill=!1,levelFruitScore=0,aEnemies=new Array,aObstacles=new Array,aFruit=new Array,previousTime=(new Date).getTime(),updateGameEvent()}function heroEvent(){}function butEventHandler(a,b){switch(console.log(a),a){case"langSelect":console.log(b.lang),curLang=b.lang,ctx.clearRect(0,0,canvas.width,canvas.height),userInput.removeHitArea("langSelect"),initLoadAssets();break;case"moveLeftEvent":hero.leftPull=b.isDown?-200:0;break;case"moveRightEvent":hero.rightPull=b.isDown?200:0;break;case"dashEvent":b.isDown&&hero.changeState("dashing");break;case"jumpEvent":b.isDown&&hero.changeState("jumping");break;case"startGame":playSound("click"),userInput.removeHitArea("startGame"),initPreGame();break;case"continue":playSound("click"),userInput.removeHitArea("continue"),initGame();break;case"powerUps":playSound("click"),userInput.removeHitArea("powerUps"),initPowerUps();break;case"jumpHeight":fruitScore>=10&&aLevelUps[0]<10&&(aLevelUps[0]++,fruitScore-=10,panel.aLevelUps=aLevelUps,panel.oScoreData.fruitNum=fruitScore);break;case"dashLength":fruitScore>=10&&aLevelUps[1]<10&&(aLevelUps[1]++,fruitScore-=10,panel.aLevelUps=aLevelUps,panel.oScoreData.fruitNum=fruitScore);break;case"turnRate":fruitScore>=10&&aLevelUps[2]<10&&(aLevelUps[2]++,fruitScore-=10,panel.aLevelUps=aLevelUps,panel.oScoreData.fruitNum=fruitScore);break;case"nextLevel":playSound("click"),userInput.removeHitArea("jumpHeight"),userInput.removeHitArea("dashLength"),userInput.removeHitArea("turnRate"),userInput.removeHitArea("nextLevel"),bgType="bg"+Math.ceil(3*Math.random()),atmosType="atmos"+Math.ceil(3*Math.random()),levelScore=0,levelNum++,initPreGame();break;case"retryLevel":playSound("click"),userInput.removeHitArea("retryLevel"),userInput.removeHitArea("quitFromEnd"),levelScore=0,fruitScore-=levelFruitScore,initPreGame();break;case"quitFromEnd":playSound("click"),userInput.removeHitArea("pause"),userInput.removeHitArea("retryLevel"),userInput.removeHitArea("quitFromEnd"),initStartScreen();break;case"mute":playSound("click"),toggleMute();break;case"pause":case"resumeFromPause":playSound("click"),toggleManualPause();break;case"quitFromPause":playSound("click"),toggleManualPause(),userInput.removeHitArea("pause"),userInput.removeHitArea("moveRightEvent"),userInput.removeHitArea("moveLeftEvent"),userInput.removeHitArea("dashEvent"),userInput.removeHitArea("jumpEvent"),userInput.removeKey("moveRightEvent"),userInput.removeKey("moveLeftEvent"),userInput.removeKey("dashEvent"),userInput.removeKey("jumpEvent"),userInput.removeHitArea("quitFromPause"),userInput.removeHitArea("resumeFromPause"),initStartScreen()}}function updateScore(a){levelScore+=a,hud.updateScore(fruitScore,levelScore+totalScore)}function updateFruitScore(a){fruitScore+=a,levelFruitScore+=a,hud.updateScore(fruitScore,levelScore+totalScore)}function addObstacle(){updateScore(10);var a;switch(a=0==levelNum%3&&levelNum>0?2:Math.ceil(2*Math.random()),lastZombieKill&&(a=3,lastZombieKill=!1),a){case 1:var b=oObstacleTypes[bgType][Math.floor(Math.random()*oObstacleTypes[bgType].length)],c=new Elements.Obstacle(assetLib.getData("obstacle"),canvas.width,canvas.height,b);c.y=-150-Math.random()*(obstacleFreq-100),aObstacles.push(c);var d=new Elements.Fruit(assetLib.getData("fruit"),canvas.width,canvas.height);d.y=c.y-35,d.x=c.x,aFruit.push(d);break;case 2:var e=Math.ceil(4*Math.random()),f=Math.random()*canvas.width;if(1==e){var g=new Elements.Enemy(assetLib.getData("zombie2"),1,10,canvas.width,canvas.height,f);g.y=-150-Math.random()*(obstacleFreq-100),aEnemies.push(g)}else if(2==e){f>canvas.width/2?f+=205:f-=205;var g=new Elements.Enemy(assetLib.getData("zombie2"),1,10,canvas.width,canvas.height,f);g.y=-150-Math.random()*(obstacleFreq-100),aEnemies.push(g),f>canvas.width/2?f-=200:f+=200;var h=new Elements.Enemy(assetLib.getData("zombie2"),1,10,canvas.width,canvas.height,f);h.y=-150-Math.random()*(obstacleFreq-100),aEnemies.push(h)}else if(3==e){var g=new Elements.Enemy(assetLib.getData("zombie1"),2,15,canvas.width,canvas.height,f);g.y=-150-Math.random()*(obstacleFreq-100),aEnemies.push(g)}else{var g=new Elements.Enemy(assetLib.getData("zombie3"),3,20,canvas.width,canvas.height,f);g.y=-150-Math.random()*(obstacleFreq-100),aEnemies.push(g)}break;case 3:for(var i=Math.ceil(5*Math.random()),j=0;i>j;j++){var d=new Elements.Fruit(assetLib.getData("fruit"),canvas.width,canvas.height);d.y=-150-Math.random()*(obstacleFreq-100),d.x=Math.random()*canvas.width,aFruit.push(d)}}}function initLevelComplete(){gameState="levelComplete",allowSound&&music.volume(.25),playSound("levelComplete"),userInput.removeHitArea("pause"),userInput.removeHitArea("moveRightEvent"),userInput.removeHitArea("moveLeftEvent"),userInput.removeHitArea("dashEvent"),userInput.removeHitArea("jumpEvent"),userInput.removeKey("moveRightEvent"),userInput.removeKey("moveLeftEvent"),userInput.removeKey("dashEvent"),userInput.removeKey("jumpEvent"),userInput.addHitArea("powerUps",butEventHandler,null,{type:"rect",aRect:[100,265,220,345]}),panel=new Elements.Panel(assetLib.getData("panels"),assetLib.getData("levelUp"),assetLib.getData("numbers"),aLevelUps,canvas.width,canvas.height),panel.startTween(),totalScore+=10*fruitScore+levelScore,panel.oScoreData={fruitScore:10*levelFruitScore,levelScore:levelScore+10*levelFruitScore,totalScore:totalScore},previousTime=(new Date).getTime(),updateLevelComplete()}function initGameEndFail(a){gameState="gameEndFail",allowSound&&music.volume(.25),playSound("gameFail"+(a+1)),userInput.removeHitArea("pause"),userInput.removeHitArea("moveRightEvent"),userInput.removeHitArea("moveLeftEvent"),userInput.removeHitArea("dashEvent"),userInput.removeHitArea("jumpEvent"),userInput.removeKey("moveRightEvent"),userInput.removeKey("moveLeftEvent"),userInput.removeKey("dashEvent"),userInput.removeKey("jumpEvent"),userInput.addHitArea("retryLevel",butEventHandler,null,{type:"rect",aRect:[161,265,295,345]}),userInput.addHitArea("quitFromEnd",butEventHandler,null,{type:"rect",aRect:[25,265,161,345]}),background.render(ctx),atmos.render(ctx),panel=new Elements.Panel(assetLib.getData("panels"),assetLib.getData("levelUp"),assetLib.getData("numbers"),aLevelUps,canvas.width,canvas.height),panel.oScoreData={totalScore:levelScore+totalScore},panel.startTween(),panelFrame=a,previousTime=(new Date).getTime(),updateGameEndFail()}function initPowerUps(){gameState="powerUps",allowSound&&music.volume(.25),userInput.addHitArea("jumpHeight",butEventHandler,null,{type:"rect",aRect:[30,135,290,185]}),userInput.addHitArea("dashLength",butEventHandler,null,{type:"rect",aRect:[30,192,290,240]}),userInput.addHitArea("turnRate",butEventHandler,null,{type:"rect",aRect:[30,250,290,300]}),userInput.addHitArea("nextLevel",butEventHandler,null,{type:"rect",aRect:[105,310,215,380]}),background.render(ctx),atmos.render(ctx),panel=new Elements.Panel(assetLib.getData("panels"),assetLib.getData("levelUp"),assetLib.getData("numbers"),aLevelUps,canvas.width,canvas.height),panel.oScoreData={fruitNum:fruitScore},panel.startTween(),previousTime=(new Date).getTime(),updatePowerUps()}function initOutro(){gameState="outro",hud.isOutro=!0,hero.changeState("outro"),levelDist=999,previousTime=(new Date).getTime(),updateOutroEvent()}function updateOutroEvent(){if(!manualPause&&!rotatePause&&"outro"==gameState){var a=getDelta();hero.update(trackX,trackY,a),trackX=6*(canvas.width/2-hero.x),trackY=0,background.update(a,-trackX,trackY),background.render(ctx),renderSprite(hero),atmos.update(a,-trackX,trackY),atmos.render(ctx),hud.render(ctx,0),requestAnimFrame(updateOutroEvent)}}function updateGameEvent(){if(!manualPause&&!rotatePause&&"game"==gameState){var a=getDelta();hero.update(trackX,trackY,a),trackX=6*(canvas.width/2-hero.x),trackY=20*(320-hero.y),background.update(a,-trackX,trackY),background.render(ctx),0>=levelDist?0==aObstacles.length&&0==aFruit.length&&0==aEnemies.length&&initOutro():(levelDist-=10*a,background.offsetY<obstacleReleaseInc-obstacleFreq&&(addObstacle(),obstacleReleaseInc=background.offsetY));for(var b=0;b<aEnemies.length;b++){aEnemies[b].update(a,trackX,-trackY),renderSprite(aEnemies[b]);var c=hero.radius;hero.isEnemyDashable(aEnemies[b].speedX)&&(c=2*hero.radius),"running"==aEnemies[b].state&&checkSpriteCollision(aEnemies[b],hero,c)&&(c==hero.radius?initGameEndFail(1):(playSound("hitZombie"),lastZombieKill=!0,aEnemies[b].changeState("bursting"),updateScore(100))),aEnemies[b].removeMe&&(aEnemies.splice(b,1),b-=1)}for(var b=0;b<aObstacles.length;b++){aObstacles[b].update(a,trackX,-trackY),aObstacles[b].render(ctx);var d=aObstacles[b].checkHit(hero);1==d&&"jumping"!=hero.state&&initGameEndFail(0),aObstacles[b].removeMe&&(aObstacles.splice(b,1),b-=1)}for(var b=0;b<aFruit.length;b++)aFruit[b].update(a,trackX,-trackY),renderSprite(aFruit[b]),aFruit[b].canHit&&checkSpriteCollision(aFruit[b],hero,hero.radius)&&(playSound("fruit"),aFruit[b].hit(),updateFruitScore(1)),aFruit[b].removeMe&&(aFruit.splice(b,1),b-=1);renderSprite(hero),atmos.update(a,-trackX,trackY),atmos.render(ctx),hud.render(ctx,levelDist),renderMuteBut(),requestAnimFrame(updateGameEvent)}}function updateLevelComplete(){rotatePause||"levelComplete"!=gameState||(getDelta(),background.render(ctx),atmos.render(ctx),panel.renderPanel(ctx,"levelComplete"),renderMuteBut(),requestAnimFrame(updateLevelComplete))}function updatePowerUps(){rotatePause||"powerUps"!=gameState||(getDelta(),background.render(ctx),atmos.render(ctx),panel.renderPanel(ctx,"powerUps"),renderMuteBut(),requestAnimFrame(updatePowerUps))}function updateGameEndFail(){rotatePause||"gameEndFail"!=gameState||(getDelta(),background.render(ctx),atmos.render(ctx),panel.renderPanel(ctx,"gameEndFail",panelFrame),renderMuteBut(),requestAnimFrame(updateGameEndFail))}function updateTutorialEvent(){rotatePause||"tutorial"!=gameState||(getDelta(),background.render(ctx),atmos.render(ctx),panel.renderPanel(ctx,"tutorial",panelFrame),renderMuteBut(),requestAnimFrame(updateTutorialEvent))}function updateSplashScreenEvent(){if(!rotatePause&&"splash"==gameState){var a=getDelta();if(splashTimer+=a,splashTimer>2.5)return allowSound&&!muted&&music.play(),initStartScreen(),void 0;splash.render(ctx,a),requestAnimFrame(updateSplashScreenEvent)}}function updateStartScreenEvent(){if(!rotatePause&&"start"==gameState){var a=getDelta();screens.render(ctx,a),renderMuteBut(),requestAnimFrame(updateStartScreenEvent)}}function getDelta(){var a=(new Date).getTime(),b=(a-previousTime)/1e3;return previousTime=a,b>.5&&(b=0),b}function renderSprite(a){ctx.save(),ctx.translate(a.x,a.y),ctx.rotate(a.rotation),ctx.scale(a.scaleX,a.scaleY),a.render(ctx),ctx.restore()}function checkSpriteCollision(a,b,c){var d=a.x,e=a.y,f=b.x,g=b.y,h=(d-f)*(d-f)+(e-g)*(e-g),i=(a.radius+c)*(a.radius+c);return i>h?!0:!1}function loadPreAssets(){aLangs.length>1?(preAssetLib=new Utils.AssetLoader(curLang,[{id:"langSelect",file:"images/langSelect.jpg"},{id:"preloadImage",file:"images/preloadImage.jpg"}],ctx,canvas.width,canvas.height,!1),preAssetLib.onReady(initLangSelect)):(curLang=aLangs[0],preAssetLib=new Utils.AssetLoader(curLang,[{id:"preloadImage",file:"images/preloadImage.jpg"}],ctx,canvas.width,canvas.height,!1),preAssetLib.onReady(initLoadAssets))}function initLangSelect(){var a=preAssetLib.getData("langSelect");ctx.drawImage(a.img,canvas.width/2-a.img.width/2,canvas.height/2-a.img.height/2);for(var b=140,c=0;c<aLangs.length;c++){var d=canvas.width/2-b*aLangs.length/2+c*b,e=canvas.height/2-b/2;userInput.addHitArea("langSelect",butEventHandler,{lang:aLangs[c]},{type:"rect",aRect:[d,e,d+b,e+140]})}}function initLoadAssets(){var a=preAssetLib.getData("preloadImage");ctx.drawImage(a.img,canvas.width/2-a.img.width/2,canvas.height/2-a.img.height-10),loadAssets()}function loadAssets(){assetLib=new Utils.AssetLoader(curLang,[{id:"bg1",file:"images/bg1.jpg"},{id:"atmos1",file:"images/atmos1.png"},{id:"bg2",file:"images/bg2.jpg"},{id:"atmos2",file:"images/atmos2.png"},{id:"bg3",file:"images/bg3.jpg"},{id:"atmos3",file:"images/atmos3.png"},{id:"title",file:"images/"+curLang+"/title.png"},{id:"rotateDeviceMessage",file:"images/rotateDeviceMessage.jpg"},{id:"splash",file:"images/splashScreen.jpg"},{id:"hud",file:"images/"+curLang+"/hud.png"},{id:"playBut",file:"images/playBut.png"},{id:"marker",file:"images/marker.png"},{id:"panels",file:"images/"+curLang+"/panels_320x460.png",oData:{columns:4,spriteWidth:320,spriteHeight:460}},{id:"numbers",file:"images/numbers_21x25.png",oData:{columns:5,spriteWidth:21,spriteHeight:25}},{id:"hero",file:"images/hero_67x160.png",oData:{oAnims:{running:[0,1,2,3,4,5,6,7],jumping:[8,9,10,11,12,13,14,15,16,17,18,19,20,21]},columns:4,spriteWidth:67,spriteHeight:160}},{id:"fruit",file:"images/fruit_95x95.png",oData:{oAnims:{waiting1:[0],waiting2:[1],waiting3:[2],waiting4:[3],waiting5:[4],bursting:[5,6,7,8,9,10,11,12,13,14,15]},columns:4,spriteWidth:95,spriteHeight:95}},{id:"zombie1",file:"images/zombie1_124x146.png",oData:{oAnims:{running:[0,1,2,3,4,5,6],bursting:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],head:[26]},columns:7,spriteWidth:124,spriteHeight:146}},{id:"zombie2",file:"images/zombie2_109x130.png",oData:{oAnims:{running:[0,1,2,3,4,5,6],bursting:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],head:[26]},columns:7,spriteWidth:109,spriteHeight:130}},{id:"zombie3",file:"images/zombie3_142x129.png",oData:{oAnims:{running:[0,1,2,3,4,5,6],bursting:[7,8,9,10,11,12,13,14,15,16,17],head:[17]},columns:6,spriteWidth:142,spriteHeight:129}},{id:"obstacle",file:"images/obstacle_211x122.png",oData:{columns:3,spriteWidth:211,spriteHeight:122}},{id:"levelUp",file:"images/levelUp_109x47.png",oData:{columns:5,spriteWidth:109,spriteHeight:47}},{id:"muteBut",file:"images/mute_29x29.png",oData:{columns:2,spriteWidth:29,spriteHeight:29}}],ctx,canvas.width,canvas.height),assetLib.onReady(initSplash)}function resizeCanvas(){var a=window.innerWidth,b=window.innerHeight;a>480&&(a-=1,b-=1),window.innerWidth>window.innerHeight&&isMobile?("loading"!=gameState&&rotatePauseOn(),a/canvas.width<b/canvas.height?(canvas.style.width=a+"px",canvas.style.height=a/canvas.width*canvas.height+"px",canvasX=0,canvasY=(b-a/canvas.width*canvas.height)/2,canvasScaleX=canvasScaleY=canvas.width/a,div.style.marginTop=canvasY+"px",div.style.marginLeft=canvasX+"px"):(canvas.style.width=b/canvas.height*canvas.width+"px",canvas.style.height=b+"px",canvasX=(a-b/canvas.height*canvas.width)/2,canvasY=0,canvasScaleX=canvasScaleY=canvas.height/b,div.style.marginTop=canvasY+"px",div.style.marginLeft=canvasX+"px")):isMobile?(rotatePause&&rotatePauseOff(),canvasX=canvasY=0,canvasScaleX=canvas.width/a,canvasScaleY=canvas.height/b,canvas.style.width=a+"px",canvas.style.height=b+"px",div.style.marginTop="0px",div.style.marginLeft="0px"):(rotatePause&&rotatePauseOff(),a/canvas.width<b/canvas.height?(canvas.style.width=a+"px",canvas.style.height=a/canvas.width*canvas.height+"px",canvasX=0,canvasY=(b-a/canvas.width*canvas.height)/2,canvasScaleX=canvasScaleY=canvas.width/a,div.style.marginTop=canvasY+"px",div.style.marginLeft=canvasX+"px"):(canvas.style.width=b/canvas.height*canvas.width+"px",canvas.style.height=b+"px",canvasX=(a-b/canvas.height*canvas.width)/2,canvasY=0,canvasScaleX=canvasScaleY=canvas.height/b,div.style.marginTop=canvasY+"px",div.style.marginLeft=canvasX+"px")),userInput.setCanvas(canvasX,canvasY,canvasScaleX,canvasScaleY)}function playSound(a){allowSound&&sound.play(a)}function toggleMute(){muted=!muted,allowSound&&(muted?Howler.mute():Howler.unmute()),renderMuteBut()}function renderMuteBut(){if(allowSound){var a=assetLib.getData("muteBut"),b=0;muted&&(b=1);var c=b*a.oData.spriteWidth%a.img.width,d=Math.floor(b/(a.img.width/a.oData.spriteWidth))*a.oData.spriteHeight;ctx.drawImage(a.img,c,d,a.oData.spriteWidth,a.oData.spriteHeight,282,7,a.oData.spriteWidth,a.oData.spriteHeight)}}function toggleManualPause(){manualPause?(manualPause=!1,userInput.removeHitArea("quitFromPause"),userInput.removeHitArea("resumeFromPause"),pauseCoreOff()):(manualPause=!0,pauseCoreOn(),userInput.addHitArea("quitFromPause",butEventHandler,null,{type:"rect",aRect:[25,215,161,310]}),userInput.addHitArea("resumeFromPause",butEventHandler,null,{type:"rect",aRect:[161,215,295,310]}),panel=new Elements.Panel(assetLib.getData("panels"),assetLib.getData("levelUp"),assetLib.getData("numbers"),aLevelUps,canvas.width,canvas.height),panel.renderPanel(ctx,"pause"),userInput.addHitArea("pause",butEventHandler,null,{type:"rect",aRect:[245,0,281,40]},!0))}function rotatePauseOn(){rotatePause=!0,ctx.drawImage(assetLib.getImg("rotateDeviceMessage"),0,0),pauseCoreOn()}function rotatePauseOff(){rotatePause=!1,pauseCoreOff()}function pauseCoreOn(){switch(allowSound&&Howler.mute(),gameState){case"splash":break;case"start":break;case"tutorial":break;case"game":break;case"levelComplete ":break;case"gameEndFail ":break;case"powerUps":break;case"outro":}}function pauseCoreOff(){switch(allowSound&&(muted||Howler.unmute()),previousTime=(new Date).getTime(),userInput.pauseIsOn=!1,gameState){case"splash":updateSplashScreenEvent();break;case"start":initStartScreen();break;case"tutorial":initPreGame();break;case"game":manualPause=!1,updateGameEvent();break;case"levelComplete":initLevelComplete();break;case"gameEndFail":initGameEndFail(1);break;case"powerUps":initPowerUps();break;case"outro":initOutro()}}var Utils;!function(a){var b=function(){function a(a,b,c,d,e,f){if("undefined"==typeof f&&(f=!0),this.oAssetData={},this.assetsLoaded=0,this.totalAssets=b.length,this.ctx=c,this.canvasWidth=d,this.canvasHeight=e,this.showBar=f,this.topLeftX=this.canvasWidth/2-d/4,this.topLeftY=this.canvasHeight/2,this.showBar){var g;"EN"==a||""==a?g="Loading...":"ES"==a?g="Cargando...":"FR"==a&&(g="Chargement..."),ctx.fillStyle="#C9451D",ctx.textAlign="center",ctx.font="14px Helvetica",ctx.fillText(g,this.canvasWidth/2,this.topLeftY+35),ctx.strokeStyle="#792810",ctx.lineWidth=2,ctx.fillStyle="#C9451D",ctx.moveTo(this.topLeftX,this.topLeftY),ctx.lineTo(this.topLeftX+d/2,this.topLeftY+0),ctx.lineTo(this.topLeftX+d/2,this.topLeftY+20),ctx.lineTo(this.topLeftX+0,this.topLeftY+20),ctx.lineTo(this.topLeftX+0,this.topLeftY+0),ctx.stroke()}for(var h=0;h<b.length;h++)this.loadImage(b[h])}return a.prototype.loadImage=function(a){var b=this,c=new Image;c.onload=function(){b.oAssetData[a.id]={},b.oAssetData[a.id].img=c,void 0!=a.oData&&(b.oAssetData[a.id].oData=a.oData),++b.assetsLoaded,b.showBar&&ctx.fillRect(b.topLeftX+2,b.topLeftY+2,(b.canvasWidth/2-4)/b.totalAssets*b.assetsLoaded,16),b.checkLoadComplete()},c.src=a.file},a.prototype.checkLoadComplete=function(){this.assetsLoaded==this.totalAssets&&this.loadedCallback()},a.prototype.onReady=function(a){this.loadedCallback=a},a.prototype.getImg=function(a){return this.oAssetData[a].img},a.prototype.getData=function(a){return this.oAssetData[a]},a}();a.AssetLoader=b}(Utils||(Utils={}));var Utils;!function(a){var b=function(){function a(a,b,c,d){this.x=0,this.y=0,this.rotation=0,this.radius=10,this.removeMe=!1,this.frameInc=0,this.animType="loop",this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1,this.oImgData=a,this.oAnims=this.oImgData.oData.oAnims,this.fps=b,this.radius=c,this.animId=d}return a.prototype.updateAnimation=function(a){this.frameInc+=this.fps*a},a.prototype.resetAnim=function(){this.frameInc=0},a.prototype.setFrame=function(a){this.fixedFrame=a},a.prototype.setAnimType=function(a,b,c){switch("undefined"==typeof c&&(c=!0),this.animId=b,this.animType=a,c&&this.resetAnim(),a){case"loop":break;case"once":this.maxIdx=this.oAnims[this.animId].length-1}},a.prototype.render=function(a){if(null!=this.animId){var b=this.oAnims[this.animId].length,c=Math.floor(this.frameInc),d=this.oAnims[this.animId][c%b],e=d*this.oImgData.oData.spriteWidth%this.oImgData.img.width,f=Math.floor(d/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;if("once"==this.animType&&c>this.maxIdx){this.fixedFrame=this.oAnims[this.animId][b-1],this.animId=null,this.animEndedFunc();var e=this.fixedFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,f=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight}}else var e=this.fixedFrame*this.oImgData.oData.spriteWidth%this.oImgData.img.width,f=Math.floor(this.fixedFrame/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;a.drawImage(this.oImgData.img,e,f,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,-this.oImgData.oData.spriteWidth/2+this.offsetX,-this.oImgData.oData.spriteHeight/2+this.offsetY,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight)},a}();a.AnimSprite=b}(Utils||(Utils={}));var Utils;!function(a){var b=function(){function a(a,b){this.x=0,this.y=0,this.rotation=0,this.radius=10,this.removeMe=!1,this.oImgData=a,this.radius=b}return a.prototype.setFrame=function(a){this.frameNum=a},a.prototype.render=function(a){var b=this.frameNum*this.oImgData.oData.spriteWidth%this.oImgData.img.width,c=Math.floor(this.frameNum/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;a.drawImage(this.oImgData.img,b,c,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,-this.oImgData.oData.spriteWidth/2,-this.oImgData.oData.spriteHeight/2,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight)},a}();a.BasicSprite=b}(Utils||(Utils={}));var Utils;!function(a){var b=function(){function a(a,b){var c=this;this.canvasX=0,this.canvasY=0,this.canvasScaleX=1,this.canvasScaleY=1,this.prevHitTime=0,this.pauseIsOn=!1,this.isDown=!1,this.isDetectingKeys=!1,this.isBugBrowser=b,a.addEventListener("touchstart",function(a){for(var b=0;b<a.changedTouches.length;b++)c.hitDown(a,a.changedTouches[b].pageX,a.changedTouches[b].pageY,a.changedTouches[b].identifier)},!1),a.addEventListener("touchend",function(a){for(var b=0;b<a.changedTouches.length;b++)c.hitUp(a,a.changedTouches[b].pageX,a.changedTouches[b].pageY,a.changedTouches[b].identifier)},!1),a.addEventListener("touchmove",function(a){for(var b=0;b<c.aHitAreas.length;b++)c.move(a,a.changedTouches[b].pageX,a.changedTouches[b].pageY,a.changedTouches[b].identifier,!0)},!1),a.addEventListener("mousedown",function(a){c.isDown=!0,c.hitDown(a,a.pageX,a.pageY,1)},!1),a.addEventListener("mouseup",function(a){c.isDown=!1,c.hitUp(a,a.pageX,a.pageY,1)},!1),a.addEventListener("mousemove",function(a){c.move(a,a.pageX,a.pageY,1,c.isDown)},!1),this.aHitAreas=new Array,this.aKeys=new Array}return a.prototype.setCanvas=function(a,b,c,d){this.canvasX=a,this.canvasY=b,this.canvasScaleX=c,this.canvasScaleY=d},a.prototype.hitDown=function(a,b,c,d){if(!this.pauseIsOn){var e=(new Date).getTime();if(!(e-this.prevHitTime<500&&isBugBrowser)){this.prevHitTime=e,a.preventDefault(),a.stopPropagation(),b=(b-this.canvasX)*this.canvasScaleX,c=(c-this.canvasY)*this.canvasScaleY;for(var f=0;f<this.aHitAreas.length;f++)if(this.aHitAreas[f].rect&&b>this.aHitAreas[f].area[0]&&c>this.aHitAreas[f].area[1]&&b<this.aHitAreas[f].area[2]&&c<this.aHitAreas[f].area[3]){this.aHitAreas[f].aTouchIdentifiers.push(d),this.aHitAreas[f].oData.isDown||(this.aHitAreas[f].oData.isDown=!0,this.aHitAreas[f].callback(this.aHitAreas[f].id,this.aHitAreas[f].oData));break}}}},a.prototype.hitUp=function(a,b,c,d){if(!this.pauseIsOn){a.preventDefault(),a.stopPropagation(),b=(b-this.canvasX)*this.canvasScaleX,c=(c-this.canvasY)*this.canvasScaleY;for(var e=0;e<this.aHitAreas.length;e++)if(this.aHitAreas[e].rect&&b>this.aHitAreas[e].area[0]&&c>this.aHitAreas[e].area[1]&&b<this.aHitAreas[e].area[2]&&c<this.aHitAreas[e].area[3]){for(var f=0;f<this.aHitAreas[e].aTouchIdentifiers.length;f++)this.aHitAreas[e].aTouchIdentifiers[f]==d&&(this.aHitAreas[e].aTouchIdentifiers.splice(f,1),f-=1);0==this.aHitAreas[e].aTouchIdentifiers.length&&(this.aHitAreas[e].oData.isDown=!1,this.aHitAreas[e].oData.multiTouch&&this.aHitAreas[e].callback(this.aHitAreas[e].id,this.aHitAreas[e].oData));break}}},a.prototype.move=function(a,b,c,d,e){if(!this.pauseIsOn&&e){b=(b-this.canvasX)*this.canvasScaleX,c=(c-this.canvasY)*this.canvasScaleY;for(var f=0;f<this.aHitAreas.length;f++)if(this.aHitAreas[f].rect)if(b>this.aHitAreas[f].area[0]&&c>this.aHitAreas[f].area[1]&&b<this.aHitAreas[f].area[2]&&c<this.aHitAreas[f].area[3])this.aHitAreas[f].aTouchIdentifiers.push(d),this.aHitAreas[f].oData.isDown||(this.aHitAreas[f].oData.isDown=!0,this.aHitAreas[f].oData.multiTouch&&this.aHitAreas[f].callback(this.aHitAreas[f].id,this.aHitAreas[f].oData));else if(this.aHitAreas[f].oData.isDown){for(var g=0;g<this.aHitAreas[f].aTouchIdentifiers.length;g++)this.aHitAreas[f].aTouchIdentifiers[g]==d&&(this.aHitAreas[f].aTouchIdentifiers.splice(g,1),g-=1);0==this.aHitAreas[f].aTouchIdentifiers.length&&(this.aHitAreas[f].oData.isDown=!1,this.aHitAreas[f].oData.multiTouch&&this.aHitAreas[f].callback(this.aHitAreas[f].id,this.aHitAreas[f].oData))}}},a.prototype.keyDown=function(a){for(var b=0;b<this.aKeys.length;b++)a.keyCode==this.aKeys[b].keyCode&&(a.preventDefault(),a.stopPropagation(),this.aKeys[b].oData.isDown=!0,this.aKeys[b].callback(this.aKeys[b].id,this.aKeys[b].oData))},a.prototype.keyPress=function(a){for(var b=0;b<this.aKeys.length;b++)a.keyCode==this.aKeys[b].keyCode&&(a.preventDefault(),a.stopPropagation())},a.prototype.keyUp=function(a){for(var b=0;b<this.aKeys.length;b++)a.keyCode==this.aKeys[b].keyCode&&(a.preventDefault(),a.stopPropagation(),this.aKeys[b].oData.isDown=!1,this.aKeys[b].callback(this.aKeys[b].id,this.aKeys[b].oData))},a.prototype.addKey=function(a,b,c,d){var e=this;this.isDetectingKeys||(window.addEventListener("keydown",function(a){e.keyDown(a)},!1),window.addEventListener("keypress",function(a){e.keyPress(a)},!1),window.addEventListener("keyup",function(a){e.keyUp(a)},!1),this.isDetectingKeys=!0),null==c&&(c=new Object),this.aKeys.push({id:a,callback:b,oData:c,keyCode:d})},a.prototype.removeKey=function(a){for(var b=0;b<this.aKeys.length;b++)this.aKeys[b].id==a&&(this.aKeys.splice(b,1),b-=1)},a.prototype.addHitArea=function(a,b,c,d,e){"undefined"==typeof e&&(e=!1),null==c&&(c=new Object),e&&this.removeHitArea(a);var f=new Array;switch(d.type){case"image":d.oImageData.isSpriteSheet?this.aHitAreas.push({id:a,aTouchIdentifiers:f,callback:b,oData:c,rect:!0,area:[d.aCentrePos[0]-d.oImageData.oData.spriteHeight/2,d.aCentrePos[1]-d.oImageData.oData.spriteHeight/2,d.aCentrePos[0]+d.oImageData.oData.spriteWidth/2,d.aCentrePos[1]+d.oImageData.oData.spriteHeight/2]}):this.aHitAreas.push({id:a,aTouchIdentifiers:f,callback:b,oData:c,rect:!0,area:[d.aCentrePos[0]-d.oImageData.img.width/2,d.aCentrePos[1]-d.oImageData.img.height/2,d.aCentrePos[0]+d.oImageData.img.width/2,d.aCentrePos[1]+d.oImageData.img.height/2]});break;case"rect":this.aHitAreas.push({id:a,aTouchIdentifiers:f,callback:b,oData:c,rect:!0,area:d.aRect})}},a.prototype.removeHitArea=function(a){for(var b=0;b<this.aHitAreas.length;b++)this.aHitAreas[b].id==a&&(this.aHitAreas.splice(b,1),b-=1)},a}();a.UserInput=b}(Utils||(Utils={}));var Utils;!function(a){var b=function(){function a(a){this.updateFreq=10,this.updateInc=0,this.frameAverage=0,this.display=1,this.log="",this.render=function(a){this.frameAverage+=this.delta/this.updateFreq,++this.updateInc>=this.updateFreq&&(this.updateInc=0,this.display=this.frameAverage,this.frameAverage=0),a.textAlign="left",ctx.font="10px Helvetica",a.fillStyle="#333333",a.beginPath(),a.rect(0,this.canvasHeight-15,40,15),a.closePath(),a.fill(),a.fillStyle="#ffffff",a.fillText(Math.round(1e3/(1e3*this.display))+" fps "+this.log,5,this.canvasHeight-5)},this.canvasHeight=a}return a.prototype.update=function(a){this.delta=a},a}();a.FpsMeter=b}(Utils||(Utils={}));var Elements;!function(a){var b=function(){function a(a,b,c){this.offsetX=0,this.offsetY=0,this.oImgData=a,this.canvasWidth=b,this.canvasHeight=c}return a.prototype.update=function(a,b,c){this.offsetX+=b*a,this.offsetY+=c*a},a.prototype.render=function(a){var b=this.offsetX%this.canvasWidth,c=this.offsetY%this.canvasHeight;0>b&&(b+=this.canvasWidth),0>c&&(c+=this.canvasHeight),a.drawImage(this.oImgData.img,b,c,this.canvasWidth,this.canvasHeight,0,0,this.canvasWidth,this.canvasHeight)},a}();a.Background=b}(Elements||(Elements={}));var Elements;!function(a){var b=function(){function a(a,b,c,d,e){this.incY=0,this.score=0,this.highestScore=0,this.posY=0,this.bgX=0,this.bgY=0,this.atmosX=0,this.atmosY=0,this.oScreens=a,this.oButs=b,this.oTitleImgData=c,this.canvasWidth=d,this.canvasHeight=e,this.posY=-this.canvasHeight}return a.prototype.setRenderFunc=function(a){switch(this.posY=-this.canvasHeight,a){case"start":this.renderFunc=this.renderStartScreen,TweenLite.to(this,.5,{posY:0});break;case"help":break;case"end":}},a.prototype.render=function(a,b){this.renderFunc(a,b)},a.prototype.renderStartScreen=function(a,b){this.incY+=5*b,this.bgY-=50*b,this.bgX-=50*Math.sin(this.incY/10)*b;
var c=this.bgX%this.canvasWidth,d=this.bgY%this.canvasHeight;0>c&&(c+=this.canvasWidth),0>d&&(d+=this.canvasHeight),a.drawImage(this.oScreens.startImageData.img,c,d,this.canvasWidth,this.canvasHeight,0,0,this.canvasWidth,this.canvasHeight),this.atmosY-=65*b,this.atmosX-=1.3*50*Math.sin(this.incY/10)*b;var e=this.atmosX%this.canvasWidth,f=this.atmosY%this.canvasHeight;0>e&&(e+=this.canvasWidth),0>f&&(f+=this.canvasHeight),a.drawImage(this.oScreens.atmosImageData.img,e,f,this.canvasWidth,this.canvasHeight,0,0,this.canvasWidth,this.canvasHeight),a.drawImage(this.oTitleImgData.img,15+this.posY,30),a.drawImage(this.oButs.play.imageData.img,this.oButs.play.pos[0]-this.oButs.play.imageData.img.width/2,this.oButs.play.pos[1]-this.oButs.play.imageData.img.height/2-5*Math.sin(this.incY)-this.posY)},a}();a.Screens=b}(Elements||(Elements={}));var Elements;!function(a){var b=function(){function a(a,b,c){this.inc=0,this.oSplashScreenImgData=a,this.canvasWidth=b,this.canvasHeight=c,this.posY=-this.canvasHeight,TweenLite.to(this,.5,{posY:0})}return a.prototype.render=function(a,b){this.inc+=5*b,a.drawImage(this.oSplashScreenImgData.img,0,0-this.posY)},a}();a.Splash=b}(Elements||(Elements={}));var Elements;!function(a){var b=function(){function a(a,b,c,d,e,f){this.timer=.3,this.endTime=0,this.numberSpace=15,this.oPanelsImgData=a,this.oLevelUpImgData=b,this.oNumbersImgData=c,this.aLevelUps=d,this.canvasWidth=e,this.canvasHeight=f}return a.prototype.update=function(){},a.prototype.startTween=function(){this.posY=320,TweenLite.to(this,.8,{posY:0,ease:"Back.easeOut"})},a.prototype.renderPanel=function(a,b,c){switch("undefined"==typeof c&&(c=0),b){case"powerUps":var d=6;this.oScoreData.fruitNum<10&&(d=7);var e=d*this.oPanelsImgData.oData.spriteWidth%this.oPanelsImgData.img.width,f=Math.floor(d/(this.oPanelsImgData.img.width/this.oPanelsImgData.oData.spriteWidth))*this.oPanelsImgData.oData.spriteHeight;a.drawImage(this.oPanelsImgData.img,e,f,this.oPanelsImgData.oData.spriteWidth,this.oPanelsImgData.oData.spriteHeight,0,0+this.posY,this.oPanelsImgData.oData.spriteWidth,this.oPanelsImgData.oData.spriteHeight);for(var g=this.oScoreData.fruitNum,h=0;h<g.toString().length;h++){d=parseFloat(g.toString().charAt(h));var e=d*this.oNumbersImgData.oData.spriteWidth%this.oNumbersImgData.img.width,f=Math.floor(d/(this.oNumbersImgData.img.width/this.oNumbersImgData.oData.spriteWidth))*this.oNumbersImgData.oData.spriteHeight;a.drawImage(this.oNumbersImgData.img,e,f,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight,204+h*this.numberSpace,107+this.posY,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight)}for(var h=0;3>h;h++){d=this.aLevelUps[h]-1;var e=d*this.oLevelUpImgData.oData.spriteWidth%this.oLevelUpImgData.img.width,f=Math.floor(d/(this.oLevelUpImgData.img.width/this.oLevelUpImgData.oData.spriteWidth))*this.oLevelUpImgData.oData.spriteHeight;a.drawImage(this.oLevelUpImgData.img,e,f,this.oLevelUpImgData.oData.spriteWidth,this.oLevelUpImgData.oData.spriteHeight,93,138+57*h+this.posY,this.oLevelUpImgData.oData.spriteWidth,this.oLevelUpImgData.oData.spriteHeight)}break;case"levelComplete":var d=0,e=d*this.oPanelsImgData.oData.spriteWidth%this.oPanelsImgData.img.width,f=Math.floor(d/(this.oPanelsImgData.img.width/this.oPanelsImgData.oData.spriteWidth))*this.oPanelsImgData.oData.spriteHeight;a.drawImage(this.oPanelsImgData.img,e,f,this.oPanelsImgData.oData.spriteWidth,this.oPanelsImgData.oData.spriteHeight,0,0+this.posY,this.oPanelsImgData.oData.spriteWidth,this.oPanelsImgData.oData.spriteHeight);for(var g=this.oScoreData.fruitScore,h=0;h<g.toString().length;h++){d=parseFloat(g.toString().charAt(h));var e=d*this.oNumbersImgData.oData.spriteWidth%this.oNumbersImgData.img.width,f=Math.floor(d/(this.oNumbersImgData.img.width/this.oNumbersImgData.oData.spriteWidth))*this.oNumbersImgData.oData.spriteHeight;a.drawImage(this.oNumbersImgData.img,e,f,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight,174+h*this.numberSpace,153+this.posY,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight)}for(var g=this.oScoreData.levelScore,h=0;h<g.toString().length;h++){d=parseFloat(g.toString().charAt(h));var e=d*this.oNumbersImgData.oData.spriteWidth%this.oNumbersImgData.img.width,f=Math.floor(d/(this.oNumbersImgData.img.width/this.oNumbersImgData.oData.spriteWidth))*this.oNumbersImgData.oData.spriteHeight;a.drawImage(this.oNumbersImgData.img,e,f,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight,174+h*this.numberSpace,182+this.posY,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight)}for(var g=this.oScoreData.totalScore,h=0;h<g.toString().length;h++){d=parseFloat(g.toString().charAt(h));var e=d*this.oNumbersImgData.oData.spriteWidth%this.oNumbersImgData.img.width,f=Math.floor(d/(this.oNumbersImgData.img.width/this.oNumbersImgData.oData.spriteWidth))*this.oNumbersImgData.oData.spriteHeight;a.drawImage(this.oNumbersImgData.img,e,f,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight,174+h*this.numberSpace,238+this.posY,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight)}break;case"gameEndFail":var d=1+c,e=d*this.oPanelsImgData.oData.spriteWidth%this.oPanelsImgData.img.width,f=Math.floor(d/(this.oPanelsImgData.img.width/this.oPanelsImgData.oData.spriteWidth))*this.oPanelsImgData.oData.spriteHeight;a.drawImage(this.oPanelsImgData.img,e,f,this.oPanelsImgData.oData.spriteWidth,this.oPanelsImgData.oData.spriteHeight,0,0+this.posY,this.oPanelsImgData.oData.spriteWidth,this.oPanelsImgData.oData.spriteHeight);for(var g=this.oScoreData.totalScore,h=0;h<g.toString().length;h++){d=parseFloat(g.toString().charAt(h));var e=d*this.oNumbersImgData.oData.spriteWidth%this.oNumbersImgData.img.width,f=Math.floor(d/(this.oNumbersImgData.img.width/this.oNumbersImgData.oData.spriteWidth))*this.oNumbersImgData.oData.spriteHeight;a.drawImage(this.oNumbersImgData.img,e,f,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight,174+h*this.numberSpace,245+this.posY,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight)}break;case"tutorial":var d=4+c,e=d*this.oPanelsImgData.oData.spriteWidth%this.oPanelsImgData.img.width,f=Math.floor(d/(this.oPanelsImgData.img.width/this.oPanelsImgData.oData.spriteWidth))*this.oPanelsImgData.oData.spriteHeight;a.drawImage(this.oPanelsImgData.img,e,f,this.oPanelsImgData.oData.spriteWidth,this.oPanelsImgData.oData.spriteHeight,0,0+this.posY,this.oPanelsImgData.oData.spriteWidth,this.oPanelsImgData.oData.spriteHeight);break;case"pause":var d=3,e=d*this.oPanelsImgData.oData.spriteWidth%this.oPanelsImgData.img.width,f=Math.floor(d/(this.oPanelsImgData.img.width/this.oPanelsImgData.oData.spriteWidth))*this.oPanelsImgData.oData.spriteHeight;a.drawImage(this.oPanelsImgData.img,e,f,this.oPanelsImgData.oData.spriteWidth,this.oPanelsImgData.oData.spriteHeight,0,0,this.oPanelsImgData.oData.spriteWidth,this.oPanelsImgData.oData.spriteHeight)}},a}();a.Panel=b}(Elements||(Elements={}));var Elements;!function(a){var b=function(){function a(a,b,c,d,e,f,g,h){this.score=0,this.numberSpace=15,this.isOutro=!1,this.fruitScore=0,this.oHudImgData=a,this.oOverlayImgData=b,this.oMarkerImgData=c,this.oNumbersImgData=d,this.levelNum=g+1,this.levelDist=h,this.canvasWidth=e,this.canvasHeight=f}return a.prototype.updateScore=function(a,b){this.fruitScore=a,this.score=b},a.prototype.render=function(a,b){a.drawImage(this.oHudImgData.img,0,0);for(var c=0;c<this.levelNum.toString().length;c++){var d=parseFloat(this.levelNum.toString().charAt(c)),e=d*this.oNumbersImgData.oData.spriteWidth%this.oNumbersImgData.img.width,f=Math.floor(d/(this.oNumbersImgData.img.width/this.oNumbersImgData.oData.spriteWidth))*this.oNumbersImgData.oData.spriteHeight;a.drawImage(this.oNumbersImgData.img,e,f,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight,51+c*this.numberSpace,6,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight)}for(var c=0;c<this.fruitScore.toString().length;c++){var d=parseFloat(this.fruitScore.toString().charAt(c)),e=d*this.oNumbersImgData.oData.spriteWidth%this.oNumbersImgData.img.width,f=Math.floor(d/(this.oNumbersImgData.img.width/this.oNumbersImgData.oData.spriteWidth))*this.oNumbersImgData.oData.spriteHeight;a.drawImage(this.oNumbersImgData.img,e,f,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight,51+c*this.numberSpace,40,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight)}for(var c=0;c<this.score.toString().length;c++){var d=parseFloat(this.score.toString().charAt(c)),e=d*this.oNumbersImgData.oData.spriteWidth%this.oNumbersImgData.img.width,f=Math.floor(d/(this.oNumbersImgData.img.width/this.oNumbersImgData.oData.spriteWidth))*this.oNumbersImgData.oData.spriteHeight;a.drawImage(this.oNumbersImgData.img,e,f,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight,this.canvasWidth/2+c*this.numberSpace-this.numberSpace*this.score.toString().length/2,6,this.oNumbersImgData.oData.spriteWidth,this.oNumbersImgData.oData.spriteHeight)}a.drawImage(this.oMarkerImgData.img,296,55+120/this.levelDist*b)},a}();a.Hud=b}(Elements||(Elements={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c},Elements;!function(a){var b=function(a){function b(b,c,d,e,f,g){a.call(this,b,15,15,"running"),this.speedX=0,this.targSpeedX=0,this.speedY=0,this.targSpeedY=0,this.rightPull=0,this.leftPull=0,this.dir="right",this.canvasWidth=c,this.canvasHeight=d,this.callback=e,this.levelNum=f,this.aLevelUps=g,this.speedY=Math.min(180+10*this.levelNum,300),this.offsetY=-30,this.turnRate=4+.6*(this.aLevelUps[2]-1),this.changeState("running")}return __extends(b,a),b.prototype.isEnemyDashable=function(a){return"dashing"==this.state?"right"==this.dir?a>0?!0:!1:"left"==this.dir?a>0?!1:!0:!1:!1},b.prototype.changeState=function(a){switch(a){case"running":this.state="running",this.targSpeedY=Math.min(180+10*this.levelNum,300),this.setAnimType("loop","running"),this.updateFunc=this.running;break;case"afterDashRunning":this.state="running",this.targSpeedY=Math.min(180+10*this.levelNum,300),this.targSpeedX*=.5,this.setAnimType("loop","running"),this.updateFunc=this.running;break;case"dashing":"running"==this.state&&(playSound("dash"),this.state="dashing","right"==this.dir?this.targSpeedX=300+20*(this.aLevelUps[1]-1):"left"==this.dir&&(this.targSpeedX=-300-20*(this.aLevelUps[1]-1)),this.timerInc=0,this.updateFunc=this.dashing);break;case"jumping":"running"==this.state&&(playSound("jump"),this.state="jumping",this.animEndedFunc=function(){this.changeState("running")},this.setAnimType("once","jumping"),this.speedY=500+50*(this.aLevelUps[0]-1),this.targSpeedY=120,this.updateFunc=this.jumping);break;case"outro":this.state="outro",this.targSpeedX=0,this.speedY=-150,this.targSpeedY=-300,this.setAnimType("loop","running"),this.updateFunc=this.outro}},b.prototype.update=function(b,c,d){a.prototype.updateAnimation.call(this,d),this.updateFunc(d),this.targSpeedX>0?this.dir="right":this.targSpeedX<0&&(this.dir="left"),this.x+=(this.speedX+b)*d,this.y+=(this.speedY+c)*d,this.rotation=this.speedX/900},b.prototype.dashing=function(a){this.timerInc+=a,this.timerInc>=.22&&this.changeState("afterDashRunning"),this.speedX=this.targSpeedX,this.speedY+=5*(this.targSpeedY-this.speedY)*a},b.prototype.running=function(a){this.targSpeedX=(this.rightPull+this.leftPull)*(1+(this.aLevelUps[2]-1)/30),this.speedX+=(this.targSpeedX-this.speedX)*this.turnRate*a,this.speedY+=(this.targSpeedY-this.speedY)*this.turnRate*a},b.prototype.outro=function(a){this.targSpeedX=this.rightPull+this.leftPull,this.speedX+=(this.targSpeedX-this.speedX)*this.turnRate*a,this.speedY+=(this.targSpeedY-this.speedY)*this.turnRate*a,this.y<-100&&this.callback()},b.prototype.jumping=function(a){this.targSpeedX=this.rightPull+this.leftPull,this.speedX+=1*(this.targSpeedX-this.speedX)*a,this.speedY+=5*(this.targSpeedY-this.speedY)*a},b}(Utils.AnimSprite);a.Hero=b}(Elements||(Elements={}));var Elements;!function(a){var b=function(a){function b(b,c,d,e,f,g){a.call(this,b,d,20,"running"),this.speedX=0,this.speedY=0,this.canvasWidth=e,this.canvasHeight=f,this.type=c,this.changeState("running"),this.animEndedFunc=function(){},this.offsetY=-20,this.offsetX=30,this.x=g,this.x>this.canvasWidth/2?(this.speedX=1==this.type?-40:2==this.type?-80:-130,this.scaleX=-1):this.speedX=1==this.type?40:2==this.type?80:130}return __extends(b,a),b.prototype.changeState=function(a){switch(this.state=a,this.state){case"running":this.setAnimType("loop",this.state);break;case"bursting":this.fps=15,this.setAnimType("once",this.state),this.speedX=this.speedY=0}this.updateFunc=this[this.state]},b.prototype.update=function(b,c,d){a.prototype.updateAnimation.call(this,b),this.updateFunc(b),this.x+=(this.speedX+c)*b,this.y+=(this.speedY+d)*b,(this.x>2*this.canvasWidth||this.x<-this.canvasWidth||this.y>this.canvasHeight+150)&&(this.removeMe=!0)},b.prototype.running=function(){},b.prototype.bursting=function(){},b}(Utils.AnimSprite);a.Enemy=b}(Elements||(Elements={}));var Elements;!function(a){var b=function(){function a(a,b,c,d){this.removeMe=!1,this.oImgData=a,this.canvasWidth=b,this.canvasHeight=c,this.frameNum=d,this.x=Math.random()*this.canvasWidth}return a.prototype.update=function(a,b,c){this.x+=b*a,this.y+=c*a,this.y>this.canvasHeight+100&&(this.removeMe=!0)},a.prototype.checkHit=function(a){return this.frameNum<4?this.y<a.y+40&&this.y>a.y-40&&this.x<a.x+100&&this.x>a.x-100?1:0:this.y<a.y+40&&this.y>a.y-40&&this.x<a.x+50&&this.x>a.x-50?1:0},a.prototype.render=function(a){var b=this.frameNum*this.oImgData.oData.spriteWidth%this.oImgData.img.width,c=Math.floor(this.frameNum/(this.oImgData.img.width/this.oImgData.oData.spriteWidth))*this.oImgData.oData.spriteHeight;a.drawImage(this.oImgData.img,b,c,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight,this.x-this.oImgData.oData.spriteWidth/2,this.y-this.oImgData.oData.spriteHeight/2,this.oImgData.oData.spriteWidth,this.oImgData.oData.spriteHeight)},a}();a.Obstacle=b}(Elements||(Elements={}));var Elements;!function(a){var b=function(){function a(a,b,c){this.offsetX=0,this.offsetY=0,this.oImgData=a,this.canvasWidth=b,this.canvasHeight=c,this.speedY=-20}return a.prototype.update=function(a,b,c){this.offsetX+=1.3*b*a,this.offsetY+=(this.speedY+1.3*c)*a},a.prototype.render=function(a){var b=this.offsetX%this.canvasWidth,c=this.offsetY%this.canvasHeight;0>b&&(b+=this.canvasWidth),0>c&&(c+=this.canvasHeight),a.drawImage(this.oImgData.img,b,c,this.canvasWidth,this.canvasHeight,0,0,this.canvasWidth,this.canvasHeight)},a}();a.Atmos=b}(Elements||(Elements={}));var Elements;!function(a){var b=function(a){function b(b,c,d){a.call(this,b,15,15,"waiting"+Math.ceil(5*Math.random())),this.canHit=!0,this.canvasWidth=c,this.canvasHeight=d,this.animEndedFunc=this.burst}return __extends(b,a),b.prototype.update=function(b,c,d){a.prototype.updateAnimation.call(this,b),this.x+=c*b,this.y+=d*b,this.y>this.canvasHeight+100&&(this.removeMe=!0)},b.prototype.hit=function(){this.canHit=!1,this.setAnimType("once","bursting")},b.prototype.burst=function(){this.removeMe=!0},b}(Utils.AnimSprite);a.Fruit=b}(Elements||(Elements={}));var requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60,(new Date).getTime())}}(),previousTime,canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");canvas.width=320,canvas.height=460;var canvasX,canvasY,canvasScaleX,canvasScaleY,div=document.getElementById("viewporter"),sound,music,allowSound=!1,muted=!1,splash,splashTimer=0,screens,assetLib,preAssetLib,rotatePause=!1,manualPause=!1,isMobile=!1,gameState="loading",aLangs=new Array("EN"),curLang="",isBugBrowser=!1,isIE10=!1;navigator.userAgent.match(/MSIE\s([\d]+)/)&&(isIE10=!0);var deviceAgent=navigator.userAgent.toLowerCase();(deviceAgent.match(/(iphone|ipod|ipad)/)||deviceAgent.match(/(android)/)||deviceAgent.match(/(iemobile)/)||deviceAgent.match(/iphone/i)||deviceAgent.match(/ipad/i)||deviceAgent.match(/ipod/i)||deviceAgent.match(/blackberry/i)||deviceAgent.match(/bada/i))&&(isMobile=!0,deviceAgent.match(/(android)/)&&!/Chrome/.test(navigator.userAgent)&&(isBugBrowser=!0));var userInput=new Utils.UserInput(canvas,isBugBrowser);resizeCanvas(),window.onresize=function(){setTimeout(function(){resizeCanvas()},1)},document.addEventListener("visibilitychange",function(){document.hidden?Howler.mute():muted||Howler.unmute()},!1),window.addEventListener("load",function(){setTimeout(function(){resizeCanvas()},0),window.addEventListener("orientationchange",function(){resizeCanvas()},!1)}),isIE10||"undefined"==typeof window.AudioContext&&"undefined"==typeof window.webkitAudioContext&&-1!=navigator.userAgent.indexOf("Android")||(allowSound=!0,sound=new Howl({urls:["audio/sound.ogg","audio/sound.m4a"],sprite:{hitZombie:[0,1500],gameFail2:[2e3,1100],levelComplete:[3500,1500],gameFail1:[5500,1e3],dash:[7e3,750],jump:[8e3,750],click:[9e3,250],fruit:[9500,1100]}}),music=new Howl({urls:["audio/music.ogg","audio/music.m4a"],volume:.25,loop:!0}));var panel,hud,background,totalScore=0,levelScore=0,levelFruitScore=0,hero,trackX,trackY,aEnemies,aObstacles,aFruit,obstacleReleaseInc,obstacleFreq,atmos,levelNum=0,aTutorials=new Array({level:0,shown:!1,panelFrame:0},{level:1,shown:!1,panelFrame:1}),panelFrame,levelDist,fruitScore,lastZombieKill,bgType,atmosType,oObstacleTypes={bg1:[2,3,4,5,6],bg2:[0,1,6,7,8],bg3:[0,1,2,3,4,5,8]},aLevelUps;loadPreAssets();