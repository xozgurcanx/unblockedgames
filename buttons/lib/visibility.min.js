!function(i){"use strict";var t=-1,e={onVisible:function(i){var t=e.isSupported();if(!t||!e.hidden())return i(),t;var n=e.change(function(t,d){e.hidden()||(e.unbind(n),i())});return n},change:function(i){if(!e.isSupported())return!1;t+=1;var n=t;return e._callbacks[n]=i,e._listen(),n},unbind:function(i){delete e._callbacks[i]},afterPrerendering:function(i){var t=e.isSupported(),n="prerender";if(!t||n!=e.state())return i(),t;var d=e.change(function(t,r){n!=r&&(e.unbind(d),i())});return d},hidden:function(){return!(!e._doc.hidden&&!e._doc.webkitHidden)},state:function(){return e._doc.visibilityState||e._doc.webkitVisibilityState||"visible"},isSupported:function(){return!(!e._doc.visibilityState&&!e._doc.webkitVisibilityState)},_doc:document||{},_callbacks:{},_change:function(i){var t=e.state();for(var n in e._callbacks)e._callbacks[n].call(e._doc,i,t)},_listen:function(){if(!e._init){var i="visibilitychange";e._doc.webkitVisibilityState&&(i="webkit"+i);var t=function(){e._change.apply(e,arguments)};e._doc.addEventListener?e._doc.addEventListener(i,t):e._doc.attachEvent(i,t),e._init=!0}}};"undefined"!=typeof module&&module.exports?module.exports=e:i.Visibility=e}(this),function(i){"use strict";if(!i.visibilityState&&!i.webkitVisibilityState){i.hidden=!1,i.visibilityState="visible";var t=null,e=function(){i.createEvent?(t||(t=i.createEvent("HTMLEvents"),t.initEvent("visibilitychange",!0,!0)),i.dispatchEvent(t)):"object"==typeof Visibility&&Visibility._change.call(Visibility,{})},n=function(){i.hidden=!1,i.visibilityState="visible",e()},d=function(){i.hidden=!0,i.visibilityState="hidden",e()};i.addEventListener?(window.addEventListener("focus",n,!0),window.addEventListener("blur",d,!0)):(i.attachEvent("onfocusin",n),i.attachEvent("onfocusout",d))}}(document),function(i){"use strict";var t=-1,e=function(e){return e.every=function(i,n,d){e._time(),d||(d=n,n=null),t+=1;var r=t;return e._timers[r]={visible:i,hidden:n,callback:d},e._run(r,!1),e.isSupported()&&e._listen(),r},e.stop=function(i){return e._timers[i]?(e._stop(i),delete e._timers[i],!0):!1},e._timers={},e._time=function(){e._timed||(e._timed=!0,e._wasHidden=e.hidden(),e.change(function(){e._stopRun(),e._wasHidden=e.hidden()}))},e._run=function(t,n){var d,r=e._timers[t];if(e.hidden()){if(null===r.hidden)return;d=r.hidden}else d=r.visible;var a=function(){r.last=new Date,r.callback.call(i)};if(n){var s=new Date,c=s-r.last;d>c?r.delay=setTimeout(function(){a(),r.id=setInterval(a,d)},d-c):(a(),r.id=setInterval(a,d))}else r.id=setInterval(a,d)},e._stop=function(i){var t=e._timers[i];clearInterval(t.id),clearTimeout(t.delay),delete t.id,delete t.delay},e._stopRun=function(i){var t=e.hidden(),n=e._wasHidden;if(t&&!n||!t&&n)for(var d in e._timers)e._stop(d),e._run(d,!t)},e};"undefined"!=typeof module&&module.exports?module.exports=e(require("./visibility.core")):e(i.Visibility)}(window);