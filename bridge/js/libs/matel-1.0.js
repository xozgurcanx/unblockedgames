"undefined"==typeof matelmas_gameJQ&&"undefined"!=typeof jQuery&&(matelmas_gameJQ=$);var LocalizationManager=function(){"use strict";function e(){p=this;var e="$$$_localization_config_content_$$$";o(e,!0),a(),y=h+d}function o(e,o){p.configuration=null;var n=null;try{n=JSON.parse(e)}catch(a){if(o!==!0)return console.error("LocalizationManager.parseConfiguration: invalid JSON <"+e+">, original error message = "+a.message),!1}if(n){var t=n.availableLocales;if(null==t)return console.error('LocalizationManager.parseConfiguration: no mandatory parameter "availableLocales", exiting!'),!1;if("object"!=typeof t||"number"!=typeof t.length||t.length<1)return console.error('LocalizationManager.parseConfiguration: "availableLocales" parameter be an Array of Strings with at least one element, exiting!'),!1;var l;for(p.configuration={availableLocales:t,languageOnlyLocales:[],localesWithCountry:[],localizedImages:[],localizedSounds:[],localizedStyles:[],localizedJs:[]},l=0;l<t.length;++l)null===r&&(r=t[l]),t[l].indexOf(M)>0?p.configuration.localesWithCountry.push(t[l]):p.configuration.languageOnlyLocales.push(t[l]);var i=n.localizedImages;if("object"==typeof i&&"number"==typeof i.length)for(l=0;l<i.length;++l)p.configuration.localizedImages.push(i[l]);var c=n.localizedSounds;if("object"==typeof c&&"number"==typeof c.length)for(l=0;l<c.length;++l)p.configuration.localizedSounds.push(c[l]);var u=n.localizedStyles;if("object"==typeof u&&"number"==typeof u.length)for(l=0;l<u.length;++l)p.configuration.localizedStyles.push(u[l]);var g=n.localizedJs;if("object"==typeof g&&"number"==typeof g.length)for(l=0;l<g.length;++l)p.configuration.localizedJs.push(g[l]);return!0}return!1}function n(e){var o=L.length>0?L+"/":L;return o+h+x+"/"+e+S}function a(){"undefined"!=typeof matelmas_gameJQ&&(g=J,console.log("LocalizationManager.detectDefaultResourceLoader: jQuery has been detected"))}function t(e){console.log("LocalizationManager.loadConfiguration: loading config file <"+y+">"),u(y,function(n,a){n===!0?o(a)===!0&&e():console.error("LocalizationManager.loadConfiguration: unable to load config file <"+y+">, error = <"+a+">, exiting.")})}var l=null,i=null,r=null,c=null,u=null,g=null,f=!1,s=null,d="localization.json",y=null,p=null,L="",h="assets/",z="images",v="sounds",m="styles",b="js",x="texts",S=".txt",C="common",M="-",J=function(e,o){matelmas_gameJQ.ajax({url:e,async:!1,cache:!0,dataType:"text",success:function(e){o(!0,e)},error:function(e,n,a){o(!1,a)}})};return e.prototype.setResourceLoader=function(e){u=e},e.prototype.getResourceLoader=function(){return u},e.prototype.getAvailableLocales=function(){return p.configuration.availableLocales},e.prototype.getTargetLocale=function(){return i},e.prototype.getActualLocale=function(){return l},e.prototype.getDefaultLocale=function(){return r},e.prototype.init=function(e){if(f)return void console.error("LocalizationManager.init: LocalizationManager can be initialized only once, exiting.");if((null==e||"object"!=typeof e)&&(e={}),(null!=e.gameURL||"string"==typeof e.gameURL)&&(L=e.gameURL),(null==e.locale||"string"!=typeof e.locale)&&(e.locale=window.navigator.userLanguage||window.navigator.language),null!=e.localeChangedCallback&&"function"==typeof e.localeChangedCallback&&(c=e.localeChangedCallback),null!=e.resourceLoader&&"function"==typeof e.resourceLoader)u=e.resourceLoader;else{if(null==g)return void console.error("LocalizationManager.init: no resourceLoader is available, exiting. Please include jQuery or PreloadJS or set another loader function in the options");u=g}var o=function(){p.setLocale(e.locale),f=!0};null!=e.configFileURL&&"string"==typeof e.configFileURL?(y=e.configFileURL,t(o)):null==p.configuration?t(o):o()},e.prototype.setLocale=function(e){(null==e||"string"!=typeof e)&&console.log("LocalizationManager.setLocale: trying to set incorrect locale <"+e+">"),l=null,i=e;var o,a=e.indexOf(M)>0;if(a===!0){for(o=0;o<p.configuration.localesWithCountry.length;++o)if(p.configuration.localesWithCountry[o]===i){l=i;break}if(null===l)for(o=0;o<p.configuration.languageOnlyLocales.length;++o)if(0===i.indexOf(p.configuration.languageOnlyLocales[o])){l=p.configuration.languageOnlyLocales[o];break}}else{for(o=0;o<p.configuration.languageOnlyLocales.length;++o)if(i===p.configuration.languageOnlyLocales[o]){l=i;break}if(null===l)for(o=0;o<p.configuration.localesWithCountry.length;++o)if(0===p.configuration.localesWithCountry[o].indexOf(i)){l=p.configuration.localesWithCountry[o];break}}null===l&&(l=r,console.log("LocalizationManager.setLocale: unable to set target locale <"+i+">, because there are no such localized resources!"),console.log("LocalizationManager.setLocale: setting default locale <"+l+">")),s={};var t=n(l);u(t,function(e,o){if(e===!0){for(var n,a,l,i,r=o.split("\n"),u=0;u<r.length;++u)if(l=r[u].trim(),0!==l.indexOf(";")){if(i=l.indexOf("="),0===i){console.error("LocalizationManager.setLocale: no key, invalid localized text line <"+l+">");continue}-1!==i&&(n=l.substr(0,i).trim(),i-1<l.length?a=l.substr(i+1,l.length-i).trim():(a="",console.log("LocalizationManager.setLocale: empty value, possibly invalid localized text line <"+l+">")),s[n]=a)}}else console.error("LocalizationManager.setLocale: can not load localized texts file <"+t+">, exiting.");null!==c&&c(e)})},e.prototype.getLocalizedImageBasePath=function(){var e=L.length>0?L+"/":L;return e+h+z+"/"+l+"/"},e.prototype.getLocalizedImageName=function(e){var o=p.getLocalizedImageBasePath(e);return o+e},e.prototype.getLocalizedSoundBasePath=function(e){for(var o=0;o<p.configuration.localizedSounds.length;++o)if(e===p.configuration.localizedSounds[o]){var n=L.length>0?L+"/":L;return n+h+v+"/"+l+"/"}var n=L.length>0?L+"/":L;return n+h+v+"/"+C+"/"},e.prototype.getLocalizedSoundName=function(e){var o=p.getLocalizedSoundBasePath(e);return o+e},e.prototype.getLocalizedStyleBasePath=function(e){for(var o=0;o<p.configuration.localizedStyles.length;++o)if(e===p.configuration.localizedStyles[o]){var n=L.length>0?L+"/":L;return n+h+m+"/"+l+"/"}var n=L.length>0?L+"/":L;return n+h+m+"/"+C+"/"},e.prototype.getLocalizedStyleName=function(e){var o=p.getLocalizedStyleBasePath(e);return o+e},e.prototype.getLocalizedJsBasePath=function(e){for(var o=0;o<p.configuration.localizedJs.length;++o)if(e===p.configuration.localizedJs[o]){var n=L.length>0?L+"/":L;return n+h+b+"/"+l+"/"}var n=L.length>0?L+"/":L;return n+h+b+"/"+C+"/"},e.prototype.getLocalizedJsName=function(e){var o=p.getLocalizedJsBasePath(e);return o+e},e.prototype.getText=function(e){var o=s[e];return"string"==typeof o?o:e},new e}();