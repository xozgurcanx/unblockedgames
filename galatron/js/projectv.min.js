define("thor/core/Validation",["require","exports","module"],function(e,t,i){function n(e){var t="[^\\x00-\\x20\\x22\\x28\\x29\\x2c\\x2e\\x3a-\\x3c\\x3e\\x40\\x5b-\\x5d\\x7f-\\xff]+",i="("+t+"|\\x5b([^\\x0d\\x5b-\\x5d\\x80-\\xff]|\\x5c[\\x00-\\x7f])*\\x5d)",r="("+t+"|\\x22([^\\x0d\\x22\\x5c\\x80-\\xff]|\\x5c[\\x00-\\x7f])*\\x22)",s=new RegExp("^"+r+"(\\x2e"+r+")*\\x40"+i+"(\\x2e"+i+")*"+"$");return(n=function(e){return s.test(e)})(e)}void 0===window.ASSERTIONS&&(window.ASSERTIONS=!0);i.exports={isValidEmail:function(e){return!("string"!=typeof e||!e)&&(!(e.length>254)&&n(e))},isObject:function(e){return!(!e||"object"!=typeof e||Array.isArray(e))},assertIsObject:function(e){if(ASSERTIONS&&!i.exports.isObject(e))throw new TypeError("expected Object, got "+typeof e+": "+e)},isNonEmptyObject:function(e){return i.exports.isObject(e)&&Object.keys(e).length>0},assertIsNonEmptyObject:function(e){if(ASSERTIONS&&!i.exports.isNonEmptyObject(e))throw new TypeError("expected non-empty Object, got "+typeof e+": "+e)},isFunction:function(e){return"function"==typeof e},assertIsFunction:function(e){if(ASSERTIONS&&!i.exports.isFunction(e))throw new TypeError("expected Function, got "+typeof e+": "+e)},isObjectOrNull:function(e){return"object"==typeof e&&!Array.isArray(e)},isString:function(e){return"string"==typeof e},assertIsString:function(e){if(ASSERTIONS&&!i.exports.isString(e))throw new TypeError("expected String, got "+typeof e+": "+e)},isNonEmptyString:function(e){return!(!e||"string"!=typeof e)},assertIsNonEmptyString:function(e){if(ASSERTIONS&&!i.exports.isNonEmptyString(e))throw new TypeError("expected non empty String, got "+typeof e+": "+e)},isNumber:function(e){return"number"==typeof e&&!isNaN(e)},assertIsNumber:function(e){if(ASSERTIONS&&!i.exports.isNumber(e))throw new TypeError("expected Number, got "+typeof e+": "+e)},isInteger:function(e){return i.exports.isNumber(e)&&e===e|0},assertIsInteger:function(e){if(!i.exports.isInteger(e))throw new TypeError("expected Integer, got "+typeof e+": "+e)},isDefined:function(e){return void 0!==e},isUndefined:function(e){return void 0===e},assertIsDefined:function(e){if(ASSERTIONS&&i.exports.isUndefined(e))throw new TypeError("expected value to be defined: "+e)},assertIsUndefined:function(e){if(ASSERTIONS&&!i.exports.isUndefined(e))throw new TypeError("expected value to be undefined, got "(typeof e)+": "+e)},isBoolean:function(e){return"boolean"==typeof e},assertIsBoolean:function(e){if(ASSERTIONS&&!i.exports.isBoolean(e))throw new TypeError("expected Boolean, got "+typeof e+": "+e)},isArray:function(e){return Array.isArray(e)},assertIsArray:function(e){if(ASSERTIONS&&!i.exports.isArray(e))throw new TypeError("expected Array, got "+typeof e+": "+e)},isNonEmptyArray:function(e){return Array.isArray(e)&&e.length>0},assertIsNonEmptyArray:function(e){if(ASSERTIONS&&!i.exports.isNonEmptyArray(e))throw new TypeError("expected non empty Array, got "+typeof e+": "+e)},isInstanceOf:function(e,t){return e&&e instanceof t},isInEnum:function(e,t){return i.exports.isNumber(e)&&null!==t.nameFromValue(e)},isEnumField:function(e,t){return t.getFields().indexOf(e)!==-1},assertIsInEnum:function(e,t){if(!i.exports.isInEnum(e,t))throw new TypeError("expected "+t.getName()+" does not contain a key for value "+e)},assertIsEnumField:function(e,t){if(!i.exports.isEnumField(e,t))throw new TypeError("expected "+t.getName()+" does not contain the field "+e)},isFileTypeOf:function(e,t){return!!i.exports.isNonEmptyString(t)&&(!!i.exports.isInstanceOf(e,File)&&e.type===t)},assertIsInstanceOf:function(e,t){if(i.exports.assertIsFunction(t),ASSERTIONS&&!i.exports.isInstanceOf(e,t))throw new TypeError("expected "+t.name+", got "+typeof e+": "+e)},assertIsFileTypeOf:function(e,t){if(ASSERTIONS&&!i.exports.isFileTypeOf(e,t))throw new TypeError("Expected file of type "+t+", got "+e.type)},conformsTo:function(e,t){if(!i.exports.isObject(e))return!1;if(!i.exports.isObject(t))return!1;for(var n in t)if(i.exports.isFunction(t[n])&&!i.exports.isFunction(e[n]))return!1;return!0},assertConformsTo:function(e,t){if(!i.exports.conformsTo(e,t))throw new TypeError("Expected conformation to "+Object.keys(t).join(", "))},isValueInEnum:function(e,t){if(!i.exports.isObject(t))return!1;for(var n in t)if(e===t[n])return!0;return!1},assertValueInEnum:function(e,t){if(ASSERTIONS&&!i.exports.isValueInEnum(e,t))throw new TypeError("expected value in enum "+Object.keys(t).join(", "))},isArrayOfInstances:function(e,t){if(!i.exports.isArray(e))return!1;for(var n=e.length,r=0;r<n;++r)if(!i.exports.isInstanceOf(e[r],t))return!1;return!0},assertIsArrayOfInstances:function(e,t){if(ASSERTIONS&&!i.exports.isArrayOfInstances(e,t))throw new TypeError("Expected array to only contain instances of ",t)}};var r=Object.keys(i.exports),s={};r.forEach(function(e){if(0===e.indexOf("assert")){var t=i.exports[e];s[e]=function(e){return!i.exports.isUndefined(e)&&null!==e&&t.apply(i.exports,arguments)}}}),i.exports.ifDefined=s;var o=[];i.exports.generate=function(e,t){i.exports.assertIsFunction(e),i.exports.assertIsDefined(t);for(var n=o.length,r=0;r<n;++r){var s=o[r];if(s.validator===e&&s.type===t)return s.generatedValidator}if(2!==e.length)throw new TypeError("Generated validators must have 2 arguments");var a=!1;for(var _ in i.exports){e===i.exports[_]&&(a=!0)}if(!a)throw new TypeError("Generated validators must be Validation properties");var l=function(i){return e(i,t)};return o.push({validator:e,type:t,generatedValidator:l}),l}}),define("thor/core/Class",["require","exports","module","./Validation"],function(e,t,i){var n=e("./Validation");i.exports={create:function(){var e=0,t=function(){};arguments.length>1&&n.isFunction(arguments[0])&&(t=arguments[0],e=1);var i=arguments[arguments.length-1],r=i.initialize,s=r;for(s.prototype=Object.create(t.prototype);e<arguments.length;++e){var o=arguments[e];for(var a in o){if("initialize"===a&&e!==arguments.length-1)throw new Error("Mixins cannot have a property named initialize.  Class name: "+r.name+" mixin index "+e);s.prototype[a]=o[a]}}return s}}}),define("thor/core/Logger",["require","exports","module","./Class","thor/config/Config"],function(e,t,i){var n=e("./Class"),r=e("thor/config/Config"),s=function(){},o={TRACE:1,DEBUG:2,LOG:3,WARN:4,ERROR:5},a={root:"DEBUG"};r.logging&&(a=r.logging);for(var _ in a){var l=a[_];o[l]?a[_]=o[l]:(console.warn("Unknown logging level "+l+" for "+_),a[_]=1/0)}i.exports=n.create({__moduleId:null,initialize:function(e,t){if("string"!=typeof e)throw new TypeError("Invalid moduleId "+e);if("number"!=typeof t)throw new TypeError("Invalid level "+t);this.__moduleId=e;for(var i in o){o[i]<t&&(this[i.toLowerCase()]=s)}window.kik&&window.kik.enabled&&(this.debug=this.log)},debug:function(){console.debug.apply(console,this.__formatArguments.apply(this,arguments))},trace:function(){this.debug.apply(this,arguments)},log:function(){console.log.apply(console,this.__formatArguments.apply(this,arguments))},warn:function(){console.warn.apply(console,this.__formatArguments.apply(this,arguments))},error:function(){console.error.apply(console,this.__formatArguments.apply(this,arguments))},__formatArguments:function(){var e=Array.prototype.slice.apply(arguments);return e[0]="["+this.__moduleId+"] "+e[0],e}}),i.exports.getLogger=function(e){if(!i||"string"!=typeof i.id)throw new TypeError("Module must be an object with a string id property");for(var t=e.id,n=a.root||o.ERROR,r=t.split("/"),s=r.length,_=r[0],l=1;l<s;++l)a[_]&&(n=a[_]),_+="/"+r[l];return a[_]&&(n=a[_]),new i.exports(t,n)}}),define("thor/util/FSM",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger"],function(e,t,i){function n(e,t){s.ifDefined.assertIsFunction(e),s.ifDefined.assertIsFunction(t),e&&(this.beforeTransition=e),t&&(this.onTransition=t)}var r=e("thor/core/Class"),s=e("thor/core/Validation"),o=(e("thor/core/Logger").getLogger(i),{}),a=r.create({initialize:function(){this._fsm=null},isCurrentState:function(){return this._fsm&&this._fsm.getCurrentStateInstance()===this},onEnter:function(){},onExit:function(){}}),_=r.create(a,{initialize:function(e,t){s.ifDefined.assertIsFunction(e),s.ifDefined.assertIsFunction(t),this.onEnter=e||this.onEnter,this.onExit=t||this.onExit}});i.exports=r.create({initialize:function(e,t){s.ifDefined.assertIsObject(t),t=t||o,s.ifDefined.assertIsBoolean(t.requireTransitions),this.__requireTransitions=t.requireTransitions||!0,this.__name=e,this.__isStarted=!1,this.__states={},this.__transitions={},this.__currentStateName=null,this.__startStateName=null,t.transitionLogger&&(this.__transitionLogger=t.transitionLogger)},start:function(){if(this.__isStarted)throw new Error("FSM::start; '"+this.__name+"' has already been started");this.reset()},reset:function(e){if(s.ifDefined.assertIsBoolean(e),!this.__startStateName)throw new Error("FSM::reset; '"+this.__name+"' has no start state");this.__isStarted=!0,this.__currentStateName&&(e?this.__currentStateName=null:this.__currentStateName!==this.__startStateName&&(this.__states[this.__currentStateName].onExit(),this.__currentStateName=null)),this.transitionTo(this.__startStateName)},addState:function(e,t){var i=null;if(s.isInstanceOf(t,a)?i=t:(t=t||o,s.ifDefined.assertIsFunction(t.onEnter),s.ifDefined.assertIsFunction(t.onExit),i=new _(t.onEnter,t.onExit)),this.__states[e])throw new Error("FSM::addState; '"+this.__name+"' state '"+e+"' already exists");i._fsm=this,this.__states[e]=i},hasState:function(e){return this.__states&&this.__states.hasOwnProperty(e)},setStartState:function(e){if(!this.__states[e])throw new Error("FSM::setStartState; '"+this.__name+"' doesn't contain the state '"+e+"'");this.__startStateName=e},__getTransitionName:function(e,t){return e.concat("_",t)},addTransition:function(e,t,i){s.ifDefined.assertIsObject(i),i=i||o,s.ifDefined.assertIsFunction(i.beforeTransition),s.ifDefined.assertIsFunction(i.onTransition);var r=i.beforeTransition||null,a=i.onTransition||null;if(!this.__states[e])throw new Error("FSM::addTransition; '"+this.__name+"' `from` argument must be a valid state name");if(!this.__states[t])throw new Error("FSM::addTransition; '"+this.__name+"' `to` argument must be a valid state name");var _=this.__getTransitionName(e,t);if(this.__transitions[_])throw new Error("FSM::addTransition; '"+this.__name+"' transition from '"+e+"' to '"+t+"' already exists");this.__transitions[_]=new n(r,a)},removeTransition:function(e,t){delete this.__transitions[this.__getTransitionName(e,t)]},removeState:function(e){delete this.__states[e]},transitionTo:function(e,t,i){if(s.ifDefined.assertIsObject(t),this.__transitionLogger&&this.__transitionLogger.debug("FSM "+this.__name+" "+this.__currentStateName+" -> "+e),!this.__isStarted)throw new Error("FSM::transitionTo; '"+this.__name+"' is not started");if(!this.__states[e])throw new Error("FSM::transitionTo; '"+this.__name+"' destination '"+e+"' is not a valid state");if(!this.__currentStateName)return this.__currentStateName=e,this.__states[e].onEnter(t),!0;var n=this.__getTransitionName(this.__currentStateName,e),r=this.__transitions[n];if(this.__currentStateName===e&&void 0===r)return!0;if(this.__requireTransitions&&void 0===r&&i!==!0)throw new Error("FSM::transitionTo; '"+this.__name+"' "+this.__currentStateName+" to "+e+" is not a valid transition");var o=this.__currentStateName;return void 0===r?(this.__currentStateName=e,this.__states[o].onExit(),this.__states[e].onEnter(t),!0):!(r.beforeTransition&&!r.beforeTransition())&&(this.__currentStateName=e,this.__states[o].onExit(),r.onTransition&&r.onTransition(),this.__states[e].onEnter(t),!0)},getCurrentState:function(){return this.__currentStateName},getCurrentStateInstance:function(){return this.__states[this.__currentStateName]}}),i.exports.State=a}),define("thor/compatibility/Promise",["require","exports","module","thor/core/Validation","thor/core/Class","thor/util/FSM","thor/config/Config"],function(e,t,i){function n(e){return new u(function(t,i){t(e)})}function r(e){return new u(function(t,i){i(e)})}function s(e){return new u(function(t,n){function r(){l++}function s(e){if(e&&(o=e),0===--l){if(o)return;t(_)}}var o,_=[],l=0;r(),e.forEach(function(e,t){a.isInstanceOf(e,u)||(e=i.exports.resolve(e)),r(),e.then(function(e){_[t]=e,s()},function(e){n(e),s(e)})}),s()})}function o(e){return new u(function(t,n){var r=function(e){t(e),s=function(){}},s=function(e){n(e),r=function(){}};e.forEach(function(e){a.isInstanceOf(e,u)||(e=i.exports.resolve(e)),e.then(r,s)})})}if(window.Promise)return void(i.exports=window.Promise);var a=e("thor/core/Validation"),_=e("thor/core/Class"),l=e("thor/util/FSM"),h=e("thor/config/Config"),u=_.create({__fsm:null,__value:null,__reason:null,__resolutionHandlers:null,initialize:function e(t){function i(t){if(r.__stuckTimerId&&clearTimeout(r.__stuckTimerId),t===r)throw new TypeError("Cannot resolve promise with itself (2.3.1)");if(a.isUndefined(t)||!a.isFunction(t)&&!a.isObject(t))return i=function(){},r.__value=t,void r.__fsm.transitionTo("fulfilled");if(a.isInstanceOf(t,e))return void t.then(function(e){i(e)},function(e){n(e)});var s=t.then;if(!a.isFunction(s))return i=function(){},r.__value=t,void r.__fsm.transitionTo("fulfilled");try{s.call(t,i,n)}catch(e){n(e)}}function n(e){n=function(){},r.__stuckTimerId&&clearTimeout(r.__stuckTimerId),r.__reason=e,r.__fsm.transitionTo("rejected")}if(h.DEBUG_STUCK_PROMISES)try{throw new Error}catch(e){this.__debugStuckTrace=e.stack}this.__resolutionHandlers=[];var r=this;this.__fsm=new l("promise"),this.__fsm.addState("pending"),this.__fsm.addState("fulfilled",{onEnter:function(){r.__onResolved()}}),this.__fsm.addState("rejected",{onEnter:function(){r.__onResolved()}}),this.__fsm.addTransition("pending","fulfilled"),this.__fsm.addTransition("pending","rejected"),this.__fsm.setStartState("pending"),this.__fsm.start();try{t(i,n)}catch(e){n(e)}h.DEBUG_STUCK_PROMISES&&(this.__stuckTimerId=setTimeout(function(){console.warn("Stuck promise (5s): ",r.__debugStuckTrace)},5e3))},then:function(e,t){function i(r,s){var o=n.__fsm.getCurrentState();if("rejected"===o)if(a.isFunction(t))try{var _=t(n.__reason);s(_)}catch(e){s(e)}else s(n.__reason);else if("fulfilled"===o)if(a.isFunction(e))try{var _=e(n.__value);r(_)}catch(e){s(e)}else r(n.__value);else n.__resolutionHandlers.push(function(){i(r,s)})}var n=this;return new u(i)},catch:function(e){return this.then(void 0,e)},__onResolved:function(){for(;this.__resolutionHandlers.length;)this.__resolutionHandlers.pop()()}});i.exports=u,i.exports.resolve=n,i.exports.reject=r,i.exports.all=s,i.exports.race=o,window.Promise||(window.Promise=i.exports)}),define("thor/core/Scheduler",["require","exports","module","./Validation"],function(e,t,i){function n(e){s.__runComputeTasks(),s.__runAnimationTasks(e),s.__scheduleFrame()}var r=e("./Validation"),s={__lastTimestamp:window.performance&&window.performance.now?performance.now():0,__isPaused:!1,__arrComputeTasks:[],__arrAnimationTasks:[],__computeTaskIndicesByTaskId:{},__animationTaskIndicesByTaskId:{},__hasScheduledFrame:!1,__getTaskId:function(){var e=0;return this.__getTaskId=function(){return++e},this.__getTaskId()},__needsFrame:function(){return!(this.__isPaused||0===this.__arrAnimationTasks.length&&0===this.__arrComputeTasks.length||this.__hasScheduledFrame)},__scheduleFrame:function(){this.__needsFrame()&&(this.__hasScheduledFrame=!0,window.requestAnimationFrame(n))},__runAnimationTasks:function(e){var t=e-this.__lastTimestamp;t=Math.min(t,50);for(var i=this.__arrAnimationTasks.length,n=0;n<i;++n)this.__arrAnimationTasks[n]&&this.__arrAnimationTasks[n](e,t);this.__lastTimestamp=e,this.__hasScheduledFrame=!1},addAnimationTask:function(e){for(var t=this.__getTaskId(),i=this.__arrAnimationTasks.length-1;i>=0;--i)if(null===this.__arrAnimationTasks[i])return this.__arrAnimationTasks[i]=e,this.__animationTaskIndicesByTaskId[t]=i,t;return this.__animationTaskIndicesByTaskId[t]=this.__arrAnimationTasks.length,this.__arrAnimationTasks.push(e),this.__scheduleFrame(),t},hasAnimationTaskId:function(e){if(!r.isNumber(e))return console.error("Invalid task id given to Thor.Scheduler.hasAnimationTask"),!1;var t=this.__animationTaskIndicesByTaskId[e];return r.isNumber(t)},removeAnimationTask:function(e){var t=this.__animationTaskIndicesByTaskId[e];delete this.__animationTaskIndicesByTaskId[e];for(var i in this.__animationTaskIndicesByTaskId)this.__animationTaskIndicesByTaskId[i]>t&&this.__animationTaskIndicesByTaskId[i]--;this.__arrAnimationTasks.splice(t,1)},__needsComputeFrame:function(){return!this.__isPaused&&0!==this.__arrComputeTasks.length&&!this.__hasScheduledFrame},__runComputeTasks:function(){for(var e=this.__arrComputeTasks.length,t=Object.keys(this.__computeTaskIndicesByTaskId),i=t.length,n=0;n<i;++n){var r=t[n],s=this.__computeTaskIndicesByTaskId[r];delete this.__computeTaskIndicesByTaskId[r],this.__arrComputeTasks[s](),this.__arrComputeTasks[s]=void 0}this.__arrComputeTasks.length===e&&(this.__arrComputeTasks.length=0)},addComputeTask:function(e){if(!r.isFunction(e))return void console.error("Invalid task given to Thor.Scheduler.addComputeTask");var t=this.__getTaskId();this.__computeTaskIndicesByTaskId[t]=this.__arrComputeTasks.length,this.__arrComputeTasks.push(e),this.__scheduleFrame()},pause:function(){this.__isPaused=!0},resume:function(){this.__isPaused=!1,this.__scheduleFrame()},printTaskStatus:function(){console.log("Compute tasks:",this.__arrComputeTasks),console.log("Animation tasks:",this.__arrAnimationTasks)},scheduleCallback:function(e){return function(){s.addComputeTask(e)}}};i.exports=s}),define("thor/core/ViewportResizeDelegate",["require","exports","module"],function(e,t,i){i.exports={onViewportResized:function(e,t){console.warn("Default onViewportResized called: ",e,t,(new Error).stack)}}}),define("thor/util/LocalStorage",["require","exports","module"],function(e,t,i){i.exports={key:function(e){try{return window.localStorage.key(e)}catch(e){return null}},getItem:function(e){try{return window.localStorage.getItem(e)}catch(e){return null}},getJSONItem:function(e){try{return JSON.parse(this.getItem(e))}catch(e){return null}},setJSONItem:function(e,t){var i=JSON.stringify(t);return this.setItem(e,i)},setItem:function(e,t){try{return window.localStorage.setItem(e,t)}catch(e){return null}},removeItem:function(e){try{return window.localStorage.removeItem(e)}catch(e){return null}},clear:function(){try{return window.localStorage.clear()}catch(e){return null}}}}),define("thor/core/Device",["require","exports","module","thor/config/Config","./Scheduler","./Validation","./Logger","./ViewportResizeDelegate","thor/util/LocalStorage"],function(e,t,i){var n=e("thor/config/Config"),r=e("./Scheduler"),s=(e("./Validation"),e("./Logger").getLogger(i)),o=(e("./ViewportResizeDelegate"),e("thor/util/LocalStorage")),a=n.REFERENCE_VIEWPORT_WIDTH_IN_PIXELS||960,_=n.REFERENCE_VIEWPORT_HEIGHT_IN_PIXELS||640,l=2,h=n.REFERENCE_ASSET_SIZE||1,u=n.MAX_VIEWPORT_WIDTH_HI_RES||2272,c=u/2,d=1,g=n.MAX_VIEWPORT_HEIGHT_HI_RES||1536,p=g/2,m=1,f=n.MAXIMUM_POINT_SCALE||1,v=n.MAXIMUM_POINT_SCALE_HI_RES||2,y=n.MINIMUM_ASPECT_RATIO||4/3,E=n.MAXIMUM_ASPECT_RATIO||16/9,S={AUDIO_REQUIRES_INPUT:3,CANVAS_STROKE:16,CANVAS_ROUNDED_CORNERS:17,ENTITY_SHADOWS:18,CANVAS_LINE_SHADOWS:19,BROKEN_CANVAS_WIND_ORDER:20,FACEBOOK_WEB_API:32,REQUIRES_FACEBOOK_AUTH:33,FACEBOOK_PURCHASES:34,FACEBOOK_LOGIN_REDIRECT:35,MAGNI:48,ONSCREEN_KEYBOARD:49,SCROLLBARS:50,SCROLL_ON_RESIZE:51,IOS_BOOKMARK_CAPABLE:52,IOS_BOOKMARK_TOP_LEFT:53,IOS_BOOKMARK_TOP_RIGHT:54,HI_RES_ASSETS:64,JSON_XML_HTTP_REQUEST:80,NO_LOCALE_STRING:81,WEB_GL:97,BOKU:113,PAYPAL:114,PAYPAL_REDIRECT:115,HARDWARE_KEYBOARD:128},T={FPS_METER:1,DEBUG_OVERLAY:2,DIRTY_LAYOUT:4,DEBUG_SCENEGRAPH_VISUALIZATION:8,METRICS:16,HIGHLIGHT_OVERFLOW_TEXT:32},C={HALF_FONT_SIZE:1,FULL_ANIMATION_SIZE:16,NO_MAX_CANVAS_SIZE:17,NO_MAX_POINT_SCALE:18,MUTE_AUDIO:33,NO_STREAMING:34,DETECT_AUDIO_CORRUPTION:35,LOGINKEY_IN_FRAGMENT:36,STATUS_BAR_OVERLAY:37,INVALID_INNERHEIGHT:38,NO_BACKING_NINE_SLICES:39},I={"iPhone1,1":"IPHONE","iPhone1,2":"IPHONE3G","iPhone2,1":"IPHONE3GS","iPhone3,1":"IPHONE4","iPhone3,3":"IPHONE4","iPhone4,1":"IPHONE4S","iPhone5,1":"IPHONE5","iPhone5,2":"IPHONE5","iPhone5,3":"IPHONE5C","iPhone5,4":"IPHONE5C","iPhone6,1":"IPHONE5S","iPhone6,2":"IPHONE5S","iPhone7,1":"IPHONE6PLUS","iPhone7,2":"IPHONE6","iPod1,1":"IPOD","iPod2,1":"IPOD2","iPod3,1":"IPOD3","iPod4,1":"IPOD4","iPod5,1":"IPOD5","iPad1,1":"IPAD","iPad1,2":"IPAD","iPad2,1":"IPAD2","iPad2,2":"IPAD2","iPad2,3":"IPAD2","iPad2,4":"IPAD2","iPad2,5":"IPAD_MINI","iPad2,6":"IPAD_MINI","iPad2,7":"IPAD_MINI","iPad3,1":"IPAD3","iPad3,2":"IPAD3","iPad3,3":"IPAD3","iPad3,4":"IPAD4","iPad3,5":"IPAD4","iPad3,6":"IPAD4","iPad4,1":"IPAD_AIR","iPad4,2":"IPAD_AIR","iPad5,3":"IPAD_AIR","iPad5,4":"IPAD_AIR","iPad4,4":"IPAD_MINI_RETINA","iPad4,5":"IPAD_MINI_RETINA","iPad4,7":"IPAD_MINI_RETINA","iPad4,8":"IPAD_MINI_RETINA","iPad4,9":"IPAD_MINI_RETINA","iPad Simulator":"IPAD","iPhone Simulator":"IPHONE"},w={IPOD:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPOD2:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPOD3:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPOD4:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPOD5:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPAD:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPAD2:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPAD3:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD,S.HI_RES_ASSETS],IPAD4:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD,S.HI_RES_ASSETS],IPAD_MINI:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPAD_AIR:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD,S.HI_RES_ASSETS],IPAD_MINI_RETINA:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD,S.HI_RES_ASSETS],IPHONE:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPHONE3G:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPHONE3GS:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPHONE4:[S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPHONE4S:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPHONE5:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPHONE5C:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPHONE5S:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPHONE6:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD],IPHONE6PLUS:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.MAGNI,S.BROKEN_CANVAS_WIND_ORDER,S.ONSCREEN_KEYBOARD,S.SCALE_TO_FIT],ANDROID:[S.FACEBOOK_WEB_API,S.SCROLL_ON_RESIZE,S.ONSCREEN_KEYBOARD,S.BOKU,S.PAYPAL],ANDROID_STANDALONE:[S.FACEBOOK_WEB_API,S.FACEBOOK_LOGIN_REDIRECT,S.SCROLL_ON_RESIZE,S.ONSCREEN_KEYBOARD,S.BOKU,S.PAYPAL,S.PAYPAL_REDIRECT],FACEBOOK:[S.CANVAS_LINE_SHADOWS,S.ENTITY_SHADOWS,S.CANVAS_STROKE,S.CANVAS_ROUNDED_CORNERS,S.FACEBOOK_WEB_API,S.FACEBOOK_PURCHASES,S.REQUIRES_FACEBOOK_AUTH,S.SCROLLBARS,S.HARDWARE_KEYBOARD],WEB:[S.CANVAS_LINE_SHADOWS,S.ENTITY_SHADOWS,S.CANVAS_STROKE,S.CANVAS_ROUNDED_CORNERS,S.FACEBOOK_WEB_API,S.SCROLLBARS,S.HARDWARE_KEYBOARD,S.BOKU,S.PAYPAL],ANIMATION_PREVIEW:[S.HARDWARE_KEYBOARD,S.CANVAS_LINE_SHADOWS,S.JSON_XML_HTTP_REQUEST,S.ENTITY_SHADOWS,S.CANVAS_STROKE,S.CANVAS_ROUNDED_CORNERS,S.SCROLLBARS],DEFAULT:[],DEFAULT_IOS:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.BROKEN_CANVAS_WIND_ORDER,S.FACEBOOK_WEB_API,S.ONSCREEN_KEYBOARD],IOS_SAFARI:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.BROKEN_CANVAS_WIND_ORDER,S.FACEBOOK_WEB_API,S.SCROLL_ON_RESIZE,S.ONSCREEN_KEYBOARD,S.IOS_BOOKMARK_CAPABLE,S.BOKU,S.PAYPAL],IOS_SAFARI_RETINA:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.HI_RES_ASSETS,S.BROKEN_CANVAS_WIND_ORDER,S.FACEBOOK_WEB_API,S.SCROLL_ON_RESIZE,S.ONSCREEN_KEYBOARD,S.IOS_BOOKMARK_CAPABLE,S.BOKU,S.PAYPAL],IOS_SAFARI_STANDALONE:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.BROKEN_CANVAS_WIND_ORDER,S.FACEBOOK_WEB_API,S.FACEBOOK_LOGIN_REDIRECT,S.SCROLL_ON_RESIZE,S.ONSCREEN_KEYBOARD,S.BOKU,S.PAYPAL,S.PAYPAL_REDIRECT],IOS_SAFARI_RETINA_STANDALONE:[S.AUDIO_REQUIRES_INPUT,S.NO_LOCALE_STRING,S.HI_RES_ASSETS,S.BROKEN_CANVAS_WIND_ORDER,S.FACEBOOK_WEB_API,S.FACEBOOK_LOGIN_REDIRECT,S.SCROLL_ON_RESIZE,S.ONSCREEN_KEYBOARD,S.BOKU,S.PAYPAL,S.PAYPAL_REDIRECT]},b={CHROME:[S.JSON_XML_HTTP_REQUEST],FIREFOX:[S.JSON_XML_HTTP_REQUEST,S.NO_LOCALE_STRING],SAFARI:[S.NO_LOCALE_STRING,S.BROKEN_CANVAS_WIND_ORDER],IE:[S.NO_LOCALE_STRING],DEFAULT:[]},M={CHROME:[C.NO_BACKING_NINE_SLICES],FIREFOX:[],SAFARI:[C.NO_STREAMING],IE:[],DEFAULT:[]},x={IPOD:[C.NO_STREAMING],IPOD2:[C.NO_STREAMING],IPOD3:[C.NO_STREAMING],IPOD4:[C.NO_STREAMING],IPOD5:[C.NO_STREAMING],IPAD:[C.NO_STREAMING],IPAD2:[C.NO_STREAMING],IPAD3:[C.NO_STREAMING,C.HALF_FONT_SIZE],IPAD4:[C.NO_STREAMING,C.HALF_FONT_SIZE],IPAD_MINI:[C.NO_STREAMING],IPAD_AIR:[C.NO_STREAMING,C.HALF_FONT_SIZE],IPAD_MINI_RETINA:[C.NO_STREAMING,C.HALF_FONT_SIZE],IPHONE:[C.NO_STREAMING],IPHONE3G:[C.NO_STREAMING],IPHONE3GS:[C.NO_STREAMING],IPHONE4:[C.NO_STREAMING],IPHONE4S:[C.NO_STREAMING],IPHONE5:[C.NO_STREAMING],IPHONE5C:[C.NO_STREAMING],IPHONE5S:[C.NO_STREAMING],IPHONE6:[C.NO_STREAMING],IPHONE6PLUS:[C.NO_STREAMING],FACEBOOK:[],ANDROID:[C.NO_STREAMING,C.NO_BACKING_NINE_SLICES],ANDROID_STANDALONE:[C.NO_STREAMING,C.NO_BACKING_NINE_SLICES],WEB:[],ANIMATION_PREVIEW:[C.FULL_ANIMATION_SIZE,C.NO_MAX_CANVAS_SIZE],DEFAULT:[],DEFAULT_IOS:[C.NO_STREAMING,C.DETECT_AUDIO_CORRUPTION],IOS_SAFARI:[C.NO_STREAMING,C.LOGINKEY_IN_FRAGMENT,C.DETECT_AUDIO_CORRUPTION],IOS_SAFARI_RETINA:[C.NO_STREAMING,C.HALF_FONT_SIZE,C.LOGINKEY_IN_FRAGMENT,C.DETECT_AUDIO_CORRUPTION],IOS_SAFARI_STANDALONE:[C.NO_STREAMING,C.DETECT_AUDIO_CORRUPTION],IOS_SAFARI_RETINA_STANDALONE:[C.NO_STREAMING,C.HALF_FONT_SIZE,C.STATUS_BAR_OVERLAY,C.DETECT_AUDIO_CORRUPTION]},R={FEATURES:S,DEBUG_FEATURES:T,HACKS:C,features:{},debugFeatures:{},hacks:{},browserVendor:"",platform:null,maxAspectRatio:E,minAspectRatio:y,aspectRatio:y,viewportWidth:0,viewportHeight:0,maxViewportWidth:0,maxViewportHeight:0,canvasWidth:0,canvasHeight:0,requestedDPViewportWidth:0,requestedDPViewportHeight:0,screenWidth:0,screenHeight:0,hasTouch:!1,capabilityLevel:10,cssViewportWidth:0,cssViewportHeight:0,pointScale:1,pixelScale:window.devicePixelRatio||1,scaleFactorX:1,scaleFactorY:1,cssToCanvasRatioX:1,cssToCanvasRatioY:1,isTablet:!1,isIOSDevice:!1,isAndroidDevice:!1,isMobileDevice:!1,isEdge:!1,isIE11:!1,isFeed:window.THOR_IS_FEED||!1,isStandalone:!1,isLandscape:!1,resizingEnabled:!0,displayPlatform:null,isLittleEndian:null,osMajorVersion:0,osMinorVersion:0,assetScale:1,verticalScale:1,horizontalScale:1,DEBUG:!1,__arrViewportResizeCallbacks:[],__arrViewportResizeDelegates:[],__normalizeConsole:function(){var e=window.console||{},t=e.log||function(){},i=e.warn||function(){arguments[0]="[WARN] "+arguments[0],t.apply(this,arguments)},n=e.error||function(){arguments[0]="[ERROR] "+arguments[0],t.apply(this,arguments)},r=e.debug||function(){arguments[0]="[DEBUG] "+arguments[0],t.apply(this,arguments)};e.log=t,e.warn=i,e.error=n,e.debug=r,window.console=e},detect:function(){if(this.__normalizeConsole(),this.features={},this.hacks={},this.browserVendor=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":"opera"in window?"O":"",this.hasTouch="ontouchstart"in window,void 0===window.devicePixelRatio&&(window.devicePixelRatio=1),this.devicePixelRatio=window.devicePixelRatio,this.isIOSDevice=/iphone|ipad/gi.test(navigator.appVersion),this.isAndroidDevice=/Android/g.test(navigator.appVersion),this.displayPlatform="Unknown",this.isIOSDevice){var e=navigator.machine;this.displayPlatform="iOS",navigator.standalone?(this.isStandalone=!0,2!==this.pixelScale||navigator.appVersion.match(/iPhone/)?this.platform="IOS_SAFARI_STANDALONE":this.platform="IOS_SAFARI_RETINA_STANDALONE",this.displayPlatform="Open Web iOS"):navigator.userAgent.match(/Safari/)?(2!==this.pixelScale||navigator.appVersion.match(/iPhone/)?this.platform="IOS_SAFARI":this.platform="IOS_SAFARI_RETINA",this.displayPlatform="Open Web iOS",/iPad/g.test(navigator.appVersion)?/CPU OS 7/g.test(navigator.appVersion)?this.features[this.FEATURES.IOS_BOOKMARK_TOP_LEFT]=!0:this.features[this.FEATURES.IOS_BOOKMARK_TOP_RIGHT]=!0:(736===screen.availWidth&&414===screen.availHeight||647===screen.availWidth&&375===screen.availHeight||414===screen.availWidth&&716===screen.availHeight||375===screen.availWidth&&647===screen.availHeight)&&(this.features[this.FEATURES.IOS_BOOKMARK_TOP_RIGHT]=!0)):void 0===I[e]?(s.warn("Encountered unknown ios device "+e),this.platform="DEFAULT_IOS"):this.platform=I[e];/ipad/gi.test(navigator.appVersion)&&(this.isTablet=!0);var t=navigator.userAgent,i=t.indexOf("OS "),n=t.indexOf("_",i+3),r=t.indexOf(" ",n+1),a=t.substring(i+3,n),_=t.substring(n+1,r),l=_.indexOf("_");l!==-1&&_.substring(0,l);var h=parseInt(a,10);NaN!==h&&(this.osMajorVersion=h);var u=parseInt(_,10);NaN!==u&&(this.osMinorVersion=u),document.getElementsByTagName("body")[0].style.minHeight=window.innerHeight+"px"}else if(this.isAndroidDevice){screen.height-document.documentElement.clientHeight<40?(this.platform="ANDROID_STANDALONE",this.isStandalone=!0):this.platform="ANDROID",this.displayPlatform="Open Web Android";var t=navigator.userAgent,i=t.indexOf("Android "),n=t.indexOf(".",i+8),r=t.indexOf(";",n+1),a=t.substring(i+8,n),_=t.substring(n+1,r),c=_.indexOf(".");c!==-1&&_.substring(0,c);var h=parseInt(a,10);NaN!==h&&(this.osMajorVersion=h);var u=parseInt(_,10);NaN!==u&&(this.osMinorVersion=u)}else window.FB_CANVAS?(this.platform="FACEBOOK",this.displayPlatform="Facebook",this.devicePixelRatio>1&&(this.features[this.FEATURES.HI_RES_ASSETS]=!0)):window.ANIMATION_PREVIEW?this.platform="ANIMATION_PREVIEW":(this.platform="WEB",this.displayPlatform="Open Web",this.devicePixelRatio>1&&(this.features[this.FEATURES.HI_RES_ASSETS]=!0));this.isMobileDevice=this.isIOSDevice||this.isAndroidDevice,this.isEdge=!!navigator.userAgent.match(/Edge/),this.isIE11=!!navigator.userAgent.match(/Trident/),void 0===w[this.platform]&&(s.warn("Encountered unknown platform "+this.platform),this.platform="DEFAULT");for(var d=0;d<w[this.platform].length;++d)this.features[w[this.platform][d]]=!0;for(var d=0;d<x[this.platform].length;++d)this.hacks[x[this.platform][d]]=!0;var g=/Chrome/i.test(navigator.userAgent)?"CHROME":/Safari/i.test(navigator.userAgent)&&/Apple Computer/i.test(navigator.vendor)?"SAFARI":"Moz"===this.browserVendor?"FIREFOX":"opera"===this.browserVendor?"OPERA":/MSIE/i.test(navigator.userAgent)||/Trident/i.test(navigator.userAgent)?"IE":"DEFAULT";if(this.browserName=g,this.isDesktopPlatform()){void 0===b[g]&&(g="DEFAULT");for(var d=0;d<b[g].length;++d)this.features[b[g][d]]=!0;for(var d=0;d<M[g].length;++d)this.hacks[M[g][d]]=!0}"true"===o.getItem("debug")&&(this.DEBUG=!0,s.log("Platform detected as `"+this.platform+"`")),this.debugFeatures=this.__getDebugFeatures(),this.detectViewportSize(),s.debug("Device detection complete:  Platform: "+this.platform+" ("+this.browserName+" - "+this.browserVendor+")"),s.debug("DPR: "+this.devicePixelRatio+" Has touch: "+this.hasTouch),s.debug("Features enabled:")
;for(var p in this.features)s.debug("\t"+this.__featureNamefromId(+p));s.debug("Hacks enabled:");for(var p in this.hacks)s.debug("\t"+this.__hackNamefromId(+p));s.debug("Debug options enabled:");for(var p in this.debugFeatures)s.debug("\t"+this.__debugOptionNamefromId(+p));var m=new ArrayBuffer(2);new DataView(m).setInt16(0,256,!0),this.isLittleEndian=256===new Int16Array(m)[0],s.debug("Endianess: "+(this.isLittleEndian?"Little":"Big"))},__getDebugFeatures:function(){var e={};if(this.DEBUG){for(var t in T)e[T[t]]=!0;return e}return n.ENABLE_FPS_METER&&(e[T.FPS_METER]=!0),n.ENABLE_DEBUG_OVERLAY&&(e[T.DEBUG_OVERLAY]=!0),n.ENABLE_DIRTY_LAYOUT&&(e[T.DIRTY_LAYOUT]=!0),n.ENABLE_METRICS&&(e[T.METRICS]=!0),n.ENABLE_SCENEGRAPH_DEBUG&&(e[DEBUG_SCENEGRAPH_VISUALIZATION]=!0),n.ENABLE_HIGHLIGHT_OVERFLOW_TEXT&&(e[T.HIGHLIGHT_OVERFLOW_TEXT]=!0),e},addViewportResizeDelegate:function(e,t){if(this.__arrViewportResizeDelegates.indexOf(e)!==-1)return void s.warn("Device: ViewportResizeDelegate already registered",e);t?this.__arrViewportResizeDelegates.unshift(e):this.__arrViewportResizeDelegates.push(e)},removeViewportResizeDelegate:function(e){var t=this.__arrViewportResizeDelegates.indexOf(e);t!==-1?this.__arrViewportResizeDelegates.splice(t,1):s.warn("Device: Attempt to remove ViewportResizeDelegate was not registered",e)},requestNextViewportResize:function(e){this.__arrViewportResizeCallbacks.push(e)},cancelNextViewportResize:function(e){var t=this.__arrViewportResizeCallbacks.indexOf(e);t!==-1&&this.__arrViewportResizeCallbacks.splice(t,1)},__handleViewportResize:function(e){var t=this;t.detectViewportSize();var i=t.__arrViewportResizeCallbacks.slice(0);t.__arrViewportResizeCallbacks.length=0;for(var n=0;n<i.length;++n)r.addComputeTask(i[n].bind(void 0,this,e));r.addComputeTask(function(){R.features[R.FEATURES.SCROLL_ON_RESIZE]&&window.scrollTo(0,0);for(var i=0,n=t.__arrViewportResizeDelegates.length;i<n;++i)t.__arrViewportResizeDelegates[i].onViewportResized(t,e)})},__getRequestedMetrics:function(){if(this.__referenceElement){var e=window.getComputedStyle(this.__referenceElement),t=e.width,i=e.height;return{width:+t.substring(0,t.length-2),height:+i.substring(0,i.length-2)}}var n="number"==typeof window.innerWidth,r=void 0!==document.documentElement,s=r&&"number"==typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth,o=n?window.innerWidth:s?document.documentElement.clientWidth:document.body.clientWidth,a=n?window.innerHeight:s?document.documentElement.clientHeight:document.body.clientHeight;return 0!==a&&0!==o||(a=2,o=2),{width:o,height:a}},detectViewportSize:function(){this.debugFeatures[T.METRICS]&&s.debug("Viewport resize begin");var e=this.__getRequestedMetrics(),t=e.width,i=e.height;if("IOS_SAFARI"!==this.platform||44!==window.innerHeight&&77!==window.innerHeight)delete this.hacks[this.HACKS.INVALID_INNERHEIGHT];else if(s.warn("iPhone 6+ landscape size bug detected"),this.hacks[this.HACKS.INVALID_INNERHEIGHT]=!0,0===window.orientation)i=414;else{var n=window.innerHeight;i=44===n?370:337,setTimeout(function(){window.scrollTo(0,-n)})}this.screenWidth=t,this.screenHeight=i,this.debugFeatures[T.METRICS]&&s.debug("Requested -> width: "+t+" height: "+i+" aspect: "+t/i+" dpr: "+this.pixelScale);var r=a/_,o=f,h=p,y=c,E=m,I=d;this.features[S.HI_RES_ASSETS]&&(o=v,h=g,y=u),this.hacks[C.NO_MAX_CANVAS_SIZE]&&(h=1/0,y=1/0),this.hacks[C.NO_MAX_POINT_SCALE]&&(o=1/0),this.maxViewportWidth=y,this.maxViewportHeight=h,this.debugFeatures[T.METRICS]&&s.debug("Limits -> width: ["+I+", "+y+"] height: ["+E+", "+h+"] aspect: ["+this.minAspectRatio+", "+this.maxAspectRatio+"]");var w,b,M,x,R=Math.max(I,Math.min(y,t)),P=Math.max(E,Math.min(h,i));if(this.isLandscape=t>i,M=R/P,x=Math.max(this.minAspectRatio,Math.min(this.maxAspectRatio,M)),this.debugFeatures[T.METRICS]&&s.debug("Clamped -> width: "+R+" height: "+P+" aspect: "+R/P),x<1){var A=P,N=A*x;N>R&&(N=R,A=N/x),w=N,b=A}else{var N=R,A=N/x;A>P&&(A=P,N=A*x),w=N,b=A}if(w>y||w<I||b>h||b<E){var D="";throw D=w>y?"acceptedViewportWidth("+w+") is above maximum ("+y+")":w<I?"acceptedViewportWidth("+w+") is below minimum ("+I+")":b>h?"acceptedViewportHeight("+b+") is above maximum ("+h+")":"acceptedViewportHeight("+b+") is below minimum ("+b+")",new Error("Cannot find valid viewport dimensions: "+D)}this.debugFeatures[T.METRICS]&&s.debug("Accepted -> width: "+w+" height: "+b+" aspect: "+x+" Reference Aspect: "+r);var L,O,V,B=x/r;L=w*(1/B)/a,O=b*B/_,V=Math.min(L,O,o),this.debugFeatures[T.METRICS]&&s.debug("Reference -> width: "+a+" height: "+_+" dpr: "+l),this.assetScale=V,this.pointScale=V,this.verticalScale=O,this.horizontalScale=L,this.debugFeatures[T.METRICS]&&s.debug("Scales -> horizontal: "+this.horizontalScale+" vertical: "+this.verticalScale+" point: "+this.pointScale+" asset: "+this.assetScale),this.viewportWidth=~~(w*this.pixelScale),this.viewportHeight=~~(b*this.pixelScale),this.cssViewportWidth=~~w,this.cssViewportHeight=~~b,this.scaleFactorX=this.screenWidth/this.cssViewportWidth,this.scaleFactorY=this.screenHeight/this.cssViewportHeight,this.aspectRatio=x,this.canvasWidth=this.viewportWidth,this.canvasHeight=this.viewportHeight,this.requestedDPViewportWidth=t,this.requestedDPViewportHeight=i,this.cssToCanvasRatioX=this.canvasWidth/this.cssViewportWidth,this.cssToCanvasRatioY=this.canvasHeight/this.cssViewportHeight,this.debugFeatures[T.METRICS]&&s.debug("Viewport resize complete")},setReferenceElement:function(e){this.__referenceElement=e,this.__handleViewportResize()},setReferenceMetrics:function(e,t,i,n){e===a&&t===_&&i===l&&n===h||(e!==a&&s.debug("Changing ref width from "+a+" to "+e),t!==_&&s.debug("Changing ref height from "+_+" to "+t),i!==l&&s.debug("Changing ref pixelRatio from "+l+" to "+i),n!==h&&s.debug("Changing ref referenceAssetSize from "+h+" to "+n),a=e,_=t,l=i,h=n)},getReferenceAssetSize:function(){return h},setMinimumAspectRatio:function(e){this.minAspectRatio=e},setMaximumAspectRatio:function(e){this.maxAspectRatio=e},setMinimumViewportSize:function(e,t){d=e,m=t},setMaximumViewportSize:function(e,t){c=e,p=t},setAssetScale:function(e){this.assetScale=e},assetSizeToAssetScale:function(e){return this.assetScale/~~(this.assetScale+.99999)*(h/e)},shdpToHdp:function(e){return e*this.horizontalScale},hdpToShdp:function(e){return e/this.horizontalScale},svdpToVdp:function(e){return e*this.verticalScale},vdpToSvdp:function(e){return e/this.verticalScale},cssToSdp:function(e){return e/this.pointScale*this.pixelScale},sdpToCss:function(e){return e*this.pointScale/this.pixelScale},scssToDp:function(e){return e*this.pointScale*this.pixelScale},dpToScss:function(e){return e/this.pointScale/this.pixelScale},dpToCss:function(e){return e/this.pixelScale},cssToDp:function(e){return e*this.pixelScale},sdpToScss:function(e){return e/this.pixelScale},scssToSdp:function(e){return e*this.pixelScale},cssToScss:function(e){return e/this.pointScale},scssToCss:function(e){return e*this.pointScale},dpToSdp:function(e){return e/this.pointScale},sdpToDp:function(e){return e*this.pointScale},remToPx:function(e){return this.hacks[C.HALF_FONT_SIZE]&&(e*=.5),10*e*this.pointScale},isDesktopPlatform:function(){return!this.isIOSDevice&&!this.isAndroidDevice},isDebug:function(){return this.DEBUG},forceResize:function(){this.__handleViewportResize(null)},__featureNamefromId:function(e){for(var t in S){if(S[t]===e)return t}return"Unknown"},__hackNamefromId:function(e){for(var t in C){if(C[t]===e)return t}return"Unknown"},__debugOptionNamefromId:function(e){for(var t in T){if(T[t]===e)return t}return"Unknown"},getScrollScaling:function(){var e=1;return"FIREFOX"===this.browserName&&(e=15),e},areCookiesEnabled:function(){return!!navigator.cookieEnabled&&(document.cookie="testcookie",document.cookie.indexOf("testcookie")!==-1)}};R.detect(),R.detect=function(){s.warn("You shouldn't call detect.",(new Error).trace)};var P=null;window.addEventListener("resize",function(){P&&clearTimeout(P),P=setTimeout(function(){if(R.__handleViewportResize(),P=null,"IOS_SAFARI"==R.platform||"IOS_SAFARI_RETINA"==R.platform){var e=window.innerHeight;setTimeout(function(){window.innerHeight!==e&&R.__handleViewportResize()},500)}},10)}),i.exports=R}),define("thor/util/Network",["require","exports","module","thor/core/Device","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Device"),r=e("thor/core/Validation");i.exports={getArrayBuffer:function(e){return i.exports.getResource(e,{responseType:"arraybuffer"})},getJSON:function(e){var t;return t=n.features[n.FEATURES.JSON_XML_HTTP_REQUEST]?"json":"text",i.exports.getResource(e,{responseType:t}).then(function(e){return n.features[n.FEATURES.JSON_XML_HTTP_REQUEST]?e:JSON.parse(e)})},sendBeacon:function(e,t){if(navigator.sendBeacon){var i=navigator.sendBeacon(e,JSON.stringify(t));return Promise.resolve(i)}return this.postJSON(e,t,{contentType:"text/plain;charset=UTF-8"})},postJSON:function(e,t,i){return this.__sendJSON(e,t,"POST",i)},putJSON:function(e,t,i){return this.__sendJSON(e,t,"PUT",i)},deleteJSON:function(e,t){return this.__sendJSON(e,t,"DELETE")},__sendJSON:function(e,t,i,s){if(r.ifDefined.assertIsObject(s),"PUT"!==i&&"POST"!==i&&"DELETE"!==i)throw new Error("Only POST, PUT, and DELETE types supported");s=s||{};var o,a=!(r.isNonEmptyString(s.responseType)&&"text"===s.responseType);o=a&&n.features[n.FEATURES.JSON_XML_HTTP_REQUEST]?"json":"text";var _=s.contentType||"application/json",l=JSON.stringify(t);return this.__sendResource(e,l,i,{contentType:_,responseType:o}).then(function(t){if(!a)return t;if(n.features[n.FEATURES.JSON_XML_HTTP_REQUEST])return t;try{return JSON.parse(t)}catch(i){throw new Error("Error parsing JSON from ("+e+"): "+t)}})},getResource:function(e,t){return this.request("GET",e,t).then(function(e){return e.response})},request:function(e,t,i){r.ifDefined.assertIsObject(i),r.isUndefined(i)&&(i={});var n=i.responseType||"text",s=i.overrideMimeType||null;return new Promise(function(o,a){var _=new XMLHttpRequest;_.open(e,t,!0),_.responseType=n,r.isNonEmptyString(i.contentType)&&_.setRequestHeader("Content-Type",i.contentType),s&&_.overrideMimeType&&_.overrideMimeType(s),_.onload=function(){200===this.status||0===this.status?o(this):a(new Error("Failed to send XHR "+t+": "+this.status))},_.onerror=function(e){a(new Error("Error in XHR "+t+": "+e))},_.send(i.body)})},postResource:function(e,t,i){return this.__sendResource(e,t,"POST",i)},putResource:function(e,t,i){return this.__sendResource(e,t,"PUT",i)},__sendResource:function(e,t,i,n){if("PUT"!==i&&"POST"!==i&&"DELETE"!==i)throw new Error("Only POST, PUT, and DELETE types supported");r.isUndefined(n)&&(n={});var s=n.overrideMimeType||null,o=n.responseType||"text";return new Promise(function(r,a){var _=new XMLHttpRequest;_.open(i,e,!0),_.responseType=o,s&&_.overrideMimeType&&_.overrideMimeType(s),n.contentType&&_.setRequestHeader("Content-Type",n.contentType),n.accept&&_.setRequestHeader("Accept",n.accept),_.onload=function(){0===this.status||200===this.status?r(this.response):a(new Error("Failed to "+i+" to "+e+": Code "+this.status))},_.onerror=function(t){a(new Error("Failed to "+i+" to "+e+": "+t.message))},_.send(t)})}}}),define("thor/util/StackFrame",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){function n(e){return!isNaN(parseFloat(e))&&isFinite(e)}var r=e("thor/core/Class");e("thor/core/Validation");i.exports=r.create({initialize:function(e,t,i,n,r,s){void 0!==e&&this.setFunctionName(e),void 0!==t&&this.setArgs(t),void 0!==i&&this.setFileName(i),void 0!==n&&this.setLineNumber(n),void 0!==r&&this.setColumnNumber(r),void 0!==s&&this.setSource(s)},getFunctionName:function(){return this.functionName},setFunctionName:function(e){this.functionName=String(e)},getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getFileName:function(){return this.fileName},setFileName:function(e){this.fileName=String(e)},getLineNumber:function(){return this.lineNumber},setLineNumber:function(e){if(!n(e))throw new TypeError("Line Number must be a Number");this.lineNumber=Number(e)},getColumnNumber:function(){return this.columnNumber},setColumnNumber:function(e){if(!n(e))throw new TypeError("Column Number must be a Number");this.columnNumber=Number(e)},getSource:function(){return this.source},setSource:function(e){this.source=String(e)},toString:function(){return(this.getFunctionName()||"{anonymous}")+"("+(this.getArgs()||[]).join(",")+")"+(this.getFileName()?"@"+this.getFileName():"")+(n(this.getLineNumber())?":"+this.getLineNumber():"")+(n(this.getColumnNumber())?":"+this.getColumnNumber():"")}})}),define("thor/util/ErrorStackParser",["require","exports","module","thor/core/Validation","./StackFrame"],function(e,t,i){var n=e("thor/core/Validation"),r=e("./StackFrame");i.exports={parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(/\s+at .*(\S+\:\d+|\(native\))/))return this.parseV8OrIE(e);if(e.stack&&e.stack.match(/(^|@)\S+\:\d+/))return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(e.indexOf(":")===-1)return[e];var t=e.replace(/[\(\)\s]/g,"").split(":"),i=t.pop(),r=t[t.length-1];if(n.isNumber(r))return[t.join(":"),i,void 0];var s=t.pop();return[t.join(":"),s,i]},parseV8OrIE:function(e){return e.stack.split("\n").filter(function(e){return!!e.match(/\s+at .*(\S+\:\d+|\(native\))/)},this).map(function(e){var t=e.replace(/^\s+/,"").split(/\s+/).slice(1),i=this.extractLocation(t.pop());return new r(t[0]&&"Anonymous"!==t[0]?t[0]:void 0,void 0,i[0],i[1],i[2],e)},this)},parseFFOrSafari:function(e){return e.stack.split("\n").filter(function(e){return!!e.match(/(^|@)\S+\:\d+/)},this).map(function(e){var t=e.split("@"),i=this.extractLocation(t.pop());return new r(t.shift()||void 0,void 0,i[0],i[1],i[2],e)},this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(e){for(var t=/Line (\d+).*script (?:in )?(\S+)/i,i=e.message.split("\n"),n=[],s=2,o=i.length;s<o;s+=2){var a=t.exec(i[s]);a&&n.push(new r(void 0,void 0,a[2],a[1],void 0,i[s]))}return n},parseOpera10:function(e){for(var t=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,i=e.stacktrace.split("\n"),n=[],s=0,o=i.length;s<o;s+=2){var a=t.exec(i[s]);a&&n.push(new r(a[3]||void 0,void 0,a[2],a[1],void 0,i[s]))}return n},parseOpera11:function(e){return e.stack.split("\n").filter(function(e){return!!e.match(/(^|@)\S+\:\d+/)&&!e.match(/^Error created at/)},this).map(function(e){var t,i=e.split("@"),n=this.extractLocation(i.pop()),s=i.shift()||"",o=s.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;return s.match(/\(([^\)]*)\)/)&&(t=s.replace(/^[^\(]+\(([^\)]*)\)$/,"$1")),new r(o,void 0===t||"[arguments not available]"===t?void 0:t.split(","),n[0],n[1],n[2],e)},this)}}}),define("thor/util/Alert",["require","exports","module","thor/core/Class","thor/core/Device","thor/config/Config","thor/core/Logger","thor/util/Network","thor/core/Validation","./ErrorStackParser"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Device"),e("thor/config/Config")),r=e("thor/core/Logger").getLogger(i),s=e("thor/util/Network"),o=e("thor/core/Validation"),a=e("./ErrorStackParser"),_=null;e(["Version"],function(e){_=e.BUILD_NUMBER},function(e){_="[DEV]"});var l='<div class="modal-content"><h2 class="title"></h2><p class="message-text"></a></p><h3 class="debug-title">Extra error information:</h3><p class="debug-text"></p><input class="button" type="button"/><h2 class="restart"></h2></div>',h=/function(?:\s+([\w$]+))+\s*\(/;i.exports={generateError:function(){for(var e="",t=[],i=arguments.callee;i&&t.length<10;){var n="",r=i.arguments.length;if(r>0){n=i.arguments[0];for(var s=1;s<r;++s)n+=","+i.arguments[s]}var o=i.toString(),a=void 0;if(a=h.exec(o)){var _=a[1]||"";e+=_+"("+n+")\n",t.push({columnNumber:-1,fileName:"unknown",functionName:_,lineNumber:-1,source:_+"("+n+")"})}else t.push({columnNumber:-1,fileName:"unknown",functionName:n,lineNumber:-1,source:n}),e+=n+"\n";try{i=i.caller}catch(e){break}}return{stack:e,stackFrames:t}},uncaughtError:function(e,t){console.error("Uncaught error: "+e),t=t||"",this.errorHandler(t+e,null,null,null,e)},errorHandler:function(e,t,i,n,r){try{var s=r&&r.stack?r:this.generateError(),o=e+"\n"+s.stack,_=s.stackFrames||a.parse(s);this.showFatalErrorModal(e,o),this.sendErrorLog(e,_),this.__triggerCallbacks(r),console.error("Fatal error stack: "+o)}catch(t){this.showFatalErrorModal(e,"Fatal Error"),this.sendErrorLog(e,null),this.__triggerCallbacks(e)}},installErrorHandler:function(){window.onerror=this.errorHandler.bind(this)},setLoggingSessionId:function(e){this.__loggingSessionId=e},sendErrorLog:function(e,t){var i={message:e,stackTrace:t,version:_};o.isDefined(this.__loggingSessionId)&&(i.sessionId=this.__loggingSessionId),o.isDefined(n.LOGGER_ENDPOINT)&&s.postJSON(n.LOGGER_ENDPOINT,i,{responseType:"text"})},showMessageModal:function(e,t){this.showModal(e,t,"","OK",function(){var e=document.getElementById("thor-modal");e.parentNode.removeChild(e)})},showModal:function(e,t,i,n,s){if(null!==document.getElementById("thor-modal"))return void r.error("Could not show modal, a modal already exists.");var o=document.createElement("div");o.id="thor-modal",o.innerHTML=l,o.getElementsByClassName("title")[0].innerHTML=e,o.getElementsByClassName("message-text")[0].innerHTML=t;var a=o.getElementsByClassName("button")[0];if(a.value=n,a.addEventListener("click",s),i){o.getElementsByClassName("debug-text")[0].innerHTML=i}else{o.getElementsByClassName("debug-title")[0].innerHTML=""}document.body.appendChild(o)},showDropDownModal:function(e,t,i,n,s){function o(){var e=h.selectedOptions[0].value;_.parentNode.removeChild(_),s(e)}function a(){_.parentNode.removeChild(_)}if(null!==document.getElementById("thor-modal"))return void r.error("Could not show modal, a modal already exists.");if(0===n.length)return r.error("Could not show picker modal, no choices to pick from."),void this.showMessageModal("Oops! Something went wrong.","Could not show the picker dialog, no options to pick form.");var _=document.createElement("div");_.id="thor-modal",_.innerHTML=l,_.getElementsByClassName("title")[0].innerHTML=e,_.getElementsByClassName("message-text")[0].innerHTML=t,_.getElementsByClassName("debug-text")[0].style.display="none",_.getElementsByClassName("debug-title")[0].style.display="none";var h=document.createElement("select");h.style.display="block",h.style.margin="auto";for(var u=0,c=n.length;u<c;u++){var d=n[u],g=document.createElement("option");g.text=d,g.value=d,g.selected=!u,h.appendChild(g)}var p=_.getElementsByClassName("button")[0];p.value=i,p.addEventListener("click",o);var m=document.createElement("input");m.className="button",m.type="button",m.value="Cancel",m.style.backgroundColor="grey",m.addEventListener("click",a),p.parentElement.appendChild(m),p.parentElement.insertBefore(h,p),document.body.appendChild(_)},showInputModal:function(e,t,i,n,s){function o(){var e=_.value;a.parentNode.removeChild(a),s(e)}if(null!==document.getElementById("thor-modal"))return void r.error("Could not show modal, a modal already exists.");var a=document.createElement("div");a.id="thor-modal",a.innerHTML=l,a.getElementsByClassName("title")[0].innerHTML=e,a.getElementsByClassName("message-text")[0].innerHTML=t,a.getElementsByClassName("debug-text")[0].style.display="none",a.getElementsByClassName("debug-title")[0].style.display="none";var _=document.createElement("input");_.style.display="block",_.style.margin="auto",_.value=n;var h=a.getElementsByClassName("button")[0];h.value=i,h.addEventListener("click",o),h.parentElement.insertBefore(_,h),document.body.appendChild(a)},showFatalErrorModal:function(e,t){if(null!==document.getElementById("thor-modal"))return void r.error("Could not show modal, a modal already exists.");var i=document.createElement("div");i.id="thor-modal",i.innerHTML=l,i.getElementsByClassName("title")[0].innerHTML="Oops! Something went wrong.";var n=encodeURIComponent("Bug on "+document.location.href),s="&body="+encodeURIComponent("Please include the following information to help us diagnose the problem:\n\n"+t);i.getElementsByClassName("message-text")[0].innerHTML='If the problem occurs again, <a href="mailto:support@bigvikinggames.com?subject='+n+s+'">send us a bug report.';var o=i.getElementsByClassName("button")[0];o.parentNode.removeChild(o),i.getElementsByClassName("debug-text")[0].innerHTML=e,i.getElementsByClassName("restart")[0].innerHTML="Please try restarting the game.",document.body.appendChild(i)},__errorCallbacks:[],addErrorCallback:function(e){this.__errorCallbacks.push(e)},clearErrorCallbacks:function(){this.__errorCallbacks.length=0},__triggerCallbacks:function(e){for(var t=0,i=this.__errorCallbacks.length;t<i;t++){(0,this.__errorCallbacks[t])(e)}}}}),define("thor/util/StringUtil",["require","exports","module","thor/core/Validation"],function(e,t,i){function n(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}var r=e("thor/core/Validation"),s={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,a:10,B:11,b:11,C:12,c:12,D:13,d:13,E:14,e:14,F:15,f:15},o=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);i.exports={crc32:function(e){for(var t=-1,i=e.length,n=0;n<i;){var r=e.charCodeAt(n++);if(r<128)t=t>>>8^o[255&(t^r)];else if(r<2048)t=t>>>8^o[255&(t^(192|r>>6&31))],t=t>>>8^o[255&(t^(128|63&r))];else if(r>=55296&&r<57344){r=64+(1023&r);var s=1023&e.charCodeAt(n++);t=t>>>8^o[255&(t^(240|r>>8&7))],t=t>>>8^o[255&(t^(128|r>>2&63))],t=t>>>8^o[255&(t^(128|s>>6&15|(3&r)<<4))],t=t>>>8^o[255&(t^(128|63&s))]}else t=t>>>8^o[255&(t^(224|r>>12&15))],t=t>>>8^o[255&(t^(128|r>>6&63))],t=t>>>8^o[255&(t^(128|63&r))]}return t^-1},toHex:function(e,t,i){t=t||0,i=i||e.length;for(var n=0,r=0;r<i;++r)n*=16,n+=s[e[t+r]];return n},trim:function(e,t,i){if(e.length<=t)return e;var n=e.substring(0,t);return i?n+i:n},getUrlParams:function(){for(var e=window.location.search.slice(1).split("&"),t={},i=e.length,n=0;n<i;n++){var s=e[n].split("="),o=s[0],a=s[1];r.isNonEmptyString(o)&&r.isNonEmptyString(a)&&(t[o]=a)}return t},setUrlParams:function(e){var t="",i=Object.keys(e),t="?"+i.map(function(t){return t+"="+e[t]}).join("&");window.location.search=t},formatHumanReadable:function(e){return e=e>1e6?e/1e6+"M":e>1e3?e/1e3+"K":""+e},getTimeDisplayString:function(e,t,n){if((e=Math.floor(e))<=0)return t;var r={none:t};return"abbreviated"===n?(r.seconds="{s}s",r.minutes="{m}m {s%m}s",r.hours="{h}h {m%h}m",r.days="{d}d {h%d}h",r.weeks="{w}w {d%w}d",r.years="{y}y"):"long"===n?(r.seconds="{s} second{ss?}",r.minutes="{m} minute{ms?}, {s%m} second{s%ms?}",r.hours="{h} hour{hs?}, {m%h} minute{m%hs?}",r.days="{d} day{ds?}, {h%d} hour{h%ds?}",r.weeks="{w} week{ws?}, {d%w} day{d%ws?}",r.years="{y} year{ys?}"):"digital"===n?(r.seconds="00:{0s%m}",r.minutes="{0m%h}:{0s%m}",r.hours="{h}:{0m%h}",r.days="{d}:{0h%d}",r.weeks="{w}:{0d%w}",r.years="{y}:{0w%y}"):"hybridHours"===n?(r.seconds="0:00:{0s%m}",r.minutes="0:{0m%h}:{0s%m}",r.hours="{h}:{0m%h}:{0s%m}",r.days="{d}d {h%d}h",r.weeks="{w}w {d%w}d",r.years="{y}y"):"hybrid"===n?(r.seconds="0:{0s%m}",r.minutes="{m%h}:{0s%m}",r.hours="{h}h {m%h}m",r.days="{d}d {h%d}h",r.weeks="{w}w {d%w}d",r.years="{y}y"):"abbreviatedForceSeconds"===n?(r.seconds="{s}s",r.minutes="{m}m {s%m}s",r.hours="{h}h {m%h}m {s%m}s"):"improper"===n&&(r.seconds="{s} second{ss?}",r.minutes="{s} second{ss?}",r.minutesRound="{m} minute{ms?}",r.hours="{m} minute{ms?}",r.hoursRound="{h} hour{hs?}",r.days="{h} hour{hs?}",r.daysRound="{d} day{ds?}",r.weeks="{d} day{ds?}",r.weeksRound="{w} week{ws?}",r.years="{w} week{ws?}",r.yearsRound="{y} year{ys?}"),i.exports.formatTime(e,r)},formatTime:function(e,t){var i={};i.s=e,i.m=i.s/60|0,i.h=i.m/60|0,i.d=i.h/24|0,i.w=i.d/7|0,i.y=i.d/365|0;var n={"{s}":""+i.s,"{m}":""+i.m,"{h}":""+i.h,"{d}":""+i.d,"{w}":""+i.w,"{y}":""+i.y,"{s%m}":""+i.s%60,"{m%h}":""+i.m%60,"{h%d}":""+i.h%24,"{d%w}":""+i.d%7,"{d%y}":""+i.d%365,"{w%y}":""+i.w%52,"{ss?}":1===i.s?"":"s","{ms?}":1===i.m?"":"s","{hs?}":1===i.h?"":"s","{ds?}":1===i.d?"":"s","{ws?}":1===i.w?"":"s","{ys?}":1===i.y?"":"s","{s%ms?}":i.s%60==1?"":"s","{m%hs?}":i.m%60==1?"":"s","{h%ds?}":i.h%24==1?"":"s","{d%ws?}":i.d%7==1?"":"s","{d%ys?}":i.d%365==1?"":"s","{w%ys?}":i.w%52==1?"":"s","{0s%m}":(i.s%60<10?"0":"")+i.s%60,"{0m%h}":(i.m%60<10?"0":"")+i.m%60,"{0h%d}":(i.h%24<10?"0":"")+i.h%24,"{0d%w}":(i.d%7<10?"0":"")+i.d%7,"{0d%y}":(i.d%365<10?"0":"")+i.d%365,"{0w%y}":(i.w%52<10?"0":"")+i.w%52},r=t.none;!i.s&&r||!t.seconds||(r=t.seconds),!i.m&&r||!t.minutes||(r=t.minutes),!i.m&&r||!t.minutesRound||i.s%60!=0||(r=t.minutesRound),!i.h&&r||!t.hours||(r=t.hours),!i.h&&r||!t.hoursRound||i.m%60!=0||(r=t.hoursRound),!i.d&&r||!t.days||(r=t.days),!i.d&&r||!t.daysRound||i.h%24!=0||(r=t.daysRound),!i.w&&r||!t.weeks||(r=t.weeks),!i.w&&r||!t.weeksRound||i.d%7!=0||(r=t.weeksRound),!i.y&&r||!t.years||(r=t.years),!i.y&&r||!t.yearsRound||i.d%365!=0||(r=t.yearsRound);var s=r;for(var o in n)s=s.replace(o,n[o]);return s},normalizeToRange:function(e,t){var i=e-e%t,n=i+t;return this.formatHumanReadable(i)+"-"+this.formatHumanReadable(n)},guid:function(){return n()+n(!0)+n(!0)+n()},formatNumberToString:function(e){return e<1e4&&e>-1e4?e+"":e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},interpolate:function(e,t){return e.replace(/\{\w+\}/g,function(e){var i=e.slice(1,-1);return i in t?t[i]:e})},snakeToCapitalCase:function(e){return e.split("_").filter(r.isNonEmptyString).map(function(e){return 0===e.length?"":e[0].toUpperCase()+e.substring(1).toLowerCase()}).join(" ")},withLeadingZeros:function(e,t){for(var i=e+"";i.length<t;){var n=t-i.length;i="0000000000".substring(0,n)+i}return i},fnv1aHash:function(e){for(var t=2166136261,i=0,n=e.length;i<n;i++)t^=e.charCodeAt(i),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}}}),define("thor/debug/PerformanceOverlay",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){function n(e,t,i,n){return e/t}var r=e("thor/core/Class"),s=(e("thor/core/Validation"),{begin:function(){},end:function(){}}),o={addInstrumentedTask:function(e,t,i){return t},addCustomTask:function(e,t,i,n,r){return s},destroy:function(){}},a=o,_=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date);i.exports=r.create({initialize:function(){if(a!==o)return this;a=this,this.__overlay=this.__createOverlay(),document.body.appendChild(this.__overlay),this.__categories=[];var e=this;window.setInterval(function(){for(var t=_(),i=0,n=e.__categories.length;i<n;++i){var r=e.__categories[i];t-r.data.lastReport>2e3&&(r.entry.firstChild.style.color="darkgrey")}},2e3),this.__open=!0},destroy:function(){this.__overlay.parentNode.removeChild(this.__overlay),a=o},toggleVisibility:function(){var e=this.__overlay;this.__open?(e.style.height="0.9rem",e.style.overflow="hidden"):(e.style.height="initial",e.style.overflow="initial"),this.__open=!this.__open},__createOverlay:function(){var e=document.createElement("div");e.id="performance-overlay",e.style.position="absolute",e.style.left="0",e.style.bottom="0",e.style.zIndex="1000",e.style.pointerEvents="none",e.style.background="black",e.style.padding="10px",e.style.margin="2px",e.style.border="white solid 1px",e.style.fontSize="0.7rem";var t=document.createElement("span");return t.innerHTML="Performance Stats",t.style.color="white",t.style.fontSize="1rem",e.appendChild(t),t.style.pointerEvents="all",t.addEventListener("click",this.toggleVisibility.bind(this),!0),e},addInstrumentedTask:function(e,t,i,n,r){var s=document.createElement("div");s.style.marginTop="5px";var o=document.createElement("span");o.innerHTML=e,o.style.color="white",o.style.marginRight="10px";var a=document.createElement("span");a.innerHTML="0.00 ms",a.style.color="cyan",a.style.float="right",s.appendChild(o),s.appendChild(a),this.__overlay.appendChild(s),s.style.display="none";var l={sum:0,samples:0,lastReport:_()};return this.__categories.push({data:l,entry:s}),function(){var e=_(),h=t.apply(t,arguments),u=_(),c=u-e;if(l.sum+=c,++l.samples,u-l.lastReport>=i){var d=l.sum/l.samples;s.style.display=d>=.5?"block":"none",a.innerHTML=d.toFixed(2)+" ms",o.style.color="white",a.style.color=d<n?"lawngreen":d<r?"yellow":"red",l.sum=0,l.samples=0,l.lastReport=u}return h}},addCustomTask:function(e,t,i,r,s,o){var a=s||n,l=void 0===o?" ms":o,h=document.createElement("div");h.style.marginTop="5px";var u=document.createElement("span");u.innerHTML=e,u.style.color="white",u.style.marginRight="10px";var c=document.createElement("span");c.innerHTML="0.00 ms",c.style.color="cyan",c.style.float="right",h.appendChild(u),h.appendChild(c),this.__overlay.appendChild(h),h.style.display="none";var d={sum:0,samples:0,lastReport:_(),start:0};return this.__categories.push({data:d,entry:h}),{begin:function(){d.start=_()},end:function(){var e=_(),n=e-d.start;if(d.sum+=n,++d.samples,e-d.lastReport>=t){
var s=e-d.lastReport,o=a(d.sum,d.samples,t,s);h.style.display=o>=.5?"block":"none",c.innerHTML=o.toFixed(2)+l,u.style.color="white",c.style.color=o<i?"lawngreen":o<r?"yellow":"red",d.sum=0,d.samples=0,d.lastReport=e}}}}}),i.exports.getInstance=function(){return a}}),define("thor/platforms/Google",["require","exports","module","thor/config/Config","thor/core/Logger","thor/core/Validation"],function(e,t,i){var n=e("thor/config/Config"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o={},a={};i.exports={shimSDK:function(){return window.ga=function(){},Promise.resolve()},loadSDK:function(e,t,i){s.ifDefined.assertIsNonEmptyString(i);for(var _ in e)var l=e[_];for(var _ in t)var l=t[_];return o=e,a=t,n.GA_KEY?new Promise(function(e,t){!function(t,i,n,r,s,o,a){t.GoogleAnalyticsObject="ga",t.ga=t.ga||function(){(t.ga.q=t.ga.q||[]).push(arguments)},t.ga.l=1*new Date,o=i.createElement("script"),a=i.getElementsByTagName("script")[0],o.async=1,o.src=r,a.parentNode.insertBefore(o,a),e()}(window,document,0,i||"https://www.google-analytics.com/analytics.js"),ga("create",n.GA_KEY,"auto"),ga("send","pageview")}):(r.warn("No Google Analytics key set, no events will be logged"),this.shimSDK())},setMetric:function(e,t){var i=o[e];if(!i)return void r.warn("Could not find metric ID for metric `"+name+"`, will not be set.");ga("set","metric"+i,t)},setDimension:function(e,t){var i=a[e];if(!i)return void r.warn("Could not find dimension ID for dimension `"+name+"`, will not be set.");ga("set","dimension"+i,t)},trackEvent:function(e,t,i){var n={};for(var s in i){var _=o[s];if(_){var l=i[s];n["metric"+_]=l}else if(_=a[s]){var l=i[s];n["dimension"+_]=l}else r.warn("Could not find metric or dimension ID for `"+s+"`, will not be included.")}ga("send","event",e,t,n)}}}),define("thor/core/Base",["require","exports","module","./Class","thor/config/Config","./Logger","./Validation"],function(e,t,i){var n=e("./Class"),r=e("thor/config/Config"),s=e("./Logger").getLogger(i),o=e("./Validation");if(r.ENABLE_MEMORY_INSTRUMENTATION)var a=[],_=[],l=[];i.exports=n.create({__loadingPromise:null,initialize:function(){this.reset(),r.ENABLE_MEMORY_INSTRUMENTATION&&a.push(this)},destroy:function(){if(this.__loadingPromise=null,r.ENABLE_MEMORY_INSTRUMENTATION){var e=a.indexOf(this);a.splice(e,1)}},isAlive:function(){return!this.__destroyed},reset:function(){var e=this;if(this.__loadingPromise)return void this.__loadingPromise.then(function(){e.__loadingPromise=null,e._reset()});this._reset()},_reset:function(){},load:function(e){return o.ifDefined.assertIsObject(e),this.__loadingPromise?this.__loadingPromise:(this.__loadingPromise=this._load(e),this.__loadingPromise||(s.warn("Base subclass didn't return a Promise from _load: ",this),this.__loadingPromise=Promise.resolve(this)),this.__loadingPromise)},_load:function(e){return o.ifDefined.assertIsObject(e),Promise.resolve(this)},toString:function(){return"[ThorObject "+this.initialize.name+"]"}}),r.ENABLE_MEMORY_INSTRUMENTATION&&(i.exports.printAllocations=function(){s.debug("Allocated Bases:",a)},i.exports.takeAllocationSnapshot=function(){for(var e=_.push(a.slice())-1,t={},i=0;i<a.length;++i){var n=a[i].__proto__.initialize.name;t[n]||(t[n]=0),t[n]++}l.push(t),s.debug("Snapshot "+e+" created")},i.exports.compareAllocationSnapshot=function(){var e=[],t=[];if(0===_.length)return void s.error("No snapshots to compare against");for(var i=_[_.length-1],n=l[l.length-1],r={},o=0;o<a.length;++o){var h=a[o].__proto__.initialize.name;r[h]||(r[h]=0),r[h]++,i.indexOf(a[o])===-1&&t.push(a[o])}for(var o=0;o<i.length;++o)a.indexOf(i[o])===-1&&e.push(i[o]);s.debug("New Bases:",t),s.debug("Destroyed Bases:",e);for(var h in r)if(n[h]){var u=n[h],c=r[h],d=c-u;d<0?console.debug("%c  Delta ▼","color: green",h,u,"->",c):d>0&&console.debug("%c  Delta ▲","color: red",h,u,"->",c)}else console.debug("%c  New ⚑","color: red",h,":",r[h]);for(var h in n)r[h]||console.debug("%c  Deleted:","color: green",h)},i.exports.clearAllocationSnapshots=function(){_=[],s.debug("Snapshots cleared")})}),define("thor/platforms/Facebook",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/config/Config"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Device"),o=e("thor/core/Logger").getLogger(i),a=e("thor/core/Validation"),_=e("thor/config/Config"),l="User cancelled",h="Unknown API response",u=r.create(n,{initialize:function(){this.__FB=null},isReady:function(){return!!this.__FB},ifReady:function(){var e=this.__FB;return new Promise(function(t,i){e?t(e):i("SDK not ready")})},getLoginStatus:function(){return this.ifReady().then(function(e){return new Promise(function(t,i){e.getLoginStatus(function(e){if(!e)return void i("No getLoginStatus response");t(e)})})})},login:function(e){function t(t,i){function n(e){if(!e.authResponse)return void i(l);t(e)}e?FB.login(n,e):FB.login(n)}return a.ifDefined.assertIsObject(e),this.__FB?new Promise(t):Promise.reject("SDK not ready")},api:function(e,t,i){return a.ifDefined.assertIsNonEmptyString(t),a.ifDefined.assertIsObject(i),this.ifReady().then(function(n){return new Promise(function(r,s){function o(e){return e?e.error?void s(e.error):void r(e):void s(h)}t?i?n.api(e,t,i,o):n.api(e,t,o):n.api(e,o)})})},ui:function(e){function t(t,i){function n(e){return e?e.error_message?i(e.error_message):t(e):i(h)}return FB.ui(e,n)}return"SAFARI"!==s.browserName?this.ifReady().then(function(e){return new Promise(t)}):this.__FB?new Promise(t):Promise.reject("SDK not ready")},_load:function(t){var i=this;return n.prototype._load.call(this,t).then(function(){return _.ENABLE_FACEBOOK?a.isObject(_.FACEBOOK)?a.isNonEmptyString(_.FACEBOOK.APP_ID)?a.isNonEmptyString(_.FACEBOOK.API_VERSION)?new Promise(function(t,i){e(["facebook"],function(){t(FB)},function(e){i(e)})}):(o.warn("Config.FACEBOOK.API_VERSION missing or invalid"),null):(o.warn("Config.FACEBOOK.APP_ID missing or invalid"),null):(o.warn("Config.FACEBOOK missing or invalid, disabling Facebook"),null):(o.warn("Facebook disabled by config"),null)}).then(function(e){return i.__FB=e,null!==e?(e.init({appId:_.FACEBOOK.APP_ID,status:!0,xfbml:!0,version:_.FACEBOOK.API_VERSION}),o.debug("Facebook init complete")):o.error("Facebook failed to load"),i})}});i.exports=new u}),define("thor/util/RingBuffer",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation");i.exports=n.create({__array:null,__maxLength:null,__size:null,__head:null,__tail:null,initialize:function(e,t,i){r.ifDefined.assertIsNumber(t),r.ifDefined.assertIsFunction(i),r.isNumber(t)||(t=e.length),this.__validate=i||r.assertIsDefined,this.__array=e,this.__maxLength=t,this.__size=0,this.__head=0,this.__tail=0},add:function(e,t){if(this.__validate(e),r.ifDefined.assertIsBoolean(t),this.__size===this.__maxLength&&!t)return!1;var i=(this.__head+1)%this.__maxLength;return this.__array[this.__head]=e,this.__head=i,this.__size<this.__maxLength?this.__size++:this.__tail++,!0},remove:function(){if(this.__head===this.__tail&&this.__size!==this.__maxLength)return null;var e=this.__array[this.__tail];return this.__array[this.__tail]=void 0,this.__tail=(this.__tail+1)%this.__maxLength,this.__size--,e},get:function(e){return e<0||e>=this.__size?void 0:this.__array[(this.__tail+e)%this.__maxLength]},reset:function(e){r.ifDefined.assertIsNumber(e),e=Math.min(e||0,this.__maxLength),this.__array.length=e,this.__head=0,this.__tail=0,this.__size=0},getCount:function(){return this.__size},getArray:function(){return this.__array},resize:function(e){if(0!==this.__size)throw new Error("RingBuffer is not empty");this.__array.length=e,this.__maxLength=e,this.__head=0,this.__tail=0},getMaximumCount:function(){return this.__maxLength}})}),define("thor/webgl/Camera",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation");i.exports=n.create({__matrix:null,initialize:function(){this.__matrix=new Float32Array(16)},getMatrix:function(){return this.__matrix}}),i.exports.makeFrustum=function(e,t,n,s,o,a,_){r.ifDefined.assertIsInstanceOf(_,i.exports),_||(_=new i.exports);var l=2*o/(t-e),h=2*o/(n-s),u=(t+e)/(t-e),c=(n+s)/(n-s),d=-(a+o)/(a-o),g=-2*a*o/(a-o),p=_.getMatrix();return p[0]=l,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=h,p[6]=0,p[7]=0,p[8]=u,p[9]=c,p[10]=d,p[11]=-1,p[12]=0,p[13]=0,p[14]=g,p[15]=0,_},i.exports.makeOrthographic=function(e,t,n,s,o,a,_){r.ifDefined.assertIsInstanceOf(_,i.exports),_||(_=new i.exports);var l=2/(t-e),h=2/(s-n),u=-2/(a-o),c=-(t+e)/(t-e),d=-(s+n)/(s-n),g=(a+o)/(a-o),p=_.getMatrix();return p[0]=l,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=h,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=u,p[11]=0,p[12]=c,p[13]=d,p[14]=g,p[15]=1,_},i.exports.makePerspective=function(e,t,n,s,o){r.ifDefined.assertIsInstanceOf(o,i.exports);var a=n*Math.tan(e*Math.PI/360),_=-a,l=_*t,h=a*t;return i.exports.makeFrustum(l,h,a,_,n,s,o)}}),define("thor/webgl/Shader",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=(e("thor/core/Validation"),0);i.exports=n.create({attributes:null,uniforms:null,__gl:null,__name:null,__program:null,initialize:function(e,t,i,n,r){this.attributes={},this.uniforms={},this.__gl=e,this.__cachedGl=t,this.__name=i,this.__program=this.__compile(e,n,r)},activate:function(){if(null===this.__program)return void r.error("Cannot activate shader "+this.__name+":  Program is null");this.__cachedGl.useProgram(this.__program);var e=0;for(var t in this.attributes){var i=this.attributes[t];e=i>e?i:e,this.__cachedGl.enableVertexAttribArray(i)}for(++e;e<=s;++e)this.__cachedGl.disableVertexAttribArray(e)},__compile:function(e,t,i){var n=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw r.error("Failed to compile vertex shader "+this.__name,e.getShaderInfoLog(n)),new Error("Vertex shader "+this.__name+" failed to compile");var o=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(o,i),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw r.error("Failed to compile fragment shader "+this.__name,e.getShaderInfoLog(o)),new Error("Fragment shader "+this.__name+" failed to compile");var a=e.createProgram();if(e.attachShader(a,n),e.attachShader(a,o),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw r.error("Failed to link shader "+this.__name,e.getProgramInfoLog(a)),new Error("Shader "+this.__name+" failed to link");for(var _=e.getProgramParameter(a,e.ACTIVE_ATTRIBUTES),l=0;l<_;++l){var h=e.getActiveAttrib(a,l).name,u=e.getAttribLocation(a,h);u>s&&(s=u),this.attributes[h]=u}for(var c=e.getProgramParameter(a,e.ACTIVE_UNIFORMS),l=0;l<c;++l){var d=e.getActiveUniform(a,l).name;this.uniforms[d]=e.getUniformLocation(a,d)}return a}})}),define("thor/webgl/Buffer",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation")),s={ARRAY_BUFFER:0,ELEMENT_BUFFER:1},o={};i.exports=n.create({initialize:function(e,t,i,n,a){switch(r.isNumber(n),r.ifDefined.assertIsObject(a),a=a||o,this.__gl=e,this.__cachedGl=t,i){case s.ARRAY_BUFFER:this.__type=e.ARRAY_BUFFER;break;case s.ELEMENT_BUFFER:this.__type=e.ELEMENT_ARRAY_BUFFER;break;default:throw new Error("Invalid buffer type: "+i)}this.__glBuffer=this.__gl.createBuffer(),this.__cachedGl.bindBuffer(this.__type,this.__glBuffer),this.__gl.bufferData(this.__type,n,a.usage||e.DYNAMIC_DRAW)},resize:function(e){r.isNumber(e),this.__cachedGl.bindBuffer(this.__type,this.__glBuffer),this.__gl.bufferData(this.__type,e,this.__gl.DYNAMIC_DRAW)},update:function(e,t){this.__cachedGl.bindBuffer(this.__type,this.__glBuffer),this.__gl.bufferSubData(this.__type,e,t)},bind:function(){this.__cachedGl.bindBuffer(this.__type,this.__glBuffer)},dispose:function(){this.__gl.deleteBuffer(this.__glBuffer)}}),i.exports.Type=s}),define("thor/webgl/Texture",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/core/Logger").getLogger(i),o=null,a=null,_=null,l={wrapRepeatS:!1,wrapRepeatT:!1},h=0,u={};i.exports=n.create({__gl:null,__domElement:null,__webglTexture:null,__textureWidth:null,__textureHeight:null,initialize:function(e,t,i){r.ifDefined.assertIsObject(i),i||(i=l);var n=e.gl;e.cachedGl;this.__gl=n,this.__domElement=t,this.__webglTexture=n.createTexture(),null===o&&this.__createTextureUnitMap(n),this.bind(0),i.skipUploadImage||n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t),i.mipmap&&n.generateMipmap(n.TEXTURE_2D),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i.wrapRepeatS?n.REPEAT:n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i.wrapRepeatT?n.REPEAT:n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i.minFilter?i.minFilter:n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,i.magFilter?i.magFilter:n.LINEAR),this.__textureWidth=this.__domElement.naturalWidth,this.__textureHeight=this.__domElement.naturalHeight,t.__thorTextureIds||(t.__thorTextureIds=[]);var s=++h;t.__thorTextureIds.push(s),u[s]=this},getWidth:function(){return this.__textureWidth},getHeight:function(){return this.__textureHeight},getName:function(){return this.__domElement.src},__createTextureUnitMap:function(e){var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);o={undefined:e.TEXTURE0},_={};for(var i=0;i<t;++i){var n=e["TEXTURE"+i];o[i]=n}},update:function(){this.bind(0),this.__domElement.naturalHeight===this.__textureHeight&&this.__domElement.naturalWidth===this.__textureWidth?this.__gl.texSubImage2D(this.__gl.TEXTURE_2D,0,0,0,this.__gl.RGBA,this.__gl.UNSIGNED_BYTE,this.__domElement):(this.__textureWidth=this.__domElement.naturalWidth,this.__textureHeight=this.__domElement.naturalHeight,this.__gl.texImage2D(this.__gl.TEXTURE_2D,0,this.__gl.RGBA,this.__gl.RGBA,this.__gl.UNSIGNED_BYTE,this.__domElement))},bind:function(e){var t=o[e];if(void 0===t)return void s.error("Invalid texture unit: "+e+".  Supported: ["+Object.keys(o).join(", ")+"]");_[t]!==this.__webglTexture&&(a!==t&&(this.__gl.activeTexture(t),a=t),this.__gl.bindTexture(this.__gl.TEXTURE_2D,this.__webglTexture),_[t]=this.__webglTexture)},dispose:function(){r.isDefined(this.__webglTexture)&&(this.__gl.deleteTexture(this.__webglTexture),this.__webglTexture=null)}}),i.exports.getTextureFromDomImage=function(e,t,n){return t.__thorTextureIds&&t.__thorTextureIds.length>0?u[t.__thorTextureIds[0]]:new i.exports(e,t,n)},i.exports.THOR_TEXTURES_BY_ID=u}),define("thor/math/MatrixOrderings",["require","exports","module"],function(e,t,i){i.exports={SRT:1,RTS:2,TRS:3,TRTS:4}}),define("thor/math/MatrixUtil",["require","exports","module","./MatrixOrderings"],function(e,t,i){var n=e("./MatrixOrderings"),r=new Float32Array([1,0,0,1,0,0]),s=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);i.exports={EPSILON:1e-5,IDENTITY_3x2:r,IDENTITY_4x4:s,equal:function(e,t,i){for(var n=0,r=e.length;n<r;++n)if(Math.abs(e[n]-t[n])>i)return!1;return!0},transform:function(e,t,i,r,s,o,a,_,l,h,u){var c=Math.sin(s),d=Math.cos(s),g=0,p=0,m=0,f=0,v=0,y=0;switch(l){case n.RTS:g=a*d,p=a*c,m=o*d-_*c,f=o*c+_*d,v=i*d-r*c,y=i*c+r*d;break;case n.TRTS:var E=_*d,S=_*c;g=a*d,p=a*c,m=o*E-S,f=o*S+E;var T=h*a+o*u*_;v=T*d-u*S+i,y=T*c+u*E+r;break;case n.TRS:g=a*d+o*c,p=a*c,m=o*d-_*c,f=_*d,v=i,y=r;break;default:case n.SRT:g=a*d+o*c,p=_*c,m=o*d-a*c,f=_*d,v=g*i+m*r,y=p*i+f*r}var C=e[0],I=e[1],w=e[2],b=e[3],M=e[4],x=e[5];t[0]=C*g+w*p,t[1]=I*g+b*p,t[2]=C*m+w*f,t[3]=I*m+b*f,t[4]=C*v+w*y+M,t[5]=I*v+b*y+x},transformWithPosition:function(e,t,n,r,s){var o=n.x,a=n.y,_=n.tx,l=n.ty,h=n.rad,u=n.xshear,c=n.xscale,d=n.yscale,g=n.registrationPointX,p=n.registrationPointY,m=n.matrixOrder;o+=~~((r.width-s.width*c)*g),a+=~~((r.height-s.height*d)*p),i.exports.transform(e,t,o,a,h,u,c,d,m,_,l)},invert:function(e,t){var i=e[0]*e[3]-e[1]*e[2];if(0===i||isNaN(i))t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0;else{var n=1/i;t[0]=e[3]*n,t[1]=-e[1]*n,t[2]=-e[2]*n,t[3]=e[0]*n,t[4]=(e[2]*e[5]-e[3]*e[4])*n,t[5]=(e[1]*e[4]-e[0]*e[5])*n}},identity3x2:function(e){e.set(r,0)},identity4x4:function(e){e.set(s,0)},multiply3x2:function(e,t,i){var n=e[0],r=e[2],s=e[4],o=e[1],a=e[3],_=e[5],l=t[0],h=t[2],u=t[4],c=t[1],d=t[3],g=t[5];i[0]=n*l+r*c,i[2]=n*h+r*d,i[4]=n*u+r*g+s,i[1]=o*l+a*c,i[3]=o*h+a*d,i[5]=o*u+a*g+_},multiply4x4:function(e,t,i){var n=e[0],r=e[4],s=e[8],o=e[12],a=e[1],_=e[5],l=e[9],h=e[13],u=e[2],c=e[6],d=e[10],g=e[14],p=e[3],m=e[7],f=e[11],v=e[15],y=t[0],E=t[4],S=t[8],T=t[12],C=t[1],I=t[5],w=t[9],b=t[13],M=t[2],x=t[6],R=t[10],P=t[14],A=t[3],N=t[7],D=t[11],L=t[15];i[0]=n*y+r*C+s*M+o*A,i[1]=a*y+_*C+l*M+h*A,i[2]=u*y+c*C+d*M+g*A,i[3]=p*y+m*C+f*M+v*A,i[4]=n*E+r*I+s*x+o*N,i[5]=a*E+_*I+l*x+h*N,i[6]=u*E+c*I+d*x+g*N,i[7]=p*E+m*I+f*x+v*N,i[8]=n*S+r*w+s*R+o*D,i[9]=a*S+_*w+l*R+h*D,i[10]=u*S+c*w+d*R+g*D,i[11]=p*S+m*w+f*R+v*D,i[12]=n*T+r*b+s*P+o*L,i[13]=a*T+_*b+l*P+h*L,i[14]=u*T+c*b+d*P+g*L,i[15]=p*T+m*b+f*P+v*L},transformVector3x2:function(e,t,i){var n=e[0],r=e[1],s=t[0],o=t[2],a=t[4],_=t[1],l=t[3],h=t[5];i[0]=n*s+r*o+a,i[1]=n*_+r*l+h},transformVector4x4:function(e,t,i){var n=e[0],r=e[1],s=e[2],o=e[3],a=t[0],_=t[4],l=t[8],h=t[12],u=t[1],c=t[5],d=t[9],g=t[13],p=t[2],m=t[6],f=t[10],v=t[14],y=t[3],E=t[7],S=t[11],T=t[15];i[0]=n*a+r*_+s*l+o*h,i[1]=n*u+r*c+s*d+o*g,i[2]=n*p+r*m+s*f+o*v,i[3]=n*y+r*E+s*S+o*T},invert4x4:function(e,t){var i=e[0],n=e[4],r=e[8],o=e[12],a=e[1],_=e[5],l=e[9],h=e[13],u=e[2],c=e[6],d=e[10],g=e[14],p=e[3],m=e[7],f=e[11],v=e[15],y=i*_*d*v+i*l*g*m+i*h*c*f+n*a*g*f+n*l*u*v+n*h*d*p+r*a*c*v+r*_*g*p+r*h*u*m+o*a*d*m+o*_*u*f+o*l*c*p-i*_*g*f-i*l*c*v-i*h*d*m-n*a*d*v-n*l*g*p-n*h*u*f-r*a*g*m-r*_*u*v-r*h*c*p-o*a*c*f-o*_*d*p-o*l*u*m;if(0===y)return void t.set(s,0);var E=_*d*v+l*g*m+h*c*f-_*g*f-l*c*v-h*d*m,S=n*g*f+r*c*v+o*d*m-n*d*v-r*g*m-o*c*f,T=n*l*v+r*h*m+o*_*f-n*h*f-r*_*v-o*l*m,C=n*h*d+r*_*g+o*l*c-n*l*g-r*h*c-o*_*d,I=a*g*f+l*u*v+h*d*p-a*d*v-l*g*p-h*u*f,w=i*d*v+r*g*p+o*u*f-i*g*f-r*u*v-o*d*p,b=i*h*f+r*a*v+o*l*p-i*l*v-r*h*p-o*a*f,M=i*l*g+r*h*u+o*a*d-i*h*d-r*a*g-o*l*u,x=a*c*v+_*g*p+h*u*m-a*g*m-_*u*v-h*c*p,R=i*g*m+n*u*v+o*c*p-i*c*v-n*g*p-o*u*m,P=i*_*v+n*h*p+o*a*m-i*h*m-n*a*v-o*_*p,A=i*h*c+n*a*g+o*_*u-i*_*g-n*h*u-o*a*c,N=a*d*m+_*u*f+l*c*p-a*c*f-_*d*p-l*u*m,D=i*c*f+a*d*p+r*u*m-i*d*m-n*u*f-r*c*p,L=i*l*m+n*a*f+r*_*p-i*_*f-n*l*p-r*a*m,O=i*_*d+n*l*u+r*a*c-i*l*c-n*a*d-r*_*u,V=1/y;t[0]=V*E,t[4]=V*S,t[8]=V*T,t[12]=V*C,t[1]=V*I,t[5]=V*w,t[9]=V*b,t[13]=V*M,t[2]=V*x,t[6]=V*R,t[10]=V*P,t[14]=V*A,t[3]=V*N,t[7]=V*D,t[11]=V*L,t[15]=V*O}}}),define("thor/webgl/DrawCall",["require","exports","module","thor/core/Class","thor/math/MatrixUtil"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/math/MatrixUtil");i.exports=n.create({projectionMatrix:null,modelviewMatrix:null,vertexOffset:null,indexOffset:null,indexLength:null,vertexFormat:null,textureCount:null,texture0:null,texture1:null,texture2:null,texture3:null,texture4:null,texture5:null,texture6:null,texture7:null,initialize:function(){this.projectionMatrix=new Float32Array(16),this.projectionMatrix.set(r.IDENTITY_4x4,0),this.modelviewMatrix=new Float32Array(16),this.modelviewMatrix.set(r.IDENTITY_4x4,0)},reset:function(){this.vertexFormat=null,this.vertexOffset=null,this.indexOffset=null,this.indexLength=null,this.textureCount=null,this.texture0=null,this.texture1=null,this.texture2=null,this.texture3=null,this.texture4=null,this.texture5=null,this.texture6=null,this.texture7=null,this.projectionMatrix.set(r.IDENTITY_4x4,0),this.modelviewMatrix.set(r.IDENTITY_4x4,0)},set:function(e,t,i,n,r,s,o,a,_,l,h,u,c,d,g){this.vertexFormat=e,this.projectionMatrix.set(t,0),this.modelviewMatrix.set(i,0),this.vertexOffset=n,this.indexOffset=r,this.indexLength=s,this.textureCount=o,this.texture0=a,this.texture1=_,this.texture2=l,this.texture3=h,this.texture4=u,this.texture5=c,this.texture6=d,this.texture7=g},execute:function(e){this.vertexFormat.setup(e,this),this.vertexFormat.draw(e,this)}})}),define("thor/math/ColorUtil",["require","exports","module"],function(e,t,i){i.exports={getR:function(e){return e>>24&255},getG:function(e){return e>>16&255},getB:function(e){return e>>8&255},getA:function(e){return 255&e},setR:function(e,t){return(16777215&e)+((255&t)<<24)},setG:function(e,t){return(4278255615&e)+((255&t)<<16)},setB:function(e,t){return(4294902015&e)+((255&t)<<8)},setA:function(e,t){return(4294967040&e)+(255&t)},lerp:function(e,t,i){return((255&(1-i)*(e>>24&255)+i*(t>>24&255))<<24)+((255&(1-i)*(e>>16&255)+i*(t>>16&255))<<16)+((255&(1-i)*(e>>8&255)+i*(t>>8&255))<<8)+(255&(1-i)*(255&e)+i*(255&t))},createRGBA:function(e,t,i,n){return((255&e)<<24)+((255&t)<<16)+((255&i)<<8)+(255&n)},createRGBAfloat:function(e,t,n,r){return i.exports.createRGBA(255*e,255*t,255*n,255*r)},writeToFloat32Array:function(e,t,i){t[i+0]=(e>>24&255)/255,t[i+1]=(e>>16&255)/255,t[i+2]=(e>>8&255)/255,t[i+3]=(255&e)/255},writeToUint8Array:function(e,t,i){t[i+0]=e>>24&255,t[i+1]=e>>16&255,t[i+2]=e>>8&255,t[i+3]=255&e},multiplyColors:function(e,t){return(e>>>24)*(t>>>24)/255<<24|(e>>16&255)*(t>>16&255)/255<<16|(e>>8&255)*(t>>8&255)/255<<8|(255&e)*(255&t)/255}}}),define("thor/webgl/VertexFormat",["require","exports","module","thor/core/Class"],function(e,t,i){var n=e("thor/core/Class");i.exports=n.create({initialize:function(){},setup:function(e,t){},draw:function(e,t){}})}),define("thor/webgl/shaders/LineBatch",["require","exports","module","thor/core/Class","thor/webgl/VertexFormat"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/webgl/VertexFormat"),s=["#version 100","","uniform mat4 projection;","uniform mat4 modelview;","","attribute vec2 vertexPosition;","attribute vec4 tintColor;","","varying vec4 vTintColor;","","void main(void) {","\tgl_Position = projection * modelview * vec4(vertexPosition.x, vertexPosition.y, 1.0, 1.0);","\tvTintColor = tintColor;","}"].join("\n"),o=["#version 100","","varying mediump vec4 vTintColor;","","void main(void) {","\tgl_FragColor = vTintColor;","}"].join("\n");i.exports={VERTEX_SOURCE:s,FRAGMENT_SOURCE:o,VERTEX_FORMAT:n.create(r,{shaderInstance:null,initialize:function(e){this.shaderInstance=e},setup:function(e,t){var i=e.gl,n=e.cachedGl;this.shaderInstance.activate();var r=this.shaderInstance.uniforms;n.uniformMatrix4fv(r.projection,!1,t.projectionMatrix),n.uniformMatrix4fv(r.modelview,!1,t.modelviewMatrix);var s=t.vertexOffset,o=this.shaderInstance.attributes;n.vertexAttribPointer(o.vertexPosition,2,i.FLOAT,!1,24,s+0),n.vertexAttribPointer(o.tintColor,4,i.FLOAT,!1,24,s+8)},draw:function(e,t){var i=e.gl;i.drawElements(i.TRIANGLES,t.indexLength,i.UNSIGNED_SHORT,t.indexOffset)}})}}),define("thor/webgl/LineBatch",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/math/ColorUtil","thor/math/MatrixUtil","./Shader","./Camera","./shaders/LineBatch"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/math/ColorUtil")),s=e("thor/math/MatrixUtil"),o=(e("./Shader"),e("./Camera"),e("./shaders/LineBatch")),a=new Float32Array(2);i.exports=n.create({__gl:null,__cachedGl:null,__session:null,__camera:null,__shader:null,__vertexFormat:null,__maxBatchSize:null,__modelview:null,__vertexData:null,__indexData:null,__vertexDataOffset:null,__batchSize:null,initialize:function(e,t,i,n){this.__gl=e.gl,this.__cachedGl=e.cachedGl,this.__session=e,this.__camera=t,this.__shader=i,this.__vertexFormat=new o.VERTEX_FORMAT(i),this.__maxBatchSize=n,this.__modelview=new Float32Array(16),this.__modelview.set(s.IDENTITY_4x4),this.__vertexData=new Float32Array(24*n),this.__indexData=new Uint16Array(6*n);for(var r=0;r<n;++r){var a=6*r,_=4*r;this.__indexData[a+0]=_+0,this.__indexData[a+1]=_+2,this.__indexData[a+2]=_+1,this.__indexData[a+3]=_+0,this.__indexData[a+4]=_+3,this.__indexData[a+5]=_+2}this.__vertexDataOffset=0,this.__batchSize=0},setCamera:function(e){this.__camera=e},addLine:function(e,t,i,n,o,_,l){this.__batchSize>=this.__maxBatchSize&&this.end(),_=_||4294967295,l=l||2,a[0]=e,a[1]=t,s.transformVector3x2(a,o,a);var h=a[0],u=a[1];a[0]=i,a[1]=n,s.transformVector3x2(a,o,a);var c=a[0],d=a[1],g=.5*l,p=c-h,m=d-u,f=Math.sqrt(p*p+m*m);if(0!==f){f/=g,p/=f,m/=f;var v=this.__vertexDataOffset;this.__vertexData[v]=h+m,this.__vertexData[v+1]=u-p,r.writeToFloat32Array(_,this.__vertexData,v+2),this.__vertexData[v+6]=h-m,this.__vertexData[v+7]=u+p,r.writeToFloat32Array(_,this.__vertexData,v+8),this.__vertexData[v+12]=c-m,this.__vertexData[v+13]=d+p,r.writeToFloat32Array(_,this.__vertexData,v+14),this.__vertexData[v+18]=c+m,this.__vertexData[v+19]=d-p,r.writeToFloat32Array(_,this.__vertexData,v+20),this.__vertexDataOffset+=24,this.__batchSize+=1}},addRect:function(e,t,i,n,r,s,o){this.addLine(e,t,e+i,t,r,s,o),this.addLine(e+i,t,e+i,t+n,r,s,o),this.addLine(e+i,t+n,e,t+n,r,s,o),this.addLine(e,t+n,e,t,r,s,o)},addCircle:function(e,t,i,n,r,s){this.addLine(e,t+i,e+i/3,t+i/3,n,r,s),this.addLine(e+i/3,t+i/3,e+i,t,n,r,s),this.addLine(e+i,t,e+5/3*i,t+i/3,n,r,s),this.addLine(e+5/3*i,t+i/3,e+2*i,t+i,n,r,s),this.addLine(e+2*i,t+i,e+5/3*i,t+5/3*i,n,r,s),this.addLine(e+5/3*i,t+5/3*i,e+i,t+2*i,n,r,s),this.addLine(e+i,t+2*i,e+i/3,t+5/3*i,n,r,s),this.addLine(e+i/3,t+5/3*i,e,t+i,n,r,s)},setModelView:function(e){e?this.__modelview.set(e,0):this.__modelview.set(s.IDENTITY_4x4,0)},saveModelView:function(e){e.set(this.__modelview)},end:function(){0!==this.__batchSize&&(this.__session.addDrawCall(this.__vertexFormat,this.__camera.getMatrix(),this.__modelview,this.__indexData.subarray(0,6*this.__batchSize),this.__vertexData.subarray(0,this.__vertexDataOffset),0,null,null,null,null,null,null,null,null),this.__batchSize=0,this.__vertexDataOffset=0)}})}),define("thor/webgl/ShaderCache",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","./Shader"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("./Shader"));i.exports=n.create({initialize:function(){this.__cachedShaders={}},createShader:function(e,t,i,n,s){var o=this.__createShaderKey(n,s);if(void 0!==this.__cachedShaders[o])return this.__cachedShaders[o];var a=new r(e,t,i,n,s);return this.__cachedShaders[o]=a,a},__createShaderKey:function(e,t){return e+"/"+t}})}),define("thor/webgl/shaders/SpriteBatchVertex",["require","exports","module"],function(e,t,i){return["#version 100","","uniform mediump mat4 projection;","uniform mediump mat4 modelview;","","attribute mediump vec4 transform0;","attribute mediump vec4 transform1;","attribute mediump vec4 vertexPositionUV;","attribute lowp vec4 tintColor;","attribute float textureIndex;","","varying mediump vec3 vTextureCoord;","varying lowp vec4 vTintColor;","","void main(void) {","\tvec4 col1 = vec4(transform0.xy, 0.0, 0.0);","\tvec4 col2 = vec4(transform0.zw, 0.0, 0.0);","\tvec4 col3 = vec4(0.0, 0.0, 1.0, 0.0);","\tvec4 col4 = vec4(transform1.x, transform1.y, 0.0, 1.0);","\tmat4 transform = mat4(col1, col2, col3, col4);","\tgl_Position = (projection * modelview) * transform * vec4(vertexPositionUV.x * transform1.z, vertexPositionUV.y * transform1.w, 1.0, 1.0);","","\tvTextureCoord = vec3(vertexPositionUV.zw, textureIndex);","\tvTintColor = tintColor;","}"].join("\n")}),define("thor/webgl/shaders/SpriteBatchFragSingle",["require","exports","module"],function(e,t,i){return["#version 100","","uniform lowp sampler2D sampler0;","","varying mediump vec3 vTextureCoord;","varying lowp vec4 vTintColor;","","void main(void) {","\tlowp vec4 fragColor = texture2D(sampler0, vTextureCoord.xy);","\tgl_FragColor = fragColor * vTintColor;","}"].join("\n")}),define("thor/webgl/shaders/SpriteBatchFrag2",["require","exports","module"],function(e,t,i){return["#version 100","","precision mediump float;","","uniform lowp sampler2D sampler0;","uniform lowp sampler2D sampler1;","","varying mediump vec3 vTextureCoord;","varying lowp vec4 vTintColor;","","void main(void) {","","\tlowp vec4 fragColors[2];","","\tfragColors[0] = texture2D(sampler0, vTextureCoord.xy);","\tfragColors[1] = texture2D(sampler1, vTextureCoord.xy);","","\tlowp float fragSteps[2];","\tlowp float invFragSteps[2];","","\tfragSteps[0] = step(0.5, vTextureCoord.z);","\tinvFragSteps[0] = 1.0 - fragSteps[0];","","\tfragSteps[1] = step(1.5, vTextureCoord.z);","\tinvFragSteps[1] = 1.0 - fragSteps[1];","","\tlowp vec4 fragColor = fragColors[0] * invFragSteps[0] + fragColors[1] * fragSteps[0] * invFragSteps[1];","","\tgl_FragColor = fragColor * vTintColor;","}"].join("\n")}),define("thor/webgl/shaders/SpriteBatchFragMulti",["require","exports","module"],function(e,t,i){return["#version 100","","precision mediump float;","","uniform lowp sampler2D sampler0;","uniform lowp sampler2D sampler1;","uniform lowp sampler2D sampler2;","uniform lowp sampler2D sampler3;","uniform lowp sampler2D sampler4;","uniform lowp sampler2D sampler5;","uniform lowp sampler2D sampler6;","uniform lowp sampler2D sampler7;","","varying mediump vec3 vTextureCoord;","varying lowp vec4 vTintColor;","","vec4 getSample(int index, vec2 texCoord) {","","\tif (index == -1) {","\t\treturn vec4(1.0, 1.0, 1.0, 1.0);","\t} else if(index == 0) {","\t\treturn texture2D(sampler0, texCoord);","\t} else if(index == 1) {","\t\treturn texture2D(sampler1, texCoord);","\t} else if(index == 2) {","\t\treturn texture2D(sampler2, texCoord);","\t} else if(index == 3) {","\t\treturn texture2D(sampler3, texCoord);","\t} else if(index == 4) {","\t\treturn texture2D(sampler4, texCoord);","\t} else if(index == 5) {","\t\treturn texture2D(sampler5, texCoord);","\t} else if(index == 6) {","\t\treturn texture2D(sampler6, texCoord);","\t} else if(index == 7) {","\t\treturn texture2D(sampler7, texCoord);","\t}","","}","","void main(void) {","\tgl_FragColor = getSample(int(vTextureCoord.z + 0.5), vTextureCoord.xy) * vTintColor;","}"].join("\n")}),define("thor/webgl/shaders/SpriteBatch",["require","exports","module","thor/core/Class","thor/webgl/VertexFormat","./SpriteBatchVertex","./SpriteBatchFragSingle","./SpriteBatchFrag2","./SpriteBatchFragMulti"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/webgl/VertexFormat"),s=e("./SpriteBatchVertex"),o=e("./SpriteBatchFragSingle"),a=e("./SpriteBatchFrag2"),_=e("./SpriteBatchFragMulti"),l={x:0,y:1,u:2,v:3,t0:4,t1:5,t2:6,t3:7,t4:8,t5:9,width_scale:10,height_scale:11,r:48,g:49,b:50,a:51,texture_index:13},h=new Float32Array([0,0,0,0,1,0,0,1,0,0,1,1,0,0]),u=56/Float32Array.BYTES_PER_ELEMENT,c=56/Uint8Array.BYTES_PER_ELEMENT;i.exports={VERTEX_SOURCE:s,FRAGMENT_SOURCE_SINGLE_TEXTURE:o,FRAGMENT_SOURCE_2_TEXTURE:a,FRAGMENT_SOURCE_MULTI_TEXTURE:_,VERTEX_LENGTH:56,VERTEX_FLOAT32_LENGTH:u,VERTEX_UINT8_LENGTH:c,VERTEX_OFFSETS:l,IDENTITY_VERTEX:h,VERTEX_FORMAT:n.create(r,{shaderInstance:null,initialize:function(e,t){this.shaderInstance=e,this.texturesPerCall=t},setup:function(e,t){var i=e.gl,n=e.cachedGl;this.shaderInstance.activate();var r=this.shaderInstance.uniforms;n.uniformMatrix4fv(r.projection,!1,t.projectionMatrix),n.uniformMatrix4fv(r.modelview,!1,t.modelviewMatrix);var s=t.textureCount;switch(s){case 8:t.texture7.bind(7),n.uniform1i(r.sampler7,7);case 7:t.texture6.bind(6),n.uniform1i(r.sampler6,6);case 6:t.texture5.bind(5),n.uniform1i(r.sampler5,5);case 5:t.texture4.bind(4),n.uniform1i(r.sampler4,4);case 4:t.texture3.bind(3),n.uniform1i(r.sampler3,3);case 3:t.texture2.bind(2),n.uniform1i(r.sampler2,2);case 2:t.texture1.bind(1),n.uniform1i(r.sampler1,1);case 1:t.texture0.bind(0),n.uniform1i(r.sampler0,0)}switch(this.texturesPerCall-s){case 7:e.defaultTexture1.bind(1),n.uniform1i(r.sampler1,1);case 6:e.defaultTexture2.bind(2),n.uniform1i(r.sampler2,2);case 5:e.defaultTexture3.bind(3),n.uniform1i(r.sampler3,3);case 4:e.defaultTexture4.bind(4),n.uniform1i(r.sampler4,4);case 3:e.defaultTexture5.bind(5),n.uniform1i(r.sampler5,5);case 2:
e.defaultTexture6.bind(6),n.uniform1i(r.sampler6,6);case 1:e.defaultTexture7.bind(7),n.uniform1i(r.sampler7,7)}var o=t.vertexOffset,a=this.shaderInstance.attributes;n.vertexAttribPointer(a.vertexPositionUV,4,i.FLOAT,!1,56,o+0),n.vertexAttribPointer(a.transform0,4,i.FLOAT,!1,56,o+16),n.vertexAttribPointer(a.transform1,4,i.FLOAT,!1,56,o+32),n.vertexAttribPointer(a.tintColor,4,i.UNSIGNED_BYTE,!0,56,o+48),n.vertexAttribPointer(a.textureIndex,1,i.FLOAT,!1,56,o+52)},draw:function(e,t){var i=e.gl;i.drawElements(i.TRIANGLE_STRIP,t.indexLength,i.UNSIGNED_SHORT,t.indexOffset)}})}}),define("thor/webgl/SpriteBatch",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/math/ColorUtil","thor/math/MatrixUtil","./Shader","./Camera","./shaders/SpriteBatch"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=(e("thor/core/Validation"),e("thor/math/ColorUtil")),o=e("thor/math/MatrixUtil"),a=(e("./Shader"),e("./Camera"),e("./shaders/SpriteBatch")),_=a.VERTEX_FORMAT,l=[new Float32Array([0,0]),new Float32Array([0,1]),new Float32Array([1,1]),new Float32Array([1,0])],h=new Float32Array(o.IDENTITY_3x2),u=new Float32Array(o.IDENTITY_3x2),c=new Float32Array(4*a.VERTEX_FLOAT32_LENGTH),d=new Float32Array(c.buffer,16,a.VERTEX_FLOAT32_LENGTH-4),g=new Uint8Array(c.buffer),p=s.createRGBA(255,255,255,255),m=a.VERTEX_OFFSETS,f=a.VERTEX_LENGTH,v=a.VERTEX_FLOAT32_LENGTH,y=a.VERTEX_UINT8_LENGTH;i.exports=n.create({__camera:null,__shader:null,__vertexFormat:null,__indexData:null,__indexCount:null,__maxBatchSize:null,__vertexData:null,__vertexDataFloat32:null,__vertexDataUint8:null,__vertexCount:null,__maxVerts:null,__currentTextures:null,__modelview:null,initialize:function(e,t,i,n,r,s){this.__vertexFormat=new _(i,s),this.__session=e,this.__camera=t,this.__shader=i,this.__modelview=new Float32Array(16),this.__modelview.set(o.IDENTITY_4x4),this.__currentTextureCount=0,this.__texturesPerCall=s,this.__currentTextures=new Array(this.__texturesPerCall);for(var h=0;h<this.__texturesPerCall;++h)this.__currentTextures[h]=null;this.__indexData=new Uint16Array(6*n),this.__vertexData=new ArrayBuffer(f*n*4),this.__vertexDataUint8=new Uint8Array(this.__vertexData),this.__vertexDataFloat32=new Float32Array(this.__vertexData),this.__indexCount=0,this.__vertexCount=0,this.__maxVerts=this.__vertexData.byteLength/f,this.__maxBatchSize=n,this.__transformStack=[],this.__combinedTransformStack=[],this.__combinedTransformAlphaStack=[],this.__tintStack=[];for(var h=0;h<4;++h){var u=a.VERTEX_FLOAT32_LENGTH*h;c.set(l[h],u)}},pushTransform:function(e){var t=this.__combinedTransformStack[0],i=this.__combinedTransformAlphaStack[0];t?(o.multiply3x2(t,e.transform,h),this.__combinedTransformStack.unshift(new Float32Array(h)),this.__combinedTransformAlphaStack.unshift(i*e.alpha)):(this.__combinedTransformStack.unshift(e.transform),this.__combinedTransformAlphaStack.unshift(e.alpha)),this.__transformStack.unshift(e)},popTransform:function(){this.__transformStack.shift(),this.__combinedTransformStack.shift(),this.__combinedTransformAlphaStack.shift()},pushTint:function(e){this.__tintStack.unshift(e)},peekTint:function(){return this.__tintStack[0]||p},popTint:function(){this.__tintStack.shift()},setCamera:function(e){this.__camera=e},__increaseBatchSize:function(){var e=2*this.__maxBatchSize,t=this.__indexData;this.__vertexData;this.__indexData=new Uint16Array(6*e);var i=f*e*4;this.__vertexData=new ArrayBuffer(i);var n=this.__vertexDataFloat32;this.__vertexDataFloat32=new Float32Array(this.__vertexData),this.__vertexDataUint8=new Uint8Array(this.__vertexData),this.__vertexDataFloat32.set(n,0),this.__indexData.set(t,0),r.debug("Resized from "+this.__maxBatchSize+" to "+e),this.__maxBatchSize=e,this.__maxVerts=i/f},setModelView:function(e){e?this.__modelview.set(e,0):this.__modelview.set(o.IDENTITY_4x4,0)},getModelView:function(){return this.__modelview},saveModelView:function(e){e.set(this.__modelview)},begin:function(){for(var e=0;e<this.__texturesPerCall;++e)this.__currentTextures[e]=null;this.__indexCount=0,this.__vertexCount=0,this.__currentTextureCount=0},__getNextTextureUnit:function(e){if(!e)return-1;for(var t=-1,i=0;i<this.__texturesPerCall;++i)if(this.__currentTextures[i]===e){t=i;break}return t===-1&&(this.__currentTextureCount===this.__texturesPerCall&&this.end(),t=this.__currentTextureCount,this.__currentTextures[t]=e,this.__currentTextureCount++),t},add:function(e,t,i,n,r){var s=r||p;return this.addColored(e,t,i,n,s,s,s,s)},addColored:function(e,t,i,n,r,s,_,l){var u=c,p=d,m=g,f=this.__indexData,y=this.__indexCount,E=this.__vertexCount;(E+4>this.__maxVerts||y+6>f.length)&&(this.__resizeable?this.__increaseBatchSize():this.end());var S=this.__getNextTextureUnit(e);y=this.__indexCount,E=this.__vertexCount;var T=1,C=this.__combinedTransformStack[0];C?(T=this.__combinedTransformAlphaStack[0],o.multiply3x2(C,i,h),u.set(h,4)):u.set(i,4);var I,w,b,M,x,R,P,A,N,D,L,O,V,B,k,W,F=this.peekTint();if(r===s&&r===_&&r===l){var U=(r>>>24)*(F>>>24)/255,G=(r>>16&255)*(F>>16&255)/255,H=(r>>8&255)*(F>>8&255)/255,q=(255&r)*(255&F)/255*T;I=w=b=M=U,x=R=P=A=G,N=D=L=O=H,V=B=k=W=q}else I=(r>>>24)*(F>>>24)/255,x=(r>>16&255)*(F>>16&255)/255,N=(r>>8&255)*(F>>8&255)/255,V=(255&r)*(255&F)/255*T,w=(s>>>24)*(F>>>24)/255,R=(s>>16&255)*(F>>16&255)/255,D=(s>>8&255)*(F>>8&255)/255,B=(255&s)*(255&F)/255*T,b=(_>>>24)*(F>>>24)/255,P=(_>>16&255)*(F>>16&255)/255,L=(_>>8&255)*(F>>8&255)/255,k=(255&_)*(255&F)/255*T,M=(l>>>24)*(F>>>24)/255,A=(l>>16&255)*(F>>16&255)/255,O=(l>>8&255)*(F>>8&255)/255,W=(255&l)*(255&F)/255*T;u[10]=n[0],u[11]=n[1],u[13]=S,u[2]=t[0],u[3]=t[1];for(var Y=1;Y<4;++Y){var z=a.VERTEX_FLOAT32_LENGTH*Y,X=z+2,K=z+3,j=2*Y,Q=j+1;u[X]=t[j],u[K]=t[Q],u.set(p,z+4)}m[48]=I,m[49]=x,m[50]=N,m[51]=V,m[104]=w,m[105]=R,m[106]=D,m[107]=B,m[160]=b,m[161]=P,m[162]=L,m[163]=k,m[216]=M,m[217]=A,m[218]=O,m[219]=W;var Z=E*v;if(this.__vertexDataFloat32.set(u,Z),y>2){y+=2;var J=y-3,$=y-2,ee=y-1;f[$]=f[J],f[ee]=E+1}var te=y+1,ie=y+2,ne=y+3;f[y]=E+1,f[te]=E+0,f[ie]=E+2,f[ne]=E+3,y+=4,this.__indexCount=y,E+=4,this.__vertexCount=E},addVerts:function(e,t,i){var n=t.byteLength/f,r=n,s=i.length+2;(this.__vertexCount+r>this.__maxVerts||this.__indexCount+s>this.__indexData.length)&&(this.__resizeable?this.__increaseBatchSize():this.end());var a=this.__getNextTextureUnit(e),_=this.__indexCount,l=this.__vertexCount;if(_>2){_+=2;var c=_-3,d=_-2,g=_-1;this.__indexData[d]=this.__indexData[c],this.__indexData[g]=l+i[0]}for(var E=0;E<i.length;++E){var S=_+E;this.__indexData[S]=l+i[E]}this.__vertexDataFloat32.set(t,l*v);var T=this.__combinedTransformStack[0];if(T)for(var C=h,I=u,w=this.__combinedTransformAlphaStack[0],E=0;E<n;++E){var b=(l+E)*v;I[0]=this.__vertexDataFloat32[b+4],I[1]=this.__vertexDataFloat32[b+5],I[2]=this.__vertexDataFloat32[b+6],I[3]=this.__vertexDataFloat32[b+7],I[4]=this.__vertexDataFloat32[b+8],I[5]=this.__vertexDataFloat32[b+9];var M=(l+E)*y+51;this.__vertexDataUint8[M]*=w,o.multiply3x2(T,I,C),this.__vertexDataFloat32.set(C,b+4)}for(var E=0;E<n;++E){var x=(l+E)*v+13;this.__vertexDataFloat32[x]=a}var R=this.peekTint();if(R!==p)for(var P=this.__vertexDataUint8,A=R>>>24&255,N=R>>>16&255,D=R>>>8&255,L=255&R,E=0;E<n;++E){var O=(l+E)*y+m.r,V=O+1,B=O+2,k=O+3,W=P[O],F=P[V],U=P[B],G=P[k],H=W*A/255,q=F*N/255,Y=U*D/255,z=G*L/255;P[O]=H,P[V]=q,P[B]=Y,P[k]=z}_+=i.length,this.__indexCount=_,l+=n,this.__vertexCount=l},end:function(){if(0!==this.__vertexCount){this.__session.addDrawCall(this.__vertexFormat,this.__camera.getMatrix(),this.__modelview,this.__indexData.subarray(0,this.__indexCount),this.__vertexDataFloat32.subarray(0,this.__vertexCount*v),this.__currentTextureCount,this.__currentTextures[0],this.__currentTextures[1],this.__currentTextures[2],this.__currentTextures[3],this.__currentTextures[4],this.__currentTextures[5],this.__currentTextures[6],this.__currentTextures[7]),this.__indexCount=0,this.__vertexCount=0,this.__currentTextureCount=0;for(var e=0;e<this.__texturesPerCall;++e)this.__currentTextures[e]=null}else{this.__currentTextureCount=0;for(var e=0;e<this.__texturesPerCall;++e)this.__currentTextures[e]=null}}}),i.exports.UNIT_QUAD_XYUVS=l}),define("thor/webgl/Framebuffer",["require","exports","module","thor/core/Class","thor/core/Validation","./Texture","./Camera"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Texture")),s=(e("./Camera"),[0,0,0,0]);i.exports=n.create({initialize:function(e,t,i,n){var s=e.gl,o=e.cachedGl;this.__gl=s,this.__cachedGl=o,this.__width=t,this.__height=i,this.__camera=n,this.__framebuffer=s.createFramebuffer();var a=document.createElement("div");a.src="FramebufferBackingTexture",a.naturalWidth=t,a.naturalHeight=i,this.__backingTexture=new r(e,a,{skipUploadImage:!0}),this.__backingTexture.bind(0),s.bindFramebuffer(s.FRAMEBUFFER,this.__framebuffer),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.__width,this.__height,0,s.RGBA,s.UNSIGNED_BYTE,null),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.__backingTexture.__webglTexture,0),this.clear(),s.bindFramebuffer(s.FRAMEBUFFER,null)},clear:function(){this.__cachedGl.getClearColor(s),this.__cachedGl.clearColor(0,0,0,0),this.__gl.clear(this.__gl.COLOR_BUFFER_BIT),this.__cachedGl.clearColor(s[0],s[1],s[2],s[3])},getWidth:function(){return this.__width},getHeight:function(){return this.__height},getBackingTexture:function(){return this.__backingTexture},getFramebuffer:function(){return this.__framebuffer},getCamera:function(){return this.__camera}})}),define("thor/webgl/WebGLRenderingSession",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/config/Config","thor/util/RingBuffer","thor/debug/PerformanceOverlay","./Camera","./Shader","./Buffer","./Texture","./DrawCall","./LineBatch","./ShaderCache","./SpriteBatch","./Framebuffer","thor/webgl/shaders/SpriteBatch","thor/webgl/shaders/LineBatch"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Device"),s=e("thor/core/Logger").getLogger(i),o=e("thor/core/Validation"),a=e("thor/config/Config"),_=e("thor/util/RingBuffer"),l=e("thor/debug/PerformanceOverlay"),h=e("./Camera"),u=(e("./Shader"),e("./Buffer")),c=e("./Texture"),d=e("./DrawCall"),g=e("./LineBatch"),p=e("./ShaderCache"),m=e("./SpriteBatch"),f=e("./Framebuffer"),v=e("thor/webgl/shaders/SpriteBatch"),y=e("thor/webgl/shaders/LineBatch"),E=n.create({initialize:function(e){this.gl=e,this.__clearColor=[0,0,0,0],this.__bufferCache={},this.__uniform1iLocations=[],this.__uniform1iCache=[],this.__vertexAttribPointerCache={},this.__activeProgram=null,this.__enabledVertexAttributes={},this.__uniformMatrix4fvLocations=[],this.__uniformMatrix4fvCache=[]},enableVertexAttribArray:function(e){this.__enabledVertexAttributes[e]||(this.gl.enableVertexAttribArray(e),this.__enabledVertexAttributes[e]=!0)},disableVertexAttribArray:function(e){this.__enabledVertexAttributes[e]&&0!==e&&(this.gl.disableVertexAttribArray(e),this.__enabledVertexAttributes[e]=!1)},useProgram:function(e){e!==this.__activeProgram&&(this.gl.useProgram(e),this.__activeProgram=e)},bindBuffer:function(e,t){this.__bufferCache[e]!==t&&(this.gl.bindBuffer(e,t),this.__bufferCache[e]=t)},uniformMatrix4fv:function(e,t,i){for(var n=0;n<this.__uniformMatrix4fvLocations.length;++n)if(this.__uniformMatrix4fvLocations[n]===e){var r=this.__uniformMatrix4fvCache[n],s=!1;if(r.length===i.length){s=!0;for(var o=0;o<r.length;){if(r[o]!==i[o]){s=!1,r.set(i,0);break}o++}}else this.__uniformMatrix4fvCache[n]=new Float32Array(i);return void(s||this.gl.uniformMatrix4fv(e,t,i))}this.gl.uniformMatrix4fv(e,t,i),this.__uniformMatrix4fvLocations.push(e),r=new Float32Array(i),this.__uniformMatrix4fvCache.push(r)},clearColor:function(e,t,i,n){this.__clearColor[0]===e&&this.__clearColor[1]===t&&this.__clearColor[2]===i&&this.__clearColor[3]===n||(this.__clearColor[0]=e,this.__clearColor[1]=t,this.__clearColor[2]=i,this.__clearColor[3]=n,this.gl.clearColor(e,t,i,n))},getClearColor:function(e){e[0]=this.__clearColor[0],e[1]=this.__clearColor[1],e[2]=this.__clearColor[2],e[3]=this.__clearColor[3]},uniform1i:function(e,t){for(var i=0;i<this.__uniform1iLocations.length;++i)if(this.__uniform1iLocations[i]===e)return void(this.__uniform1iCache[i]!==t&&(this.gl.uniform1i(e,t),this.__uniform1iCache[i]=t));this.gl.uniform1i(e,t),this.__uniform1iLocations.push(e),this.__uniform1iCache.push(t)},vertexAttribPointer:function(e,t,i,n,r,s){var o=this.__vertexAttribPointerCache[e];o||(o={buffer:null,size:null,type:null,normalized:null,stride:null,offset:null}),o.buffer===this.__bufferCache[this.gl.ARRAY_BUFFER]&&o.size===t&&o.type===i&&o.normalized===n&&o.stride===r&&o.offset===s||(this.gl.vertexAttribPointer(e,t,i,n,r,s),o.buffer=this.__bufferCache[this.gl.ARRAY_BUFFER],o.size=t,o.type=i,o.normalized=n,o.stride=r,o.offset=s,this.__vertexAttribPointerCache[e]=o)}});i.exports=n.create({mainCamera:null,currentCamera:null,spriteBatch:null,gl:null,shaderCache:null,spriteShader:null,indexData:null,indexBuffer:null,indexOffset:null,indexLength:null,vertexData:null,vertexDataF32:null,vertexDataU8:null,vertexBuffer:null,vertexByteOffset:null,vertexByteLength:null,defaultTexture:null,__drawCallBuffer:null,__drawCalls:null,__drawCallCount:null,initialize:function(e,t,i){var n=t||1e3,o=i||1e3,h=e.getParameter(e.RENDERER),f=e.getParameter(e.VENDOR),S=e.getParameter(e.VERSION);s.debug("GL RENDERER INFO: "+h+" - "+f+" - "+S);var T=!1,C=e.getExtension("WEBGL_debug_renderer_info");if(C){var f=e.getParameter(C.UNMASKED_VENDOR_WEBGL),h=e.getParameter(C.UNMASKED_RENDERER_WEBGL);s.debug("GL RENDERER DEBUG INFO: Vendor "+f+" - Renderer "+h);/Adreno/g.test(h)&&(s.debug("GL - Detected Adreno GPU, falling back to single texture mode"),T=!0)}this.cachedGl=new E(e),this.cachedGl.clearColor(0,0,0,1),e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE),this.gl=e,this.shaderCache=new p;var I=8;T&&(I=1);var w;1===I?w=v.FRAGMENT_SOURCE_SINGLE_TEXTURE:2===I?w=v.FRAGMENT_SOURCE_2_TEXTURE:8===I&&(w=v.FRAGMENT_SOURCE_MULTI_TEXTURE),this.spriteShader=this.shaderCache.createShader(e,this.cachedGl,"Sprite Batch",v.VERTEX_SOURCE,w),this.lineShader=this.shaderCache.createShader(e,this.cachedGl,"Line Batch",y.VERTEX_SOURCE,y.FRAGMENT_SOURCE),this.indexData=new Uint16Array(6*n),this.indexBuffer=new u(e,this.cachedGl,u.Type.ELEMENT_BUFFER,this.indexData),this.indexOffset=0,this.indexLength=this.indexData.length,this.vertexData=new ArrayBuffer(4*n*v.VERTEX_LENGTH),this.vertexDataF32=new Float32Array(this.vertexData),this.vertexDataU8=new Uint8Array(this.vertexData),this.vertexBuffer=new u(e,this.cachedGl,u.Type.ARRAY_BUFFER,this.vertexData),this.vertexByteOffset=0,this.vertexByteLength=this.vertexData.byteLength,this.onViewportResized(r.viewportWidth,r.viewportHeight),this.currentCamera=this.mainCamera,this.spriteBatch=new m(this,this.currentCamera,this.spriteShader,o,!0,I),this.lineBatch=new g(this,this.currentCamera,this.lineShader,1e3,!1),this.__drawCalls=new Array(25),this.__drawCallCount=0,this.__drawCallBuffer=new _(new Array(25),25);for(var b=0;b<25;++b)this.__drawCallBuffer.add(new d);this.frameCount=0,this.__drawCallMaximum=5;var M=document.createElement("canvas");M.width=1,M.height=1,M.src="DummyTexture",M.getContext("2d").clearRect(0,0,M.width,M.height),this.defaultTexture=c.getTextureFromDomImage(this,M),this.defaultTexture1=new c(this,M),this.defaultTexture2=new c(this,M),this.defaultTexture3=new c(this,M),this.defaultTexture4=new c(this,M),this.defaultTexture5=new c(this,M),this.defaultTexture6=new c(this,M),this.defaultTexture7=new c(this,M);var x=e.getExtension("EXT_disjoint_timer_query");if(a.ENABLE_GL_PROFILING&&x){s.debug("EXT_disjoint_timer_query is available, initializing"),this.__disjointTimerQuery=x,this.__queryBuffer=new _(new Array(16),16);for(var b=0;b<16;++b)this.__queryBuffer.add({id:b,startQuery:null,endQuery:null,waiting:!1});this.__activeQueries={}}var R=l.getInstance();this.onFrameStart=R.addInstrumentedTask("Frame Start",this.onFrameStart.bind(this),1e3,5,10),this.onFrameEnd=R.addInstrumentedTask("Frame End",this.onFrameEnd.bind(this),1e3,5,10)},setFramebuffer:function(e){o.ifDefined.assertIsInstanceOf(e,f);var t=this.gl;this.onFrameEnd(),e?(t.bindFramebuffer(t.FRAMEBUFFER,e.__framebuffer),this.gl.viewport(0,0,e.getWidth(),e.getHeight()),this.spriteBatch.setCamera(e.getCamera()),this.lineBatch.setCamera(e.getCamera())):(t.bindFramebuffer(t.FRAMEBUFFER,null),this.gl.viewport(0,0,r.viewportWidth,r.viewportHeight),this.spriteBatch.setCamera(this.mainCamera),this.lineBatch.setCamera(this.mainCamera)),this.onFrameStart()},__resizeBuffers:function(e,t){var i=Math.ceil(1.5*t);i<this.indexLength&&(i=this.indexLength);var n=this.indexOffset+(e>i?e:i),r=new Uint16Array(n);r.set(this.indexData,0),this.indexData=r,this.indexBuffer.resize(this.indexData),this.indexLength=n;var o=Math.ceil(n*(4/6))*Float32Array.BYTES_PER_ELEMENT*v.VERTEX_LENGTH,a=new ArrayBuffer(o),_=new Uint8Array(a);_.set(this.vertexDataU8,0),this.vertexData=a,this.vertexDataU8=_,this.vertexDataF32=new Float32Array(this.vertexData),this.vertexByteLength=this.vertexData.byteLength,this.vertexBuffer.resize(this.vertexDataU8),s.warn("Resized drawing buffers to "+n+" indices and "+o+" vertex bytes")},startTimerQuery:function(){var e=this.__disjointTimerQuery;if(!e)return-1;var t=this.__queryBuffer.remove();return t?(t.startQuery=e.createQueryEXT(),t.endQuery=e.createQueryEXT(),t.waiting=!1,e.queryCounterEXT(t.startQuery,e.TIMESTAMP_EXT),this.__activeQueries[t.id]=t,t.id):-1},endTimerQuery:function(e){var t=this.__disjointTimerQuery;if(t){var i=this.__activeQueries[e];i&&!i.waiting&&(t.queryCounterEXT(i.endQuery,t.TIMESTAMP_EXT),i.waiting=!0)}},onFrameStart:function(){var e=this.__disjointTimerQuery;if(e){var t=this.spriteBatch.getStats();this.__queryBuffer.getArray();for(var i in this.__activeQueries){var n=this.__activeQueries[i];if(n.waiting){var r=e.getQueryObjectEXT(n.endQuery,e.QUERY_RESULT_AVAILABLE_EXT),o=this.gl.getParameter(e.GPU_DISJOINT_EXT);if(r&&!o){var a=e.getQueryObjectEXT(n.startQuery,e.QUERY_RESULT_EXT),_=e.getQueryObjectEXT(n.endQuery,e.QUERY_RESULT_EXT),l=_-a,h=t.flushIndexByTimerId[n.id];if(h>=0){var u=t.cumulativeAverageByFlushIndex[h]||0;t.cumulativeAverageByFlushIndex[h]=(u*this.frameCount+l)/(this.frameCount+1),delete t.flushIndexByTimerId[n.id]}}(o||r)&&(delete this.__activeQueries[i],e.deleteQueryEXT(n.startQuery),e.deleteQueryEXT(n.endQuery),n.startQuery=null,n.endQuery=null,n.waiting=!1,this.__queryBuffer.add(n))}}if(this.frameCount%60==0)for(var h in t.cumulativeAverageByFlushIndex)s.debug("CMA (ms) for flush index "+h+": "+1e-6*t.cumulativeAverageByFlushIndex[h]);this.__frameTimerQueryId=this.startTimerQuery()}this.spriteBatch.begin()},addDrawCall:function(e,t,i,n,r,s,o,a,_,l,h,u,c,d){var g=n.length,p=r.byteLength;(this.indexOffset+g>this.indexLength||this.vertexByteOffset+p>this.vertexByteLength)&&this.__resizeBuffers(g,p/v.VERTEX_LENGTH);var m=this.__getDrawCall();m.set(e,t,i,this.vertexByteOffset,this.indexOffset*Uint16Array.BYTES_PER_ELEMENT,g,s,o,a,_,l,h,u,c,d),this.__drawCalls[this.__drawCallCount]=m,++this.__drawCallCount,this.indexData.set(n,this.indexOffset);var f=new Uint8Array(r.buffer,0,p);this.vertexDataU8.set(f,this.vertexByteOffset),this.indexOffset+=g,this.vertexByteOffset+=p},__getDrawCall:function(){var e=this.__drawCallBuffer.remove();return null!==e?e:(this.__flushDrawCalls(),e=this.__drawCallBuffer.remove())},onFrameEnd:function(){this.spriteBatch.end(),this.lineBatch.end(),this.__flushDrawCalls(),this.endTimerQuery(this.__frameTimerQueryId),this.frameCount++},__flushDrawCalls:function(){this.vertexBuffer.update(0,this.vertexDataU8.subarray(0,this.vertexByteOffset)),this.indexBuffer.update(0,this.indexData.subarray(0,this.indexOffset));for(var e=0;e<this.__drawCallCount;++e){var t=this.__drawCalls[e];t.execute(this),t.reset(),this.__drawCallBuffer.add(t),this.__drawCalls[e]=null}this.__drawCallCount=0,this.indexOffset=0,this.vertexByteOffset=0},onViewportResized:function(e,t){this.gl.viewport(0,0,e,t),this.mainCamera=h.makeOrthographic(0,e,t,0,-1,1,this.mainCamera)}})}),define("thor/graphics/Surface",["require","exports","module","thor/config/Config","thor/core/Class","thor/core/Base","thor/core/Validation","thor/webgl/WebGLRenderingSession","thor/webgl/Camera","thor/core/Device","thor/core/ViewportResizeDelegate"],function(e,t,i){var n=(e("thor/config/Config"),e("thor/core/Class")),r=e("thor/core/Base"),s=e("thor/core/Validation"),o=e("thor/webgl/WebGLRenderingSession"),a=(e("thor/webgl/Camera"),e("thor/core/Device")),_=e("thor/core/ViewportResizeDelegate"),l={CANVAS2D:0,WEBGL:1};i.exports=n.create(r,_,{__domComponent:null,__renderer:null,__mode:null,initialize:function(e,t,i){s.ifDefined.assertIsNumber(t),s.ifDefined.assertIsNumber(i),this.__domComponent=e,a.addViewportResizeDelegate(this),this.__initializeRenderer(t,i)},__initializeRenderer:function(e,t){var i=null,n={antialias:!1,stencil:!0};if(null===(i=this.__domComponent.getContext("webgl",n)||this.__domComponent.getContext("experimental-webgl",n)))throw new Error("Failed to initialize WebGL");this.__mode=l.WEBGL,this.__renderer=new o(i,e,t),this.__domComponent.addEventListener("webglcontextlost",function(e){console.error("WebGL Context Lost!")}),this.onViewportResized(a)},onViewportResized:function(e,t){this.__renderer.onViewportResized&&this.__renderer.onViewportResized(e.viewportWidth,e.viewportHeight)},getRenderer:function(){return this.__renderer},onFrameEnd:function(){this.__renderer.onFrameEnd()},getWidth:function(){return this.__domComponent.width},getHeight:function(){return this.__domComponent.height},getMode:function(){return this.__mode}}),i.exports.DrawingMode=l}),define("thor/graphics/animation/EasingFunctions",["require","exports","module"],function(e,t,i){function n(e){return e}function r(e){return(1-Math.cos(e*Math.PI))/2}function s(e){return e*e*(3-2*e)}function o(e){return e*e*e*(e*(6*e-15)+10)}function a(e){var t=e*e*e;return t*(7+e*(t-7))}function _(e){var t=e*e,i=t*t;return i*(25-48*e+t*(25-i))}function l(e){return e*e}function h(e){return e*(2-e)}function u(e){var t=e*e;return t*t}function c(e){var t=1-e,i=t*t;return 1-i*i}function d(e){return e<1/2.75?e*e*7.5625:e<2/2.75?(e-=1.5/2.75)*e*7.5625+.75:e<2.5/2.75?(e-=2.25/2.75)*e*7.5625+.9375:(e-=2.625/2.75)*e*7.5625+.984375}function g(e){return e<.9?4.44444*e-4.93827*e*e:32*(e*e-1.9*e+.9)}function p(e){return Math.pow(2,-10*e)*Math.sin(2*(e-.075)*Math.PI/.3)+1}function m(e){return e/=2,Math.exp(-16*e)*Math.sin(2*(e-.075)*Math.PI/.3)+1}function f(e){return e<.75?1.3333*e:-5.3333*e*e+9.3333*e-3}function v(e){return e<.15?3.333333*e:e<.25?2*e+.2:e<.35?1.5*e+.325:e<.5?.666667*e+.6166667:.1*e+.9}function y(e){var t=-(e*e);return Math.E*e*Math.exp(t)}function E(e){return e-=.5,Math.exp(-32*e*e)}function S(e){return e<.2?5*e*e-e:1.25*e-.25}function T(e,t,i,n){function r(e,t){return 1-3*t+3*e}function s(e,t){return 3*t-6*e}function o(e){return 3*e}function a(e,t,i){return((r(t,i)*e+s(t,i))*e+o(t))*e}function _(e,t,i){return 3*r(t,i)*e*e+2*s(t,i)*e+o(t)}function l(t){for(var n=t,r=0;r<4;++r){var s=_(n,e,i);if(0==s)return n;n-=(a(n,e,i)-t)/s}return n}this.get=function(r){return e==t&&i==n?r:a(l(r),t,n)}}function C(e,t,i,n){return new T(e,t,i,n).get}i.exports={interpolateLinear:n,interpolateCosine:r,interpolateCubic:s,interpolateQuintic:o,interpolateSeptimic:a,interpolateDecimic:_,easeIn:l,easeOut:h,fastEaseIn:u,fastEaseOut:c,easeInOut:s,bounce:d,bounceLoop:g,elastic:p,stiffelastic:m,overshoot:f,sigmoid:v,exponentialOvershoot:y,pulse:E,startBounce:S,createBezier:C}}),define("thor/graphics/animation/Tweenable",["require","exports","module","thor/core/Class","thor/core/Validation","./EasingFunctions"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation"),e("./EasingFunctions");i.exports=n.create({initialize:function(){},isAnimating:function(){return!1},update:function(e){}})}),define("thor/graphics/animation/Tween",["require","exports","module","thor/core/Class","thor/core/Validation","./Tweenable","./EasingFunctions"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./Tweenable"),o=e("./EasingFunctions");i.exports=n.create(s,{initialize:function(e,t,i,n){r.ifDefined.assertIsFunction(n),this.__initialValue=e,this.__finalValue=t,this.__durationMs=i,this.__easingFunction=n||o.interpolateLinear,this.__elapsedTime=0,this.__current=e},setDuration:function(e){this.__durationMs=e},setInitialValue:function(e){this.__initialValue=e},setFinalValue:function(e){this.__finalValue=e},setEasingFunction:function(e){this.__easingFunction=e},restart:function(){this.__elapsedTime=0},reset:function(){this.__elapsedTime=0,this.__current=this.__initialValue},reverse:function(){var e=this.__initialValue;this.__initialValue=this.__finalValue,this.__finalValue=e},getValue:function(){return this.__current},valueOf:function(){return this.__current},isAnimating:function(){return this.__elapsedTime<=this.__durationMs},update:function(e){var t=this.__durationMs-this.__elapsedTime,i=Math.min(t,e);this.__elapsedTime+=e;var n=Math.min(1,Math.max(0,this.__elapsedTime/this.__durationMs));return this.__current=this.__initialValue+this.__easingFunction(n)*(this.__finalValue-this.__initialValue),e-i}})}),define("thor/graphics/animation/actions/Action",["require","exports","module","thor/core/Class","thor/core/Validation","../Tween"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation"),e("../Tween");i.exports=n.create({initialize:function(){this.reset()},reset:function(){},setTarget:function(e){this._target=e},isComplete:function(){return!0},update:function(e){}})}),define("thor/graphics/animation/Transform",["require","exports","module","thor/core/Class","thor/core/Validation","thor/math/ColorUtil","thor/math/MatrixUtil","thor/math/MatrixOrderings","thor/graphics/animation/actions/Action"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/math/ColorUtil"),e("thor/math/MatrixUtil")),s=e("thor/math/MatrixOrderings"),o=(e("thor/graphics/animation/actions/Action"),n.create({initialize:function(){this.reset()},pause:function(){this.__paused=!0},resume:function(){this.__paused=!1},setPaused:function(e){this.__paused=e},reset:function(){return this.__paused=!1,this.__action=null,this.xOrigin=0,this.yOrigin=0,this.x=0,this.y=0,this.sx=1,this.sy=1,this.tx=0,this.ty=0,this.rad=0,this.xshear=0,this.matrixMode=s.TRTS,this.transform=new Float32Array(r.IDENTITY_3x2),this.alpha=1,this},resetToOrigin:function(){var e=this.tx,t=this.ty,i=this.xOrigin,n=this.yOrigin;this.reset(),this.x=i,this.y=n,this.tx=e,this.ty=t,this.xOrigin=i,this.yOrigin=n},saveOrigin:function(){this.xOrigin=this.x,this.yOrigin=this.y},completeAction:function(){for(;this.__action&&!this.__action.isComplete();)this.update(1/0)},clearAction:function(){this.__action=null},setAction:function(e){e.setTarget(this),this.__action=e},getAction:function(){return this.__action},update:function(e){return!this.__paused&&(!(this.__action&&!this.__action.isComplete())||(this.__action.update(e),r.transform(r.IDENTITY_3x2,this.transform,this.x,this.y,this.rad,this.xshear,this.sx,this.sy,this.matrixMode,this.tx,this.ty),!1))}}));i.exports=o}),define("thor/ui/Vector",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({initialize:function(e,t){this.x=e,this.y=t}})}),define("thor/ui/Geometry",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({initialize:function(e,t,i,n){this.__absolutePositionX=e,this.__absolutePositionY=t,this.__sizeX=i,this.__sizeY=n,this.__transform=null},copyFrom:function(e){this.__sizeX=e.__sizeX,this.__sizeY=e.__sizeY,this.__absolutePositionX=e.__absolutePositionX,this.__absolutePositionY=e.__absolutePositionY,this.__transform=e.__transform},createOffsetGeometry:function(e,t,i,n,r){e.__absolutePositionX=Math.min(this.__absolutePositionX+t,this.__absolutePositionX+this.__sizeX),e.__absolutePositionY=Math.min(this.__absolutePositionY+i,this.__absolutePositionY+this.__sizeY),e.__sizeX=Math.max(0,Math.min(n,this.__sizeX-t)),e.__sizeY=Math.max(0,Math.min(r,this.__sizeY-i))},getWidth:function(){return this.__sizeX},getHeight:function(){return this.__sizeY},getX:function(){return this.__absolutePositionX},getY:function(){return this.__absolutePositionY}})}),define("thor/ui/Widget",["require","exports","module","thor/core/Class","thor/core/Validation","thor/math/MatrixUtil","thor/graphics/animation/Transform","thor/graphics/animation/actions/Action","thor/core/Scheduler","./Vector","./Geometry"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/math/MatrixUtil"),o=e("thor/graphics/animation/Transform"),a=(e("thor/graphics/animation/actions/Action"),e("thor/core/Scheduler")),_=e("./Vector"),l=e("./Geometry"),h={VISIBLE:0,HIDDEN:1,COLLAPSED:2};i.exports=n.create({initialize:function(){this.__desiredSize=new _(0,0),this.__cachedGeometry=new l(0,0,0,0),this.__namedSlots={},this.__namedSlotNames=[],this.__name=void 0,this.__visibility=h.VISIBLE,this._transform=null,this.__actionTaskId=null},runAction:function(e,t,i){r.ifDefined.assertIsBoolean(t),r.ifDefined.assertIsBoolean(i),r.isDefined(t)||(t=!1);var n;n=i?this.getTransform()||new o:new o,this.setTransform(n,t),n.setAction(e);var s=this;this.cancelAction();var _=a.addAnimationTask(function(e,t){s._transform&&!s._transform.update(t)||a.removeAnimationTask(_)});return this.__actionTaskId=_,n},cancelAction:function(){this.__actionTaskId&&a.hasAnimationTaskId(this.__actionTaskId)&&(a.removeAnimationTask(this.__actionTaskId),this.__actionTaskId=null)},setTransform:function(e,t){if(r.ifDefined.assertIsInstanceOf(e,o),r.ifDefined.assertIsBoolean(t),r.isDefined(t)||(t=!1),e){if(e.x=this.__cachedGeometry.__absolutePositionX,e.y=this.__cachedGeometry.__absolutePositionY,e.tx=-this.__cachedGeometry.__absolutePositionX,e.ty=-this.__cachedGeometry.__absolutePositionY,t){var i=this.__cachedGeometry.__sizeX/2,n=this.__cachedGeometry.__sizeY/2;e.x+=i,e.y+=n,e.tx-=i,e.ty-=n}e.saveOrigin()}this._transform=e},getTransform:function(){return this._transform},destroy:function(){},_setProperties:function(e,t){throw new Error("Widget._setProperties must be overridden by sub-types")},setName:function(e){return this.__name=e,this},getName:function(){return this.__name},setVisibility:function(e){return this.__visibility=e,this},getVisibility:function(){return this.__visibility},_onForEachDescendant:function(e){for(var t=0;t<this.__namedSlotNames.length;++t){var i=this.__namedSlots[this.__namedSlotNames[t]],n=i.getWidget();n&&e(n)}this._onForEachChild(e)},_onForEachChild:function(e){},_onForEachChildReverse:function(e){},_onComputeDesiredSize:function(e){e.x=0,e.y=0},_cacheDesiredSize:function(){this._onForEachChild(function(e){e._cacheDesiredSize()}),this._onComputeDesiredSize(this.__desiredSize)},getDesiredSize:function(){return this.__desiredSize},invalidate:function(){this._cacheDesiredSize(),this._onArrangeChildren(this.__cachedGeometry)},_setGeometry:function(e){this.__cachedGeometry.copyFrom(e),this._onArrangeChildren(this.__cachedGeometry)},getGeometry:function(e){e.copyFrom(this.__cachedGeometry)},_onArrangeChildren:function(e){},_draw:function(e){},_debugDraw:function(e){this.__visibility===h.VISIBLE&&(this.__debugIdentity=this.__debugIdentity||new Float32Array(s.IDENTITY_3x2),e.lineBatch.addRect(this.__cachedGeometry.__absolutePositionX,this.__cachedGeometry.__absolutePositionY,this.__cachedGeometry.__sizeX,this.__cachedGeometry.__sizeY,this.__debugIdentity,4278190335),
e.lineBatch.addLine(this.__cachedGeometry.__absolutePositionX,this.__cachedGeometry.__absolutePositionY,this.__cachedGeometry.__absolutePositionX+this.__cachedGeometry.__sizeX,this.__cachedGeometry.__absolutePositionY+this.__cachedGeometry.__sizeY,this.__debugIdentity,4278190335),e.lineBatch.addLine(this.__cachedGeometry.__absolutePositionX+this.__cachedGeometry.__sizeX,this.__cachedGeometry.__absolutePositionY,this.__cachedGeometry.__absolutePositionX,this.__cachedGeometry.__absolutePositionY+this.__cachedGeometry.__sizeY,this.__debugIdentity,4278190335),this._onForEachChild(function(t){t._debugDraw(e)}))},containsPoint:function(e,t){if(this.__visibility!==h.VISIBLE)return!1;var i=this.__cachedGeometry.__absolutePositionX,n=i+this.__cachedGeometry.__sizeX,r=this.__cachedGeometry.__absolutePositionY,s=r+this.__cachedGeometry.__sizeY;return e>=i&&e<=n&&t>=r&&t<=s},pick:function(e,t,i){if(this.containsPoint(e,t)){if(!i(this))return!1;var n=!1;if(this._onForEachChildReverse(function(r){if(!r.pick(e,t,i))return n=!0,!0}),n)return!1}return!0},_createNamedSlot:function(e,t){if(r.assertIsObject(t),void 0!==this.__namedSlots[e])throw new Error("Slot with name "+e+" already exsits");this.__namedSlotNames.push(e),this.__namedSlotNames.sort(),this.__namedSlots[e]=t},getNamedSlotNames:function(){return this.__namedSlotNames},getNamedSlot:function(e){if(void 0===this.__namedSlots[e])throw new Error("No slot exists with name "+e);return this.__namedSlots[e]},handleNamedSlot:function(e,t){return t(this.getNamedSlot(e)),this},findWidgetsWithName:function(e){var t=[];return this.__findWidgetsWithName(e,t),t},findSingleWidgetWithName:function(e){var t=[];if(this.__findWidgetsWithName(e,t),0===t.length)throw new Error("No widgets with name "+e+" where one was expected");var i=t[0];if(1===t.length)return i;for(var n=1;n<t.length;++n)if(t[n]!==i)throw new Error("Multiple widgets with name "+e+" where one was expected");return i},__findWidgetsWithName:function(e,t){this.__name===e&&t.push(this),this._onForEachDescendant(function(i){i.__findWidgetsWithName(e,t)})}}),i.exports.validateProperties=function(e,t){throw new Error("Widget::validateProperties must be overridden by sub-types")},i.exports.validateNamedSlotProperties=function(e,t,i){throw new Error("Widget::validateNamedSlotProperties must be overridden by sub-types")};var u=n.create(i.exports,{initialize:function(){i.exports.prototype.initialize.call(this)},_setGeometry:function(e){}});i.exports.NULL_WIDGET=new u,i.exports.VISIBILITY=h}),define("thor/ui/InputEvent",["require","exports","module","thor/core/Class","thor/core/Validation","./Widget"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Widget"),{CANCEL:-1,POINTER_DOWN:0,POINTER_UP:1,POINTER_MOVE:2,WHEEL:3});i.exports=n.create({initialize:function(e){this.__uiRoot=e,this.x=0,this.y=0,this.wheelDelta=0,this.type=r.CANCEL,this.wasCaptured=!1,this.originalEvent=null,this.touchIdentifier=null},_setEventData:function(e,t,i,n,r,s,o){this.x=e,this.y=t,this.wheelDelta=r,this.type=i,this.originalEvent=n,this.touchIdentifier=s,this.touchCount=o},_setIsCaptured:function(e){this.wasCaptured=e},capture:function(e,t){this.__uiRoot._captureEventForWidget(e,t)},stopCapture:function(e,t){this.__uiRoot._stopCaptureEventForWidget(e,t)}}),i.exports.EVENT_TYPE=r}),define("thor/ui/UiOverlay",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({initialize:function(){},draw:function(e){}})}),define("thor/ui/UiRoot",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Validation","thor/core/Logger","thor/math/MatrixUtil","thor/debug/PerformanceOverlay","./Widget","./Geometry","./InputEvent","./UiOverlay"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Device"),s=e("thor/core/Validation"),o=e("thor/core/Logger").getLogger(i),a=e("thor/math/MatrixUtil"),_=e("thor/debug/PerformanceOverlay"),l=e("./Widget"),h=e("./Geometry"),u=e("./InputEvent"),c=e("./UiOverlay"),d={};d[u.EVENT_TYPE.CANCEL]="onPointerCancel",d[u.EVENT_TYPE.POINTER_DOWN]="onPointerDown",d[u.EVENT_TYPE.POINTER_UP]="onPointerUp",d[u.EVENT_TYPE.POINTER_MOVE]="onPointerMove",d[u.EVENT_TYPE.WHEEL]="onWheel";var g=new Float32Array([0,0,0,1]);i.exports=n.create({initialize:function(e,t,i,n){this.__name=e,this.__widget=n,this.__uiWidth=0,this.__uiHeight=0,this.__debugDraw=!1,this.__scale=1,this.__savedModelView=new Float32Array(16),this.__modelView=new Float32Array(a.IDENTITY_4x4),this.__inverseModelView=new Float32Array(a.IDENTITY_4x4),this.__dirtyInverse=!1,this.__transform=new Float32Array(a.IDENTITY_4x4),this.__cachedInputEvent=new u(this),this.__geometry=new h(0,0,0,0),this.__uiOverlay=void 0,this.__inputWhitelist=void 0,this.__capturedEventWidgets={};for(var s in u.EVENT_TYPE)this.__capturedEventWidgets[u.EVENT_TYPE[s]]=[];this.__uiScaleCallback=null,this.__oldPointerX=-1,this.__oldPointerY=-1,this.__oldWheelDelta=0,r.addViewportResizeDelegate({onViewportResized:this.__handleViewportUpdate.bind(this)}),this.setUiSize(t,i);var o=_.getInstance();this.invalidate=o.addInstrumentedTask(e+" UI Layout",this.invalidate.bind(this),1e3,5,10),this.draw=o.addInstrumentedTask(e+" UI Draw",this.draw.bind(this),1e3,5,10),this.handleInput=o.addInstrumentedTask(e+" Input",this.handleInput.bind(this),1e3,5,10)},getGeometry:function(){return this.__geometry},setUiSize:function(e,t){this.__uiWidth=e,this.__uiHeight=t,o.debug("Setting UI size to "+e+", "+t),this.__recalculateUIScale()},setTransform:function(e){this.__transform.set(e,0),a.identity4x4(this.__modelView),this.__modelView[0]=this.__modelView[5]=this.__scale,a.multiply4x4(this.__transform,this.__modelView,this.__modelView),this.__dirtyInverse=!0},setUIScaleCallback:function(e){this.__uiScaleCallback=e},__recalculateUIScale:function(){var e=r.canvasWidth/this.__uiWidth,t=r.canvasHeight/this.__uiHeight,i=Math.min(e,t);o.debug("Calculated scale to be "+i+" ( "+e+", "+t+" )");var n=r.canvasWidth/i,s=r.canvasHeight/i;o.debug("Viewport dimensions: "+r.canvasWidth+", "+r.canvasHeight),o.debug("Setting UI dimensions to "+n+", "+s),this.__scale===i&&this.__geometry.__sizeX===n&&this.__geometry.__sizeY===s||(this.__scale=i,a.identity4x4(this.__modelView),this.__modelView[0]=this.__modelView[5]=i,a.multiply4x4(this.__transform,this.__modelView,this.__modelView),this.__dirtyInverse=!0,this.__geometry.__sizeX=n,this.__geometry.__sizeY=s,this.__widget._setGeometry(this.__geometry),this.__uiScaleCallback&&this.__uiScaleCallback())},setWidget:function(e){this.__widget=e,this.__widget._setGeometry(this.__geometry)},getWidget:function(){return this.__widget},getScale:function(){return this.__scale},invalidate:function(){this.__widget.invalidate()},setUiOverlay:function(e){s.ifDefined.assertIsInstanceOf(e,c),this.__uiOverlay=e},setInputWhitelist:function(e){s.ifDefined.assertIsArrayOfInstances(e,l),this.__inputWhitelist=e},draw:function(e){var t=e.spriteBatch;if(t.saveModelView(this.__savedModelView),t.setModelView(this.__modelView),t.begin(),this.__widget._draw(e),this.__uiOverlay&&this.__uiOverlay.draw(e),t.end(),t.setModelView(this.__savedModelView),t.begin(),this.__debugDraw){this.__savedDebugModelView=this.__savedDebugModelView||new Float32Array(a.IDENTITY_4x4);var i=e.lineBatch;i.end(),i.saveModelView(this.__savedDebugModelView),i.setModelView(this.__modelView),this.__widget._debugDraw(e),i.end(),i.setModelView(this.__savedDebugModelView)}},__handleViewportUpdate:function(){this.__recalculateUIScale()},handleInput:function(e,t,i,n,r,o,_,l){function h(e){var t=!0;if(y.__inputWhitelist&&y.__inputWhitelist.indexOf(e)===-1)return t;if(e[m]){e[m](f)&&(E=!0,s.isFunction(e.getPreviousWheelDelta)&&(v=e.getPreviousWheelDelta()),t=!1)}return t}this.__dirtyInverse&&(a.invert4x4(this.__modelView,this.__inverseModelView),this.__dirtyInverse=!1),g[0]=e,g[1]=t,a.transformVector4x4(g,this.__inverseModelView,g);var c=g[0],p=g[1],m=d[i],f=this.__cachedInputEvent;f._setEventData(c,p,i,n,o,_,l);var v=0,y=this,E=!1;f._setIsCaptured(!0);for(var S=this.__capturedEventWidgets[i],T=S.length,C=0;C<T;++C){var I=S[C][m];I&&I.call(S[C],f),T!==S.length&&(T--,C--)}if(f._setIsCaptured(!1),this.__widget.pick(c,p,h),i===u.EVENT_TYPE.POINTER_MOVE||i===u.EVENT_TYPE.POINTER_UP||i===u.EVENT_TYPE.WHEEL||i===u.EVENT_TYPE.CANCEL){var w=i!==u.EVENT_TYPE.CANCEL&&i!==u.EVENT_TYPE.POINTER_UP;this.__sendPointerOverOutEvents(this.__oldPointerX,this.__oldPointerY+v,c,p,this.__widget,w,!0,f),this.__oldPointerX=c,this.__oldPointerY=p}return E},__sendPointerOverOutEvents:function(e,t,i,n,r,s,o,a){var _=!0;this.__inputWhitelist&&this.__inputWhitelist.indexOf(r)===-1&&(_=!1);var l=r.containsPoint(i,n)&&s,h=r.containsPoint(e,t)&&o;if(l&&_?r.onPointerOver&&r.onPointerOver():!l&&h&&_&&r.onPointerOut&&r.onPointerOut(a),l||h){var u=this;r._onForEachChild(function(r){u.__sendPointerOverOutEvents(e,t,i,n,r,l,h,a)})}},_captureEventForWidget:function(e,t){var i=this.__capturedEventWidgets[e];i.indexOf(t)===-1&&i.push(t)},_stopCaptureEventForWidget:function(e,t){var i=this.__capturedEventWidgets[e],n=i.indexOf(t);n!==-1&&i.splice(n,1)}})}),define("thor/ui/InputProvider",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Device","./UiRoot","./InputEvent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/core/Device"),o=(e("./UiRoot"),e("./InputEvent")),a=["mousedown","mouseup","mousemove","wheel","mouseout"],_=["touchstart","touchmove","touchend"],l={x:0,y:0};i.exports=n.create({initialize:function(e,t,i){r.ifDefined.assertIsBoolean(i),this.__inputElement=e,this.__uiRoot=t,this.__allowPropagation=!!i,this.__boundMouseInputEvent=this.__onMouseInput.bind(this),this.__boundTouchInputEvent=this.__onTouchInput.bind(this);for(var n=0,o=a.length;n<o;++n)e.addEventListener(a[n],this.__boundMouseInputEvent,!0);for(var n=0,o=_.length;n<o;++n)e.addEventListener(_[n],this.__boundTouchInputEvent,!1);e.oncontextmenu=function(){return!1},this.__synchronousEventHandlers=[],this.__scrollScaling=s.getScrollScaling()},destroy:function(){for(var e=this.__inputElement,t=0,i=a.length;t<i;++t)e.removeEventListener(a[t],this.__boundMouseInputEvent,!0);for(var t=0,i=_.length;t<i;++t)e.removeEventListener(_[t],this.__boundTouchInputEvent,!1);delete this.__uiRoot,delete this.__inputElement,delete this.__boundMouseInputEvent,delete this.__boundTouchInputEvent,delete this.__synchronousEventHandlers},setUiRoot:function(e){this.__uiRoot=e},addSynchronousEventHandler:function(e){this.__synchronousEventHandlers.push(e)},__onMouseInput:function(e){this.__dispatchSynchronousEvent();var t,i=void 0;switch(e.type){case"mousedown":i=o.EVENT_TYPE.POINTER_DOWN,t=1;break;case"mouseup":i=o.EVENT_TYPE.POINTER_UP,t=0;break;case"mousemove":i=o.EVENT_TYPE.POINTER_MOVE,t=1;break;case"wheel":i=o.EVENT_TYPE.WHEEL,t=1;break;case"mouseout":i=o.EVENT_TYPE.CANCEL,t=0;break;default:return void console.error("Unknown event type",e.type,e)}var n=e.offsetX*s.pixelScale,r=e.offsetY*s.pixelScale,a=e.deltaY?this.__scrollScaling*e.deltaY:0;this.__uiRoot.handleInput(n,r,i,e,!1,a,"mouse",t)&&!this.__allowPropagation&&(e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault())},__onTouchInput:function(e){this.__allowPropagation||(e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()),this.__dispatchSynchronousEvent();for(var t=e.changedTouches.length,i=0;i<t;++i){var n=e.changedTouches[i];this.__getAbsoluteOffset(n.target,l);var r=n.pageX-l.x,a=n.pageY-l.y,_=r*s.cssToCanvasRatioX,h=a*s.cssToCanvasRatioY,u=void 0;switch(e.type){case"touchstart":u=o.EVENT_TYPE.POINTER_DOWN;break;case"touchend":u=o.EVENT_TYPE.POINTER_UP;break;case"touchmove":u=o.EVENT_TYPE.POINTER_MOVE;break;case"touchcancel":u=o.EVENT_TYPE.CANCEL;break;default:return void console.error("Unknown event type",e.type,e)}this.__uiRoot.handleInput(_,h,u,e,!0,0,n.identifier,e.touches.length)}},__getAbsoluteOffset:function(e,t){t.x=0,t.y=0;for(var i=e;i&&i!==document.documentElement;)t.x+=i.offsetLeft,t.y+=i.offsetTop,i=i.parentNode},__dispatchSynchronousEvent:function(){for(;this.__synchronousEventHandlers.length;)this.__synchronousEventHandlers.pop()()}})}),define("thor/util/FileUtil",["require","exports","module","thor/core/Validation"],function(e,t,i){e("thor/core/Validation");i.exports={downloadBlob:function(e,t){var i=URL.createObjectURL(e),n=document.createElement("a");n.setAttribute("href",i),n.setAttribute("download",t);var r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(r),URL.revokeObjectURL(i)},downloadJSON:function(e,t){var i=document.createElement("a");i.setAttribute("href","data:application/json,"+window.encodeURIComponent(e)),i.setAttribute("download",t);var n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(n)},getFileReader:function(e){var t=new FileReader;return t.addEventListener("load",function(t){e(null,t.target.result)}),t.addEventListener("error",function(t){e(t)}),t}}}),define("thor/audio/SoundManager",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/config/Config","thor/util/Network","thor/util/FileUtil","thor/util/RingBuffer","thor/util/LocalStorage","thor/ui/InputProvider"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Device"),o=e("thor/core/Logger").getLogger(i),a=e("thor/core/Validation"),_=(e("thor/config/Config"),e("thor/util/Network")),l=e("thor/util/FileUtil"),h=e("thor/util/RingBuffer"),u=e("thor/util/LocalStorage"),c=(e("thor/ui/InputProvider"),{}),d=["","maybe","probably"],g=["audio/ogg","audio/mpeg"],p={"audio/mpeg":"mp3","audio/ogg":"ogg"},m=g[1],f=r.create({initialize:function(){this.reset()},reset:function(){this.source&&(this.source.onended=null),this.id=null,this.instanceId=0,this.previousGain=null,this.startTime=0,this.stopTimeoutId=null,this.isStreamed=!1,this.stopped=!1,this.muted=!1,this.channel=null,this.onEnded=null,this.tag=null,this.source=null,this.gainNode=null,this.onFinished=null}}),v=r.create({initialize:function(){this.reset()},reset:function(){this.name=null,this.muted=!1,this.previousGain=null,this.gainNode=null,this.parentNode=null,this.playingSounds={}}}),y=r.create(n,{__soundReferenceCountById:null,__arrMuteCallbacks:null,__arrUnmuteCallbacks:null,__muted:null,__audioContext:null,__dynamicsCompressorNode:null,__audioBuffersById:null,__audioTagsById:null,__audioSourcesById:null,__channelByPlayingSound:null,__pausedSoundsById:null,__instanceId:null,__loadHistory:null,__freeSoundInstances:null,MUTED_LOCALSTORAGE_KEY:"MASTER_MUTED",AUDIO_CHANNELS:["MASTER","BGM","SFX"],CHANNEL_PARENTS:{BGM:"MASTER",SFX:"MASTER"},CHANNEL_MUTED_LOCALSTORAGE_KEY_SUFFIX:"_MUTED",MAX_VOLUME:2,ARR_DEFAULT_SOUNDS:[],DEFAULT_VOLUME:1,initialize:function(){function e(){i||u.setItem(a.MUTED_LOCALSTORAGE_KEY,!1),a.removeMuteCallback(e)}n.prototype.initialize.call(this),this.__instanceId=1,this.__soundReferenceCountById={},this.__arrMuteCallbacks=[],this.__arrUnmuteCallbacks=[],this.__audioBuffersById={},this.__audioTagsById={},this.__audioSourcesById={},this.__boundBufferSourceOnEnded=this.__bufferSourceOnEnded.bind(this),this.__channelByPlayingSound={},this.__freeSoundInstances=new h(new Array(128),128);for(var t=0;t<128;++t)this.__freeSoundInstances.add(new f);this.__pausedSoundsById={},this.__loadHistory=[],this.__channels={};var i=!1,r=u.getJSONItem(this.MUTED_LOCALSTORAGE_KEY);null!==r&&(i=r);var a=this;this.__muted=i,s.hacks[s.HACKS.MUTE_AUDIO]&&(this.__muted=!0),this.__audioFormat=m;try{window.AudioContext=window.AudioContext||window.webkitAudioContext,this.__audioContext=new AudioContext,44100!==this.__audioContext.sampleRate&&s.hacks[s.HACKS.DETECT_AUDIO_CORRUPTION]&&s.isIOSDevice&&s.osMajorVersion<10&&(o.warn("Audio corruption detected, incorrect sample rate: `"+this.__audioContext.sampleRate+"`, muting audio"),this.__muted=!0,this.addMuteCallback(e));var _=m,l=0,c=document.createElement("audio");if(c&&c.canPlayType)for(var t=0;t<g.length;++t){var p=g[t],v=c.canPlayType(p),y=d.indexOf(v);y>l&&(l=y,_=p),o.debug("Format detection result: `"+p+"` confidence `"+v+"`")}this.__audioFormat=_,o.debug("Format picked: `"+this.__audioFormat+"`")}catch(e){o.warn("Web Audio API is not supported in this browser")}},setupDynamicsCompressor:function(e,t,i,n,r){if(this.__audioContext){var s=this.__audioContext.createDynamicsCompressor();s.threshold.value=e,s.knee.value=t,s.ratio.value=i,s.attack.value=n,s.release.value=r,this.__dynamicsCompressorNode=s,this.__dynamicsCompressorNode.connect(this.__audioContext.destination)}},installUserInputHandler:function(e){if(s.features[s.FEATURES.AUDIO_REQUIRES_INPUT]){var t=this.__audioContext.createBuffer(1,2,this.__audioContext.sampleRate),i=this.__audioContext.createBufferSource();i.buffer=t,i.connect(this.__audioContext.destination),e.addSynchronousEventHandler(function(){i.start(0)})}},addMuteCallback:function(e){this.__arrMuteCallbacks.indexOf(e)===-1&&this.__arrMuteCallbacks.push(e)},removeMuteCallback:function(e){var t=this.__arrMuteCallbacks.indexOf(e);t!==-1&&this.__arrMuteCallbacks.splice(t,1)},addUnmuteCallback:function(e){this.__arrUnmuteCallbacks.indexOf(e)===-1&&this.__arrUnmuteCallbacks.push(e)},isSoundLoaded:function(e){return this.__soundReferenceCountById[e]>0},isSoundPlaying:function(e){for(var t in this.__channelByPlayingSound){var i=this.__getInstanceFromInstanceId(+t);if(i.id===e&&!i.stopTimeoutId)return!0}return!1},isInstancePlaying:function(e){return!!this.__channelByPlayingSound[e]},_load:function(e){return this.__muted&&this.mute(),this.__setupChannels(),this.__preloadDefaultSounds()},addAudioChannel:function(e,t){if(this.AUDIO_CHANNELS.indexOf(t)<0)throw new Error("addAudioChannel: parent channel ["+t+"] does not exist");this.AUDIO_CHANNELS.indexOf(e)<0&&this.AUDIO_CHANNELS.push(e),this.CHANNEL_PARENTS[e]=t},addDefaultSound:function(e){this.ARR_DEFAULT_SOUNDS.indexOf(e)===-1&&this.ARR_DEFAULT_SOUNDS.push(e)},__setupChannels:function(){if(!this.__audioContext)return void o.warn("setupChannels: no audioContext found");for(var e in this.AUDIO_CHANNELS){var t=this.AUDIO_CHANNELS[e],i=new v,n=this.__audioContext.createGain();if("MASTER"===t)this.__dynamicsCompressorNode?(n.connect(this.__dynamicsCompressorNode),i.parentNode=this.__dynamicsCompressorNode):(n.connect(this.__audioContext.destination),i.parentNode=this.__audioContext.destination);else{var r=this.CHANNEL_PARENTS[t],s=this.__channels[r];n.connect(s.gainNode),i.parentNode=s.gainNode}var a=t+this.CHANNEL_MUTED_LOCALSTORAGE_KEY_SUFFIX,_=u.getJSONItem(a);i.muted=!!_,i.name=t,i.gainNode=n,i.muted&&(i.previousGain=i.gainNode.gain.value,i.gainNode.gain.value=0),this.__channels[t]=i}},__preloadDefaultSounds:function(){return 0===this.ARR_DEFAULT_SOUNDS.length?Promise.resolve(!0):Promise.all(this.ARR_DEFAULT_SOUNDS.map(this.preloadSound))},setChannelGain:function(e,t,i){var n=this.__channels[e];if(!n)return void o.error("Could not find channel "+e);n.gainNode.gain.cancelScheduledValues(this.getTime()),i?n.gainNode.gain.linearRampToValueAtTime(t,this.getTime()+i):n.gainNode.gain.setValueAtTime(t,this.getTime())},getTime:function(){return this.__audioContext?this.__audioContext.currentTime:0},getSize:function(e){if(!this.__audioContext)return 0;var t=this.__audioBuffersById[e],i=this.__audioTagsById[e];if(!t&&!i)return o.warn("Tried to get the size of a sound which wasn't preloaded: "+e),0;if(!t)return-1;for(var n=0,r=0;r<t.numberOfChannels;++r){var s=t.getChannelData(r);n+=s.length*s.BYTES_PER_ELEMENT}return n},getDuration:function(e){if(!this.__audioContext)return 0;var t=this.__audioBuffersById[e];return t?t.duration:(o.warn("Tried to get the duration of a sound which wasn't preloaded: "+e),0)},__bufferSourceOnEnded:function(e){var t=e.target.thorInstanceId;this.__sourceOnEnded(t)},__sourceOnEnded:function(e){var t=this.__channelByPlayingSound[e],i=this.__channels[t],n=i.playingSounds[e];delete i.playingSounds[e],delete this.__channelByPlayingSound[e],n&&this.__instanceOnEnded(n)},__instanceOnEnded:function(e){var t=e.onFinished;e.gainNode&&e.gainNode.disconnect(),e.reset(),this.__freeSoundInstances.add(e),t&&t()},playSFX:function(e,t){return t=t||{},t.channel="SFX",this.playSound(e,t)},playBGM:function(e,t){return t=t||{},t.channel="BGM",this.playSound(e,t)},playSound:function(e,t){t=t||{};var i=t.onFinished,n=a.isNumber(t.volume)?t.volume:this.DEFAULT_VOLUME;n=Math.min(n,this.MAX_VOLUME),n=Math.max(n,0);var r=t.loop;a.isUndefined(r)&&(r=!1);var s=t.loopStart,_=t.loopEnd;a.isUndefined(s),a.isUndefined(_);var l=t.channel;a.isUndefined(l);var h=(t.position||0)/1e3,u=(t.fadeInDuration||0)/1e3,c=Math.min(this.DEFAULT_VOLUME,t.fadeStartVolume||0),d=t.resume||!1,g=this.getTime(),p=t.startTime||g,m=t.duration,f=t.useDurationInStart||!1;d&&this.__pausedSoundsById[e]&&(h=this.__pausedSoundsById[e].pausedOffset,delete this.__pausedSoundsById[e]),a.ifDefined.assertIsNumber(m);var v=this.__freeSoundInstances.remove();if(!v)return o.error("Exhaused sound instances (MAX: "+this.__freeSoundInstances.getMaximumCount()+")"),i&&setTimeout(i,0),null;v.id=e,v.instanceId=this.__instanceId,v.previousGain=n,v.startTime=p,v.stopTimeoutId=null,v.onFinished=i,this.__instanceId=this.__instanceId+1;var y=this;if(this.__audioContext){var E=this.__audioBuffersById[e],S=this.__audioTagsById[e],T=this.__audioSourcesById[e];if(!E&&!S)return o.warn("Tried to play a sound which wasn't preloaded: "+e),this.__freeSoundInstances.add(v),null;if(S&&this.isSoundPlaying(e))return o.warn("Can only play one instance of a streaming sound at a time"),this.__freeSoundInstances.add(v),null;a.isUndefined(T)&&(E?(T=this.__audioContext.createBufferSource(),T.thorInstanceId=v.instanceId,T.buffer=E,T.onended=this.__boundBufferSourceOnEnded):(T=this.__audioContext.createMediaElementSource(S),this.__audioSourcesById[e]=T)),E?(v.isStreamed=!1,T.loop=r,r&&a.isNumber(s)&&(T.loopStart=s),r&&a.isNumber(_)&&(T.loopEnd=_)):(v.isStreamed=!0,v.onEnded=function(){S.removeEventListener("pause",v.onEnded),y.__sourceOnEnded(v.instanceId)},S.addEventListener("pause",v.onEnded),v.tag=S,p!=g&&o.warn("Streamed sounds do not support `startTime`"),a.isNumber(s)&&o.warn("Streamed sounds do not support `loopStart`"),a.isNumber(_)&&o.warn("Streamed sounds do not support `loopEnd`"),0!=h&&o.warn("Streamed sounds do not support `position`"),a.isNumber(m)&&o.warn("Streamed sounds do not suppoer `duration`"),S.loop=!!r);var C=this.__audioContext.createGain();T.connect(C);var I,w=this.AUDIO_CHANNELS.indexOf(l);w<0?(o.warn("playSound: non-existent channel ["+l+"], playing on master"),I="MASTER"):I=this.AUDIO_CHANNELS[w];var b=this.__channels[I];C.connect(b.gainNode),v.channel=I,v.source=T,v.gainNode=C,this.__channelByPlayingSound[v.instanceId]=I,b.playingSounds[v.instanceId]=v,0===u?(C.gain.value=n,E?a.isNumber(m)&&m>0?f?T.start(p,h,m):(T.start(p,h),T.stop(p+m)):T.start(p,h):S.play()):(C.gain.linearRampToValueAtTime(c,p),C.gain.linearRampToValueAtTime(n,p+u),E?T.start(p,h,m):S.play())}else setTimeout(this.__instanceOnEnded.bind(this,v),0);return v.instanceId},stopAllSounds:function(){for(var e in this.__channelByPlayingSound)this.stopSoundByInstanceId(+e)},stopAllSoundsInChannel:function(e){var t=this.__getChannelFromName(e);if(t)for(var i in t.playingSounds)this.stopSoundByInstanceId(+i)},__getInstanceFromInstanceId:function(e){var t=this.__channelByPlayingSound[e];return a.isUndefined(t)?null:this.__channels[t].playingSounds[e]},stopSoundByInstanceId:function(e,t){if(t=t||{},!this.__audioContext)return t.fadeOutDuration&&0!==t.fadeOutDuration&&t.onFinished&&t.onFinished(),0;var i=this.__getInstanceFromInstanceId(e);return i?this.__stopSoundInstance(i,t):(o.warn("Tried to stop a sound which wasn't playing. Instance Id: "+e),0)},stopSoundsBySoundId:function(e,t){if(t=t||{},!this.__audioContext)return t.fadeOutDuration&&0!==t.fadeOutDuration&&t.onFinished&&t.onFinished(),0;var i=[];for(var n in this.__channelByPlayingSound){var r=this.__getInstanceFromInstanceId(+n);if(r.id===e){var s=this.__stopSoundInstance(r,t);i.push(s)}}return 0===i.length?(o.warn("Tried to stop a sound which wasn't playing. Sound Id: "+e),0):i},__stopSoundInstance:function(e,t){var i=t.fadeOutDuration||0,n=t.pause||!1,r=this.getTime(),_=t.stopTime||r;a.isUndefined(t.onFinished);var l=e.onFinished;if(l&&(e.onFinished=function(){l(!0)}),0===i){var h=this.getDuration(e.id);return n&&(e.isStreamed?o.warn("Pausing streamed sounds is not supported"):(e.pausedOffset=(this.getTime()-e.startTime)%h,this.__pausedSoundsById[e.id]=e)),e.isStreamed?e.stopped||setTimeout(function(){e.tag.pause()},1e3*(_-r)):e.stopped||(e.source.stop(_),this.__muted&&"SAFARI"===s.browserName&&!e.source.loop&&(e.source.onended=null,setTimeout(this.__sourceOnEnded.bind(this,e.instanceId),1e3*(_-r)))),e.stopped=!0,_}if(e.stopTimeoutId)return o.warn("Tried to stop a sound by fading that was already fading: "+e.id),e.stopped=!0,0;var u=_,c=_+i/1e3;e.gainNode.gain.linearRampToValueAtTime(e.gainNode.gain.value,u),e.gainNode.gain.linearRampToValueAtTime(0,c),e.stopped||e.isStreamed||e.source.stop(c);return e.stopTimeoutId=setTimeout(function(){e.isStreamed&&(e.onEnded(),e.tag.pause(),e.tag.currentTime=0),t.onFinished&&t.onFinished()},1e3*(_-this.getTime())+i),e.stopped=!0,c},stopSound:function(e,t){if(a.isNonEmptyString(e))return this.stopSoundsBySoundId(e,t);a.isObject(e)&&(t=e),t=t||{};var i=t.instanceId;return this.stopSoundByInstanceId(i,t)},preloadManySounds:function(e){if(0===e.length)throw new Error("SoundManager: Must provide at least one sound");return Promise.all(e.map(this.preloadSound))},preloadSoundFromBlob:function(e,t){if(!this.__audioContext)return Promise.resolve(!0);if(this.__soundReferenceCountById[e]>0)return this.__soundReferenceCountById[e]++,Promise.resolve(!0);if(0===this.__soundReferenceCountById[e])return Promise.reject("Sound Blob decode is still in progress for "+e);this.__soundReferenceCountById[e]=0;var i=this;return new Promise(function(n,r){function s(t){delete i.__soundReferenceCountById[e],r(t)}l.getFileReader(function(t,r){if(t)return void s(t);i.__audioContext.decodeAudioData(r,function(t){i.__audioBuffersById[e]=t,i.__soundReferenceCountById[e]++,n()},function(e){s("Sound decode from blob failed: "+e)})}).readAsArrayBuffer(t)})},preloadSound:function(e,t){if(a.isUndefined(t)&&(t=c),s.DEBUG&&this.__loadHistory.push({url:e,options:t}),this.__soundReferenceCountById[e]>=0)return this.__soundReferenceCountById[e]++,Promise.resolve(!0);if(this.__soundReferenceCountById[e]=0,!this.__audioContext)return Promise.resolve(!0);var i=this.__getAudioURL(e);if(t.cachebust&&(i+=t.cachebust),t.stream&&!s.hacks[s.HACKS.NO_STREAMING]){var n=new Audio;return n.src=i,n.controls=!1,n.autoplay=!1,n.preload="auto",n.load(),this.__audioTagsById[e]=n,document.body.appendChild(n),Promise.resolve(!0)}var r=this;return _.getArrayBuffer(i).then(function(t){return new Promise(function(n,s){r.__audioContext.decodeAudioData(t,function(t){r.__audioBuffersById[e]=t,r.__soundReferenceCountById[e]++,n()},function(t){var n="Sound decode failed: "+i+": "+t;o.error(n),0===r.__soundReferenceCountById[e]?delete r.__soundReferenceCountById[e]:r.release(e),s(n)})})})},releaseMany:function(e){for(var t=0;t<e.length;++t)this.release(e[t])},release:function(e){if(!(this.__soundReferenceCountById[e]>0))return void o.warn("Tried to release a sound which doesn't exist or is still loading: "+e);if(--this.__soundReferenceCountById[e]<0)throw Error("Sound has a negative reference count: `"+e+"`");0===this.__soundReferenceCountById[e]&&(this.__audioBuffersById[e]?delete this.__audioBuffersById[e]:this.__audioTagsById[e]&&(document.body.removeChild(this.__audioTagsById[e]),delete this.__audioTagsById[e],delete this.__audioSourcesById[e]),delete this.__soundReferenceCountById[e])},printPoolStatus:function(){o.log("Preloaded sounds:");var e=0,t=[];for(var i in this.__soundReferenceCountById){var n,r=this.getSize(i);r!=-1?(r=r/1024/1024,e+=r,n=" ("+r.toPrecision(2)+" MB)"):n=" ( Streamed )",t.push([r,"   "+i+": "+this.__soundReferenceCountById[i]+n])}t.sort(function(e,t){return t[0]-e[0]}),t.forEach(function(e){o.log(e[1])}),o.log("Total size: "+e.toPrecision(2)+" MB")},preloadManifest:function(e){function t(e){var t={url:e.u};if(a.isObject(e.o)){var i=e.o;i.hasOwnProperty("s")&&(i.stream=i.s),t.options=i}return t}return Promise.all(e.map(t).map(function(e){return this.preloadSound(e.url,e.options)},this))},dumpPoolAsJSON:function(){var e=this.__loadHistory.map(function(e){var t={u:e.url};if(a.isNonEmptyObject(e.options)){var i=e.options;i.hasOwnProperty("stream")&&(i.s=i.stream,delete i.stream),t.o=i}return t}),t=JSON.stringify(e);o.debug(t)},__getAudioURL:function(e){return e.match(/^blob:/)?e:e+"."+p[this.__audioFormat]},muteSound:function(e){var t=this.__getInstanceFromInstanceId(e);t&&(t.muted||(this.__audioContext&&(t.previousGain=t.gainNode.gain.value,t.source.disconnect()),t.muted=!0))},unmuteSound:function(e,t){a.ifDefined.assertIsNumber(t);var i=this.__getInstanceFromInstanceId(e);i&&(!a.isNumber(t)&&a.isNumber(i.previousGain)?t=i.previousGain:a.isNumber(t)||(t=1),this.__audioContext&&(i.gainNode.gain.value=t,i.muted&&i.source.connect(i.gainNode)),delete i.previousGain,i.muted=!1)},transitionGainForSound:function(e,t){var i=this.__getInstanceFromInstanceId(e);if(i&&!this.isMuted()&&!i.muted&&this.__audioContext){var n=i.gainNode,r=this.getTime(),s=t.startTime||r,o=t.startValue||+n.gain.value,a=(t.duration||0)/1e3;n.gain.linearRampToValueAtTime(o,s),n.gain.linearRampToValueAtTime(t.endValue,s+a)}},transitionGainForChannel:function(e,t){a.isObject(e)&&(t=e,e="MASTER");var i=this.__getChannelFromName(e);if(i&&!this.isMuted()&&!i.muted&&this.__audioContext){var n=i.gainNode,r=this.getTime(),s=t.startTime||r,o=t.startValue||+n.gain.value,_=(t.duration||0)/1e3;n.gain.linearRampToValueAtTime(o,s),n.gain.linearRampToValueAtTime(t.endValue,s+_)}},isMutedChannel:function(e){var t=this.__getChannelFromName(e);return!!t&&!!t.muted},isMutedSound:function(e){var t=this.__getInstanceFromInstanceId(e);return!!t&&!!t.muted},getSoundIdFromInstanceId:function(e){var t=this.__getInstanceFromInstanceId(e);return t?t.id:null},setMuted:function(e){this.__muted=e,this.__channels.MASTER&&(e?this.muteChannel("MASTER"):this.unmuteChannel("MASTER")),u.setItem(this.MUTED_LOCALSTORAGE_KEY,e)},__getChannelFromName:function(e){return this.AUDIO_CHANNELS.indexOf(e)<0?(o.warn("getChannelFromName: channel ["+e+"] not found"),null):this.__channels[e]},getChannelPlayingSounds:function(e){var t=this.__getChannelFromName(e);return t?t.playingSounds:null},muteChannel:function(e){var t=this.__getChannelFromName(e);if(t&&!t.muted){this.__audioContext&&(t.previousGain=t.gainNode.gain.value,t.gainNode.gain.value=0),t.muted=!0;var i=t.name+this.CHANNEL_MUTED_LOCALSTORAGE_KEY_SUFFIX;u.setItem(i,!0)}},unmuteChannel:function(e,t){a.isBoolean(t)?(unmuteSounds=t,t=null):a.ifDefined.assertIsNumber(t);var i=this.__getChannelFromName(e);if(i&&i.muted){!a.isNumber(t)&&a.isNumber(i.previousGain)?t=i.previousGain:a.isNumber(t)||(t=1),this.__audioContext&&(i.gainNode.gain.value=t,i.gainNode.connect(i.parentNode)),delete i.previousGain,i.muted=!1;var n=i.name+this.CHANNEL_MUTED_LOCALSTORAGE_KEY_SUFFIX;u.setItem(n,!1)}},mute:function(){this.setMuted(!0);for(var e in this.__channelByPlayingSound)this.muteSound(+e);for(var t=0;t<this.__arrMuteCallbacks.length;++t)setTimeout(this.__arrMuteCallbacks[t],0)},unmute:function(){this.setMuted(!1);for(var e in this.__channelByPlayingSound)this.unmuteSound(+e);for(var t=0;t<this.__arrUnmuteCallbacks.length;++t)setTimeout(this.__arrUnmuteCallbacks[t],0)},isMuted:function(){return this.__muted}});i.exports=new y}),define("thor/event/ReplicationHandler",["require","exports","module","thor/core/Class"],function(e,t,i){
var n=e("thor/core/Class");i.exports=n.create({initialize:function(){},replicateEvent:function(e){}})}),define("thor/event/Event",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),{}),s=i.exports=n.create({originatedLocally:!0,initialize:function(){},getType:function(){}});i.exports.getEventClass=function(e){return r[e]},i.exports.generateEventClass=function(e,t,o,a,_){var l=[],h={getName:function(){return u.EVENT_NAME},getType:function(){return u.EVENT_TYPE},reset:function(){for(var e=0;e<l.length;++e)this[l[e]]=void 0;delete this.originatedLocally},toString:function(){var t=e;for(var i in o)t+=" ("+i+": "+this["__"+i]+")";return t},shouldReplicate:function(){return this.isReplicated&&this.originatedLocally},isSingular:!1,isReplicated:!1};a&&(h.isSingular=!0),_&&(h.isReplicated=!0),Object.keys(o).forEach(function(e){function t(t){o[e](t),this[n]=t}function i(e){this[n]=e}if("type"===e)throw new Error("Events cannot have a field named `type`, this is reserved");if("name"===e)throw new Error("Events cannot have a field named `name`, this is reserved");var n="__"+e;l.push(n);var r=e[0].toUpperCase()+e.slice(1);h["get"+r]=function(){return this[n]},window.ASSERTIONS?h["set"+r]=t:h["set"+r]=i}),h.initialize=new Function("Event","return function "+e+"(){ Event.prototype.initialize.call(this); this.reset(); }")(s);var u=n.create(i.exports,h);return u.EVENT_TYPE=t,u.EVENT_NAME=e,r[t]=u,u}}),define("thor/event/EventManager",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/util/RingBuffer","thor/event/ReplicationHandler","thor/debug/PerformanceOverlay","./Event"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Logger").getLogger(i),o=(e("thor/core/Validation"),e("thor/util/RingBuffer")),a=(e("thor/event/ReplicationHandler"),e("thor/debug/PerformanceOverlay"));e("./Event");i.exports=r.create(n,{__eventQueueA:null,__eventQueueB:null,__singularEventQueueA:null,__singularEventQueueB:null,__eventQueue:null,__singularEventQueue:null,__eventHandlersByType:null,__eventPoolsByType:null,initialize:function(e){this.__eventQueueA=new o(new Array(e),e),this.__eventQueueB=new o(new Array(e),e),this.__eventQueue=this.__eventQueueA,this.__eventTrace=!1,this.__eventHandlersByType={},this.__eventPoolsByType={},this.__singularEventQueueA=[],this.__singularEventQueueB=[],this.__singularEventQueue=this.__singularEventQueueA;var t=a.getInstance();this.dispatchEvents=t.addInstrumentedTask("Event Dispatch",this.dispatchEvents.bind(this),1e3,5,10),this.__replicationHandlers=[]},addReplicationHandler:function(e){this.__replicationHandlers.push(e)},removeReplicationHandler:function(e){var t=this.__replicationHandlers.indexOf(e);t!==-1?this.__replicationHandlers.splice(t,1):s.warn("Tried to remove a replication handler that was not registered")},getNewEvent:function(e,t){var i=e.EVENT_TYPE;this.__eventPoolsByType[i]||(this.__eventPoolsByType[i]=[]);var n=this.__eventPoolsByType[i],r=n.pop();if(!r){t=t||8;for(var s=1;s<t;s++)n.push(new e);r=new e}return r},queueEvent:function(e){if(e.shouldReplicate())for(var t=0;t<this.__replicationHandlers.length;++t)this.__replicationHandlers[t].replicateEvent(e);if(!e.isReplicated&&!e.originatedLocally)return void s.error("Received a non-replicated event from a replication source, ignoring it");var i=e.getType();if(e.isSingular){for(var t=0;t<this.__singularEventQueue.length;++t){var n=this.__singularEventQueue[t];if(n.getType()==i)return n.reset(),this.__eventPoolsByType[i].push(n),void(this.__singularEventQueue[t]=e)}this.__singularEventQueue.push(e)}else this.__eventQueue.add(e)||s.error("Too many events queued, event dropped")},triggerEvent:function(e){if(this.__eventTrace&&s.debug("Trigger Event: "+e),e.isReplicated)return void s.warn("Replicated events cannot be triggered: "+e);var t=e.getType(),i=this.__eventHandlersByType[t];if(i)for(var n=0;n<i.length;++n)i[n](e);e.reset(),this.__eventPoolsByType[t].push(e)},setEventTracing:function(e){this.__eventTrace=e},dispatchEvents:function(){var e=this.__eventQueue,t=this.__singularEventQueue;e===this.__eventQueueA?(this.__eventQueue=this.__eventQueueB,this.__singularEventQueue=this.__singularEventQueueB):(this.__eventQueue=this.__eventQueueA,this.__singularEventQueue=this.__singularEventQueueA);for(var i,n,r=t.length,o=0;o<r;++o){n=t[o],i=n.getType(),this.__eventTrace&&s.debug("Dispatching: "+n);var a=this.__eventHandlersByType[i];if(a)for(var _=a.length,l=0;l<_;++l)a[l](n);n.reset(),this.__eventPoolsByType[i].push(n)}for(t.length=0,n=e.remove();null!==n;){i=n.getType(),this.__eventTrace&&s.debug("Dispatching: "+n);var a=this.__eventHandlersByType[i];if(a)for(var _=a.length,h=0;h<a.length;++h)a[h](n);n.reset(),this.__eventPoolsByType[i].push(n),n=e.remove()}},registerEventHandler:function(e,t){return this.__eventHandlersByType[e]||(this.__eventHandlersByType[e]=[]),this.__eventHandlersByType[e].push(t),t},unregisterEventHandler:function(e,t){var i=this.__eventHandlersByType[e];if(i){var n=i.indexOf(t);i.splice(n,1)}}})}),define("thor/resources/Resource",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation");i.exports=n.create({initialize:function(e,t){this.__resourceType=e,this.__data=t,this.__numUses=0},getResourceType:function(){return this.__resourceType},getData:function(){return this.__data},getNumUses:function(){return this.__numUses},use:function(){this.__numUses++},destroy:function(){r.isFunction(this.__data.destroy)&&this.__data.destroy(),this.__numUses=0}})}),define("thor/resources/ResourceLoader",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({initialize:function(e){this.__resourceTypes=e},getTypes:function(){return this.__resourceTypes},guid:function(e){throw new Error("ResourceLoader::guid not overridden in derived class!")},load:function(e){throw new Error("ResourceLoader::load not overridden in derived class!")},postLoad:function(e,t){return Promise.resolve(!0)}})}),define("thor/resources/ResourceManager",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","./Resource","./ResourceLoader"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=e("./Resource");e("./ResourceLoader");i.exports=n.create({initialize:function(){this.__resourcesByTypeName={},this.__promisesByGuid={},this.__resourceTypesByGuid={},this.__loadersByType={},this.__isLocked=!1,this.__mappingsByType={}},isRegisteredLoaderType:function(e){return!!this.__loadersByType[e]},registerLoader:function(e,t){if(this.__loadersByType[e])throw new Error("Duplicate loader registered for type "+e);this.__loadersByType[e]={load:this.__createLoaderWrapper(e,t),guid:t.guid.bind(t)};for(var i=t.getTypes(),n=0,r=i.length;n<r;++n){var s=i[n];this.__resourcesByTypeName[s]||(this.__resourcesByTypeName[s]={})}},__createLoaderWrapper:function(e,t){var i=this,n=t.getTypes();return function(r){function s(e){for(var s=0,o=n.length;s<o;++s)i.__resourcesByTypeName[n[s]][r]=e;e.use();var a=e.getData();return t.postLoad(r,a).then(function(){return a})}var a=i.__getResource(e,r);if(a)return a.use(),Promise.resolve(a.getData());var _=t.guid.apply(t,arguments);if(i.__promisesByGuid[_]){if(i.__resourceTypesByGuid[_]!==e)throw new Error("Resource with guid "+_+" was already loaded with type "+i.__resourceTypesByGuid[_]);return i.__promisesByGuid[_].then(s)}var l=t.load.apply(t,arguments).then(function(t){return new o(e,t)});return i.__promisesByGuid[_]=l,i.__resourceTypesByGuid[_]=e,l.then(s)}},loader:function(e){if(!this.__loadersByType[e])throw new Error("Unkown asset type "+e);return this.__loadersByType[e]},get:function(e,t){var i=this.__getResource(e,t);if(!i)throw new Error("Unknown resource "+t+" of type "+e);return i.use(),i.getData()},getOrDefault:function(e,t,i){var n=this.__getResource(e,t);return n?(n.use(),n.getData()):i},put:function(e,t,i,n){if(this.__isLocked)return void r.error("Cannot put resource ",t,"(",i,") of type ",e," into ResourceManager. ResourceManager is locked.");if(this.__getResource(e,t))throw new Error("Cannot put duplicate resource "+t+" of type "+e);var s=this.__mappingsByType[e];if(s){var a=s[t];a&&(r.debug("Put Mapping: `",t,"` -> `",a,"`"),t=a)}var _=new o(e,n);this.__resourcesByTypeName[e][t]=_,this.__promisesByGuid[i]=Promise.resolve(_),this.__resourceTypesByGuid[i]=e},remove:function(e,t,i){if(this.has(e,t)){var n=this.__resourcesByTypeName[e][t];n.destroy();var r=this.__resourcesByTypeName[e];for(var s in r){n===r[s]&&delete r[s]}delete this.__resourcesByTypeName[e][t],delete this.__promisesByGuid[i],delete this.__resourceTypesByGuid[i]}},has:function(e,t){return this.__resourcesByTypeName[e]&&this.__resourcesByTypeName[e][t]},__getResource:function(e,t){if(!this.__resourcesByTypeName[e])throw new Error("Invalid resource type "+e);var i=this.__mappingsByType[e];if(i){var n=i[t];n&&(r.debug("Mapping: `",t,"` -> `",n+"`"),t=n)}return this.__resourcesByTypeName[e][t]},loadBulk:function(e){var t=this;return new Promise(function(i,n){var r=[];for(var o in e){var a=e[o];if(!s.isNonEmptyString(o))return void n("Invalid resource type "+o);var _=t.loader(o);if(!_)return void n("No resource loader for resource type "+o);for(var l=0;l<a.length;++l){var h=a[l];if(!s.isNonEmptyString(h.name))return void n("Invalid resource name "+h.name);if(!s.isArray(h.parameters))return void n("Invalid parameter list for resource "+h.name);var u=[h.name];u.push.apply(u,h.parameters),r.push(_.load.apply(_,u))}}i(Promise.all(r))})},getAllResourceNamesByType:function(e){if(!this.__resourcesByTypeName[e])throw new Error("Invalid resource type "+e);return Object.keys(this.__resourcesByTypeName[e])},foreachResourcesByType:function(e,t){if(this.__resourcesByTypeName[e])for(var i in this.__resourcesByTypeName[e]){var n=this.__resourcesByTypeName[e][i];t(i,n)}},lock:function(){this.__isLocked=!0},unlock:function(){this.__isLocked=!1},setOverrideMappings:function(e){this.__mappingsByType=e},clearOverrideMappings:function(){this.__mappingsByType={}}})}),define("thor/math/MathHelper",["require","exports","module","thor/core/Validation"],function(e,t,i){var n=(e("thor/core/Validation"),Math.PI/180);i.exports={TWOPI:2*Math.PI,HALFPI:Math.PI/2,PI180:n,EPSILON:1e-5,sign:function(e){return 0===e||isNaN(e)?e:e>0?1:-1},isPowerOf2:function(e){for(;e%2==0;)e/=2;return e<=1},angularDifference:function(e,t,i,n){for(;e<0;)e+=i;for(;t<0;)t+=i;for(;e>=i;)e-=i;for(;t>=i;)t-=i;var r=e>t?e-t:t-e;return r<=n?r:i-r},invertMatrix:function(e){var t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],a=t*r-i*n;if(0===a||isNaN(a))return console.warn("MathHelper.invertMatrix: The matrix is not invertible! Returning identity matrix."),[1,0,0,1,0,0];var _=1/a;return[r*_,-i*_,-n*_,t*_,(n*o-r*s)*_,(i*s-t*o)*_]},matrixMultiply:function(e,t,i){var n=t.x,r=t.y;i.x=e[0]*n+e[2]*r+e[4],i.y=e[1]*n+e[3]*r+e[5]},clamp:function(e,t,i){return Math.min(t,Math.max(e,i))},distance:function(e,t,i,n){var r=i-e,s=n-t;return Math.sqrt(r*r+s*s)},angle:function(e,t,i,n){var r=i-e,s=n-t;return Math.atan2(s,r)},toRadians:function(e){return e*n},toDegrees:function(e){return e/n},boxContainsPoint:function(e,t,i){return t>=e.x&&t<=e.x+e.width&&i>=e.y&&i<=e.y+e.height},getCubicBezier:function(e,t,i,n){return function(r){var s=1-r;return s*s*s*e+3*s*s*r*t+3*s*r*r*i+r*r*r*n}}}}),define("thor/entity/Entity",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({__id:null,__components:null,__active:null,__rootComponent:null,initialize:function(){this.__active=!1,this.__components=[]},setActive:function(e){this.__active=e},isActive:function(e){return this.__active},reset:function(){this.__id=null,this.__components.length=0},setId:function(e){this.__id=e},getId:function(){return this.__id},addComponent:function(e){-1===this.__components.indexOf(e)&&(this.__components.push(e),e.setOwningEntity(this))},removeComponent:function(e){var t=this.__components.indexOf(e);t!==-1&&(this.__components.splice(t,1),e.reset())},onChanged:function(){for(var e=0,t=this.__components.length;e<t;++e)this.__components[e].entityChanged()},getComponent:function(e){for(var t=0,i=this.__components.length;t<i;++t)for(var n=Object.getPrototypeOf(this.__components[t]);n&&n.getType;){var r=n.getType();if(e===r)return this.__components[t];n=Object.getPrototypeOf(n)}return null},getComponentsOfType:function(e,t){t.length=0;for(var i=0,n=this.__components.length;i<n;++i)for(var r=Object.getPrototypeOf(this.__components[i]);r&&r.getType;){var s=r.getType();if(e===s){t.push(this.__components[i]);break}r=Object.getPrototypeOf(r)}},getComponentByName:function(e){for(var t=0,i=this.__components.length;t<i;++t)if(this.__components[t].getName()===e)return this.__components[t];return null},getComponents:function(){return this.__components},getRootComponent:function(){return this.__rootComponent},setRootComponent:function(e){this.__rootComponent=e;var t=this.__components.indexOf(e);-1===t?(this.__components.unshift(e),e.setOwningEntity(this)):(this.__components[t]=this.__components[0],this.__components[0]=e)}})}),define("thor/graphics/DebugRenderer",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/util/RingBuffer"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Device"),s=e("thor/core/Logger").getLogger(i),o=(e("thor/core/Validation"),e("thor/util/RingBuffer"));i.exports=n.create({__freeDebugItems:null,__debugItems:null,initialize:function(){this.__freeDebugItems=new o(new Array(300),300),this.__debugItems=new o(new Array(300),300);for(var e=0;e<300;++e)this.__freeDebugItems.add({type:0,x:0,y:0,extentsX:0,extentsY:0,fillStyle:"",strokeStyle:"",lineWidth:0})},addCircle:function(e,t,i,n){var o=this.__freeDebugItems.remove();if(null===o)return void s.debug("Maximum debug entries reached");o.type=1,o.x=r.sdpToDp(e),o.y=r.sdpToDp(t),o.extentsX=r.sdpToDp(i),o.extentsY=0,o.fillStyle=n,o.strokeStyle="",this.__debugItems.add(o)},addLine:function(e,t,i,n,o,a){var _=this.__freeDebugItems.remove();if(null===_)return void s.debug("Maximum debug entries reached");_.type=3,_.x=r.sdpToDp(e),_.y=r.sdpToDp(t),_.extentsX=r.sdpToDp(i),_.extentsY=r.sdpToDp(n),_.fillStyle="",_.strokeStyle=o,_.lineWidth=a,this.__debugItems.add(_)},drawCanvas:function(e){e.globalAlpha=this._cachedOpacity;var t=this._worldTransform;e.setTransform(t[0],t[1],t[2],t[3],t[4],t[5]);for(var i=this.__debugItems.remove();null!==i;){switch(e.fillStyle=i.fillStyle,e.strokeStyle=i.strokeStyle,e.lineWidth=i.lineWidth,i.type){case 3:e.strokeStyle=i.fillStyle,e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(i.extentsX,i.extentsY),e.stroke();break;case 2:var n=i.x-i.extentsX,r=i.y-i.extentsY,s=2*i.extentsX,o=2*i.extentsY;e.fillRect(n,r,s,o);break;case 1:e.beginPath(),e.arc(i.x,i.y,i.extentsX,0,2*Math.PI,!1),e.closePath(),e.fill()}this.__freeDebugItems.add(i),i=this.__debugItems.remove()}},drawWebGL:function(){}})}),define("thor/entity/EntityComponent",["require","exports","module","thor/core/Class","./Entity","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class"),r=(e("./Entity"),e("thor/core/Validation")),s={INITIALIZE:0,REGISTER:1,BEGIN_PLAY:2,END_PLAY:3};i.exports=n.create({DEPENDENCIES:{},initialize:function(){this.lifecyclePhase=null,this.__owningEntity=null,this._siblings={},this.__name=null},initializeState:function(){this.lifecyclePhase=s.INITIALIZE},register:function(e){this.lifecyclePhase=s.REGISTER},$beginPlay:{arguments:[],returnValue:void 0},beginPlay:function(){this.lifecyclePhase=s.BEGIN_PLAY},$update:{arguments:[{name:"delta",type:"Number",tooltip:"Number of milliseconds since last update"}],returnValue:void 0},update:function(e){},$endPlay:{arguments:[],returnValue:void 0},endPlay:function(){this.lifecyclePhase=s.END_PLAY},reset:function(){var e=this._siblings;for(var t in e)e[t]=null},entityChanged:function(){var e=this._siblings;for(var t in e)e[t]=null;var i=this.DEPENDENCIES;for(var n in i){var s=i[n],o=!r.isBoolean(s.required)||s.required,a=this.getOwningEntity().getComponent(n);if(o&&!a)throw new Error("Component "+this.getType()+" requires sibling "+n);a&&(e[n]=a)}},debugDraw:function(e){},getType:function(){return"EntityComponent"},setOwningEntity:function(e){this.__owningEntity=e},getOwningEntity:function(){return this.__owningEntity},setName:function(e){return this.__name=e,this},getName:function(){return this.__name},clone:function(e){e.__name=this.__name}}),i.exports.computeDependencies=function(e,t,i){if(!e.prototype.DEPENDENCIES)throw new Error("Base class `"+e.name+"` for EntityComponent did not have dependencies computed");var n,r={};for(n in e.DEPENDENCIES)r[n]=e.DEPENDENCIES[n];for(n in t)r[n]=t[n];i.prototype.DEPENDENCIES=r},i.exports.LIFECYCLE_PHASES=s}),define("thor/entity/EntityDestroyedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("EntityDestroyedEvent",1195122013,{entityId:n.assertIsNumber,destroyedByPlayer:n.ifDefined.assertIsBoolean})}),define("thor/entity/EntityManager",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/util/RingBuffer","thor/event/EventManager","thor/graphics/DebugRenderer","thor/debug/PerformanceOverlay","./Entity","./EntityComponent","./EntityDestroyedEvent"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Logger").getLogger(i),o=e("thor/core/Validation"),a=e("thor/util/RingBuffer"),_=(e("thor/event/EventManager"),e("thor/graphics/DebugRenderer"),e("thor/debug/PerformanceOverlay")),l=e("./Entity"),h=(e("./EntityComponent"),e("./EntityDestroyedEvent"));i.exports=r.create(n,{__availableEntities:null,__entitiesById:null,__nextEntityId:null,__componentArraysByType:null,__componentConstructorsByType:null,__componentConstructorArgsByType:null,initialize:function(e,t){n.prototype.initialize.call(this),this.__entitiesById={},this.__availableEntities=new a(new Array(t),t);for(var i=0;i<t;++i)this.__availableEntities.add(new l);this.__componentArraysByType={},this.__componentConstructorsByType={},this.__componentBuffersByType={},this.__nextEntityId=0,e.registerEventHandler(h.EVENT_TYPE,this.__entityDestroyedEventHandler.bind(this));var r=_.getInstance();this.update=r.addInstrumentedTask("EM Update",this.update.bind(this),1e3,5,10)},destroy:function(){for(var e in this.__entitiesById)this.__entitiesById[e].destroy();n.prototype.destroy.call(this)},getEntity:function(e){return this.__entitiesById[e]||null},createEntity:function(){var e=this.__availableEntities.remove();if(!e)throw new Error("Exhausted pool of free entities");var t=++this.__nextEntityId;return e.setId(t),this.__entitiesById[t]=e,e},destroyEntity:function(e){var t=this.__entitiesById[e];if(!t)return void s.debug("Entity already destroyed:",e);t.isActive()&&this.deactivateEntity(t,!1),delete this.__entitiesById[e];for(var i=t.getComponents(),n=0;n<i.length;++n){var r=i[n];r.reset(),this.__componentBuffersByType[r.getType()].add(r)}t.reset(),this.__availableEntities.add(t)},__entityDestroyedEventHandler:function(e){var t=e.getEntityId();this.destroyEntity(t)},registerComponentType:function(e,t,i,n){if(o.ifDefined.assertIsArray(i),o.ifDefined.assertIsNumber(n),n=o.isNumber(n)?n:10,!t.prototype.DEPENDENCIES)return void s.error("Component type "+e+" is missing computed dependencies, call computeDependencies in class definition");i=i||[],i.unshift(null);var r=Function.prototype.bind.apply(t,i);this.__componentConstructorsByType[e]=r,this.__componentArraysByType[e]=[];for(var _=new a(new Array(n),n),l=0;l<n;++l)_.add(new r);this.__componentBuffersByType[e]=_,s.debug("EntityComponent registered ("+n+" instances): ",e)},getComponentInstance:function(e){var t=this.__componentBuffersByType[e];if(!t)return s.error("No such component type registered:",e),null;var i=t.remove();if(!i){var n=t.getMaximumCount(),r=2*n;t.resize(r);for(var o=this.__componentConstructorsByType[e],a=0;a<n;++a)t.add(new o);s.debug("Resized buffer of `"+e+"` to "+r),i=t.remove()}return i},__activateComponent:function(e){this.__componentArraysByType[e.getType()].push(e)},addComponent:function(e,t,i){var n=this.getComponentInstance(t);return e.addComponent(n),e.isActive()&&this.__activateComponent(n),i||e.onChanged(),n},removeComponent:function(e,t){e.removeComponent(t),this.__componentBuffersByType[t.getType()].add(t);var i=this.__componentArraysByType[t.getType()],n=i.indexOf(t);n>=0&&i.splice(n,1)},addComponents:function(e,t){for(var i=0;i<t.length;++i){var n=t[i],r=this.getComponentInstance(n);e.addComponent(r)}e.onChanged()},activateEntity:function(e){if(!e.isActive()){var t=e.getComponents();for(var i in t){var n=t[i];this.__activateComponent(n)}e.setActive(!0)}},deactivateEntity:function(e,t){if(o.ifDefined.assertIsBoolean(t),!e.isActive())throw new Error("Deactivating an already deactivated entity");for(var i=e.getComponents(),n=0;n<i.length;++n){var r=i[n],s=this.__componentArraysByType[r.getType()];s.splice(s.indexOf(r),1),t&&r.reset()}e.setActive(!1)},update:function(e){for(var t in this.__componentArraysByType)for(var i=this.__componentArraysByType[t],n=i.length,r=0;r<n;++r)i[r].update(e)},debugDraw:function(e){for(var t in this.__componentArraysByType)for(var i=this.__componentArraysByType[t],n=0;n<i.length;++n)i[n].debugDraw(e)},clone:function e(t){var i=t.getType(),e=this.getComponentInstance(i);return t.clone(e),e},snapshotEntities:function(){var e={};for(var t in this.__entitiesById)e[t]=this.__entitiesById[t];return e},compareSnapshot:function(e){var t=0,i=0;for(var n in this.__entitiesById)i++,e[n]||(t++,console.debug("New entity",this.__entitiesById[n]));var r=0;for(var n in e)this.__entitiesById[n]||r++;console.debug("Total entities: "+i),console.debug("New entities: "+t),console.debug("Deleted entities: "+r),console.debug("Delta: "+(t-r))}})}),define("thor/entity/World",["require","exports","module","thor/config/Config","thor/core/Class","thor/core/Device","thor/core/Scheduler","thor/core/Validation","thor/core/Logger","thor/graphics/Surface","thor/ui/InputEvent","thor/util/RingBuffer","thor/math/MathHelper","thor/debug/PerformanceOverlay","./Entity","./EntityManager","./EntityComponent","./EntityDestroyedEvent","thor/event/EventManager"],function(e,t,i){var n=(e("thor/config/Config"),e("thor/core/Class")),r=(e("thor/core/Device"),e("thor/core/Scheduler"),e("thor/core/Validation")),s=(e("thor/core/Logger").getLogger(i),e("thor/graphics/Surface"),e("thor/ui/InputEvent"),e("thor/util/RingBuffer"),e("thor/math/MathHelper"),e("thor/debug/PerformanceOverlay")),o=(e("./Entity"),e("./EntityManager"),e("./EntityComponent")),a=e("./EntityDestroyedEvent"),_=(e("thor/event/EventManager"),{CLEAR:1,PRESERVE:2}),l={noActivate:!1},h=[],u=n.create({__animationTaskId:null,__surface:null,__discardFramebuffer:null,__scene:null,__entityManager:null,initialize:function(e,t,i){this.__surface=e,this.__entityManager=t,this.__eventManager=i,this.setClearMode(_.PRESERVE);var n=s.getInstance();this.updateScene=n.addInstrumentedTask("World Update",this.updateScene.bind(this),1e3,5,10),this.draw=n.addInstrumentedTask("World Draw",this.draw.bind(this),1e3,5,10),h.push(this)},setScene:function(e){this.__scene=e},getScene:function(){return this.__scene},destroy:function(){var e=h.indexOf(this);if(e>=0&&h.splice(e,1),this.__scene){var t=this.__eventManager.getNewEvent(a);t.setEntityId(this.__scene.getId()),this.__eventManager.queueEvent(t),this.__scene=null}},handleInputEvent:function(e){var t=this.__scene.getComponent("InputComponent");return!!t&&t.handleInputEvent(e)},updateScene:function(e,t){this.__scene.getRootComponent().updateTransform(!1)},getSurface:function(){return this.__surface},draw:function(e){if(this.__discardFramebuffer){var t=e.gl;t.clear(t.COLOR_BUFFER_BIT)}this.__draw(e)},debugDraw:function(e){this.__entityManager.debugDraw(e)},setClearMode:function(e){switch(e){case _.CLEAR:this.__discardFramebuffer=!0;break;case _.PRESERVE:this.__discardFramebuffer=!1}},__draw:function(e){var t=this.__scene.getRootComponent();t.drawWebGL(e);for(var i=t.getChildren(),n=0,r=i.length;n<r;++n)this.__drawWebGLHelper(e,i[n])},__drawWebGLHelper:function(e,t){if(t.lifecyclePhase===o.LIFECYCLE_PHASES.BEGIN_PLAY){t.drawWebGL(e);for(var i=t.getChildren(),n=0,r=i.length;n<r;++n)this.__drawWebGLHelper(e,i[n])}},spawnEntity:function(e,t){r.ifDefined.assertIsObject(t),t=t||l;var i=this.__entityManager.createEntity(),n=e.getRootComponent();if(n){var s=this.__entityManager.clone(n);i.addComponent(s),s.register(this),i.setRootComponent(s)}for(var o=e.getComponents(),a=0,_=o.length;a<_;++a){var h=o[a];if(h!==n){var u=this.__entityManager.clone(h);u.register(this),i.addComponent(u)}}var n=i.getRootComponent();n||(n=this.__entityManager.addComponent(i,"SceneComponent",!1),i.setRootComponent(n));for(var c=i.getComponents(),a=0,_=o.length;a<_;++a){var h=o[a];if(h._parent){var d=h._parent,g=o.indexOf(d);-1!==g&&c[a].attachTo(c[g])}}var p=[];e.getRootComponent().getAttachedEntities(p);for(var m={attachParent:i.getRootComponent()},a=0,_=p.length;a<_;++a){var f=p[a];this.spawnEntity(f,m).getRootComponent().attachTo(n)}if(r.isNumber(t.sortOrder)&&n.setSortOrder(t.sortOrder),!t.noActivate){var v=t.attachParent||this.__scene.getRootComponent();n.attachTo(v)}o=i.getComponents();for(var a=0,_=o.length;a<_;++a)o[a].beginPlay();return i.onChanged(),t.noActivate||this.__entityManager.activateEntity(i),i}});i.exports=u,i.exports.MULTIVERSE=h,i.exports.CLEAR_MODE=_}),define("thor/math/BoundingBox",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({initialize:function(e,t){this.width=e,this.height=t}})}),define("thor/util/Float32ArrayAllocator",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({__name:null,__chunks:null,__freeList:null,initialize:function(e,t,i){this.__name=e,this.__elementSize=t,this.__chunkSize=i,this.__chunks=[],this.__freeList=[],this.__allocateChunk()},__allocateChunk:function(){for(var e=new Float32Array(this.__elementSize*this.__chunkSize),t=0;t<this.__chunkSize;++t)this.__freeList.push(e.subarray(t*this.__elementSize,(t+1)*this.__elementSize));this.__chunks.push(e)},allocate:function(){return 0!==this.__freeList.length?this.__freeList.pop():(this.__allocateChunk(),this.__freeList.pop())},recycle:function(e){this.__freeList.push(e)}})}),define("thor/entity/SceneComponent",["require","exports","module","thor/core/Class","thor/core/Logger","thor/graphics/Surface","thor/core/Validation","thor/math/ColorUtil","thor/math/MatrixUtil","thor/math/BoundingBox","thor/math/MatrixOrderings","thor/util/Float32ArrayAllocator","./EntityComponent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/graphics/Surface"),o=e("thor/core/Validation"),a=e("thor/math/ColorUtil"),_=e("thor/math/MatrixUtil"),l=e("thor/math/BoundingBox"),h=e("thor/math/MatrixOrderings"),u=e("thor/util/Float32ArrayAllocator"),c=e("./EntityComponent"),d=new Float32Array(8);d[4]=1,d[5]=1;var g=new u("SceneComponentData",14,200),p=(new Float32Array(6),{INHERIT:0,SELF:1});i.exports=n.create(c,{_matrixMode:null,_parent:null,_children:null,_sortOrder:null,_dpBoundingBox:null,_worldToLocalTransform:null,initialize:function(){c.prototype.initialize.call(this),this._children=[],this._sortOrder=0,this._matrixMode=h.SRT,this._dpBoundingBox=new l(0,0),this.__data=g.allocate(),this.__data[4]=1,this.__data[5]=1,this._worldToLocalTransform=this.__data.subarray(8,14),this._tintColor=4294967295,this._tintMode=p.INHERIT,this._combinedTintColor=4294967295,this.__centered=!1,this.__dirtyTransform=!0},destroy:function(){this._worldToLocalTransform=null,g.recycle(this.__data),this.__data=null},reset:function(){c.prototype.reset.call(this),this.removeFromParent(),this._children.length=0,this.__data.set(d,0),this._sortOrder=0,this._matrixMode=h.SRT,this._tintColor=4294967295,this._tintMode=p.INHERIT,this._combinedTintColor=4294967295,this.__centered=!1,this._dpBoundingBox.width=0,this._dpBoundingBox.height=0,this.__dirtyTransform=!0},clone:function(e){c.prototype.clone.call(this,e),e.__data.set(this.__data,0),e.__centered=this.__centered,e._tintColor=this._tintColor,e._tintMode=this._tintMode,e._matrixMode=this._matrixMode,e._sortOrder=this._sortOrder,e._dpBoundingBox.width=this._dpBoundingBox.width,e._dpBoundingBox.height=this._dpBoundingBox.height,e.__dirtyTransform=!0},getType:function(){return"SceneComponent"},register:function(e){c.prototype.register.call(this,e);var t=e.getSurface();if(t.getMode()===s.DrawingMode.WEBGL){var i=t.getRenderer();this._initWebGL(i)}},_initWebGL:function(e){},getParent:function(){return this._parent},attachTo:function(e){if(this._parent===e)return void(this._parent._children.indexOf(this)===-1&&r.error("Parent component is set but does not know we are a child of it"));this._parent&&this.removeFromParent(),this._parent=e,this.__dirtyTransform=!0;var t=this._parent._children,i=t.length;if(0===i||t[i-1]._sortOrder<=this._sortOrder)return void t.push(this);for(var n=0;n<i;++n){var s=t[n];if(!(s._sortOrder<=this._sortOrder)){for(t[n]=this,++n;n<i;++n){var o=t[n];t[n]=s,s=o}return void t.push(s)}}},removeFromParent:function(){if(this._parent){for(var e=this._parent._children,t=e.length,i=0;i<t;++i){if(e[i]===this)break}this._parent=null,i!==t&&e.splice(i,1)}},getChildren:function(){return this._children},getChildByName:function(e){for(var t=this._children.length,i=0;i<t;i++){var n=this._children[i];if(e===n.getName())return n}for(var i=0;i<t;i++){var n=this._children[i],r=n.getChildByName(e);if(null!==r)return r}return null},clearChildren:function(){for(;this._children.length>0;)this._children[0].removeFromParent()},getAttachedEntities:function(e){for(var t=this.getOwningEntity(),i=0,n=this._children.length;i<n;++i){var r=this._children[i];t===r.getOwningEntity()?r.getAttachedEntities(e):e.push(t)}},setCentered:function(e){e&&!this.__centered?(this.setMatrixMode(h.TRTS),this.__data[0]=this.__data[0]-this._dpBoundingBox.width/2,this.__data[1]=this.__data[1]-this._dpBoundingBox.height/2):!e&&this.__centered&&(this.__data[0]=this.__data[0]+this._dpBoundingBox.width/2,this.__data[1]=this.__data[1]+this._dpBoundingBox.height/2),this.__centered=e,this.__dirtyTransform=!0},setSortOrder:function(e){var t=this._parent,i=t&&e!==this._sortOrder;this._sortOrder=e,i&&(this.removeFromParent(),this.attachTo(t))},setTintColor:function(e){o.isNonEmptyString(e)&&(e=parseInt(e,16)),this._tintColor=e},setTintMode:function(e){this._tintMode=e},setRedTint:function(e){this._tintColor=a.setR(this._tintColor,e)},setGreenTint:function(e){this._tintColor=a.setG(this._tintColor,e)},setBlueTint:function(e){this._tintColor=a.setB(this._tintColor,e)},setAlphaTint:function(e){this._tintColor=a.setA(this._tintColor,e)},getTintColor:function(){return this._tintColor},setMatrixMode:function(e){this._matrixMode=e,this.__dirtyTransform=!0},translate:function(e,t){this.__data[2]+=e,this.__data[3]+=t,this.__dirtyTransform=!0},setTranslation:function(e,t){this.__data[2]=e,this.__data[3]=t,this.__dirtyTransform=!0},getTranslation:function(e){e[0]=this.__data[2],e[1]=this.__data[3]},rotate:function(e){this.__data[6]+=e,this.__dirtyTransform=!0},setRotation:function(e){this.__data[6]=e,this.__dirtyTransform=!0},getRotation:function(){return this.__data[6]},shear:function(e){this.__data[7]+=e,
this.__dirtyTransform=!0},setShear:function(e){this.__data[7]=e,this.__dirtyTransform=!0},getShear:function(){return this.__data[7]},scale:function(e,t){this.__data[4]*=e,this.__data[5]*=t,this.__dirtyTransform=!0},setScale:function(e,t){this.__data[4]=e,this.__data[5]=t,this.__dirtyTransform=!0},getScale:function(e){e[0]=this.__data[4],e[1]=this.__data[5]},setTransformPoint:function(e,t){this.__data[0]=e,this.__data[1]=t,this.__dirtyTransform=!0},getTransformPoint:function(e){e[0]=this.__data[0],e[1]=this.__data[1]},getBounds:function(){return this._dpBoundingBox},getWorldToLocalTransform:function(){return this._worldToLocalTransform},updateTransform:function(e){this._parent&&this._tintMode===p.INHERIT?this._combinedTintColor=a.multiplyColors(this._parent._tintColor,this._tintColor):this._combinedTintColor=this._tintColor;var t=this.__dirtyTransform||e;if(t){var i=this.__data,n=i[0],r=i[1],s=i[2],o=i[3],l=i[4],h=i[5],u=i[6],c=i[7],d=this._parent?this._parent._worldToLocalTransform:_.IDENTITY_3x2;_.transform(d,this._worldToLocalTransform,s,o,u,c,l,h,this._matrixMode,n,r)}this.__propagateTransformUpdate(t),this.__dirtyTransform=!1},__propagateTransformUpdate:function(e){for(var t=0,i=this._children.length;t<i;++t)this._children[t].updateTransform(e)},drawWebGL:function(e){}}),c.computeDependencies(c,{},i.exports),i.exports.TintMode=p}),define("thor/entity/InputComponent",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","./EntityComponent","thor/ui/InputEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("./EntityComponent"));e("thor/ui/InputEvent");i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.__inputHandlersByEventType={}},getType:function(){return"InputComponent"},setInputHandlerForType:function(e,t){return this.__inputHandlersByEventType[e]=t,this},clearInputHandlerForType:function(e){return delete this.__inputHandlersByEventType[e],this},getInputHandlerForType:function(e){return this.__inputHandlersByEventType[e]||null},handleInputEvent:function(e){return!!this.__inputHandlersByEventType[e.type]&&this.__inputHandlersByEventType[e.type](e)}}),r.computeDependencies(r,{},i.exports)}),define("thor/debug/FPSMeter",["require","exports","module","thor/core/Class","thor/core/Base","thor/core/Validation","thor/core/Scheduler","thor/core/Device"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Base"),s=e("thor/core/Validation"),o=e("thor/core/Scheduler"),a=e("thor/core/Device");i.exports=n.create(r,{__domNode:null,__animationTaskId:null,initialize:function(e){s.ifDefined.assertIsBoolean(e),r.prototype.initialize.call(this),this.__showMemory=e},_load:function(e){return a.debugFeatures[a.DEBUG_FEATURES.FPS_METER]?(this.__domNode=document.createElement("div"),this.__domNode.id="fps-meter",this.__domNode.style.position="absolute",this.__domNode.style.top="0",this.__domNode.style.left="0",this.__domNode.style.zIndex="1000",this.__domNode.style.background="black",this.__domNode.style.color="red",this.__domNode.style.pointerEvents="none",this.__frames=0,this.__prev=0,this.__time=0,this.__scheduleAnimationTask(),document.body.appendChild(this.__domNode),r.prototype._load.call(this,e)):r.prototype._load.call(this,e)},destroy:function(){o.removeAnimationTask(this.__animationTaskId),this.__domNode&&(document.body.removeChild(this.__domNode),delete this.__domNode),r.prototype.destroy.call(this)},__scheduleAnimationTask:function(){this.__animationTaskId&&o.removeAnimationTask(this.__animationTaskId),this.__animationTaskId=o.addAnimationTask(this.__fpsCounterAnimationTask.bind(this))},__fpsCounterAnimationTask:function(e,t){if(!(t>1e3)&&(++this.__frames,this.__time+=t,this.__time>1e3)){var i=this.__frames;if(this.__showMemory){var n=this.__getMemoryInfo();n&&(i+="<br/>"+n)}this.__domNode.innerHTML=i,this.__frames=0,this.__time-=1e3}},__getMemoryInfo:function(){if(window.performance&&window.performance.memory){return(window.performance.memory.usedJSHeapSize/1024/1024).toFixed(2)+" MB"}return null}})}),define("Version",["require","exports","module"],function(e,t,i){i.exports.BUILD_NUMBER="1.3.48-QUICKSILVER-SNAPSHOT#245#19b0c58f28577f1675df1387431fb7be7b602b53",i.exports.BUILD_MVN="1.3.48-QUICKSILVER-SNAPSHOT",i.exports.BUILD_JENKINS="245",i.exports.BUILD_GITHASH="19b0c58f28577f1675df1387431fb7be7b602b53"}),define("thor/analytics/Seidr",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/util/StringUtil","thor/util/Network","thor/config/Config"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=e("thor/util/StringUtil"),a=e("thor/util/Network"),_=e("thor/config/Config"),l=n.create({initialize:function(){this.__hostUri=_.SEIDR_HOST_URI||null,this.__productId=_.SEIDR_PRODUCT_ID||null,this.__platform="thor-default-platform",this.__source="thor-default-user",this.__sourceType="user",this.__sessionId=o.guid()},setPlatform:function(e){this.__platform=e},setSource:function(e){this.__source=e},setSessionId:function(e){this.__sessionId=e},event:function(e,t,i,n,_){if(!this.__hostUri)return void r.warn("SEIDR_HOST_URI not set, event skipped");if(!this.__productId)return void r.warn("SEIDR_PRODUCT_ID not set, event skipped");s.ifDefined.assertIsObject(t),t=t||{};var l={};for(var h in t)s.isString(t[h])?l[h]=t[h]:l[h]=""+t[h];if(s.ifDefined.assertIsNonEmptyString(i),s.ifDefined.assertIsNonEmptyString(n),s.ifDefined.assertIsNonEmptyString(_),i&&!n||!i&&n)return void r.warn("Both target and targetType must be specified");var u={platform:this.__platform,timestamp:""+Date.now(),name:e,eventId:o.guid(),sessionId:this.__sessionId,source:this.__source,sourceType:this.__sourceType,props:l};i&&n&&(u.target=i,u.targetType=n),_&&(u.transactionId=_);var c=this.__hostUri+"/api/v1/"+this.__productId+"/events";a.sendBeacon(c,u).then(function(t){t?r.debug("Seidr event queued: "+e):r.error("Failed to queue Seidr event: "+e)}).catch(function(e){r.error("Error posting Seidr event",e)})}}),h=null;return l.get=function(){return null===h&&(h=new l),h},l.event=function(){var e=l.get();e.event.apply(e,arguments)},l}),define("thor/math/MersenneTwister",["require","exports","module"],function(e,t,i){var n=624,r=397,s=function(e){void 0===e&&(e=(new Date).getTime()),this.mt=new Array(n),this.mti=625,this.seed(e)};s.prototype.seed=function(e){var t;for(this.mt[0]=e>>>0,this.mti=1;this.mti<n;this.mti++)t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0},s.prototype.seedArray=function(e){var t,i=1,r=0,s=n>e.length?n:e.length;for(this.seed(19650218);s>0;s--)t=this.mt[i-1]^this.mt[i-1]>>>30,this.mt[i]=(this.mt[i]^(1664525*((4294901760&t)>>>16)<<16)+1664525*(65535&t))+e[r]+r,this.mt[i]>>>=0,i++,r++,i>=n&&(this.mt[0]=this.mt[623],i=1),r>=e.length&&(r=0);for(s=623;s;s--)t=this.mt[i-1]^this.mt[i-1]>>>30,this.mt[i]=(this.mt[i]^(1566083941*((4294901760&t)>>>16)<<16)+1566083941*(65535&t))-i,this.mt[i]>>>=0,++i>=n&&(this.mt[0]=this.mt[623],i=1);this.mt[0]=2147483648},s.prototype.int=function(){var e,t,i=new Array(0,2567483615);if(this.mti>=n){for(625===this.mti&&this.seed(5489),t=0;t<227;t++)e=2147483648&this.mt[t]|2147483647&this.mt[t+1],this.mt[t]=this.mt[t+r]^e>>>1^i[1&e];for(;t<623;t++)e=2147483648&this.mt[t]|2147483647&this.mt[t+1],this.mt[t]=this.mt[t+(r-n)]^e>>>1^i[1&e];e=2147483648&this.mt[623]|2147483647&this.mt[0],this.mt[623]=this.mt[396]^e>>>1^i[1&e],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,(e^=e>>>18)>>>0},s.prototype.int31=function(){return this.int()>>>1},s.prototype.real=function(){return this.int()*(1/4294967295)},s.prototype.realx=function(){return(this.int()+.5)*(1/4294967296)},s.prototype.rnd=function(){return this.int()*(1/4294967296)},s.prototype.random=s.prototype.rnd,s.prototype.rndHiRes=function(){return(67108864*(this.int()>>>5)+(this.int()>>>6))*(1/9007199254740992)};var o=new s;s.random=function(){return o.rnd()},i.exports=s}),define("thor/util/XMLLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger","thor/resources/ResourceLoader","./Network"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/core/Logger").getLogger(i)),s=e("thor/resources/ResourceLoader"),o=e("./Network"),a=["xml"];i.exports=n.create(s,{initialize:function(e){s.prototype.initialize.call(this,a),this.__cacheBuster=e?"?c="+e:"",this.__uriPrefix=""},setUriPrefix:function(e){return this.__uriPrefix=e,this},guid:function(e,t){return t},load:function(e,t){var i=t;return this.__uriPrefix&&0!==i.indexOf(this.__uriPrefix)&&(i=this.__uriPrefix+i),i+=this.__cacheBuster,r.debug("Loading "+e+" at "+i),o.getResource(i,{responseType:"document",overrideMimeType:"text/xml"}).then(function(e){return e.documentElement})}}),i.exports.RESOURCE_TYPE="xml"}),define("thor/util/JSONLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger","thor/resources/ResourceLoader","./Network"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/core/Logger").getLogger(i)),s=e("thor/resources/ResourceLoader"),o=e("./Network"),a=["json"];i.exports=n.create(s,{initialize:function(e){s.prototype.initialize.call(this,a),this.__cacheBuster=e?"?c="+e:"",this.__uriPrefix=""},setUriPrefix:function(e){return this.__uriPrefix=e,this},guid:function(e,t){return t},load:function(e,t){var i=t;return this.__uriPrefix&&0!==i.indexOf(this.__uriPrefix)&&(i=this.__uriPrefix+i),i+=this.__cacheBuster,r.debug("Loading "+e+" at "+i),o.getJSON(i)}}),i.exports.RESOURCE_TYPE="json"}),define("thor/util/BulkXMLLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger","thor/resources/ResourceLoader","./Network","./XMLLoader"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/core/Logger").getLogger(i)),s=e("thor/resources/ResourceLoader"),o=e("./Network"),a=e("./XMLLoader"),_=["xmlatlas"];i.exports=n.create(s,{initialize:function(e,t){s.prototype.initialize.call(this,_),this.__resourceManager=e,this.__cacheBuster=t?"?c="+t:""},guid:function(e,t){return t},load:function(e,t){var i=this;return o.getResource(t+this.__cacheBuster,{responseType:"document",overrideMimeType:"text/xml"}).then(function(e){var t=e.querySelectorAll("resource");r.debug("Loading "+t.length+" XML resources");for(var n=0;n<t.length;++n){for(var s=t[n],o=s.getAttribute("name"),_=null,l=0;l<s.childNodes.length;++l){var h=s.childNodes[l];if(1===h.nodeType){_=h;break}}i.__resourceManager.put(a.RESOURCE_TYPE,o,o,_)}return r.debug("Bulk load complete"),e})}}),i.exports.RESOURCE_TYPE="xmlatlas"}),define("thor/util/BulkJSONLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger","thor/resources/ResourceLoader","./Network","./JSONLoader"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/core/Logger").getLogger(i)),s=e("thor/resources/ResourceLoader"),o=e("./Network"),a=e("./JSONLoader"),_=["jsonatlas"];i.exports=n.create(s,{initialize:function(e,t){s.prototype.initialize.call(this,_),this.__resourceManager=e,this.__cacheBuster=t?"?c="+t:""},guid:function(e,t){return t},load:function(e,t){var i=this;return o.getJSON(t+this.__cacheBuster).then(function(e){var t=0;for(var n in e){var s=e[n];i.__resourceManager.put(a.RESOURCE_TYPE,n,n+".json",s),t++}return r.debug("Loaded "+t+" JSON resources"),e})}}),i.exports.RESOURCE_TYPE="jsonatlas"}),define("thor/util/TimeoutContext",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({__arrTimeoutIds:null,__arrIntervalIds:null,initialize:function(){this.__arrTimeoutIds=[],this.__arrIntervalIds=[]},cancelTimeout:function(e){for(var t=this.__arrTimeoutIds.length,i=0;i<t;i++)if(this.__arrTimeoutIds[i]===e){window.clearTimeout(e),this.__arrTimeoutIds.splice(i,1);break}},cancelInterval:function(e){for(var t=this.__arrIntervalIds.length,i=0;i<t;i++)if(this.__arrIntervalIds[i]===e){window.clearTimeout(e),this.__arrIntervalIds.splice(i,1);break}},setTimeout:function(e,t){var i=window.setTimeout(e,t);return this.__arrTimeoutIds.push(i),i},setInterval:function(e,t){var i=window.setInterval(e,t);return this.__arrIntervalIds.push(i),i},clearTimeouts:function(){for(var e=0;e<this.__arrTimeoutIds.length;++e)window.clearTimeout(this.__arrTimeoutIds[e]);this.__arrTimeoutIds.length=0},clearIntervals:function(){for(var e=0;e<this.__arrIntervalIds.length;++e)window.clearTimeout(this.__arrIntervalIds[e]);this.__arrIntervalIds.length=0},clearAll:function(){this.clearTimeouts(),this.clearIntervals()}})}),define("thor/audio/SoundSprite",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/util/TimeoutContext","./SoundManager"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Logger").getLogger(i),o=e("thor/core/Validation"),a=e("thor/util/TimeoutContext"),_=e("./SoundManager"),l=r.create(n,{__seekPoints:null,__soundNamesByIndex:null,__soundId:null,__playingSoundInstancesIdByName:null,__numSounds:null,initialize:function(e,t){if(n.prototype.initialize.call(this),this.__seekPoints={},this.__soundNamesByIndex={},this.__numSounds=0,o.isArray(t))for(var i=0;i<t.length;++i){var r=t[i][0],s=t[i][1],_=t[i][2]-s;this.__seekPoints[r]={name:r,seekPoint:s,endPosition:s+_},this.__soundNamesByIndex[i]=r,this.__numSounds++}else if(o.isObject(t)){for(var l in t)var s=t[l];this.__seekPoints=t}else this.__seekPoints[e]={name:e,seekPoint:0},this.__soundNamesByIndex[0]=r,this.__numSounds=1;this.__soundId=e,this.__playingSoundInstancesIdByName={},this.__playingMusicInstancesByName={},this.__musicTimestamps={},this.__queuedMusicLoopsByName={},this.__timeoutContext=new a,this.__lastPlayedTimesByName={}},getSeekPoints:function(){return this.__seekPoints},isSoundPlaying:function(e){return!!this.__playingSoundInstancesIdByName[e]||this.__playingMusicInstancesByName[e]&&this.__playingMusicInstancesByName[e].length||this.__queuedMusicLoopsByName[e]&&this.__queuedMusicLoopsByName[e].length},play:function(e,t){var i;if(i=o.isNonEmptyString(e)?this.__seekPoints[e]:this.__seekPoints[this.__soundNamesByIndex[0]],o.isUndefined(i))return s.warn("Tried to play non-existant sound within sound sprite:",e),null;var n=this,r=_.getTime(),a=this.__lastPlayedTimesByName[e];if(a&&(t?t.startTime||r:r)-a<.015)return null;t=t||{},o.ifDefined.assertIsFunction(t.onFinished);var l={};l.position=1e3*i.seekPoint,l.onFinished=function(i){delete n.__playingSoundInstancesIdByName[e],!i&&t.onFinished&&t.onFinished()},o.isNumber(t.fadeInDuration)&&(l.fadeInDuration=t.fadeInDuration),o.isNumber(t.volume)&&(l.volume=t.volume),l.channel=o.isNonEmptyString(t.channel)?t.channel:"SFX",t.loop&&(l.loop=!0,l.loopStart=i.seekPoint,l.loopEnd=i.endPosition),t.startTime&&(l.startTime=t.startTime),t.useDurationInStart&&(l.useDurationInStart=t.useDurationInStart),t.loop||(l.duration=i.endPosition-i.seekPoint);var h=_.playSound(this.__soundId,l);return h?(this.__playingSoundInstancesIdByName[e]=h,this.__lastPlayedTimesByName[e]=r,h):null},playLoopingMusicWithTail:function(e,t){function i(){var n=_.getTime(),r=c.play(e,{loop:!1,volume:t.volume,fadeInDuration:t.fadeInDuration,channel:t.channel,onFinished:i,startTime:n+h,useDurationInStart:!0});c.__queuedMusicLoopsByName[e].shift(),c.__queuedMusicLoopsByName[e].push(r)}o.ifDefined.assertIsObject(t),t=t||{};var n=t.tailDuration||0;if(n<=0)return void this.play(e,{loop:!0,volume:t.volume,fadeInDuration:t.fadeInDuration,channel:t.channel,useDurationInStart:!0});var r=this.__seekPoints[e];if(!o.isObject(r))return void s.warn("Tried to play non-existant sound within sound sprite: ",e);var a=r.endPosition-r.seekPoint,l=a-n,h=l-n,u=_.getTime();if(h<0)return void s.warn("Tried to play sprite with tail duration longer than half the full duration, this play mode is not supported: ",e);var c=this,d=this.play(e,{loop:!1,volume:t.volume,fadeInDuration:t.fadeInDuration,channel:t.channel,onFinished:i,useDurationInStart:!0}),g=this.play(e,{loop:!1,volume:t.volume,fadeInDuration:t.fadeInDuration,channel:t.channel,onFinished:i,startTime:u+l,useDurationInStart:!0});this.__queuedMusicLoopsByName[e]||(this.__queuedMusicLoopsByName[e]=[]),this.__queuedMusicLoopsByName[e].push(d),this.__queuedMusicLoopsByName[e].push(g)},stop:function(e,t){var i=this.__playingSoundInstancesIdByName[e];if(!i&&this.__playingMusicInstancesByName[e]&&this.__playingMusicInstancesByName[e].length>0){this.__timeoutContext.clearAll(),delete this.__musicTimestamps[e];var n=_.stopSoundsBySoundId(this.__soundId,t);return this.__playingMusicInstancesByName[e].length=0,n[0]}if(this.__queuedMusicLoopsByName[e]){var r=this.__queuedMusicLoopsByName[e].indexOf(i);r!==-1&&this.__queuedMusicLoopsByName[e].splice(r,1);for(var r=0,o=this.__queuedMusicLoopsByName[e].length;r<o;r++){var a=this.__queuedMusicLoopsByName[e][r];_.stopSoundByInstanceId(a,t)}this.__queuedMusicLoopsByName[e].length=0}return i?_.stopSoundByInstanceId(i,t):(s.warn("Tried to stop a sound that's not playing:",e),null)},getInstanceIdFromSoundName:function(e){return this.__playingSoundInstancesIdByName[e]},getDuration:function(e){var t=this.__seekPoints[e];return t?t.endPosition-t.seekPoint:(s.warning("Sound `"+e+"` does not exist in SoundSprite"),0)},playByIndex:function(e){var t=this.__soundNamesByIndex[e];if(!o.isNonEmptyString(t))throw new Error("No sound at index "+e+" for this sound sprite.");return this.play(t)},getNumberOfSounds:function(){return this.__numSounds},destroy:function(){_.release(this.__soundId),this.__seekPoints=null,this.__soundNamesByIndex=null,this.__timeoutContext.clearAll(),delete this.__timeoutContext,delete this.__playingSoundInstancesIdByName,delete this.__playingMusicInstancesByName,delete this.__queuedMusicLoopsByName,delete this.__musicTimestamps},_load:function(e){var t=this;return _.preloadSound(this.__soundId,e).then(function(){var e=_.getDuration(t.__soundId);for(var i in t.__seekPoints)t.__seekPoints[i].endPosition||(t.__seekPoints[i].endPosition=e);return t})}});l.parseTimecode=function(e){for(var t={},i=e.split("\n"),n=0;n<i.length;++n){var r=i[n].match(/^\d+\s+(\d+):(\d{2})\.(\d{3})\s+\d+\s+Samples\s+(START|END)_(\w+)\s+$/);if(r){var s=+r[1],a=+r[2],_=+r[3],l=r[4],h=r[5].toLowerCase(),u=_/1e3+a+60*s;t[h]||(t[h]={name:h}),"START"===l?t[h].seekPoint=u:"END"===l&&(t[h].endPosition=u)}}for(var c in t){var d=t[c];if(!o.isNumber(d.seekPoint))throw new Error('Missing START tag for "'+c+'"');if(!o.isNumber(d.endPosition))throw new Error('Missing END tag for "'+c+'"')}return t},i.exports=l,i.exports.EMPTY_SOUND_SPRITE=new l("empty-sound-sprite",{})}),define("thor/audio/SoundResourceLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/resources/ResourceLoader","thor/audio/SoundManager"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/resources/ResourceLoader")),s=e("thor/audio/SoundManager");i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this,["sound"])},guid:function(e,t){return t},load:function(e,t){return s.preloadSound(t).then(function(){return t})}}),i.exports.RESOURCE_TYPE="sound"}),define("thor/audio/SoundSpriteResourceLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/resources/ResourceManager","thor/resources/ResourceLoader","thor/audio/SoundSprite","thor/util/JSONLoader"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/resources/ResourceManager"),e("thor/resources/ResourceLoader")),s=e("thor/audio/SoundSprite"),o=e("thor/util/JSONLoader");i.exports=n.create(r,{initialize:function(e,t){r.prototype.initialize.call(this,["soundsprite"]),this.__resourceManager=e,this.__cacheBuster=t?"?c="+t:""},guid:function(e,t){return"soundsprite::"+t},load:function(e,t){var i=t+".json",n=this.__cacheBuster;return this.__resourceManager.loader(o.RESOURCE_TYPE).load(i,i).then(function(e){return new s(t,e).load({cachebust:n})})}}),i.exports.RESOURCE_TYPE="soundsprite"}),define("thor/graphics/resources/Image",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({initialize:function(e,t){this.__width=e,this.__height=t},getWidth:function(){return this.__width},getHeight:function(){return this.__height}}),i.exports.RESOURCE_TYPE="image"}),define("thor/graphics/resources/DOMImageResource",["require","exports","module","thor/core/Class","thor/core/Validation","./Image"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Image"));i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,e.naturalWidth,e.naturalHeight),this.__domElement=e},getDOMElement:function(){return this.__domElement}}),i.exports.RESOURCE_TYPE="domimage"}),define("thor/graphics/resources/TextureRegionResource",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","thor/webgl/Texture","./DOMImageResource"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=(e("thor/core/Validation"),e("thor/webgl/Texture"));e("./DOMImageResource");i.exports=n.create({initialize:function(e,t,i,n,r){Object.defineProperty(this,"name",{configurable:!1,enumerable:!0,value:e,writable:!1}),Object.defineProperty(this,"dimensions",{configurable:!1,enumerable:!0,value:t,writable:!1}),Object.defineProperty(this,"uvs",{configurable:!1,enumerable:!0,value:i,writable:!1}),Object.defineProperty(this,"image",{configurable:!1,enumerable:!0,value:n,writable:!1}),Object.defineProperty(this,"textureFilter",{configurable:!1,enumerable:!0,value:r,writable:!1})},getWidth:function(){return this.dimensions[0]},getHeight:function(){return this.dimensions[1]},getName:function(){return this.name},destroy:function(){if(this.image.__thorTextureIds){for(var e=0;e<this.image.__thorTextureIds.length;++e){var t=this.image.__thorTextureIds[e];r.THOR_TEXTURES_BY_ID[t].dispose()}this.image.__thorTextureIds.length=0}}}),i.exports.RESOURCE_TYPE="textureregion"}),define("thor/graphics/resources/DOMImageLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/resources/ResourceLoader","./Image","./DOMImageResource","./TextureRegionResource"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/resources/ResourceLoader")),s=e("./Image"),o=e("./DOMImageResource"),a=e("./TextureRegionResource"),_=[s.RESOURCE_TYPE,o.RESOURCE_TYPE],l=new Float32Array([0,0,0,1,1,1,1,0]);i.exports=n.create(r,{initialize:function(e,t,i){r.prototype.initialize.call(this,i||_),this.__resourceManager=e,this.__cacheBuster=t?"?c="+t:"",this.__uriPrefix=""},setUriPrefix:function(e){return this.__uriPrefix=e,this},guid:function(e,t){return t},load:function(e,t){var i=document.createElement("img");i.crossOrigin="";var n=t+this.__cacheBuster;this.__uriPrefix&&0!==n.indexOf(this.__uriPrefix)&&(n=this.__uriPrefix+n);var r=this;return new Promise(function(e,t){function s(){_(null)}function o(){_("Image failed to load")}function a(){_("Image loading was aborted")}function _(n){if(i.removeEventListener("load",s,!1),i.removeEventListener("error",o,!1),i.removeEventListener("abort",a,!1),n)t(n);else{e(r._createResourceFromImage(i))}}i.addEventListener("load",s,!1),i.addEventListener("error",o,!1),i.addEventListener("abort",a,!1),i.src=n})},postLoad:function(e,t){var i=new Float32Array([t.getWidth(),t.getHeight()]);return this.__resourceManager.loader(a.RESOURCE_TYPE).load(e,i,l,t)},_createResourceFromImage:function(e){return new o(e)}})}),define("thor/ui/Alignment",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){e("thor/core/Class"),e("thor/core/Validation");i.exports.H_ALIGNMENT={LEFT:0,CENTER:1,RIGHT:2,FILL:3},i.exports.V_ALIGNMENT={TOP:0,CENTER:1,BOTTOM:2,FILL:3}}),define("thor/graphics/resources/BitmapFont",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Alignment","./DOMImageResource","thor/math/MatrixUtil"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation");e("thor/ui/Alignment"),e("./DOMImageResource"),e("thor/math/MatrixUtil");i.exports=n.create({initialize:function(e,t,i,n,s,o){r.ifDefined.assertIsNumber(n),r.ifDefined.assertIsObject(o),this.__imagesByOrdinal=e,this.__domElement=this.__imagesByOrdinal[Object.keys(this.__imagesByOrdinal)[0]].image.getDOMElement(),this.__stretchH=n||1,this.__charsByOrdinal=t,this.__topOverhang=i,this.__fontStringCache=o,this.__kerningByOrdinal={},this.__lineHeight=0;var a=s.split("/");this.__resourceName=a[a.length-1],this.__name="";var _=Object.keys(this.__imagesByOrdinal)[0],l=this.__imagesByOrdinal[_],h=l.image.getDOMElement().src;for(var u in this.__imagesByOrdinal){l=this.__imagesByOrdinal[u];var c=l.image.getDOMElement().src;if(h!==c)throw new Error("Fonts must have a single source image for their characters, "+c+" does not match "+h)}},__setKerningByOrdinal:function(e){this.__kerningByOrdinal=e},__setLineHeight:function(e){this.__lineHeight=e},__setName:function(e){this.__name=e},getDOMElement:function(){return this.__domElement},getOrdinalTextureRegion:function(e){return this.__imagesByOrdinal[e]},getFontStringCache:function(){return this.__fontStringCache},getShortResourceName:function(){return this.__resourceName}}),i.exports.RESOURCE_TYPE="bitmapfont"}),define("thor/webgl/DynamicAtlas",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({initialize:function(e,t){this.__width=e,this.__height=t,this.__lineWidths=new Uint32Array(t)},__findRectangle:function(e,t,i){for(var n=-1,r=0,s=0,o=0;o<this.__height;++o){var a=this.__lineWidths[o];if(a+e<=this.__width){if(n===-1&&(n=o),r++,s=Math.max(a,s),r>=t)return this.__reserveRectangle(s,n,e,t,i),!0}else n=-1,r=0,s=0}return!1},__reserveRectangle:function(e,t,i,n,r){for(var s=t;s<t+n;++s)this.__lineWidths[s]=e+i;r[0]=e,r[1]=t,r[2]=i,r[3]=n},allocateRectangle:function(e,t,i){return this.__findRectangle(e,t,i)},getWidth:function(){return this.__width},getHeight:function(){return this.__height},clear:function(){for(var e=0;e<this.__height;++e)this.__lineWidths[e]=0}})}),define("thor/graphics/text/TextAlignment",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){e("thor/core/Class"),e("thor/core/Validation");i.exports={LEFT:0,CENTER:1,RIGHT:2}}),define("thor/graphics/text/TextLayout",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({initialize:function(e,t,i){this.__topOverhang=e,this.__lineSpacing=t,this.__stretchH=i,this.__textLines=[],this.__textWidths=[],this.__maxTextWidth=0,this.__numCharacters=0},addTextLine:function(e,t){this.__textLines.push(e),this.__textWidths.push(t),this.__maxTextWidth=Math.max(this.__maxTextWidth,t),this.__numCharacters+=e.length},getMaxTextWidth:function(){return this.__maxTextWidth},getMaxTextHeight:function(){return this.__topOverhang+this.__textLines.length*this.__lineSpacing*this.__stretchH},getNumLines:function(){return this.__textLines.length},getTextForLine:function(e){if(e<0||e>=this.__textLines.length)throw new Error("Invalid line index in TextLayout::getTextForLine");return this.__textLines[e]},getWidthForLine:function(e){if(e<0||e>=this.__textWidths.length)throw new Error("Invalid line index in TextLayout::getWidthForLine");return this.__textWidths[e]},getNumCharacters:function(){return this.__numCharacters}})}),define("thor/graphics/text/CachedText",["require","exports","module","thor/core/Class","thor/core/Validation","thor/graphics/resources/BitmapFont","./TextLayout","./TextAlignment"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation");e("thor/graphics/resources/BitmapFont"),e("./TextLayout"),e("./TextAlignment");i.exports=n.create({initialize:function(){var e=new Float32Array([0,0,0,1,1,1,1,0,0,0]);this.__uvs=e.subarray(0,8),this.__extents=e.subarray(8)},setParameters:function(e,t,i,n,s,o,a,_,l,h){r.ifDefined.assertIsNumber(l),r.ifDefined.assertIsNumber(h),l=l||0,h=h||0,this.__text=e,this.__font=t,this.__alignment=i,this.__width=n,this.__height=s,this.__wrap=o,this.__allowOverdraw=a,this.__additionalLineHeight=l,this.__additionalXAdvance=h,this.__cacheToken=_,this.__extents[0]=n,this.__extents[1]=s},setAtlasGeometry:function(e,t,i,n){this.__uvs[0]=e[0]/t,this.__uvs[1]=e[1]/i,this.__uvs[2]=e[0]/t,this.__uvs[3]=(e[1]+e[3])/i,this.__uvs[4]=(e[0]+e[2])/t,this.__uvs[5]=(e[1]+e[3])/i,this.__uvs[6]=(e[0]+e[2])/t,this.__uvs[7]=e[1]/i,this.__extents[0]=n.getMaxTextWidth(),this.__extents[1]=n.getMaxTextHeight()},getUVs:function(){return this.__uvs},getExtents:function(){return this.__extents}})}),define("thor/graphics/text/BitmapFontRenderer",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Device","thor/webgl/WebGLRenderingSession","thor/webgl/Texture","thor/math/MatrixUtil","thor/graphics/resources/BitmapFont","thor/webgl/SpriteBatch","thor/webgl/shaders/SpriteBatch","./TextLayout","./TextAlignment"],function(e,t,i){function n(e,t,i,n){l.ifDefined.assertIsNumber(n),n=n||0;for(var r=0,s=null,o=-1,a=0,_=e.length;a<_;){var h=e.charCodeAt(a);if(h===f)return e.substring(0,a);h===v&&(o=a);var u=t.__charsByOrdinal[h];if(u){var c=s?s.ordinal:0,d=0;t.__kerningByOrdinal[c]&&t.__kerningByOrdinal[c][u.ordinal]&&(d=t.__kerningByOrdinal[c][u.ordinal]);if(r+(u.xOffset+u.width+d)>i)return o!==-1?e.substring(0,o):e.substring(0,a);r+=u.xAdvance+d+n}else if(h===A){a+=D+1,s=u;continue}s=u,a++}return e}function r(e,t,i){l.ifDefined.assertIsNumber(i),i=i||0;for(var n=0,r=null,s=0,o=e.length;s<o;){var a=e.charCodeAt(s),_=t.__charsByOrdinal[a];if(_){var h=r?r.ordinal:0,u=0;if(t.__kerningByOrdinal[h]&&t.__kerningByOrdinal[h][_.ordinal]&&(u=t.__kerningByOrdinal[h][_.ordinal]),s===o-1){n+=_.xOffset+_.width+u}else n+=_.xAdvance+u+i}else if(a===A){s+=D+1,r=_;continue}r=_,s++}return n}function s(e,t,i,s,o){l.ifDefined.assertIsNumber(s),l.ifDefined.assertIsNumber(o),s=s||0,o=o||0;for(var a=new p(t.__topOverhang,t.__lineHeight+s,t.__stretchH),_=e;;){var h=n(_,t,i,o);0===h.length&&(h=_);var u=r(h,t,o);if(a.addTextLine(h,u),h.length===_.length)return a;var c=!1,d=_.charCodeAt(h.length);d!==v&&d!==f||(c=!0),_=_.substring(h.length+(c?1:0))}}function o(e,t,i,n){l.ifDefined.assertIsNumber(i),l.ifDefined.assertIsNumber(n),i=i||0,n=n||0;var s=new p(t.__topOverhang,t.__lineHeight+i,t.__stretchH),o=r(e,t,n);return s.addTextLine(e,o),s}function a(e,t,n,r,s,o,a,c,d,g,p,f,v){l.ifDefined.assertIsNumber(f),l.ifDefined.assertIsNumber(v),f=f||0,v=v||0;var y=i.exports.measureText(t,n,o,g,f,v),I=y.getNumCharacters();if(0!==I){h.debugFeatures[h.DEBUG_FEATURES.HIGHLIGHT_OVERFLOW_TEXT]&&y.getMaxTextWidth()>o&&p===!1&&(s=_(s));var w=T*I*4;if(void 0===E&&(E=new Float32Array(w)),E.length<w){var x=E.length;do{x*=2}while(x<w);E=new Float32Array(x)}var R=6*I;if(void 0===S&&(S=new Uint16Array(R)),S.length<R){var x=S.length;do{x*=2}while(x<R);S=new Uint16Array(x)}for(var P=S,L=E,O=0,V=0,B=n.__stretchH,k=0,W=n.__topOverhang,F=C,U=b,G=M,H=y.getNumLines(),q=0;q<H;++q){var Y=y.getTextForLine(q);switch(r){case m.CENTER:k=~~((o-y.getWidthForLine(q))/2);break;case m.RIGHT:k=o-y.getWidthForLine(q);break;default:k=0}for(var z=null,X=0,K=s,j=!0,Q=!1;X<Y.length;){var Z=Y.charCodeAt(X),J=n.__charsByOrdinal[Z];if(j&&(G[48]=K>>>24,G[49]=K>>16&255,G[50]=K>>8&255,G[51]=255&K),J){var $=z?z.ordinal:0,ee=0;n.__kerningByOrdinal[$]&&n.__kerningByOrdinal[$][J.ordinal]&&(ee=n.__kerningByOrdinal[$][J.ordinal]);var te=n.getOrdinalTextureRegion(Z)
;if(J.width>=1&&J.height>=1&&te){var ie=te.uvs[0],ne=te.uvs[1],re=te.uvs[4],se=te.uvs[5],oe=J.height,ae=oe*(B-1)*.5,_e=c+k+ee,le=d+W+J.yOffset-ae,he=J.width,ue=oe*B;F[2]=ie,F[3]=ne,F[8]=_e,F[9]=le,F[10]=he,F[11]=ue;var ce=T,de=ce+2,ge=ce+3;F[de]=ie,F[ge]=se,F.set(U,ce+4),ce+=T,de=ce+2,ge=ce+3,F[de]=re,F[ge]=se,F.set(U,ce+4),ce+=T,de=ce+2,ge=ce+3,F[de]=re,F[ge]=ne,F.set(U,ce+4);var pe=V*T;if(L.set(C,pe),O>2){O+=2;var me=O-3,fe=O-2,ve=O-1;P[fe]=P[me],P[ve]=V+1}var ye=O+1,Ee=O+2,Se=O+3;P[O]=V+1,P[ye]=V+0,P[Ee]=V+2,P[Se]=V+3,O+=4,V+=4}k+=J.xAdvance+ee+v}else{if(Z===A){if(Q)throw new TypeError("Cannot embed color changes inside other color changes, detected in string: "+Y);Q=!0;var Te=Y.substring(X+1,X+D+1);if(!l.isNumber(+Te))throw new TypeError(Te+" is not a valid hex tint color, encountered in string: "+Y);K=+Te,X+=D+1,z=J,j=!0;continue}if(Z===N){if(!Q)throw new TypeError("Attempted to close a color change when no existing color change started in string: "+Y);Q=!1,K=s,j=!0}}z=J,X++}if(Q)throw new TypeError("Unclosed color change encountered in string: "+Y);W+=(n.__lineHeight+f)*B}var Ce=u.getTextureFromDomImage(e,n.getDOMElement()),Ie=L.subarray(0,V*T),we=P.subarray(0,O);e.spriteBatch.addVerts(Ce,Ie,we)}}function _(e){var t=16776960&e;return(16776960&(t=~t))+(4278190335&e)}var l=(e("thor/core/Class"),e("thor/core/Validation")),h=e("thor/core/Device"),u=(e("thor/webgl/WebGLRenderingSession"),e("thor/webgl/Texture")),c=e("thor/math/MatrixUtil"),d=(e("thor/graphics/resources/BitmapFont"),e("thor/webgl/SpriteBatch")),g=e("thor/webgl/shaders/SpriteBatch"),p=e("./TextLayout"),m=e("./TextAlignment"),f=10,v=32,y=new Float32Array(c.IDENTITY_3x2),E=void 0,S=void 0,T=g.VERTEX_FLOAT32_LENGTH,C=new Float32Array(4*T);C[4]=y[0],C[5]=y[1],C[6]=y[2],C[7]=y[3];for(var I=0;I<4;++I){var w=g.VERTEX_FLOAT32_LENGTH*I;C.set(d.UNIT_QUAD_XYUVS[I],w)}var b=new Float32Array(C.buffer,16,T-4),M=new Uint8Array(C.buffer),x=new Float32Array(c.IDENTITY_3x2),R="«",P="»",A=R.charCodeAt(0),N=P.charCodeAt(0),D=10;i.exports.renderText=function(e,t,i,n,r,s,o,l,u,c,d,g,p,f){var v=n.getFontStringCache();if(""===i)return-1;if(v){var y=v.getCachedText(t);if(y){var E=y.getExtents(),S=0;switch(r){case m.CENTER:S=~~((o-E[0])/2);break;case m.RIGHT:S=o-E[0];break;default:S=0}return x[4]=u+S,x[5]=c,h.debugFeatures[h.DEBUG_FEATURES.HIGHLIGHT_OVERFLOW_TEXT]&&E[0]>o&&g===!1&&(s=_(s)),e.spriteBatch.add(v.getTexture(),y.getUVs(),x,E,s),t}return a(e,i,n,r,s,o,l,u,c,d,g,p,f),v.cacheText(i,n,r,o,l,d,g,p,f)}return a(e,i,n,r,s,o,l,u,c,d,g,p,f),-1},i.exports.renderUncachedText=function(e,t,i,n,r,s,o,_,l,h,u,c,d){a(e,t,i,n,r,s,o,_,l,h,u,c,d)},i.exports.measureText=function(e,t,i,n,r,a){return l.ifDefined.assertIsNumber(r),l.ifDefined.assertIsNumber(a),n?s(e,t,i,r,a):o(e,t,r,a)}}),define("thor/graphics/text/FontStringCache",["require","exports","module","thor/core/Logger","thor/core/Class","thor/core/Validation","thor/util/RingBuffer","thor/webgl/Texture","thor/webgl/Framebuffer","thor/webgl/DynamicAtlas","thor/webgl/Camera","./TextAlignment","./CachedText","./BitmapFontRenderer"],function(e,t,i){var n=e("thor/core/Logger").getLogger(i),r=e("thor/core/Class"),s=(e("thor/core/Validation"),e("thor/util/RingBuffer")),o=(e("thor/webgl/Texture"),e("thor/webgl/Framebuffer")),a=e("thor/webgl/DynamicAtlas"),_=e("thor/webgl/Camera"),l=(e("./TextAlignment"),e("./CachedText")),h=e("./BitmapFontRenderer"),u=new Uint32Array([0,0,0,0]);i.exports=r.create({initialize:function(e){this.__renderer=e;var t=_.makeOrthographic(0,2048,0,2048,-1,1);this.__framebuffer=new o(e,2048,2048,t),this.__dynamicAtlas=new a(2048,2048),this.__tokenCounter=0,this.__cachedText={},this.__deferredCachedText=[],this.__clearFrameBuffer=!0;this.__cachedTextBuffer=new s(new Array(128),128);for(var i=0;i<128;++i)this.__cachedTextBuffer.add(new l)},getCachedText:function(e){return this.__cachedText[e]},cacheText:function(e,t,i,n,r,s,o,a,_){if(""===e)return-1;var h=++this.__tokenCounter,u=this.__cachedTextBuffer.remove();if(!u){var c=this.__cachedTextBuffer.getMaximumCount(),d=2*c;this.__cachedTextBuffer.resize(d);for(var g=0;g<c;++g)this.__cachedTextBuffer.add(new l);console.warn("Increased CachedText buffer size to "+d),u=this.__cachedTextBuffer.remove()}return u.setParameters(e,t,i,n,r,s,o,h,a,_),this.__deferredCachedText.push(u),h},__resetCache:function(){for(var e in this.__cachedText)this.__cachedTextBuffer.add(this.__cachedText[e]);this.__cachedText={},this.__deferredCachedText=[],this.__dynamicAtlas.clear(),this.__clearFrameBuffer=!0},cacheDeferredText:function(){if(0!==this.__deferredCachedText.length){this.__renderer.gl;this.__renderer.setFramebuffer(this.__framebuffer),this.__deferredCachedText.sort(function(e,t){return t.__height-e.__height}),this.__clearFrameBuffer&&(this.__framebuffer.clear(),this.__clearFrameBuffer=!1);for(var e=0;e<this.__deferredCachedText.length;++e){var t=this.__deferredCachedText[e],i=h.measureText(t.__text,t.__font,t.__width,t.__wrap,t.__additionalLineHeight,t.__additionalXAdvance);if(!this.__dynamicAtlas.allocateRectangle(i.getMaxTextWidth(),i.getMaxTextHeight(),u)){n.warn("Font cache full!"),this.__resetCache();break}t.setAtlasGeometry(u,2048,2048,i),h.renderUncachedText(this.__renderer,t.__text,t.__font,t.__alignment,4294967295,i.getMaxTextWidth(),i.getMaxTextHeight(),u[0],u[1],t.__wrap,t.__allowOverdraw,t.__additionalLineHeight,t.__additionalXAdvance),this.__cachedText[t.__cacheToken]=t}this.__renderer.setFramebuffer(null),this.__deferredCachedText.length=0}},getTexture:function(){return this.__framebuffer.getBackingTexture()},debugDraw:function(e){this.__debugUVs=this.__debugUVs||new Float32Array([0,0,0,1,1,1,1,0]),e.spriteBatch.add(this.__framebuffer.getBackingTexture(),this.__debugUVs,new Float32Array([1,0,0,1,0,0]),new Float32Array([800,800]),4294967168)}})}),define("thor/graphics/resources/BitmapFontLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/util/XMLLoader","thor/resources/ResourceLoader","./Image","./BitmapFont","./DOMImageResource","./TextureRegionResource","../text/FontStringCache","thor/util/Network"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/util/XMLLoader"),o=e("thor/resources/ResourceLoader"),a=(e("./Image"),e("./BitmapFont")),_=e("./DOMImageResource"),l=e("./TextureRegionResource"),h=e("../text/FontStringCache"),u=(e("thor/util/Network"),[a.RESOURCE_TYPE]);i.exports=n.create(o,{initialize:function(e,t,i,n){o.prototype.initialize.call(this,u),r.ifDefined.assertIsInstanceOf(i,h),r.ifDefined.assertIsBoolean(n),this.__resourceManager=e,this.__cacheBuster="?c="+t,this.__fontStringCache=i,this.__uriPrefix="",r.isDefined(n)?this.__isPreProcessed=n:this.__isPreProcessed=!0},setUriPrefix:function(e){return this.__uriPrefix=e,this},guid:function(e,t){return t+"-font"},load:function(e,t){var i=this,n=t;return this.__uriPrefix&&0!==n.indexOf(this.__uriPrefix)&&(n=this.__uriPrefix+n),new Promise(function(t,r){i.__resourceManager.has(s.RESOURCE_TYPE,e)?t(i.__resourceManager.get(s.RESOURCE_TYPE,e)):i.__resourceManager.loader(s.RESOURCE_TYPE).load(e,n).then(function(){t(i.__resourceManager.get(s.RESOURCE_TYPE,e))})}).then(function(t){return i.__processData(t,e,n.substring(0,n.lastIndexOf("/")+1))})},__processData:function(e,t,i){var n=this;return new Promise(function(s,o){function h(e,t){return new Promise(function(r,s){n.__resourceManager.has(l.RESOURCE_TYPE,e)?r(n.__resourceManager.get(l.RESOURCE_TYPE,e)):n.__resourceManager.loader(_.RESOURCE_TYPE).load(e,i+t).then(function(){r(n.__resourceManager.get(l.RESOURCE_TYPE,e))})})}function u(e,t){var i=t+"-"+e;return h(i,i+".png")}function c(e,t,i){return u(e,t).then(function(t){return i[e]=t,t})}function d(e,t,i){var n=i.getWidth(),r=i.getHeight(),s=i.textureFilter,o=i.image,a=t.charsByOrdinal[e],_=i.name+"-"+e,h=a.width,u=a.height,c=a.x,d=a.y,g=h/n,p=u/r,m=c/n,f=d/r,v=new Float32Array(8);v[0]=m,v[1]=f,v[2]=m,v[3]=f+p,v[4]=m+g,v[5]=f+p,v[6]=m+g,v[7]=f;var y=new Float32Array(2);return y[0]=h,y[1]=u,new l(_,y,v,o,s)}function g(e){var t=e.arrOrdinals;return new Promise(function(i,r){var s=f.querySelectorAll("page");if(1!==s.length)r("Expected 1 font page. Got "+s.length);else{var o=s[0],a=o.getAttribute("file"),_=a.replace(/\.png$/,"").toLowerCase();if(n.__isPreProcessed){for(var l={},u=[],g=0,p=t.length;g<p;g++){var m=t[g];32!==m&&u.push(c(m,_,l))}Promise.all(u).then(function(){i(l)})}else h(_,a).then(function(n){for(var r={},s=0,o=t.length;s<o;s++){var a=t[s];32!==a&&(r[a]=d(a,e,n))}i(r)})}})}if("font"!==e.tagName)return o("Font definition expected be a <font> element.  Found "+e.tagName),null;var p=e,m=p.querySelector("common"),f=p.querySelector("pages"),v=p.querySelector("chars"),y=p.querySelector("kernings"),E=p.querySelector("info"),S=new Promise(function(e,t){r.isObject(v)||t("Could not find chars element in font xml");for(var i=v.querySelectorAll("char"),n=0,s={},o=[],a=0,_=i.length;a<_;++a){var l=i[a],h=+l.getAttribute("id"),u=l.getAttribute("letter"),c={ordinal:h,letter:u,x:+l.getAttribute("x"),y:+l.getAttribute("y"),width:+l.getAttribute("width"),height:+l.getAttribute("height"),xOffset:+l.getAttribute("xoffset"),yOffset:+l.getAttribute("yoffset"),xAdvance:+l.getAttribute("xadvance"),page:l.getAttribute("page")};c.yOffset<0&&(n=Math.max(n,-c.yOffset)),s[h]=c,o.push(h)}e({charsByOrdinal:s,topOverhang:n,arrOrdinals:o})}),T=new Promise(function(e,t){if(!r.isObject(y))return void e(null);for(var i=y.querySelectorAll("kerning"),n={},s=0,o=i.length;s<o;++s){var a=i[s],_=a.getAttribute("first"),l=a.getAttribute("second"),h=+a.getAttribute("amount");n[_]||(n[_]={}),n[_][l]=h}e(n)});return Promise.all([S,T]).then(function(e){var t=e[0],i=e[1];return g(t).then(function(e){return[e,t,i]})}).then(function(e){var i=e[0],r=e[1].charsByOrdinal,o=e[1].topOverhang,_=+E.getAttribute("stretchH")/100,l=new a(i,r,o,_,t,n.__fontStringCache);e[2]&&l.__setKerningByOrdinal(e[2]),m&&l.__setLineHeight(Number(m.getAttribute("lineHeight"))),E&&l.__setName(E.getAttribute("face")),s(l)})})}})}),define("thor/graphics/resources/TextureRegionResourceLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/resources/ResourceLoader","./DOMImageResource","./TextureRegionResource"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/resources/ResourceLoader"),o=(e("./DOMImageResource"),e("./TextureRegionResource")),a=[o.RESOURCE_TYPE];i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this,a)},guid:function(e,t,i,n,s){return r.ifDefined.assertIsNonEmptyString(s),n.getDOMElement().src+"#"+i[0]+","+i[1]+","+i[4]+","+i[5]+","+s},load:function(e,t,i,n,s){return r.ifDefined.assertIsNonEmptyString(s),Promise.resolve(new o(e,t,i,n,s))}})}),define("thor/graphics/resources/TextureRegion",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/core/Logger").getLogger(i);i.exports=n.create({initialize:function(e){this.__name=e,this.__source=e,this.__rotated=!1,this.__x=0,this.__y=0,this.__width=0,this.__height=0,this.__originalWidth=0,this.__originalHeight=0,this.__offsetX=0,this.__offsetY=0,this.__index=-1,this.__uvs=new Float32Array(8),this.__textureFilter=null},getName:function(){return this.__name},setSource:function(e){return this.__source=e,this},getSource:function(){return this.__source},getUVs:function(){return this.__uvs},setRotate:function(e){return this.__rotated=e,this},isRotated:function(){return this.__rotated},setXy:function(e,t){return this.__x=e,this.__y=t,this},setSize:function(e,t){return this.__width=e,this.__height=t,this},getWidth:function(){return this.__width},getHeight:function(){return this.__height},setOrig:function(e,t){return this.__originalWidth=e,this.__originalHeight=t,this},getOriginalWidth:function(){return this.__originalWidth},getOriginalHeight:function(){return this.__originalHeight},setOffset:function(e,t){return this.__offsetX=e,this.__offsetY=t,this},getOffsetX:function(){return this.__offsetX},getOffsetY:function(){return this.__offsetY},setTextureFilter:function(e){r.ifDefined.assertIsNonEmptyString(e),this.__textureFilter=e},getTextureFilter:function(){return this.__textureFilter},setIndex:function(e){return-1!==e&&s.warn("Got index that was not -1 ("+e+").  What do?"),this.__index=e,this},setAtlasSize:function(e,t){return this.__rotated?(this.__uvs[0]=this.__x,this.__uvs[1]=this.__y,this.__uvs[2]=this.__x,this.__uvs[3]=this.__y+this.__width,this.__uvs[4]=this.__x+this.__height,this.__uvs[5]=this.__y+this.__width,this.__uvs[6]=this.__x+this.__height,this.__uvs[7]=this.__y):(this.__uvs[0]=this.__x,this.__uvs[1]=this.__y,this.__uvs[2]=this.__x,this.__uvs[3]=this.__y+this.__height,this.__uvs[4]=this.__x+this.__width,this.__uvs[5]=this.__y+this.__height,this.__uvs[6]=this.__x+this.__width,this.__uvs[7]=this.__y),this}})}),define("thor/graphics/resources/ThorTextureAtlas",["require","exports","module","thor/core/Class","thor/core/Validation","./TextureRegion","./DOMImageResource"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation"),e("./TextureRegion"),e("./DOMImageResource");i.exports=n.create({initialize:function(e){this.__domImageResource=e,this.__name=void 0,this.__width=e.getWidth(),this.__height=e.getHeight(),this.__regions={}},setAssetName:function(e){this.__name=e},addRegion:function(e){this.__regions[e.getName()]=e,e.setAtlasSize(this.__width,this.__height)},getRegion:function(e){return this.__regions[e]},getRegions:function(e){return this.__regions},getImage:function(){return this.__domImageResource}}),i.exports.RESOURCE_TYPE="thoratlas"}),define("thor/graphics/resources/ProxyImageResource",["require","exports","module","thor/core/Class","thor/core/Validation","./DOMImageResource"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./DOMImageResource"));i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,e)},setResolveURI:function(e){return this.resolveURI=e,this}}),i.exports.RESOURCE_TYPE="proxyimage"}),define("thor/graphics/resources/ThorTextureAtlasLoader",["require","exports","module","thor/core/Class","thor/util/Network","thor/core/Validation","thor/util/JSONLoader","thor/resources/ResourceLoader","./TextureRegion","./DOMImageResource","./ProxyImageResource","./ThorTextureAtlas","./TextureRegionResource"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/util/Network"),e("thor/core/Validation")),s=e("thor/util/JSONLoader"),o=e("thor/resources/ResourceLoader"),a=e("./TextureRegion"),_=e("./DOMImageResource"),l=e("./ProxyImageResource"),h=e("./ThorTextureAtlas"),u=e("./TextureRegionResource"),c=[h.RESOURCE_TYPE];i.exports=n.create(o,{initialize:function(e){o.prototype.initialize.call(this,c),this.__resourceManager=e},guid:function(e,t){return"thoratlas:"+t},load:function(e,t,i){r.ifDefined.assertIsBoolean(i);var n=this,o=t.replace(/\.json((\?.+)|)$/,"_sm.png$1"),a=t.replace(/\.json((\?.+)|)$/,".png$1");return Promise.all([this.__resourceManager.loader(s.RESOURCE_TYPE).load(t,t),i?this.__resourceManager.loader(l.RESOURCE_TYPE).load(a,o,a):this.__resourceManager.loader(_.RESOURCE_TYPE).load(a,a)]).then(function(t){var i=t[0],r=t[1],s=n.__createAtlas(i,r);s.setAssetName(e);var o=s.getRegions();return Promise.all(Object.keys(o).map(function(e){var t=o[e],i=new Float32Array([t.getOriginalWidth(),t.getOriginalHeight()]),s=t.getTextureFilter();return n.__resourceManager.loader(u.RESOURCE_TYPE).load(t.getName(),i,t.getUVs(),r,s).then(function(e){if(n.__resourceManager.has(u.RESOURCE_TYPE,t.getSource()))return e;var o=n.__resourceManager.loader(u.RESOURCE_TYPE).guid(t.getName(),i,t.getUVs(),r,s);return n.__resourceManager.put(u.RESOURCE_TYPE,t.getSource(),o,e),e})})).then(function(){return s})})},__createAtlas:function(e,t){for(var i=new h(t),n=e.frames,r=0;r<n.length;++r){var s=n[r],o=s.options,_=new a(s.name);_.setSource(s.source),_.setRotate(o.rotated||!1),_.setXy(s.x,s.y),_.setSize(s.width,s.height),_.setOrig(o.sourceSize.w,o.sourceSize.h),_.setOffset(0,0),_.setTextureFilter(o.textureFilter),i.addRegion(_)}return i}})}),define("thor/ui/Slot",["require","exports","module","thor/core/Class","thor/core/Validation","./Widget"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Widget"));i.exports=n.create({initialize:function(){this.__widget=r.NULL_WIDGET},_setProperties:function(e,t){throw new Error("Slot._setProperties must be overridden by sub-types")},setWidget:function(e){this.__widget=e},getWidget:function(){return this.__widget},getOffsetLeft:function(){return this.__offsets.left},setOffsetLeft:function(e){this.__offsets.left=e},getOffsetTop:function(){return this.__offsets.top},setOffsetTop:function(e){this.__offsets.top=e},getOffsetRight:function(){return this.__offsets.right},setOffsetRight:function(e){this.__offsets.right=e},getOffsetBottom:function(){return this.__offsets.bottom},setOffsetBottom:function(e){this.__offsets.bottom=e}})}),define("thor/ui/Panel",["require","exports","module","thor/core/Class","thor/core/Validation","thor/math/ColorUtil","./Vector","./Geometry","./Widget","./Slot"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/math/ColorUtil"),o=(e("./Vector"),e("./Geometry"),e("./Widget"));e("./Slot");i.exports=n.create(o,{initialize:function(){o.prototype.initialize.call(this),this.__childSlots=[],this._inheritTint=!0,this._tintColor=4294967295},setTintColor:function(e){this._tintColor=e},getTintColor:function(){return this._tintColor},setInheritTint:function(e){this._inheritTint=e},getInheritTint:function(){return this._inheritTint},_setProperties:function(e,t){void 0!==e.tintColor&&this.setTintColor(e.tintColor),void 0!==e.inheritTint&&this.setInheritTint(e.inheritTint)},_onForEachChild:function(e){for(var t=this.__childSlots.length,i=0;i<t;++i){if(e(this.__childSlots[i].getWidget()))return}},_onForEachChildReverse:function(e){for(var t=this.__childSlots.length,i=t-1;i>=0;--i){if(e(this.__childSlots[i].getWidget()))return}},_onComputeDesiredSize:function(e){e.x=0,e.y=0},_onArrangeChildren:function(e){},_draw:function(e){if(this.getVisibility()===o.VISIBILITY.VISIBLE){this._transform&&e.spriteBatch.pushTransform(this._transform),this._inheritTint?e.spriteBatch.pushTint(s.multiplyColors(this._tintColor,e.spriteBatch.peekTint())):e.spriteBatch.pushTint(this._tintColor);for(var t=this.__childSlots.length,i=0;i<t;++i){this.__childSlots[i].getWidget()._draw(e)}this._transform&&e.spriteBatch.popTransform(),e.spriteBatch.popTint()}},_onCreateSlot:function(){throw new Error("Derived Panel didn't override _onCreateSlot")},addSlot:function(e){var t=this._onCreateSlot();return this.__childSlots.push(t),e(t),this},getSlotAtIndex:function(e){if(e<0||e>=this.__childSlots.length)throw new Error("Slot index out of range");return this.__childSlots[e]},removeSlotAtIndex:function(e){return this.__childSlots.splice(e,1)[0]},removeSlot:function(e){var t=this.__childSlots.indexOf(e);if(-1!==t)return this.removeSlotAtIndex(t)},findSlotWithWidget:function(e){for(var t=0,i=this.__childSlots.length;t<i;++t){var n=this.__childSlots[t];if(e===n.getWidget())return n}return null},getNumSlots:function(){return this.__childSlots.length}}),i.exports.validateProperties=function(e,t){r.ifDefined.assertIsNumber(e.tintColor),r.ifDefined.assertIsBoolean(e.inheritTint)},i.exports.validateSlotProperties=function(e,t){throw new Error("Panel::validateSlotProperties must be overridden by sub-types")}}),define("thor/ui/Anchor",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({initialize:function(e,t,i,n){this.minX=e,this.minY=t,this.maxX=i,this.maxY=n},isStretchedVertical:function(){return this.minY!==this.maxY},isStretchedHorizontal:function(){return this.minX!==this.maxX}}),i.exports.createUniformAnchor=function(e){return new i.exports(e,e,e,e)},i.exports.createSplitAnchor=function(e,t){return new i.exports(e,t,e,t)}}),define("thor/ui/LeafWidget",["require","exports","module","thor/core/Class","thor/core/Validation","./Widget","./Vector"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Widget"));e("./Vector");i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this)},_onComputeDesiredSize:function(e){e.x=0,e.y=0},_draw:function(e){}})}),define("thor/ui/ImageWidget",["require","exports","module","thor/core/Class","thor/core/Validation","thor/graphics/resources/Image","thor/graphics/resources/DOMImageResource","thor/graphics/resources/TextureRegionResource","thor/webgl/Texture","./Widget","./LeafWidget","./Vector","thor/math/MatrixUtil"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=(e("thor/graphics/resources/Image"),e("thor/graphics/resources/DOMImageResource")),o=e("thor/graphics/resources/TextureRegionResource"),a=e("thor/webgl/Texture"),_=e("./Widget"),l=e("./LeafWidget"),h=(e("./Vector"),e("thor/math/MatrixUtil")),u=new Float32Array(h.IDENTITY_3x2),c={STRETCH:0,FIT:1,FILL:2};i.exports=n.create(l,{initialize:function(){l.prototype.initialize.call(this),this.__region=null,this.__extents=new Float32Array(2),this.__location=new Float32Array(2),this.__scale=1,this.__uvs=new Float32Array([0,0,0,1,1,1,1,0]),this.__scaledUVs=new Float32Array([0,0,0,1,1,1,1,0]),this.__texture=void 0,this._hasRenderState=!1,this.__vertexColors=[4294967295,4294967295,4294967295,4294967295],this.__flipX=!1,this.__flipY=!1,this.__layoutMode=c.STRETCH},_setProperties:function(e,t){void 0!==e.region&&this.setTextureRegion(t.get(o.RESOURCE_TYPE,e.region)),void 0!==e.vertexColors?this.setVertexColors(e.vertexColors):void 0!==e.tintColor&&this.setTintColor(e.tintColor),void 0!==e.flipX&&this.setFlipX(e.flipX),void 0!==e.flipY&&this.setFlipY(e.flipY),void 0!==e.layoutMode&&this.setLayoutMode(e.layoutMode),void 0!==e.scale&&this.setScale(e.scale)},setTextureRegion:function(e){this.__region=e,this.__extents.set(e.dimensions,0),this.__uvs.set(e.uvs,0);var t=this.__uvs;if(this.__flipX){var i=t[0],n=t[1],r=t[4],s=t[5];t[0]=r,t[1]=n,t[2]=r,t[3]=s,t[4]=i,t[5]=s,t[6]=i,t[7]=n}if(this.__flipY){var i=t[0],n=t[1],r=t[4],s=t[5];t[0]=i,t[1]=s,t[2]=i,t[3]=n,t[4]=r,t[5]=n,t[6]=r,t[7]=s}return this._hasRenderState=!1,this},clearTextureRegion:function(){this.__region=null,this._hasRenderState=!1},setTintColor:function(e){return this.__vertexColors[0]=e,this.__vertexColors[1]=e,this.__vertexColors[2]=e,this.__vertexColors[3]=e,this},setVertexColors:function(e){return this.setVertexColor(0,e[0]),this.setVertexColor(1,e[1]),this.setVertexColor(2,e[2]),this.setVertexColor(3,e[3]),this},setVertexColor:function(e,t){return this.__vertexColors[e]=t,this},getTintColor:function(){return this.__vertexColors[0]},getVertexColors:function(){return this.__vertexColors},setFlipX:function(e){if(e!==this.__flipX){var t=this.__uvs,i=t[0],n=t[1],r=t[4],s=t[5];t[0]=r,t[1]=n,t[2]=r,t[3]=s,t[4]=i,t[5]=s,t[6]=i,t[7]=n}return this.__flipX=e,this},setFlipY:function(e){if(e!==this.__flipY){var t=this.__uvs,i=t[0],n=t[1],r=t[4],s=t[5];t[0]=i,t[1]=s,t[2]=i,t[3]=n,t[4]=r,t[5]=n,t[6]=r,t[7]=s}return this.__flipY=e,this},setScale:function(e){return this.__scale=e,this},setLayoutMode:function(e){this.__layoutMode=e},__createTexture:function(e){r.isInstanceOf(this.__region,o)&&(this.__texture=a.getTextureFromDomImage(e,this.__region.image.getDOMElement()),this._hasRenderState=!0)},_onComputeDesiredSize:function(e){this.__region?(e.x=Math.round(this.__region.getWidth()*this.__scale),e.y=Math.round(this.__region.getHeight()*this.__scale)):(e.x=0,e.y=0)},_setGeometry:function(e){if(l.prototype._setGeometry.call(this,e),this.__region&&this.__layoutMode===c.FIT){var t=this.__region.getWidth()/this.__region.getHeight(),i=e.__sizeX/e.__sizeY;if(i>t){var n=this.__region.getHeight()*i;this.__extents[0]=e.__sizeX*(this.__region.getWidth()/n),this.__extents[1]=e.__sizeY}else{var r=this.__region.getWidth()/i;this.__extents[0]=e.__sizeX,this.__extents[1]=e.__sizeY*(this.__region.getHeight()/r)}var s=.5*(e.__sizeX-this.__extents[0]),o=.5*(e.__sizeY-this.__extents[1]);this.__location[0]=e.__absolutePositionX+s,this.__location[1]=e.__absolutePositionY+o}else this.__extents[0]=e.__sizeX,this.__extents[1]=e.__sizeY,this.__location[0]=e.__absolutePositionX,this.__location[1]=e.__absolutePositionY;this.__updateScaledUVs()},__updateScaledUVs:function(){if(this.__region)switch(this.__layoutMode){case c.STRETCH:case c.FIT:this.__scaledUVs.set(this.__uvs,0);break;case c.FILL:var e=this.__extents[0]/this.__extents[1];if(e>this.__region.getWidth()/this.__region.getHeight()){var t=this.__region.getWidth()/e,i=this.__uvs[5]-this.__uvs[1],n=this.__region.getHeight()/t;n>1&&(n=1/n);var r=(i-i*n)/2;this.__scaledUVs[0]=this.__uvs[0],this.__scaledUVs[1]=this.__uvs[1]+r,this.__scaledUVs[2]=this.__uvs[2],this.__scaledUVs[3]=this.__uvs[3]-r,this.__scaledUVs[4]=this.__uvs[4],this.__scaledUVs[5]=this.__uvs[5]-r,this.__scaledUVs[6]=this.__uvs[6],this.__scaledUVs[7]=this.__uvs[7]+r}else{var s=this.__region.getHeight()*e,o=this.__uvs[4]-this.__uvs[0],n=this.__region.getWidth()/s;n>1&&(n=1/n);var a=(o-o*n)/2;this.__scaledUVs[0]=this.__uvs[0]+a,this.__scaledUVs[1]=this.__uvs[1],this.__scaledUVs[2]=this.__uvs[2]+a,this.__scaledUVs[3]=this.__uvs[3],this.__scaledUVs[4]=this.__uvs[4]-a,this.__scaledUVs[5]=this.__uvs[5],this.__scaledUVs[6]=this.__uvs[6]-a,this.__scaledUVs[7]=this.__uvs[7]}}},_draw:function(e){this.getVisibility()===_.VISIBILITY.VISIBLE&&(this._hasRenderState||(this.__createTexture(e),this._hasRenderState))&&(u[4]=this.__location[0],u[5]=this.__location[1],this._transform&&e.spriteBatch.pushTransform(this._transform),e.spriteBatch.addColored(this.__texture,this.__scaledUVs,u,this.__extents,this.__vertexColors[0],this.__vertexColors[1],this.__vertexColors[2],this.__vertexColors[3]),this._transform&&e.spriteBatch.popTransform())}}),i.exports.validateProperties=function(e,t){r.ifDefined.assertIsNonEmptyString(e.image),r.ifDefined.assertIsNumber(e.tintColor),r.ifDefined.assertIsBoolean(e.flipX),r.ifDefined.assertIsBoolean(e.flipY),r.ifDefined.assertValueInEnum(e.layoutMode,c),r.ifDefined.assertIsNumber(e.scale),r.ifDefined.assertIsArray(e.vertexColors),e.image&&t.get(s.RESOURCE_TYPE,e.image)},i.exports.LAYOUT_MODE=c}),define("thor/ui/ListPanel",["require","exports","module","thor/core/Class","thor/core/Validation","./Widget","./Vector","./Geometry","./Panel","./Slot","./Alignment"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./Widget"),o=(e("./Vector"),e("./Geometry")),a=e("./Panel"),_=e("./Slot"),l=e("./Alignment"),h=new o(0,0,0,0),u={HORIZONTAL:"horizontal",VERTICAL:"vertical"},c=n.create(_,{initialize:function(){_.prototype.initialize.call(this),this.__hAlign=l.H_ALIGNMENT.FILL,this.__vAlign=l.V_ALIGNMENT.FILL,this.__autoSize=!0,this.__sizeFraction=1},_setProperties:function(e,t){void 0!==e.hAlign&&this.setHAlign(e.hAlign),void 0!==e.vAlign&&this.setVAlign(e.vAlign),void 0!==e.autoSize&&this.setAutoSize(e.autoSize),void 0!==e.sizeFraction&&this.setSizeFraction(e.sizeFraction)},setHAlign:function(e){this.__hAlign=e},setVAlign:function(e){this.__vAlign=e},setAutoSize:function(e){this.__autoSize=e},setSizeFraction:function(e){this.__sizeFraction=e}});i.exports=n.create(a,{initialize:function(){a.prototype.initialize.call(this),this.__axis=u.VERTICAL,this.__spacing=0},_setProperties:function(e,t){a.prototype._setProperties.call(this,e,t),void 0!==e.axis&&this.setAxis(e.axis),void 0!==e.spacing&&this.setSpacing(e.spacing)},setAxis:function(e){return this.__axis=e,this},setSpacing:function(e){return this.__spacing=e,this},_onComputeDesiredSize:function(e){for(var t=0,i=0,n=0,r=this.__childSlots.length,o=0;o<r;++o){var a=this.__childSlots[o].getWidget();if(a.getVisibility()!==s.VISIBILITY.COLLAPSED){var _=a.getDesiredSize();n++,t+=this.__axis===u.HORIZONTAL?_.x:_.y,i=Math.max(i,this.__axis===u.HORIZONTAL?_.y:_.x)}}n>1&&(t+=this.__spacing*(n-1)),this.__axis===u.HORIZONTAL?(e.x=t,e.y=i):(e.y=t,e.x=i)},_onArrangeChildren:function(e){for(var t=this.__childSlots.length,i=0,n=0,r=0,o=0,a=0,_=0;_<t;++_){var c=this.__childSlots[_],d=c.getWidget();d.getVisibility()!==s.VISIBILITY.COLLAPSED&&(a++,c.__autoSize?(i+=d.getDesiredSize().x,n+=d.getDesiredSize().y):(r+=c.__sizeFraction,o+=c.__sizeFraction,0===r&&(r=1),0===o&&(o=1)))}var g=a>1?this.__spacing*(a-1):0;i+=g,n+=g;for(var p=e.__sizeX-i,m=e.__sizeY-n,f=0,v=0,_=0;_<t;++_){var c=this.__childSlots[_],d=c.getWidget();if(d.getVisibility()!==s.VISIBILITY.COLLAPSED){var y=d.getDesiredSize(),E=c.__autoSize?this.__axis===u.HORIZONTAL?y.x:e.__sizeX:this.__axis===u.HORIZONTAL?p*c.__sizeFraction/r:e.__sizeX,S=c.__autoSize?this.__axis===u.VERTICAL?y.y:e.__sizeY:this.__axis===u.VERTICAL?m*c.__sizeFraction/o:e.__sizeY,T=c.__autoSize&&this.__axis==u.HORIZONTAL||c.__hAlign!==l.H_ALIGNMENT.FILL?Math.min(y.x,E):E,C=c.__autoSize&&this.__axis==u.VERTICAL||c.__vAlign!==l.V_ALIGNMENT.FILL?Math.min(y.y,S):S,I=0,w=0;switch(c.__hAlign){case l.H_ALIGNMENT.LEFT:I=0;break;case l.H_ALIGNMENT.CENTER:I=(E-T)/2;break;case l.H_ALIGNMENT.RIGHT:I=E-T;break;case l.H_ALIGNMENT.FILL:I=0}switch(c.__vAlign){case l.V_ALIGNMENT.TOP:w=0;break;case l.V_ALIGNMENT.CENTER:w=(S-C)/2;break;case l.V_ALIGNMENT.BOTTOM:w=S-C;break;case l.V_ALIGNMENT.FILL:w=0}e.createOffsetGeometry(h,f+I,v+w,T,C),d._setGeometry(h),this.__axis===u.HORIZONTAL?(f+=E,f+=this.__spacing):(v+=S,v+=this.__spacing)}}},_onCreateSlot:function(){return new c}}),i.exports.validateProperties=function(e,t){a.validateProperties(e,t),r.ifDefined.assertValueInEnum(e.axis,u)},i.exports.validateSlotProperties=function(e,t){r.ifDefined.assertValueInEnum(e.hAlign,l.H_ALIGNMENT),r.ifDefined.assertValueInEnum(e.vAlign,l.V_ALIGNMENT),r.ifDefined.assertIsBoolean(e.autoSize),r.ifDefined.assertIsNumber(e.sizeFraction)},i.exports.PRIMARY_AXIS=u}),define("thor/ui/HListPanel",["require","exports","module","thor/core/Class","./ListPanel","thor/core/Logger"],function(e,t,i){var n=e("thor/core/Class"),r=e("./ListPanel"),s=e("thor/core/Logger").getLogger(i);i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),s.warn("HListPanel is depreciated, use ListPanel instead.")}}),i.exports.validateProperties=r.validateProperties,i.exports.validateSlotProperties=r.validateSlotProperties,i.exports.PRIMARY_AXIS=r.PRIMARY_AXIS}),define("thor/ui/Margin",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({initialize:function(e,t,i,n){this.left=e,this.top=t,this.right=i,this.bottom=n}}),i.exports.createUniformMargin=function(e){return new i.exports(e,e,e,e)},i.exports.createSplitMargin=function(e,t){return new i.exports(e,t,e,t)}}),define("thor/ui/CanvasPanel",["require","exports","module","thor/core/Class","thor/core/Validation","./Widget","./Vector","./Geometry","./Panel","./Slot","./Alignment","./Anchor","./Margin"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./Widget"),o=e("./Vector"),a=e("./Geometry"),_=e("./Panel"),l=e("./Slot"),h=(e("./Alignment"),e("./Anchor")),u=e("./Margin"),c=new a(0,0,0,0),d=n.create(l,{initialize:function(){l.prototype.initialize.call(this),this.__autoSize=!1,this.__alignment=new o(0,0),this.__anchors=new h(0,0,0,0),this.__offsets=new u(0,0,0,0),this.__padding=0},_setProperties:function(e,t){void 0!==e.autoSize&&this.setAutoSize(e.autoSize),this.setAlignment(e.alignmentX||this.__alignment.x,e.alignmentY||this.__alignment.y),this.setAnchor(new h(e.anchorLeft||this.__anchors.minX,e.anchorTop||this.__anchors.minY,e.anchorRight||this.__anchors.maxX,e.anchorBottom||this.__anchors.maxY)),this.setOffset(new u(e.marginLeft||this.__offsets.left,e.marginTop||this.__offsets.top,e.marginRight||this.__offsets.right,e.marginBottom||this.__offsets.bottom)),void 0!==e.padding&&this.setPadding(e.padding)},
setAutoSize:function(e){this.__autoSize=e},setAnchor:function(e){this.__anchors=e},setOffset:function(e){this.__offsets=e},setPadding:function(e){this.__padding=e},setAlignment:function(e,t){this.__alignment.x=e,this.__alignment.y=t},getAutoSize:function(){return this.__autoSize},getAnchor:function(){return this.__anchors},getOffset:function(){return this.__offsets},getPadding:function(){return this.__padding},getAlignment:function(){return this.__alignment}});i.exports=n.create(_,{initialize:function(){_.prototype.initialize.call(this)},_setProperties:function(e,t){_.prototype._setProperties.call(this,e,t)},_onComputeDesiredSize:function(e){for(var t=0,i=0,n=this.__childSlots.length,r=0;r<n;++r){var o=this.__childSlots[r],a=o.getWidget();if(a.getVisibility()!==s.VISIBILITY.COLLAPSED){var _=a.getDesiredSize(),l=(o.__autoSize?_.x:o.__offsets.right)+2*o.__padding,h=(o.__autoSize?_.y:o.__offsets.bottom)+2*o.__padding,u=o.__anchors.minX===o.__anchors.maxX&&(0===o.__anchors.minX||1===o.__anchors.maxX),c=o.__anchors.minY===o.__anchors.maxY&&(0===o.__anchors.minY||1===o.__anchors.maxY);t=Math.max(t,l+(u?Math.abs(o.__offsets.left):0)),i=Math.max(i,h+(c?Math.abs(o.__offsets.top):0))}}e.x=t,e.y=i},_onArrangeChildren:function(e){for(var t=this.__childSlots.length,i=0;i<t;++i){var n=this.__childSlots[i],r=n.getWidget();if(r.getVisibility()!==s.VISIBILITY.COLLAPSED){var o=r.getDesiredSize(),a=n.__anchors.minX*e.__sizeX,_=n.__anchors.minY*e.__sizeY,l=n.__anchors.maxX*e.__sizeX,h=n.__anchors.maxY*e.__sizeY,u=n.__anchors.minX!==n.__anchors.maxX,d=n.__anchors.minY!==n.__anchors.maxY,g=(n.__autoSize?o.x:n.__offsets.right)+2*n.__padding,p=(n.__autoSize?o.y:n.__offsets.bottom)+2*n.__padding,m=g*n.__alignment.x,f=p*n.__alignment.y,v=u?a+n.__offsets.left:a+n.__offsets.left-m,y=u?l-v-n.__offsets.right:g,E=d?_+n.__offsets.top:_+n.__offsets.top-f,S=d?h-E-n.__offsets.bottom:p;e.createOffsetGeometry(c,v,E,y,S),r._setGeometry(c)}}},_onCreateSlot:function(){return new d}}),i.exports.validateProperties=function(e,t){_.validateProperties(e,t)},i.exports.validateSlotProperties=function(e,t){r.ifDefined.assertIsBoolean(e.autoSize),r.ifDefined.assertIsNumber(e.alignmentX),r.ifDefined.assertIsNumber(e.alignmentY),r.ifDefined.assertIsNumber(e.anchorLeft),r.ifDefined.assertIsNumber(e.anchorRight),r.ifDefined.assertIsNumber(e.anchorTop),r.ifDefined.assertIsNumber(e.anchorBottom),r.ifDefined.assertIsNumber(e.marginLeft),r.ifDefined.assertIsNumber(e.marginRight),r.ifDefined.assertIsNumber(e.marginTop),r.ifDefined.assertIsNumber(e.marginBottom)}}),define("thor/ui/CompositeWidget",["require","exports","module","thor/core/Class","thor/core/Validation","thor/math/MatrixUtil","./Widget","./Vector","./Geometry"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/math/MatrixUtil"),e("./Widget"));e("./Vector"),e("./Geometry");i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.__content=r.NULL_WIDGET},setContent:function(e){return this.__content=e,this},_onForEachChild:function(e){e(this.__content)},_onForEachChildReverse:function(e){e(this.__content)},_onComputeDesiredSize:function(e){this.__content._onComputeDesiredSize(e)},_onArrangeChildren:function(e){this.__content._setGeometry(e)},_draw:function(e){this.getVisibility()===r.VISIBILITY.VISIBLE&&(this._transform&&e.spriteBatch.pushTransform(this._transform),this.__content._draw(e),this._transform&&e.spriteBatch.popTransform())}})}),define("thor/ui/ScissorBoxWidget",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Device","./Widget","./CompositeWidget","thor/math/MatrixUtil","thor/webgl/VertexFormat"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/core/Device"),e("./Widget")),s=e("./CompositeWidget"),o=e("thor/math/MatrixUtil"),a=e("thor/webgl/VertexFormat"),_=new Float32Array([0,0,0,1,1,1,1,0]),l=new Float32Array([0,0]),h=new Float32Array(o.IDENTITY_3x2),u=n.create(a,{initialize:function(){},setup:function(e,t){var i=e.gl;i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT),i.stencilFunc(i.ALWAYS,1,255),i.stencilOp(i.KEEP,i.REPLACE,i.REPLACE),i.stencilMask(255),i.colorMask(!1,!1,!1,!1)}}),c=n.create(a,{initialize:function(){},setup:function(e,t){var i=e.gl;i.colorMask(!0,!0,!0,!0),i.stencilFunc(i.EQUAL,1,255)}}),d=n.create(a,{initialize:function(){},setup:function(e,t){var i=e.gl;i.disable(i.STENCIL_TEST)}}),g=new u,p=new c,m=new d,f=new Float32Array(0),v=new Uint16Array(0);i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__stencilPosition=new Float32Array([0,0,0,1]),this.__stencilSize=new Float32Array([0,0,0,0]),this.__enableStencilVertexFormat=new u},_draw:function(e){if(this.getVisibility()===r.VISIBILITY.VISIBLE){var t=e.spriteBatch;t.end(),e.addDrawCall(g,f,f,v,f,0,null,null,null,null,null,null,null,null),t.begin(),l[0]=this.__cachedGeometry.__sizeX,l[1]=this.__cachedGeometry.__sizeY,h[4]=this.__cachedGeometry.__absolutePositionX,h[5]=this.__cachedGeometry.__absolutePositionY,t.add(e.defaultTexture,_,h,l,4294967295),t.end(),e.addDrawCall(p,f,f,v,f,0,null,null,null,null,null,null,null,null),t.begin(),this._transform&&e.spriteBatch.pushTransform(this._transform),this.__content._draw(e),this._transform&&e.spriteBatch.popTransform(),t.end(),e.addDrawCall(m,f,f,v,f,0,null,null,null,null,null,null,null,null),t.begin()}}})}),define("thor/ui/ScrollWidgetEvent",["require","exports","module","thor/core/Class"],function(e,t,i){var n=e("thor/core/Class");i.exports=n.create({initialize:function(){this.contentSize=0,this.scrollAmount=0}})}),define("thor/ui/ScrollWidget",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Scheduler","thor/core/Validation","thor/math/MatrixUtil","./Widget","./CompositeWidget","./ScissorBoxWidget","./InputEvent","./Geometry","./Slot","./Margin","./ScrollWidgetEvent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Device"),s=e("thor/core/Scheduler"),o=e("thor/core/Validation"),a=(e("thor/math/MatrixUtil"),e("./Widget"),e("./CompositeWidget")),_=e("./ScissorBoxWidget"),l=e("./InputEvent"),h=e("./Geometry"),u=e("./Slot"),c=e("./Margin"),d=e("./ScrollWidgetEvent"),g=n.create(u,{initialize:function(e){u.prototype.initialize.call(this),this.__containingCompositeWidget=e,this.__margin=new c(0,0,0,0)},_setProperties:function(e,t){this.setMargin(new c(e.marginLeft||this.__margin.left,e.marginTop||this.__margin.top,e.marginRight||this.__margin.right,e.marginBottom||this.__margin.bottom))},setMargin:function(e){this.__margin=e},setWidget:function(e){u.prototype.setWidget.call(this,e),this.__containingCompositeWidget.setContent(e)}});i.exports=n.create(a,{initialize:function(){a.prototype.initialize.call(this),this.__forceAllowDragScrolling=!0,this.__scrollVertically=!1,this.__scrollHorizontally=!1,this.__mouseScrollRate=1,this.__verticalScrollAmount=0,this.__horizontalScrollAmount=0,this.__scrollHandler=null,this.__possibleVerticalScrollPixels=0,this.__possibleHorizontalScrollPixels=0,this.__cachedChildGeometry=new h(0,0,0,0),this.__isScrolling=!1,this.__isReadyToScroll=!1,this.__isInertiaScrolling=!1,this.__lastScrollX=0,this.__lastScrollY=0,this.__velocityX=0,this.__velocityY=0,this.__previousWheelDelta=0,this.__animationTaskId=void 0,this.__lastMoveEventTimestamp=0,this.__scissorBoxWidget=new _,this.setContent(this.__scissorBoxWidget),this.__scrollSlot=new g(this.__scissorBoxWidget),this._createNamedSlot("content",this.__scrollSlot)},getVerticalScrollAmount:function(){return this.__verticalScrollAmount},getHorizontalScrollAmount:function(){return this.__horizontalScrollAmount},_setProperties:function(e,t){void 0!==e.scrollVertically&&this.setScrollVertically(e.scrollVertically),void 0!==e.scrollHorizontally&&this.setScrollHorizontally(e.scrollHorizontally),void 0!==e.forceAllowDragScrolling&&this.setForceAllowDragScrolling(e.forceAllowDragScrolling),void 0!==e.mouseScrollRate&&this.setMouseScrollRate(e.mouseScrollRate)},setScrollVertically:function(e){return this.__scrollVertically=e,this},setScrollHorizontally:function(e){return this.__scrollHorizontally=e,this},setForceAllowDragScrolling:function(e){return this.__forceAllowDragScrolling=e,this},setMouseScrollRate:function(e){return this.__mouseScrollRate=e,this},setVerticalScrollRatio:function(e){this.__verticalScrollAmount=Math.max(Math.min(e,1),0);var t=new d;return t.scrollAmount=this.__scrollVertically?this.__verticalScrollAmount:this.__horizontalScrollAmount,this.onScroll(t),this.invalidate(),this},setHorizontalScrollRatio:function(e){this.__horizontalScrollAmount=Math.max(Math.min(e,1),0);var t=new d;return t.scrollAmount=this.__scrollVertically?this.__verticalScrollAmount:this.__horizontalScrollAmount,this.onScroll(t),this.invalidate(),this},getPreviousWheelDelta:function(){return this.__previousWheelDelta},_cacheDesiredSize:function(){a.prototype._cacheDesiredSize.call(this);var e=new d;e.contentSize=this.__scrollVertically?this.getDesiredSize().y:this.getDesiredSize().x,this.onSizeChange(e)},_onForEachDescendant:function(e){this._onForEachChild(e)},_onArrangeChildren:function(e){if(this.__content._setGeometry(e),this.__cachedChildGeometry.copyFrom(e),this.__scrollHorizontally){var t=this.__desiredSize.x;this.__cachedChildGeometry.__sizeX=t;var i=t+this.__scrollSlot.__margin.left+this.__scrollSlot.__margin.right-this.__scissorBoxWidget.__cachedGeometry.__sizeX;i=Math.max(i,0),this.__possibleHorizontalScrollPixels=i;var n=this.__horizontalScrollAmount*i;this.__cachedChildGeometry.__absolutePositionX=this.__scissorBoxWidget.__cachedGeometry.__absolutePositionX+this.__scrollSlot.__margin.left-n}if(this.__scrollVertically){var r=this.__desiredSize.y;this.__cachedChildGeometry.__sizeY=r;var s=r+this.__scrollSlot.__margin.top+this.__scrollSlot.__margin.bottom-this.__scissorBoxWidget.__cachedGeometry.__sizeY;s=Math.max(s,0),this.__possibleVerticalScrollPixels=s;var n=this.__verticalScrollAmount*s;this.__cachedChildGeometry.__absolutePositionY=this.__scissorBoxWidget.__cachedGeometry.__absolutePositionY+this.__scrollSlot.__margin.top-n}this.getNamedSlot("content").getWidget()._setGeometry(this.__cachedChildGeometry)},onPointerDown:function(e){if(!this.__forceAllowDragScrolling&&!r.hasTouch)return!1;var t=this.__isInertiaScrolling;return this.__isScrolling===!1&&(this.__lastScrollX=e.x,this.__lastScrollY=e.y,this.__isReadyToScroll=!0),this.__isInertiaScrolling=!1,t&&(Math.abs(this.__velocityX)<=5||Math.abs(this.__velocityY)<=5)&&(t=!1),t},onPointerUp:function(e){if(!this.__forceAllowDragScrolling&&!r.hasTouch)return!1;var t=this.__isScrolling,i=this.__isInertiaScrolling;if(this.__isScrolling===!0){this.__isScrolling=!1,e.wasCaptured&&(e.stopCapture(l.EVENT_TYPE.POINTER_UP,this),e.stopCapture(l.EVENT_TYPE.CANCEL,this)),e.stopCapture(l.EVENT_TYPE.POINTER_MOVE,this);Date.now()-this.__lastMoveEventTimestamp<500&&(0!==this.__velocityX||0!==this.__velocityY)&&(this.__isInertiaScrolling=!0,this.__startAnimation())}return this.__isReadyToScroll=!1,t||i},onPointerMove:function(e){function t(i){i._onForEachChild(function(i){i.onPointerCancel&&i.onPointerCancel(e),t(i)})}if(!this.__forceAllowDragScrolling&&!r.hasTouch)return!1;var i=this.__isScrolling,n=e.x-this.__lastScrollX,s=e.y-this.__lastScrollY;if(0===n&&0===s)return i;if(this.__isScrolling){var o=Date.now(),a=(o-this.__lastMoveEventTimestamp)/1e3;if(this.__lastMoveEventTimestamp=o,this.__velocityX=0!==a?n/a:0,this.__velocityY=0!==a?s/a:0,this.__lastScrollX=e.x,this.__lastScrollY=e.y,this.__scrollHorizontally&&this.__possibleHorizontalScrollPixels>0){this.__horizontalScrollAmount-=n/this.__possibleHorizontalScrollPixels,this.__horizontalScrollAmount=Math.min(Math.max(0,this.__horizontalScrollAmount),1);var e=new d;e.scrollAmount=this.__horizontalScrollAmount,this.onScroll(e)}if(this.__scrollVertically&&this.__possibleVerticalScrollPixels>0){this.__verticalScrollAmount-=s/this.__possibleVerticalScrollPixels,this.__verticalScrollAmount=Math.min(Math.max(0,this.__verticalScrollAmount),1);var e=new d;e.scrollAmount=this.__verticalScrollAmount,this.onScroll(e)}this.invalidate()}else this.__isReadyToScroll&&(Math.abs(n)>=10||Math.abs(s)>=10)&&(this.__isScrolling=!0,e.capture(l.EVENT_TYPE.POINTER_UP,this),e.capture(l.EVENT_TYPE.POINTER_MOVE,this),e.capture(l.EVENT_TYPE.CANCEL,this),t(this));return i},onWheel:function(e){var t=!1;if(this.__scrollVertically){var i=this.__possibleVerticalScrollPixels*this.__verticalScrollAmount,n=Math.min(Math.max(i-this.__possibleVerticalScrollPixels,this.__mouseScrollRate*-e.wheelDelta),i),r=this.__verticalScrollAmount;if(this.__possibleVerticalScrollPixels>0){this.__verticalScrollAmount-=n/this.__possibleVerticalScrollPixels;var e=new d;e.scrollAmount=this.__verticalScrollAmount,this.onScroll(e)}t=r!==this.__verticalScrollAmount,this.__previousWheelDelta=n}return this.invalidate(),t},onPointerCancel:function(e){return this.onPointerUp(e)},__animationTask:function(e,t){if(!this.__isInertiaScrolling)return void this.__stopAnimation();var i=t/1e3,n=!1;if(this.__scrollHorizontally&&this.__possibleHorizontalScrollPixels>0&&Math.abs(this.__velocityX)>2){var r=this.__velocityX*i*3;this.__velocityX-=r,this.__horizontalScrollAmount-=this.__velocityX*i/this.__possibleHorizontalScrollPixels,this.__horizontalScrollAmount=Math.min(Math.max(0,this.__horizontalScrollAmount),1);var s=new d;s.scrollAmount=this.__horizontalScrollAmount,this.onScroll(s),n=!0}if(this.__scrollVertically&&this.__possibleVerticalScrollPixels>0&&Math.abs(this.__velocityY)>2){var r=this.__velocityY*i*3;this.__velocityY-=r,this.__verticalScrollAmount-=this.__velocityY*i/this.__possibleVerticalScrollPixels,this.__verticalScrollAmount=Math.min(Math.max(0,this.__verticalScrollAmount),1);var s=new d;s.scrollAmount=this.__verticalScrollAmount,this.onScroll(s),n=!0}n?this.invalidate():(this.__isInertiaScrolling=!1,this.__stopAnimation())},__startAnimation:function(){void 0===this.__animationTaskId&&(this.__animationTaskId=s.addAnimationTask(this.__animationTask.bind(this)))},__stopAnimation:function(){void 0!==this.__animationTaskId&&(s.removeAnimationTask(this.__animationTaskId),this.__animationTaskId=void 0,this.__velocityX=0,this.__velocityY=0)},onSizeChange:function(e){},onScroll:function(e){this.__scrollHandler&&this.__scrollHandler(e)},setScrollHandler:function(e){this.__scrollHandler=e}}),i.exports.validateProperties=function(e,t){o.ifDefined.assertIsBoolean(e.scrollVertically),o.ifDefined.assertIsBoolean(e.scrollHorizontally)},i.exports.validateNamedSlotProperties=function(e,t,i){o.ifDefined.assertIsNumber(t.marginLeft),o.ifDefined.assertIsNumber(t.marginRight),o.ifDefined.assertIsNumber(t.marginTop),o.ifDefined.assertIsNumber(t.marginBottom)}}),define("thor/ui/resources/NineSliceResource",["require","exports","module","thor/core/Class","thor/core/Validation","thor/graphics/resources/TextureRegionResource"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation"),e("thor/graphics/resources/TextureRegionResource");i.exports=n.create({initialize:function(e,t){this.__textureRegion=e,this.__margins=t},getTextureRegion:function(){return this.__textureRegion},getMargins:function(){return this.__margins}}),i.exports.RESOURCE_TYPE="nineslice"}),define("thor/ui/NineSliceWidget",["require","exports","module","thor/core/Class","thor/core/Validation","thor/math/ColorUtil","thor/graphics/resources/Image","thor/graphics/resources/TextureRegionResource","thor/webgl/Texture","thor/webgl/shaders/SpriteBatch","./Widget","./LeafWidget","./Vector","./resources/NineSliceResource"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/math/ColorUtil"),o=(e("thor/graphics/resources/Image"),e("thor/graphics/resources/TextureRegionResource")),a=e("thor/webgl/Texture"),_=e("thor/webgl/shaders/SpriteBatch"),l=e("./Widget"),h=e("./LeafWidget"),u=(e("./Vector"),e("./resources/NineSliceResource")),c=new Float32Array([1,0,0,1,0,0]),d=new Uint16Array([0,4,1,5,2,6,3,7,7,4,4,8,5,9,6,10,7,11,11,8,8,12,9,13,10,14,11,15]);i.exports=n.create(h,{initialize:function(){h.prototype.initialize.call(this),this.__region=null,this.__vertBuffer=new ArrayBuffer(16*_.VERTEX_LENGTH),this.__vertexDataFloat32=new Float32Array(this.__vertBuffer),this.__vertexDataUint8=new Uint8Array(this.__vertBuffer),this.__top=0,this.__right=0,this.__bottom=0,this.__left=0,this.__tintColor=4294967295,this.__vertexColors=[4294967295,4294967295,4294967295,4294967295],this.__perVertexColors=!1,this._hasRenderState=!1,this.__horizontalFlip=!1,this.__verticalFlip=!1},setTintColor:function(e){this.__tintColor=e;for(var t=0,i=this.__vertexDataUint8,n=0;n<4;++n)for(var r=0;r<4;++r){var o=t*_.VERTEX_UINT8_LENGTH;s.writeToUint8Array(this.__tintColor,i,o+_.VERTEX_OFFSETS.r),t++}return this.__perVertexColors=!1,this},getTintColor:function(){return this.__tintColor},setVertexColors:function(e){return this.__vertexColors=e,this.__perVertexColors=!0,this},getVertexColors:function(){return this.__vertexColors},setHorizontalFlip:function(e){this.__horizontalFlip=e},getHorizontalFlip:function(){return this.__horizontalFlip},setVerticalFlip:function(e){this.__verticalFlip=e},getVerticalFlip:function(){return this.__verticalFlip},_setProperties:function(e,t){if(void 0!==e.nineslice){var i=t.get(u.RESOURCE_TYPE,e.nineslice),n=i.getMargins();this.setTextureRegionWithMetrics(i.getTextureRegion(),n.top,n.right,n.bottom,n.left)}else void 0!==e.region&&this.setTextureRegionWithMetrics(t.get(o.RESOURCE_TYPE,e.region),e.top||this.__top,e.right||this.__right,e.bottom||this.__bottom,e.left||this.__left);void 0!==e.vertexColors?this.setVertexColors(e.vertexColors):void 0!==e.tintColor&&this.setTintColor(e.tintColor),r.isBoolean(e.horizontalFlip)&&this.setHorizontalFlip(e.horizontalFlip),r.isBoolean(e.verticalFlip)&&this.setVerticalFlip(e.verticalFlip)},setTextureRegionWithMetrics:function(e,t,i,n,r){return this.__top=t,this.__right=i,this.__bottom=n,this.__left=r,this.__region=e,this._hasRenderState=!1,this},setTextureRegion:function(e){return this.__region=e,this._hasRenderState=!1,this},_onComputeDesiredSize:function(e){this.__region?(e.x=this.__region.getWidth(),e.y=this.__region.getHeight()):(e.x=0,e.y=0)},_setGeometry:function(e){if(this.__region){h.prototype._setGeometry.call(this,e);var t=this.__region.getWidth(),i=this.__region.getHeight(),n=e.__sizeX,r=e.__sizeY,o=Math.min(n,this.__left),a=Math.max(o,n-this.__right),l=this.__region.uvs,u=l[0],d=l[1],g=l[4],p=l[5],m=g-u,f=p-d,v=[0,o,a,n],y=Math.min(r,this.__top),E=Math.max(y,r-this.__bottom),S=[0,y,E,r],T=[u,u+m*(o/t),u+m*Math.max(o,t-this.__right)/t,g],C=[d,d+f*(y/i),d+f*(Math.max(1,Math.max(y,i-this.__bottom))/i),p];if(this.__horizontalFlip){for(var I=0;I<4;I++)v[I]=n-v[I];v.reverse(),T.reverse()}if(this.__verticalFlip){for(var I=0;I<4;I++)S[I]=r-S[I];S.reverse(),C.reverse()}var w=0;c[4]=this.__cachedGeometry.__absolutePositionX,c[5]=this.__cachedGeometry.__absolutePositionY;for(var b=this.__vertexDataFloat32,M=this.__vertexDataUint8,x=0;x<4;++x)for(var R=0;R<4;++R){var P=w*_.VERTEX_FLOAT32_LENGTH,A=w*_.VERTEX_UINT8_LENGTH,N=v[x],D=S[R],L=T[x],O=C[R];if(b[P+_.VERTEX_OFFSETS.x]=N,b[P+_.VERTEX_OFFSETS.y]=D,b[P+_.VERTEX_OFFSETS.u]=L,b[P+_.VERTEX_OFFSETS.v]=O,b.set(c,P+_.VERTEX_OFFSETS.t0),b[P+_.VERTEX_OFFSETS.width_scale]=1,b[P+_.VERTEX_OFFSETS.height_scale]=1,this.__perVertexColors){var V=s.lerp(this.__vertexColors[0],this.__vertexColors[1],N/n),o=s.lerp(this.__vertexColors[3],this.__vertexColors[2],N/n),B=s.lerp(V,o,D/r);s.writeToUint8Array(B,M,A+_.VERTEX_OFFSETS.r)}else s.writeToUint8Array(this.__tintColor,M,A+_.VERTEX_OFFSETS.r);w++}}},__createTexture:function(e){r.isInstanceOf(this.__region,o)&&(this.__texture=a.getTextureFromDomImage(e,this.__region.image.getDOMElement()),this._hasRenderState=!0)},_draw:function(e){this.getVisibility()===l.VISIBILITY.VISIBLE&&(this._hasRenderState||(this.__createTexture(e),this._hasRenderState))&&(this._transform&&e.spriteBatch.pushTransform(this._transform),e.spriteBatch.addVerts(this.__texture,this.__vertexDataFloat32,d),this._transform&&e.spriteBatch.popTransform())}}),i.exports.validateProperties=function(e,t){r.ifDefined.assertIsNonEmptyString(e.nineslice),r.ifDefined.assertIsNonEmptyString(e.region),r.ifDefined.assertIsNumber(e.top),r.ifDefined.assertIsNumber(e.right),r.ifDefined.assertIsNumber(e.bottom),r.ifDefined.assertIsNumber(e.left),r.ifDefined.assertIsNumber(e.tintColor),r.ifDefined.assertIsArray(e.vertexColors),r.ifDefined.assertIsBoolean(e.horizontalFlip),r.ifDefined.assertIsBoolean(e.verticalFlip),e.nineslice&&t.get(u.RESOURCE_TYPE,e.nineslice),e.region&&t.get(o.RESOURCE_TYPE,e.region)}}),define("thor/ui/ScrollBarWidget",["require","exports","module","thor/core/Class","thor/core/Validation","./CompositeWidget","./NineSliceWidget","thor/graphics/animation/Tween","./resources/NineSliceResource","./Geometry","./Vector","./InputEvent","./ScrollWidgetEvent","./Anchor","./Slot","./ListPanel","./CanvasPanel","./ScrollWidget","thor/ui/Widget"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./CompositeWidget"),o=(e("./NineSliceWidget"),e("thor/graphics/animation/Tween")),a=(e("./resources/NineSliceResource"),e("./Geometry")),_=(e("./Vector"),e("./InputEvent")),l=(e("./ScrollWidgetEvent"),e("./Anchor")),h=e("./Slot"),u=e("./ListPanel"),c=e("./CanvasPanel"),d=(e("./ScrollWidget"),e("thor/ui/Widget").VISIBILITY),g=(new a(0,0,0,0),n.create(h,{initialize:function(e,t){h.prototype.initialize.call(this),this.__scrollBar=e,this.__containingSlot=t},_setProperties:function(e,t){},setWidget:function(e){h.prototype.setWidget.call(this,e),this.__containingSlot.setWidget(e),this.__scrollBar.invalidate()}}));i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__scrollVertically=!1,this.__scrollHorizontally=!1,this.__interactable=!1,this.__buttonSpacing=0,this.__contentSize=0,this.__scrollRatio=0,this.__animationDuration=600,this.__visibleDuration=1100,this.__currentVisibleTime=this.__visibleDuration,this.__thumbAnchor=new l(0,0,1,1);var e=this;this.__listPanel=(new u).addSlot(function(e){}).addSlot(function(t){var i=(new c).addSlot(function(e){e.setAutoSize(!1),e.setAnchor(new l(0,0,1,1))}).addSlot(function(t){t.setAutoSize(!1),t.setAnchor(e.__thumbAnchor)});t.setAutoSize(!1),t.setWidget(i),e._createNamedSlot("background",new g(e,i.getSlotAtIndex(0))),e._createNamedSlot("thumb",new g(e,i.getSlotAtIndex(1)))}).addSlot(function(e){}),this.setContent(this.__listPanel),this._createNamedSlot("reverse button",new g(e,this.__listPanel.getSlotAtIndex(0))),this._createNamedSlot("forward button",new g(e,this.__listPanel.getSlotAtIndex(2)))},_setProperties:function(e,t){void 0!==e.scrollVertically&&this.setScrollVertically(e.scrollVertically),void 0!==e.scrollHorizontally&&this.setScrollHorizontally(e.scrollHorizontally),void 0!==e.interactable&&this.setInteractable(e.interactable),void 0!==e.buttonSpacing&&this.setButtonSpacing(e.buttonSpacing),void 0!==e.animationDuration&&this.setAnimationDuration(e.animationDuration),void 0!==e.visibleDuration&&this.setVisibleDuration(e.visibleDuration)},setScrollVertically:function(e){return this.__scrollVertically=e,this},setScrollHorizontally:function(e){return this.__scrollHorizontally=e,this},setInteractable:function(e){return this.__interactable=e,this},setButtonSpacing:function(e){this.__buttonSpacing=e,this.__listPanel.setSpacing(e)},setAnimationDuration:function(e){this.__animationDuration=e},setVisibleDuration:function(e){this.__visibleDuration=e},_onArrangeChildren:function(e){if(this.__contentSize||(this.__scrollHorizontally&&(this.__contentSize=3*this.getNamedSlot("background").getWidget().__cachedGeometry.__sizeX),this.__scrollVertically&&(this.__contentSize=3*this.getNamedSlot("background").getWidget().__cachedGeometry.__sizeY)),this.__contentSize)if(this.__scrollVertically){var t=this.getNamedSlot("background").getWidget().__cachedGeometry.__sizeY;t>0&&(this.__thumbAnchor.minY=this.__scrollRatio*(1-t/this.__contentSize),this.__thumbAnchor.maxY=this.__thumbAnchor.minY+t/this.__contentSize)}else{var t=this.getNamedSlot("background").getWidget().__cachedGeometry.__sizeX;t>0&&(this.__thumbAnchor.minX=this.__scrollRatio*(1-t/this.__contentSize),this.__thumbAnchor.maxX=this.__thumbAnchor.minX+t/this.__contentSize)}s.prototype._onArrangeChildren.call(this,e)},onPointerDown:function(e){return!this.__isScrolling&&this.getNamedSlot("background").getWidget().containsPoint(e.x,e.y)&&(this.__isScrolling=!0,e.capture(_.EVENT_TYPE.POINTER_UP,this),e.capture(_.EVENT_TYPE.POINTER_MOVE,this),e.capture(_.EVENT_TYPE.CANCEL,this),this.getNamedSlot("thumb").getWidget().containsPoint(e.x,e.y)?this.__clickOffset=this.__scrollVertically?e.y-this.getNamedSlot("thumb").getWidget().__cachedGeometry.__absolutePositionY:e.x-this.getNamedSlot("thumb").getWidget().__cachedGeometry.__absolutePositionX:(this.__clickOffset=this.__scrollVertically?this.getNamedSlot("thumb").getWidget().__cachedGeometry.__sizeY/2:this.getNamedSlot("thumb").getWidget().__cachedGeometry.__sizeX/2,this.onPointerMove(e))),!1},onPointerUp:function(e){var t=this.__isScrolling;return t&&e.wasCaptured&&(e.stopCapture(_.EVENT_TYPE.POINTER_UP,this),e.stopCapture(_.EVENT_TYPE.POINTER_MOVE,this),e.stopCapture(_.EVENT_TYPE.CANCEL,this)),this.__isScrolling=!1,e.__uiRoot.__scrollBar=void 0,t},onPointerMove:function(e){if(this.__isScrolling){var t,i;if(this.__scrollVertically)var t=this.getNamedSlot("background").getWidget().__cachedGeometry.__absolutePositionY+this.__clickOffset,i=this.getNamedSlot("background").getWidget().__cachedGeometry.__sizeY-(this.__clickOffset+this.getNamedSlot("thumb").getWidget().__cachedGeometry.__sizeY-this.__clickOffset);else var t=this.getNamedSlot("background").getWidget().__cachedGeometry.__absolutePositionX+this.__clickOffset,i=this.getNamedSlot("background").getWidget().__cachedGeometry.__sizeX-(this.__clickOffset+this.getNamedSlot("thumb").getWidget().__cachedGeometry.__sizeX-this.__clickOffset);if(r.isDefined(t)&&r.isDefined(i)){var n=(e.y-t)/i;return this.setScrollRatio(n),!0}}return!1},__getAlpha:function(){return this.__interactable?1:this.__fadeTween?this.__fadeTween.getValue():0},update:function(e){this.__fadeTween&&(this.__fadeTween.isAnimating()?this.__fadeTween.update(e):this.__currentVisibleTime>0?this.__currentVisibleTime-=e:1==this.__getAlpha()&&(this.__fadeTween=new o(1,0,this.__animationDuration))),this.__forwardPressed&&this.setScrollRatio(this.__scrollRatio+.01),this.__reversePressed&&this.setScrollRatio(this.__scrollRatio-.01),this.__content.setTintColor(4294967040&this.__content.getTintColor()|255*this.__getAlpha())},linkScrollWidget:function(e){if(e.onSizeChange=this.onSizeChange.bind(this),e.onScroll=this.onScroll.bind(this),this.__interactable){this.__scrollVertically?this.setScrollRatio=e.setVerticalScrollRatio.bind(e):this.setScrollRatio=e.setHorizontalScrollRatio.bind(e),e.setForceAllowDragScrolling(!1);var t=this;this.__namedSlots["forward button"].getWidget().addDownListener&&(this.__namedSlots["forward button"].getWidget().setCapture(!0),this.__namedSlots["forward button"].getWidget().addDownListener(function(){return t.setScrollRatio(t.__scrollRatio+.1),t.__timer=setTimeout(function(){t.__forwardPressed=!0},167),!1})),this.__namedSlots["forward button"].getWidget().addClickListener&&(this.__namedSlots["forward button"].getWidget().setCapture(!0),this.__namedSlots["forward button"].getWidget().addClickListener(function(){return clearTimeout(t.__timer),t.__forwardPressed=!1,!1})),this.__namedSlots["reverse button"].getWidget().addDownListener&&(this.__namedSlots["reverse button"].getWidget().setCapture(!0),this.__namedSlots["reverse button"].getWidget().addDownListener(function(){return t.setScrollRatio(t.__scrollRatio-.1),t.__timer=setTimeout(function(){t.__reversePressed=!0},167),!1})),this.__namedSlots["reverse button"].getWidget().addClickListener&&(this.__namedSlots["reverse button"].getWidget().setCapture(!0),this.__namedSlots["reverse button"].getWidget().addClickListener(function(){return clearTimeout(t.__timer),t.__reversePressed=!1,!1}))}},onSizeChange:function(e){if(this.__scrollVertically){var t=this.getNamedSlot("background").getWidget().__cachedGeometry.__sizeY,i=this.getNamedSlot("thumb").getWidget().getDesiredSize().y;this.__contentSize=Math.min(e.contentSize,t*t/i),this.setVisibility(!this.__contentSize||this.__contentSize<=this.getNamedSlot("background").getWidget().__cachedGeometry.__sizeY?d.HIDDEN:d.VISIBLE)}else{var t=this.getNamedSlot("background").getWidget().__cachedGeometry.__sizeX,i=this.getNamedSlot("thumb").getWidget().getDesiredSize().x;this.__contentSize=Math.min(e.contentSize,t*t/i),this.setVisibility(!this.__contentSize||this.__contentSize<=this.getNamedSlot("background").getWidget().__cachedGeometry.__sizeX?d.HIDDEN:d.VISIBLE)}return this.invalidate(),this},onScroll:function(e){return this.__scrollRatio=e.scrollAmount,this.__fadeTween=new o(this.__getAlpha(),1,Math.abs(1-this.__getAlpha())*this.__animationDuration),this.__currentVisibleTime=this.__visibleDuration,this.invalidate(),this},setScrollRatio:function(e){}}),i.exports.validateProperties=function(e,t){r.ifDefined.assertIsBoolean(e.scrollVertically),r.ifDefined.assertIsBoolean(e.scrollHorizontally)},i.exports.validateNamedSlotProperties=function(e,t,i){}}),define("thor/ui/TextWidget",["require","exports","module","thor/core/Class","thor/core/Validation","./Widget","./LeafWidget","./Vector","thor/math/BoundingBox","thor/graphics/resources/BitmapFont","thor/graphics/text/BitmapFontRenderer","thor/graphics/text/TextAlignment","thor/graphics/text/TextLayout"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./Widget"),o=e("./LeafWidget"),a=(e("./Vector"),e("thor/math/BoundingBox"),e("thor/graphics/resources/BitmapFont")),_=e("thor/graphics/text/BitmapFontRenderer"),l=e("thor/graphics/text/TextAlignment");e("thor/graphics/text/TextLayout");i.exports=n.create(o,{initialize:function(){o.prototype.initialize.call(this),this.__font=void 0,this.__addiionalXAdvance=0,this.__additionalLineHeight=0,this.__text="",this.__wrapWidth=0,this.__alignment=l.LEFT,this.__tintColor=4294967295,this.__allowOverdraw=!1,this.__textLayout=null,this.__cacheToken=-1},_setProperties:function(e,t){void 0!==e.alignment&&this.setAlignment(e.alignment),void 0!==e.wrapWidth?this.setWrapWidth(e.wrapWidth):e.wrap&&this.setWrapWidth(1/0),void 0!==e.tintColor&&this.setTintColor(e.tintColor),void 0!==e.text&&this.setText(e.text),void 0!==e.allowOverdraw&&this.setAllowOverdraw(e.allowOverdraw),void 0!==e.font&&this.setFont(t.get(a.RESOURCE_TYPE,e.font)),void 0!==e.additionalXAdvance&&this.setAdditionalXAdvance(e.additionalXAdvance),void 0!==e.additionalLineHeight&&this.setAdditionalLineHeight(e.additionalLineHeight)},setAlignment:function(e){return e!==this.__alignment&&(this.__alignment=e,this.__cacheToken=-1),this},setTintColor:function(e){return e!==this.__tintColor&&(this.__tintColor=e,this.__cacheToken=-1),this},getTintColor:function(){return this.__tintColor},setFont:function(e){return e!==this.__font&&(this.__font=e,this.__textLayout=null,this.__cacheToken=-1),this},setAdditionalXAdvance:function(e){return e!==this.__addiionalXAdvance&&(this.__addiionalXAdvance=e,this.__textLayout=null,this.__cacheToken=-1),this},setAdditionalLineHeight:function(e){return e!==this.__additionalLineHeight&&(this.__additionalLineHeight=e,this.__textLayout=null,this.__cacheToken=-1),this},setText:function(e){return e!==this.__text&&(this.__text=e,this.__textLayout=null,this.__cacheToken=-1),this},setWrapWidth:function(e){return e!==this.__wrapWidth&&(this.__wrapWidth=e,this.__textLayout=null,this.__cacheToken=-1),this},setAllowOverdraw:function(e){return e!==this.__allowOverdraw&&(this.__allowOverdraw=e,this.__cacheToken=-1),this},_onComputeDesiredSize:function(e){if(!this.__font)return e.x=0,void(e.y=0);if(!this.__textLayout){var t=this.__wrapWidth>0?this.__wrapWidth:1/0
;this.__textLayout=_.measureText(this.__text,this.__font,t,this.__wrapWidth>0,this.__additionalLineHeight,this.__addiionalXAdvance)}e.x=this.__textLayout.getMaxTextWidth(),e.y=this.__textLayout.getMaxTextHeight()},_draw:function(e){this.__font&&this.getVisibility()===s.VISIBILITY.VISIBLE&&(this._transform&&e.spriteBatch.pushTransform(this._transform),this.__cacheToken=_.renderText(e,this.__cacheToken,this.__text,this.__font,this.__alignment,this.__tintColor,this.__cachedGeometry.__sizeX,this.__cachedGeometry.__sizeY,this.__cachedGeometry.__absolutePositionX,this.__cachedGeometry.__absolutePositionY,this.__wrapWidth>0,this.__allowOverdraw,this.__additionalLineHeight,this.__addiionalXAdvance),this._transform&&e.spriteBatch.popTransform())}}),i.exports.validateProperties=function(e,t){r.ifDefined.assertValueInEnum(e.alignment,l),r.ifDefined.assertIsNonEmptyString(e.font),r.ifDefined.assertIsString(e.text),r.ifDefined.assertIsNumber(e.wrapWidth),r.ifDefined.assertIsNumber(e.tintColor),r.ifDefined.assertIsBoolean(e.allowOverdraw),e.font&&t.get(a.RESOURCE_TYPE,e.font)}}),define("thor/ui/ProgressBarWidget",["require","exports","module","thor/core/Class","thor/core/Validation","./Anchor","./Widget","./CanvasPanel","./CompositeWidget","./Slot","thor/graphics/animation/Tween"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./Anchor"),o=e("./Widget"),a=e("./CanvasPanel"),_=e("./CompositeWidget"),l=e("./Slot"),h=e("thor/graphics/animation/Tween"),u={HORIZONTAL:"horizontal",VERTICAL:"vertical"},c=n.create(l,{initialize:function(e,t){l.prototype.initialize.call(this),this.__progressBar=e,this.__containingSlot=t},_setProperties:function(e,t){},setWidget:function(e){l.prototype.setWidget.call(this,e),this.__containingSlot.setWidget(e),this.__progressBar.invalidate()}});i.exports=n.create(_,{initialize:function(){_.prototype.initialize.call(this),this.__backgroundWidget=o.NULL_WIDGET,this.__fillWidget=o.NULL_WIDGET,this.__fillAnchor=new s(0,0,1,1),this.__axis=u.HORIZONTAL,this.__reverseFill=!1,this.__fillSlotProperty="maxX",this.__animationDuration=667;var e=this,t=(new a).addSlot(function(e){e.setAutoSize(!1),e.setAnchor(new s(0,0,1,1))}).addSlot(function(t){t.setAutoSize(!1),t.setAnchor(e.__fillAnchor)});this.setContent(t),this._createNamedSlot("background",new c(this,t.getSlotAtIndex(0))),this._createNamedSlot("fill",new c(this,t.getSlotAtIndex(1)))},_setProperties:function(e,t){void 0!==e.progress&&this.setProgress(e.progress),void 0!==e.__animationDuration&&this.setAnimationDuration(e.__animationDuration),void 0!==e.axis&&this.setAxis(e.axis),void 0!==e.reverseFill&&this.setReverseFill(e.reverseFill)},setAnimationDuration:function(e){this.__animationDuration=e},setAxis:function(e){this.__axis!==e&&(this.__axis=e,this.__updateFillSlotProperty())},setReverseFill:function(e){this.__reverseFill!==e&&(this.__reverseFill=e,this.__updateFillSlotProperty())},__updateFillSlotProperty:function(){var e=this.__reverseFill?"min":"max",t=this.__axis===u.HORIZONTAL?"X":"Y";this.__fillSlotProperty=e+t,this.__fillAnchor.minX=0,this.__fillAnchor.maxX=1,this.__fillAnchor.minY=0,this.__fillAnchor.maxY=1,this.__setProgress(this.__progress),this.invalidate()},setProgress:function(e){e!==this.__progress&&(this.__setProgress(e),this.invalidate())},setProgressAnimated:function(e){e!==this.__progress&&(this.__progressTween=new h(this.__progress,e,Math.abs(e-this.__progress)*this.__animationDuration),this.__setProgress(e))},update:function(e){this.__progressTween&&this.__progressTween.isAnimating()&&(this.__progressTween.update(e),this.__setProgress(this.__progressTween.valueOf()),this.invalidate())},__setProgress:function(e){this.__progress=Math.min(1,Math.max(0,e));var t=this.__progress;this.__reverseFill&&(t=1-t),this.__fillAnchor[this.__fillSlotProperty]=t}}),i.exports.validateProperties=function(e,t){r.ifDefined.assertIsNumber(e.progress),r.ifDefined.assertIsBoolean(e.reverseFill),r.ifDefined.assertValueInEnum(e.axis,u)},i.exports.validateNamedSlotProperties=function(e,t,i){}}),define("thor/ui/PopupContainerWidget",["require","exports","module","thor/core/Class","thor/core/Validation","./Slot","./Anchor","./Margin","./Widget","./CanvasPanel","./CompositeWidget"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Slot")),s=e("./Anchor"),o=(e("./Margin"),e("./Widget")),a=e("./CanvasPanel"),_=e("./CompositeWidget"),l=n.create(r,{initialize:function(e,t){r.prototype.initialize.call(this),this.__popupContainerWidget=e,this.__containingSlot=t},_setProperties:function(e,t){},setWidget:function(e){r.prototype.setWidget.call(this,e),this.__containingSlot.setWidget(e),this.__popupContainerWidget.invalidate()},getContainingSlot:function(){return this.__containingSlot}});i.exports=n.create(_,{initialize:function(){_.prototype.initialize.call(this),this.__isEnabled=!1;var e=(new a).addSlot(function(e){e.setAutoSize(!0),e.setAnchor(new s(0,0,1,1))}).addSlot(function(e){e.setAutoSize(!1),e.setAnchor(new s(0,0,1,1))});this.setContent(e),this._createNamedSlot("modal",new l(this,e.getSlotAtIndex(0))),this._createNamedSlot("popup",new l(this,e.getSlotAtIndex(1)))},_setProperties:function(e,t){},setEnabled:function(e){return e!==this.__isEnabled&&(this.__isEnabled=e,this.invalidate()),this},isEnabled:function(){return this.__isEnabled},showModal:function(e,t,i){this.getNamedSlot("popup").setWidget(e),this.__isEnabled?this.invalidate():this.setEnabled(!0)},invalidate:function(){var e=this.__isEnabled?o.VISIBILITY.VISIBLE:o.VISIBILITY.HIDDEN;this.getNamedSlot("modal").getWidget().setVisibility(e),this.getNamedSlot("popup").getWidget().setVisibility(e),_.prototype.invalidate.call(this)}}),i.exports.NAMED_SLOT_MODAL="modal",i.exports.NAMED_SLOT_POPUP="popup",i.exports.validateProperties=function(e,t){},i.exports.validateNamedSlotProperties=function(e,t,i){}}),define("thor/ui/RadialProgressWidget",["require","exports","module","thor/core/Class","thor/graphics/resources/Image","thor/ui/Vector","thor/webgl/Texture","thor/math/ColorUtil","./Widget","thor/ui/LeafWidget","thor/core/Validation","thor/webgl/shaders/SpriteBatch","thor/graphics/resources/TextureRegionResource"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/graphics/resources/Image"),e("thor/ui/Vector"),e("thor/webgl/Texture")),s=e("thor/math/ColorUtil"),o=e("./Widget"),a=e("thor/ui/LeafWidget"),_=e("thor/core/Validation"),l=e("thor/webgl/shaders/SpriteBatch"),h=e("thor/graphics/resources/TextureRegionResource"),u=new Float32Array([1,0,0,1,0,0]),c=new Float32Array([0,0,0,0,.5,0,.5,0,1,0,1,0,0,.5,0,.5,.5,.5,.5,.5,1,.5,1,.5,0,1,0,1,.5,1,.5,1,1,1,1,1,0,0,0,0,0,0,0,0]),d=[new Uint16Array([10,1,9,4]),new Uint16Array([1,0,4,9]),new Uint16Array([1,0,4,3,9,10]),new Uint16Array([1,0,4,3,6,6,6,6,9,4]),new Uint16Array([1,0,4,3,6,6,6,6,4,7,9,10]),new Uint16Array([1,0,4,3,6,6,6,6,7,4,8,9,10]),new Uint16Array([1,0,4,3,6,6,6,6,7,4,8,5,5,10,10,9,5,4]),new Uint16Array([1,0,4,3,6,6,6,6,7,4,8,5,5,5,5,4,2,9])];new Uint16Array([1,0,4,3,6,6,6,6,7,4,8,5,5,5,5,4,2,9]);i.exports=n.create(a,{initialize:function(){a.prototype.initialize.call(this),this.__region=null,this.__vertBuffer=new ArrayBuffer(11*l.VERTEX_LENGTH),this.__vertexDataFloat32=new Float32Array(this.__vertBuffer),this.__vertexDataUint8=new Uint8Array(this.__vertBuffer),this._hasRenderState=!1,this.__progress=1,this.__tintColor=4294967295},_setProperties:function(e,t){void 0!==e.region&&this.setTextureRegion(t.get(h.RESOURCE_TYPE,e.region)),void 0!==e.progress&&this.setProgress(e.progress),void 0!==e.tintColor&&this.setTintColor(e.tintColor)},setTextureRegion:function(e){return this.__region=e,this._hasRenderState=!1,this},setTintColor:function(e){this.__tintColor=e;for(var t=this.__vertexDataUint8,i=0;i<11;++i){var n=i*l.VERTEX_UINT8_LENGTH;s.writeToUint8Array(e,t,n+l.VERTEX_OFFSETS.r)}return this},_onComputeDesiredSize:function(e){this.__region?(e.x=this.__region.getWidth(),e.y=this.__region.getHeight()):(e.x=0,e.y=0)},_setGeometry:function(e){if(this.__region){a.prototype._setGeometry.call(this,e);var t=this.__vertexDataFloat32,i=this.__vertexDataUint8;u[4]=this.__cachedGeometry.__absolutePositionX,u[5]=this.__cachedGeometry.__absolutePositionY;for(var n=this.__tintColor,r=this.__region.uvs,o=r[0],_=r[1],h=r[4],d=r[5],g=h-o,p=d-_,m=0;m<11;++m){var f=m*l.VERTEX_FLOAT32_LENGTH,v=m*l.VERTEX_UINT8_LENGTH;t[f+l.VERTEX_OFFSETS.x]=c[4*m+0],t[f+l.VERTEX_OFFSETS.y]=c[4*m+1],t[f+l.VERTEX_OFFSETS.u]=o+g*c[4*m+2],t[f+l.VERTEX_OFFSETS.v]=_+p*c[4*m+3],t.set(u,f+l.VERTEX_OFFSETS.t0),t[f+l.VERTEX_OFFSETS.width_scale]=e.__sizeX,t[f+l.VERTEX_OFFSETS.height_scale]=e.__sizeY,s.writeToUint8Array(n,i,v+l.VERTEX_OFFSETS.r)}this.setProgress(this.__progress)}},setProgress:function(e){this.__progress=e;var t,i;if(e>=1?(t=.5*Math.PI,i=7):(t=2*Math.PI*this.__progress,t%=Math.PI/2,i=~~(8*this.__progress)),this.__region){var n,r,s,o,a=this.__region.uvs,_=a[0],h=a[1],u=a[4],c=a[5],d=u-_,g=c-h,p=this.__vertexDataFloat32,m=9*l.VERTEX_FLOAT32_LENGTH,f=10*l.VERTEX_FLOAT32_LENGTH,v=.5*Math.sin(t),y=.5*Math.cos(t);switch(i){case 0:case 1:n=.5-v,r=.5-y,s=n,o=0;break;case 2:case 3:n=.5-y,r=.5+v,s=0,o=r;break;case 4:case 5:n=.5+v,r=.5+y,s=n,o=1;break;case 6:case 7:n=.5+y,r=.5-v,s=1,o=r}p[m+l.VERTEX_OFFSETS.x]=n,p[m+l.VERTEX_OFFSETS.y]=r,p[m+l.VERTEX_OFFSETS.u]=_+d*n,p[m+l.VERTEX_OFFSETS.v]=h+g*r,p[f+l.VERTEX_OFFSETS.x]=s,p[f+l.VERTEX_OFFSETS.y]=o,p[f+l.VERTEX_OFFSETS.u]=_+d*s,p[f+l.VERTEX_OFFSETS.v]=h+g*o}},__createTexture:function(e){_.isInstanceOf(this.__region,h)&&(this.__texture=r.getTextureFromDomImage(e,this.__region.image.getDOMElement()),this._hasRenderState=!0)},_draw:function(e){if(this.getVisibility()===o.VISIBILITY.VISIBLE&&(this._hasRenderState||(this.__createTexture(e),this._hasRenderState))&&!(this.__progress<=0)){this._transform&&e.spriteBatch.pushTransform(this._transform);var t=this.__progress>=1?7:~~(8*this.__progress);e.spriteBatch.addVerts(this.__texture,this.__vertexDataFloat32,d[t]),this._transform&&e.spriteBatch.popTransform()}}}),i.exports.validateProperties=function(e,t){_.ifDefined.assertIsNonEmptyString(e.region),_.ifDefined.assertIsNumber(e.progress),_.ifDefined.assertIsNumber(e.tintColor),e.region&&t.get(h.RESOURCE_TYPE,e.region)}}),define("thor/ui/WorldWidget",["require","exports","module","thor/core/Class","thor/core/Validation","./Widget","./LeafWidget","./Vector","thor/entity/World","./UiRoot","./InputEvent","thor/math/MatrixUtil"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Widget")),s=e("./LeafWidget");e("./Vector"),e("thor/entity/World"),e("./UiRoot"),e("./InputEvent"),e("thor/math/MatrixUtil");i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__worldWidth=0,this.__worldHeight=0,this.onPointerDown=this.__handleEvent,this.onPointerUp=this.__handleEvent,this.onPointerMove=this.__handleEvent,this.onWheel=this.__handleEvent,this.onPointerCancel=this.__handleEvent,this.onPointerOut=this.__handleEvent},_setProperties:function(e,t){},setSize:function(e,t){return this.__worldWidth=e,this.__worldHeight=t,this},setWorld:function(e){return this.__world=e,this},clearWorld:function(){return this.__world=null,this},__handleEvent:function(e){return!!this.__world&&this.__world.handleInputEvent(e)},_onComputeDesiredSize:function(e){e.x=this.__worldWidth,e.y=this.__worldHeight},_setGeometry:function(e){if(s.prototype._setGeometry.call(this,e),this.__world){var t=this.__world.getScene();t&&t.getRootComponent().setTranslation(this.__cachedGeometry.__absolutePositionX,this.__cachedGeometry.__absolutePositionY)}},_draw:function(e){this.getVisibility()===r.VISIBILITY.VISIBLE&&this.__world&&this.__world.draw(e)},_debugDraw:function(e){s.prototype._debugDraw.call(this,e),this.getVisibility()===r.VISIBILITY.VISIBLE&&this.__world&&this.__world.debugDraw(e)}}),i.exports.validateProperties=function(e,t){}}),define("thor/ui/SimpleButtonWidget",["require","exports","module","thor/core/Class","thor/core/Validation","./Widget","./CompositeWidget","./InputEvent","./Slot","../audio/SoundSprite"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=(e("./Widget"),e("./CompositeWidget")),o=e("./InputEvent"),a=e("./Slot"),_=(e("../audio/SoundSprite"),function(){}),l=n.create(a,{initialize:function(){a.prototype.initialize.call(this)},_setProperties:function(e,t){}});i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__isDisabled=!1,this.__isPressed=!1,this.__isHovered=!1,this.__actionOnDown=!1,this.__captureEvents=!1,this.__clickHandler=_,this.__soundSprite=null,this.__clickSound="click",this.__hoverInHandler=_,this.__hoverOutHandler=_,this.__clickListeners=[],this.__downListeners=[],this._createNamedSlot("normal",new l),this._createNamedSlot("hovered",new l),this._createNamedSlot("pressed",new l),this._createNamedSlot("disabled",new l)},_setProperties:function(e,t){void 0!==e.enabled&&this.setEnabled(e.enabled),void 0!==e.clickSound&&this.setClickSound(e.clickSound)},isPressed:function(){return this.__isPressed},setActionOnDown:function(e){this.__actionOnDown=e},setEnabled:function(e){return e!==!this.__isDisabled&&(this.__isDisabled=!e,this.invalidate()),this},isEnabled:function(){return!this.__isDisabled},setCapture:function(e){this.__captureEvents=e},setClickHandler:function(e){return this.__clickHandler=e,this},clearClickHandler:function(){this.__clickHandler=_},setSoundSprite:function(e){return this.__soundSprite=e,this},setHoverInHandler:function(e){return this.__hoverInHandler=e,this},setClickSound:function(e){return this.__clickSound=e,this},setHoverOutHandler:function(e){return this.__hoverOutHandler=e,this},addClickListener:function(e){return this.__clickListeners.push(e),this},removeClickListener:function(e){var t=this.__clickListeners.indexOf(e);return t!==-1&&this.__clickListeners.splice(t,1),this},addDownListener:function(e){return this.__downListeners.push(e),this},removeDownListener:function(e){var t=this.__downListeners.indexOf(e);return t!==-1&&this.__downListeners.splice(t,1),this},__updateButtonState:function(){this.__isDisabled?this.setContent(this.getNamedSlot("disabled").getWidget()):this.__isPressed?this.setContent(this.getNamedSlot("pressed").getWidget()):this.__isHovered?this.setContent(this.getNamedSlot("hovered").getWidget()):this.setContent(this.getNamedSlot("normal").getWidget())},_onArrangeChildren:function(e){this.__updateButtonState(),s.prototype._onArrangeChildren.call(this,e)},_onComputeDesiredSize:function(e){this.__updateButtonState(),s.prototype._onComputeDesiredSize.call(this,e)},invalidate:function(){this.__updateButtonState(),s.prototype.invalidate.call(this)},onPointerDown:function(e){if(this.__isPressed===!1){this.__isPressed=!0,this.__isHovered=!1,this.invalidate(),this.__actionOnDown&&this.__buttonAction(e),this.__captureEvents&&(e.capture(o.EVENT_TYPE.POINTER_UP,this),e.capture(o.EVENT_TYPE.POINTER_MOVE,this),e.capture(o.EVENT_TYPE.CANCEL,this));for(var t=0;t<this.__downListeners.length;++t){this.__downListeners[t]()&&(this.__downListeners.splice(t,1),t--)}}return!0},onPointerUp:function(e){if(this.__isPressed===!0&&(this.__isPressed=!1,this.invalidate(),this.__actionOnDown||this.__buttonAction(e),!this.__isDisabled))for(var t=0;t<this.__clickListeners.length;++t){var i=this.__clickListeners[t]();i&&(this.__clickListeners.splice(t,1),t--)}return this.__captureEvents&&e.wasCaptured&&(e.stopCapture(o.EVENT_TYPE.POINTER_UP,this),e.stopCapture(o.EVENT_TYPE.POINTER_MOVE,this),e.stopCapture(o.EVENT_TYPE.CANCEL,this)),!0},onPointerOver:function(){this.__isHovered===!1&&(this.__hoverInHandler(this),this.__isHovered=!0,this.invalidate())},onPointerOut:function(){var e=!1;this.__isHovered===!0&&(this.__hoverOutHandler(this),this.__isHovered=!1,e=!0),this.__isPressed&&!this.__captureEvents&&(this.__isPressed=!1,e=!0),e&&this.invalidate()},onPointerCancel:function(){this.onPointerOut()},__buttonAction:function(e){this.__isDisabled||(this.__soundSprite&&this.__clickSound&&this.__soundSprite.play(this.__clickSound),this.__clickHandler(this,e))}}),i.exports.NAMED_SLOT_NORMAL="normal",i.exports.NAMED_SLOT_HOVERED="hovered",i.exports.NAMED_SLOT_PRESSED="pressed",i.exports.NAMED_SLOT_DISABLED="disabled",i.exports.validateProperties=function(e,t){r.ifDefined.assertIsBoolean(e.enabled),r.ifDefined.assertIsNonEmptyString(e.clickSound)},i.exports.validateNamedSlotProperties=function(e,t,i){}}),define("thor/ui/ToggleButtonWidget",["require","exports","module","thor/core/Class","thor/core/Validation","./Widget","./CompositeWidget","./InputEvent","./Slot","../audio/SoundSprite"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=(e("./Widget"),e("./CompositeWidget")),o=e("./InputEvent"),a=e("./Slot"),_=(e("../audio/SoundSprite"),function(){}),l=n.create(a,{initialize:function(){a.prototype.initialize.call(this)},_setProperties:function(e,t){}});i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__isDisabled=!1,this.__isPressed=!1,this.__isHovered=!1,this.__isOn=!1,this.__captureEvents=!1,this.__autoToggle=!0,this.__clickHandler=_,this.__soundSprite=null,this.__clickSound="click",this.__downListeners=[],this.__clickListeners=[],this._createNamedSlot("normal_off",new l),this._createNamedSlot("normal_on",new l),this._createNamedSlot("hovered_off",new l),this._createNamedSlot("hovered_on",new l),this._createNamedSlot("pressed_off",new l),this._createNamedSlot("pressed_on",new l),this._createNamedSlot("disabled",new l)},_setProperties:function(e,t){void 0!==e.enabled&&this.setEnabled(e.enabled),void 0!==e.on&&this.setOn(e.on),void 0!==e.clickSound&&this.setClickSound(e.clickSound),void 0!==e.autoToggle&&this.setAutoToggle(e.autoToggle)},setAutoToggle:function(e){this.__autoToggle=e},isAutoToggle:function(){return this.__autoToggle},setEnabled:function(e){return e!==!this.__isDisabled&&(this.__isDisabled=!e,this.invalidate()),this},isEnabled:function(){return!this.__isDisabled},setOn:function(e){return e!==this.__isOn&&(this.__isOn=e,this.invalidate()),this},isOn:function(){return this.__isOn},setCapture:function(e){this.__captureEvents=e},setClickHandler:function(e){return this.__clickHandler=e,this},clearClickHandler:function(){this.__clickHandler=_},setSoundSprite:function(e){return this.__soundSprite=e,this},setClickSound:function(e){return this.__clickSound=e,this},addClickListener:function(e){return this.__clickListeners.push(e),this},removeClickListener:function(e){var t=this.__clickListeners.indexOf(e);return t!==-1&&this.__clickListeners.splice(t,1),this},addDownListener:function(e){return this.__downListeners.push(e),this},removeDownListener:function(e){var t=this.__downListeners.indexOf(e);return t!==-1&&this.__downListeners.splice(t,1),this},__updateButtonState:function(){this.__isDisabled?this.setContent(this.getNamedSlot("disabled").getWidget()):this.__isPressed?this.setContent(this.getNamedSlot(this.__isOn?"pressed_on":"pressed_off").getWidget()):this.__isHovered?this.setContent(this.getNamedSlot(this.__isOn?"hovered_on":"hovered_off").getWidget()):this.setContent(this.getNamedSlot(this.__isOn?"normal_on":"normal_off").getWidget())},_onArrangeChildren:function(e){this.__updateButtonState(),s.prototype._onArrangeChildren.call(this,e)},_onComputeDesiredSize:function(e){this.__updateButtonState(),s.prototype._onComputeDesiredSize.call(this,e)},invalidate:function(){this.__updateButtonState(),s.prototype.invalidate.call(this)},onPointerDown:function(e){if(this.__isPressed===!1){this.__isPressed=!0,this.__isHovered=!1,this.invalidate(),this.__captureEvents&&(e.capture(o.EVENT_TYPE.POINTER_UP,this),e.capture(o.EVENT_TYPE.POINTER_MOVE,this),e.capture(o.EVENT_TYPE.CANCEL,this));for(var t=0;t<this.__downListeners.length;++t){this.__downListeners[t]()&&(this.__downListeners.splice(t,1),t--)}}return!0},onPointerUp:function(e){if(this.__isPressed===!0&&(this.__isPressed=!1,!this.__isDisabled&&this.__autoToggle&&(this.__isOn=!this.__isOn),this.invalidate(),!this.__isDisabled)){this.__soundSprite&&this.__clickSound&&this.__soundSprite.play(this.__clickSound),this.__clickHandler(this);for(var t=0;t<this.__clickListeners.length;++t){this.__clickListeners[t]()&&(this.__clickListeners.splice(t,1),t--)}}return this.__captureEvents&&e.wasCaptured&&(e.stopCapture(o.EVENT_TYPE.POINTER_UP,this),e.stopCapture(o.EVENT_TYPE.POINTER_MOVE,this),e.stopCapture(o.EVENT_TYPE.CANCEL,this)),!0},onPointerOver:function(){this.__isHovered===!1&&(this.__isHovered=!0,this.invalidate())},onPointerOut:function(){var e=!1;this.__isHovered===!0&&(this.__isHovered=!1,e=!0),this.__isPressed&&!this.__captureEvents&&(this.__isPressed=!1,e=!0),e&&this.invalidate()},onPointerCancel:function(){this.onPointerOut()},resetState:function(){this.__isPressed=!1,this.__isOn=!1,this.invalidate()}}),i.exports.validateProperties=function(e,t){r.ifDefined.assertIsBoolean(e.enabled),r.ifDefined.assertIsBoolean(e.on),r.ifDefined.assertIsNonEmptyString(e.clickSound),r.ifDefined.assertIsBoolean(e.autoToggle)},i.exports.validateNamedSlotProperties=function(e,t,i){}}),define("thor/ui/HoldableButtonWidget",["require","exports","module","thor/core/Class","thor/core/Validation","./Widget","./SimpleButtonWidget","./InputEvent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=(e("./Widget"),e("./SimpleButtonWidget")),o=(e("./InputEvent"),function(){});i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__clickStartHandler=o,this.__clickMovedOffHandler=o},setClickStartHandler:function(e){return this.__clickStartHandler=e,this},setClickMovedOffHandler:function(e){return this.__clickMovedOffHandler=e,this},onPointerDown:function(e){return this.__isPressed!==!1||this.__isDisabled||this.__clickStartHandler(),s.prototype.onPointerDown.call(this,e)},onPointerOut:function(){this.__isPressed&&!this.__isDisabled&&this.__clickMovedOffHandler(),s.prototype.onPointerOut.call(this)}}),i.exports.validateProperties=function(e,t){r.ifDefined.assertIsBoolean(e.enabled)},i.exports.validateNamedSlotProperties=function(e,t,i){}}),define("thor/graphics/resources/AnimatedSpriteResource",["require","exports","module","thor/core/Class","thor/core/Validation","./TextureRegionResource"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation");e("./TextureRegionResource");i.exports=n.create({initialize:function(e,t,i){if(r.ifDefined.assertIsObject(i),this.__frames=e,this.__framesPerSecond=t,this.__arrFrameEndTimesMS=null,this.__duration=null,i){this.__duration=0;var n=0,s=1e3/t;for(this.__arrFrameEndTimesMS=[];n<this.__frames.length;)this.__duration+=i[n]?i[n]:s,this.__arrFrameEndTimesMS[n]=this.__duration,n++}else this.__duration=1e3*this.__frames.length/this.__framesPerSecond},getFrames:function(){return this.__frames},getFrameAtIndex:function(e){if(e<0||e>=this.__frames.length)throw new Error("Frame index out of bounds");return this.__frames[e]},getFrameAtTime:function(e){return this.getFrameAtIndex(this.getFrameIndexAtTime(e))},getFrameIndexAtTime:function(e){if(this.__arrFrameEndTimesMS){e%=this.__duration;for(var t=0;t<this.__arrFrameEndTimesMS.length;t++)if(e<this.__arrFrameEndTimesMS[t])return t;return this.__frames.length-1}return~~(e%this.__duration*this.__framesPerSecond/1e3)},getFramesPerSecond:function(){return this.__framesPerSecond},getDurationSeconds:function(){return this.__duration/1e3},getDurationMS:function(){return this.__duration}}),i.exports.RESOURCE_TYPE="animatedsprite"}),define("thor/ui/AnimatedSpriteWidget",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Scheduler","thor/graphics/resources/AnimatedSpriteResource","thor/graphics/resources/TextureRegionResource","thor/webgl/Texture","./Widget","./LeafWidget","./Vector","thor/math/MatrixUtil"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/core/Scheduler"),o=e("thor/graphics/resources/AnimatedSpriteResource"),a=(e("thor/graphics/resources/TextureRegionResource"),e("thor/webgl/Texture")),_=e("./Widget"),l=e("./LeafWidget"),h=(e("./Vector"),e("thor/math/MatrixUtil")),u=new Float32Array(h.IDENTITY_3x2);i.exports=n.create(l,{initialize:function(){l.prototype.initialize.call(this),this.__animatedSprite=null,this.__extents=new Float32Array(2),this.__tintColor=4294967295,this.__frameIndex=0,this.__elapsedTime=0,this.__textureOptions={},this.__textures=void 0,this._hasRenderState=!1,this.__onCompleteCallback=void 0,this.__animationTaskId=void 0},_setProperties:function(e,t){void 0!==e.animatedSprite&&this.setAnimatedSprite(t.get(o.RESOURCE_TYPE,e.animatedSprite)),void 0!==e.tintColor&&this.setTintColor(e.tintColor)},setAnimatedSprite:function(e){return this.__animatedSprite=e,this._hasRenderState=!1,this.__frameIndex=0,this.__elapsedTime=0,this},setTintColor:function(e){return this.__tintColor=e,this},getTintColor:function(){return this.__tintColor},setOnCompleteCallback:function(e){this.__onCompleteCallback=e},playOnce:function(){void 0===this.__animationTaskId&&(this.__animationTaskId=s.addAnimationTask(this.__animationTask.bind(this))),this.__frameIndex=0,this.__elapsedTime=0},stop:function(){if(void 0!==this.__animationTaskId&&(s.removeAnimationTask(this.__animationTaskId),this.__animationTaskId=void 0,this.__onCompleteCallback)){var e=this.__onCompleteCallback;this.__onCompleteCallback=void 0,e()}},__animationTask:function(e,t){this.__elapsedTime+=t;for(var i=1e3/this.__animatedSprite.getFramesPerSecond();this.__elapsedTime>=i;)if(this.__frameIndex++,this.__elapsedTime-=i,this.__frameIndex>=this.__animatedSprite.getFrames().length&&(this.__frameIndex=0,this.__elapsedTime=0,s.removeAnimationTask(this.__animationTaskId),this.__animationTaskId=void 0,this.__onCompleteCallback)){var n=this.__onCompleteCallback;this.__onCompleteCallback=void 0,n()}},__createTextures:function(e){if(r.isInstanceOf(this.__animatedSprite,o)){this.__textures=[];var t=this.__animatedSprite.getFrames(),i=t[0],n=i.textureFilter;if(n){var s=e.gl[n];this.__textureOptions.minFilter=s,this.__textureOptions.magFilter=s}for(var _=0;_<t.length;++_)this.__textures[_]=a.getTextureFromDomImage(e,t[_].image.getDOMElement(),this.__textureOptions);this._hasRenderState=!0}},_onComputeDesiredSize:function(e){if(this.__animatedSprite){var t=this.__animatedSprite.getFrameAtIndex(0),i=t.getWidth(),n=t.getHeight();e.x=i,e.y=n}else e.x=0,e.y=0},_setGeometry:function(e){l.prototype._setGeometry.call(this,e),this.__extents[0]=e.__sizeX,this.__extents[1]=e.__sizeY},_draw:function(e){if(this.getVisibility()===_.VISIBILITY.VISIBLE&&(this._hasRenderState||(this.__createTextures(e),this._hasRenderState))){var t=this.__animatedSprite.getFrameAtIndex(this.__frameIndex);u[4]=this.__cachedGeometry.__absolutePositionX,u[5]=this.__cachedGeometry.__absolutePositionY,this._transform&&e.spriteBatch.pushTransform(this._transform),e.spriteBatch.add(this.__textures[this.__frameIndex],t.uvs,u,this.__extents,this.__tintColor),this._transform&&e.spriteBatch.popTransform()}}}),i.exports.validateProperties=function(e,t){r.ifDefined.assertIsNonEmptyString(e.region),r.ifDefined.assertIsNumber(e.tintColor),e.region&&t.get(o.RESOURCE_TYPE,e.region)}}),define("thor/ui/ComponentPositionWidget",["require","exports","module","thor/core/Class","thor/core/Validation","./Vector","./LeafWidget","thor/entity/SceneComponent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Vector"),e("./LeafWidget"));e("thor/entity/SceneComponent");i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.__component=void 0},_setProperties:function(e,t){},setComponent:function(e){this.__component=e,this.__updateComponent()},clearComponent:function(){this.__component=void 0},_setGeometry:function(e){r.prototype._setGeometry.call(this,e),this.__updateComponent()},__updateComponent:function(){if(this.__component){var e=this.__cachedGeometry.__absolutePositionX,t=this.__cachedGeometry.__absolutePositionY;this.__component.setTranslation(e,t)}},getGeometry:function(){return this.__cachedGeometry},_onComputeDesiredSize:function(e){if(this.__component){var t=this.__component.getBounds();e.x=t.width,e.y=t.height}else e.x=0,e.y=0}}),i.exports.validateProperties=function(e,t){}}),define("thor/ui/ShineWidget",["require","exports","module","thor/core/Class","./Vector","./Widget","thor/webgl/Texture","thor/math/ColorUtil","thor/ui/LeafWidget","thor/core/Validation","thor/webgl/shaders/SpriteBatch","thor/graphics/resources/TextureRegionResource"],function(e,t,i){var n=e("thor/core/Class"),r=(e("./Vector"),e("./Widget")),s=e("thor/webgl/Texture"),o=e("thor/math/ColorUtil"),a=e("thor/ui/LeafWidget"),_=e("thor/core/Validation"),l=e("thor/webgl/shaders/SpriteBatch"),h=e("thor/graphics/resources/TextureRegionResource"),u=new Float32Array([1,0,0,1,0,0]),c=new Float32Array([0,1,0,1,1,1,0,0,1,0,1,0]),d=new Uint16Array([0,1,2,3,4,5]);i.exports=n.create(a,{initialize:function(){a.prototype.initialize.call(this),this.__region=null,this.__vertBuffer=new ArrayBuffer(6*l.VERTEX_LENGTH),this.__vertexDataFloat32=new Float32Array(this.__vertBuffer),this.__vertexDataUint8=new Uint8Array(this.__vertBuffer),this._hasRenderState=!1,this.__progress=0,this.__angle=Math.PI/4,this.__baseWidth=.2,this.__triWidth=0,this.__travelWidth=0,this.__tintColor=4294967295,this.__flipped=!1},setTintColor:function(e){this.__tintColor=e;for(var t=0,i=this.__vertexDataUint8,n=0;n<4;++n)for(var r=0;r<4;++r){var s=t*l.VERTEX_UINT8_LENGTH;o.writeToUint8Array(this.__tintColor,i,s+l.VERTEX_OFFSETS.r),t++}return this},getTintColor:function(){return this.__tintColor},setFlipped:function(e){this.__flipped=e,this.setProgress(this.__progress)},isFlipped:function(){return this.__flipped},_setProperties:function(e,t){void 0!==e.region&&this.setTextureRegion(t.get(h.RESOURCE_TYPE,e.region)),void 0!==e.tintColor&&this.setTintColor(e.tintColor),e.baseWidth&&(this.__baseWidth=Math.max(0,Math.min(1,e.baseWidth))),e.angle&&(this.__angle=Math.max(0,Math.min(Math.PI/2,e.angle))),void 0!==e.progress&&this.setProgress(e.progress),e.flip===!0&&this.setFlipped(!0)},_onComputeDesiredSize:function(e){e.x=0,e.y=0},_setGeometry:function(e){if(this.__region){a.prototype._setGeometry.call(this,e),this.__triWidth=1/Math.tan(this.__angle),this.__travelWidth=this.__triWidth+this.__baseWidth+1;var t=this.__vertexDataFloat32,i=this.__vertexDataUint8;u[4]=this.__cachedGeometry.__absolutePositionX,u[5]=this.__cachedGeometry.__absolutePositionY;for(var n=this.__region.uvs,r=n[0],s=n[1],_=n[4],h=n[5],d=_-r,g=h-s,p=0;p<6;++p){var m=p*l.VERTEX_FLOAT32_LENGTH,f=p*l.VERTEX_UINT8_LENGTH;t.set(u,m+l.VERTEX_OFFSETS.t0),t[m+l.VERTEX_OFFSETS.width_scale]=e.__sizeX,t[m+l.VERTEX_OFFSETS.height_scale]=e.__sizeY,t[m+l.VERTEX_OFFSETS.u]=r+d*c[2*p],t[m+l.VERTEX_OFFSETS.v]=s+g*c[2*p+1],o.writeToUint8Array(this.__tintColor,i,f+l.VERTEX_OFFSETS.r)}this.setProgress(this.__progress)}},setProgress:function(e){if(this.__progress=Math.max(0,Math.min(1,e)),this.__region){var t=this.__travelWidth*e,i=this.__region.uvs,n=i[0],r=i[1],s=i[4],o=i[5],a=s-n,_=o-r,h=this.__vertexDataFloat32,u=l.VERTEX_FLOAT32_LENGTH,c=l.VERTEX_OFFSETS,d=Math.max(0,t-this.__triWidth-this.__baseWidth);h[0*u+c.x]=this.__flipped?1-d:d,h[0*u+c.y]=1,h[0*u+c.u]=n+a*Math.max(0,Math.min(1,1-(t-this.__triWidth)/this.__baseWidth));var g=Math.max(0,Math.min(1,t-this.__triWidth-this.__baseWidth));h[1*u+c.x]=this.__flipped?1-g:g,h[1*u+c.y]=Math.max(0,Math.min(1,(t-this.__baseWidth)/this.__triWidth));var p=t-this.__baseWidth;h[1*u+c.u]=n+a*Math.max(0,Math.min(1,-p/this.__baseWidth)),h[1*u+c.v]=r+_*h[1*u+c.y];var m=Math.max(0,Math.min(1,t-this.__triWidth));h[2*u+c.x]=this.__flipped?1-m:m;var p=t-this.__triWidth;p<0?h[2*u+c.y]=t/this.__triWidth:p>1?(h[2*u+c.y]=1,h[2*u+c.u]=n+1*a-(p-1)/this.__baseWidth):h[2*u+c.y]=1,h[2*u+c.v]=r+_*h[2*u+c.y];var f=Math.max(0,Math.min(1,t-this.__baseWidth));h[3*u+c.x]=this.__flipped?1-f:f;var p=t-this.__baseWidth;p>1?h[3*u+c.y]=(p-1)/this.__triWidth:p<0?(h[3*u+c.y]=0,
h[3*u+c.u]=n+a*(-p/this.__baseWidth)):h[3*u+c.y]=0,h[3*u+c.v]=r+_*h[3*u+c.y];var v=Math.max(0,Math.min(1,t));h[4*u+c.x]=this.__flipped?1-v:v,h[4*u+c.y]=Math.max(0,Math.min(1,(t-1)/this.__triWidth));var p=t-this.__triWidth;h[4*u+c.u]=n+a*Math.max(0,Math.min(1,1-(p-1)/this.__baseWidth)),h[4*u+c.v]=r+_*h[4*u+c.y];var y=Math.min(1,t);h[5*u+c.x]=this.__flipped?1-y:y,h[5*u+c.y]=0,h[5*u+c.u]=n+a*Math.max(0,Math.min(1,1-(t-1)/this.__baseWidth))}},setAngle:function(e){this.__angle=e},setBaseWidth:function(e){this.__baseWidth=e},setTextureRegion:function(e){return this.__region=e,this._hasRenderState=!1,this},__createTexture:function(e){_.isInstanceOf(this.__region,h)&&(this.__texture=s.getTextureFromDomImage(e,this.__region.image.getDOMElement()),this._hasRenderState=!0)},_draw:function(e){this.getVisibility()===r.VISIBILITY.VISIBLE&&(this._hasRenderState||(this.__createTexture(e),this._hasRenderState))&&(this.__progress<=0||(this._transform&&e.spriteBatch.pushTransform(this._transform),e.spriteBatch.addVerts(this.__texture,this.__vertexDataFloat32,d),this._transform&&e.spriteBatch.popTransform()))}}),i.exports.validateProperties=function(e,t){_.ifDefined.assertIsNonEmptyString(e.region),_.ifDefined.assertIsNumber(e.progress),_.ifDefined.assertIsNumber(e.baseWidth),_.ifDefined.assertIsNumber(e.angle),_.ifDefined.assertIsNumber(e.tintColor),e.region&&t.get(h.RESOURCE_TYPE,e.region)}}),define("thor/ui/CarouselPanelEvent",["require","exports","module","thor/core/Class"],function(e,t,i){var n=e("thor/core/Class");i.exports=n.create({initialize:function(){this.contentSize=0,this.scrollAmount=0}})}),define("thor/ui/CarouselPanel",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Scheduler","thor/core/Validation","thor/math/MatrixUtil","thor/graphics/animation/EasingFunctions","./Panel","./Widget","./CompositeWidget","./ScrollWidget","./ScissorBoxWidget","./InputEvent","./Geometry","./Vector","./Slot","./Margin","./CarouselPanelEvent","./ListPanel"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Device"),s=(e("thor/core/Logger").getLogger(i),e("thor/core/Scheduler")),o=e("thor/core/Validation"),a=(e("thor/math/MatrixUtil"),e("thor/graphics/animation/EasingFunctions")),_=e("./Panel"),l=e("./Widget"),h=(e("./CompositeWidget"),e("./ScrollWidget")),u=(e("./ScissorBoxWidget"),e("./InputEvent")),c=(e("./Geometry"),e("./Vector"),e("./Slot"),e("./Margin"),e("./CarouselPanelEvent"),e("./ListPanel")),d={VERTICAL:"vertical",HORIZONTAL:"horizontal"},g={LINEAR:"interpolateLinear",EASE_IN_OUT:"easeInOut",ELASTIC:"elastic",STIFF_ELASTIC:"stiffelastic",OVERSHOOT:"overshoot",SIGMOID:"sigmoid"},p=n.create(h,{initialize:function(e){o.assertIsObject(e),h.prototype.initialize.call(this),this.__carousel=e,this.__animationTaskId=null},onWheel:function(e){return!1},onPointerDown:function(e){return!(!this.__forceAllowDragScrolling&&!r.hasTouch)&&(null!==this.__carousel.__animationTaskId&&this.__carousel.__stopAnimation(),h.prototype.onPointerDown.call(this,e))},getScrollPercent:function(){return this.__carousel.__axis===d.HORIZONTAL?this.__horizontalScrollAmount:this.__verticalScrollAmount},setScrollPercent:function(e){return this.__carousel.__axis===d.HORIZONTAL?this.setHorizontalScrollRatio(e):this.setVerticalScrollRatio(e)},onPointerUp:function(e){if(!this.__forceAllowDragScrolling&&!r.hasTouch)return!1;var t=this.__isScrolling,i=this.__isInertiaScrolling;if(this.__isScrolling===!0){this.__isScrolling=!1,e.wasCaptured&&(e.stopCapture(u.EVENT_TYPE.POINTER_UP,this),e.stopCapture(u.EVENT_TYPE.CANCEL,this)),e.stopCapture(u.EVENT_TYPE.POINTER_MOVE,this);var n=e.x-this.__lastScrollX,s=e.y-this.__lastScrollY,o=Date.now(),a=(o-this.__lastMoveEventTimestamp)/1e3;this.__velocityX=0!==a?n/a:0,this.__velocityY=0!==a?s/a:0,this.__lastScrollX=e.x,this.__lastScrollY=e.y;var _,l=this.__carousel.getNumPages(),h=this.getScrollPercent(),c=h*(l-1),d=Math.floor(c),g=Math.ceil(c);_=c-d>g-c?g:d,_=Math.min(l-1,Math.max(0,_)),this.__isInertiaScrolling=!0,this.__startAnimation(_,l)}return this.__isReadyToScroll=!1,t||i},__startAnimation:function(e,t){if(null===this.__animationTaskId){var i=e/(t-1);this.__animationTaskId=s.addAnimationTask(this.__animationTask.bind(this,i,e))}},__stopAnimation:function(){null!==this.__animationTaskId&&(s.removeAnimationTask(this.__animationTaskId),this.__animationTaskId=null,this.__velocityX=0,this.__velocityY=0)},__animationTask:function(e,t,i,n){if(!this.__isInertiaScrolling)return void this.__stopAnimation();var r=!1,s=this.__carousel.__axis===d.HORIZONTAL,o=s?this.__horizontalScrollAmount:this.__verticalScrollAmount,a=s?this.__possibleHorizontalScrollPixels:this.__possibleVerticalScrollPixels,_=a*o,l=a*e,h=l-_,u=(s?this.__velocityX:this.__velocityY)/1e3,c=Math.abs(u);if(Math.abs(h)<20&&c<2)this.setScrollPercent(e);else if(Math.abs(h)<20&&(0===e||1===e))this.setScrollPercent(e);else{var g=.001*h,p=-.05*u,m=g+p;u+=m*n,s?this.__velocityX=1e3*u:this.__velocityY=1e3*u,_+=u*n,o=_/a,this.setScrollPercent(o),r=!0}r||(this.__carousel.__currentPageIdx=t,this.__isInertiaScrolling=!1,this.__stopAnimation())}});i.exports=n.create(_,{initialize:function(){_.prototype.initialize.call(this);var e=new p(this),t=new c;e.getNamedSlot("content").setWidget(t),this.__contentPanel=t,this.__content=e,this.__axis=d.HORIZONTAL,this.__currentPageIdx=0,this.__shouldAnimate=!0,this.__animationTaskId=null,this.__animationTimerMS=0,this.__easingFunction=a.interpolateLinear,this.__pageTransferTimeMS=500},_setProperties:function(e,t){_.prototype._setProperties.call(this,e,t),void 0!==e.animate&&(this.__shouldAnimate=e.animate),void 0!==e.easingFunction&&(this.__easingFunction=a[e.easingFunction]),void 0!==e.pageTransferTimeMS&&(this.__pageTransferTimeMS=e.pageTransferTimeMS),void 0!==e.axis&&(this.__axis=e.axis);var i=this.__axis===d.HORIZONTAL,n=i?c.PRIMARY_AXIS.HORIZONTAL:c.PRIMARY_AXIS.VERTICAL;this.__content.setScrollVertically(!i),this.__content.setScrollHorizontally(i),this.__contentPanel.setAxis(n)},setAxis:function(e){this.__axis=e;var t=this.__axis===d.HORIZONTAL,i=t?c.PRIMARY_AXIS.HORIZONTAL:c.PRIMARY_AXIS.VERTICAL;return this.__content.setScrollVertically(!t),this.__content.setScrollHorizontally(t),this.__contentPanel.setAxis(i),this},setEasingFunction:function(e){return this.__easingFunction=a[e],this},setAnimate:function(e){return this.__shouldAnimate=e,this},_onCreateSlot:function(){return this.__contentPanel._onCreateSlot()},_onForEachChild:function(e){e(this.__content)},_onForEachChildReverse:function(e){e(this.__content)},_onComputeDesiredSize:function(e){this.__content._onComputeDesiredSize(e)},_onArrangeChildren:function(e){this.__content._setGeometry(e)},_draw:function(e){this.getVisibility()===l.VISIBILITY.VISIBLE&&(this._transform&&e.spriteBatch.pushTransform(this._transform),this.__content._draw(e),this._transform&&e.spriteBatch.popTransform())},addSlot:function(e){return this.__contentPanel.addSlot(e)},getSlotAtIndex:function(e){return this.__contentPanel.getSlotAtIndex(e)},removeSlotAtIndex:function(e){return this.__contentPanel.removeSlotAtIndex(e)},removeSlot:function(e){return this.__contentPanel.removeSlot(e)},findSlotWithWidget:function(e){return this.__contentPanel.findSlotWithWidget(e)},getNumSlots:function(){return this.__contentPanel.getNumSlots()},getNumPages:function(){return this.__contentPanel.getNumSlots()},getCurrentPage:function(){return this.__currentPageIdx},prevPage:function(e){o.ifDefined.assertIsBoolean(e),e=e||!1;var t=this.getNumPages(),i=this.__currentPageIdx-1;i<0&&(i=e?t-1:0),this.goToPage(i)},nextPage:function(e){o.ifDefined.assertIsBoolean(e),e=e||!1;var t=this.getNumPages(),i=this.__currentPageIdx+1;i>=t&&(i=e?0:t-1),this.goToPage(i)},goToPage:function(e){if(e!==this.__currentPageIdx)if(this.__shouldAnimate)this.__startAnimation(e);else{var t=this.getNumPages(),i=e/(t-1);this.__content.setScrollPercent(i),this.__currentPageIdx=e}},__startAnimation:function(e){if(null===this.__animationTaskId){this.__animationTimerMS=0;var t=this.getNumPages(),i=this.__currentPageIdx/(t-1),n=e/(t-1);this.__animationTaskId=s.addAnimationTask(this.__goToPageAnimationTask.bind(this,i,n,e))}},__stopAnimation:function(){null!==this.__animationTaskId&&(s.removeAnimationTask(this.__animationTaskId),this.__animationTaskId=null)},__goToPageAnimationTask:function(e,t,i,n,r){if(!this.__shouldAnimate)return void this.__stopAnimation();this.__animationTimerMS+=r;var s,o=this.__animationTimerMS/this.__pageTransferTimeMS;if(o<=0)s=e;else if(o>=1)s=t,this.__currentPageIdx=i,this.__stopAnimation();else{var a=t-e,_=this.__easingFunction(o);s=e+a*_}this.__content.setScrollPercent(s)}}),i.exports.validateProperties=function(e,t){o.ifDefined.assertValueInEnum(e.axis,d),o.ifDefined.assertIsBoolean(e.animate),o.ifDefined.assertValueInEnum(e.easingFunction,g),o.ifDefined.assertIsNumber(e.pageTransferTimeMS)},i.exports.validateSlotProperties=function(e,t){c.validateSlotProperties(e,t)},i.exports.AXIS=d,i.exports.EASING_FUNCTIONS=g}),define("thor/ui/MeshWidget",["require","exports","module","thor/core/Class","thor/core/Validation","thor/math/ColorUtil","thor/math/MatrixUtil","thor/graphics/resources/DOMImageResource","thor/graphics/resources/TextureRegionResource","./Widget","./LeafWidget","thor/webgl/Texture","thor/webgl/shaders/SpriteBatch","thor/graphics/animation/Transform"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/math/ColorUtil"),o=e("thor/math/MatrixUtil"),a=e("thor/graphics/resources/DOMImageResource"),_=e("thor/graphics/resources/TextureRegionResource"),l=e("./Widget"),h=e("./LeafWidget"),u=e("thor/webgl/Texture"),c=e("thor/webgl/shaders/SpriteBatch"),d=e("thor/graphics/animation/Transform");i.exports=n.create(h,{initialize:function(){h.prototype.initialize.call(this),this.__vertices=new ArrayBuffer(4*c.VERTEX_LENGTH),this.__indicies=new Uint16Array(4),this.__indicies[0]=0,this.__indicies[1]=1,this.__indicies[2]=2,this.__indicies[3]=3,this.__floatView=new Float32Array(this.__vertices),this.__floatView.set(c.IDENTITY_VERTEX,0),this.__floatView.set(c.IDENTITY_VERTEX,c.VERTEX_FLOAT32_LENGTH),this.__floatView.set(c.IDENTITY_VERTEX,2*c.VERTEX_FLOAT32_LENGTH),this.__floatView.set(c.IDENTITY_VERTEX,3*c.VERTEX_FLOAT32_LENGTH),this.__uint8View=new Uint8Array(this.__vertices),this.__meshExtents={minX:0,minY:0,maxX:0,maxY:0},this.__textureRegion=null,this.__texture=null,this.__usedVertices=4,this.__drawVertices=this.__floatView,this.__drawIndices=this.__indicies,this._hasRenderState=!1,this.__meshTransform=new d,this.__meshTransform.setPaused(!1),this.__scaleX=!0,this.__scaleY=!0},getVertexCount:function(){return this.__usedVertices},addVertices:function(e){if(this.__vertices.byteLength/c.VERTEX_LENGTH-this.__usedVertices>=e)return this.__usedVertices+=e,this.__drawVertices=this.__vertices.subarray(0,this.__usedVertices),void(this.__drawIndices=this.__indicies.subarray(0,this.__usedVertices));for(var t=this.__usedVertices+e,i=this.__vertices.byteLength/c.VERTEX_LENGTH;i<t;)i*=2;var n=new ArrayBuffer(i*c.VERTEX_LENGTH),r=new Float32Array(n);r.set(this.__floatView,0);for(var s=new Uint16Array(i),o=0;o<i;++o)s[o]=o,o>=this.__usedVertices&&r.set(c.IDENTITY_VERTEX,o*c.VERTEX_FLOAT32_LENGTH);this.__vertices=n,this.__indicies=s,this.__floatView=r,this.__uint8View=new Uint8Array(this.__vertices),this.__usedVertices+=e,this.__drawVertices=this.__floatView.subarray(0,this.__usedVertices*c.VERTEX_FLOAT32_LENGTH),this.__drawIndices=this.__indicies.subarray(0,this.__usedVertices)},setVertices:function(e){var t=e.length;t>this.__usedVertices?this.addVertices(t-this.__usedVertices):this.__usedVertices=t;for(var i=0;i<t;++i){var n=e[i];this.setColor(i,n.color),this.setPosition(i,n.position[0],n.position[1]),this.setTextureCoordinates(i,n.uvs[0],n.position[1]),n.transform&&this.setVertexTransform(i,n.transform)}},setColor:function(e,t){var i=e*c.VERTEX_UINT8_LENGTH+c.VERTEX_OFFSETS.r;s.writeToUint8Array(t,this.__uint8View,i)},setPosition:function(e,t,i){var n=e*c.VERTEX_FLOAT32_LENGTH;this.__floatView[n+c.VERTEX_OFFSETS.x]=t,this.__floatView[n+c.VERTEX_OFFSETS.y]=i,this.__recomputeBounds()},setTextureCoordinates:function(e,t,i){var n=e*c.VERTEX_FLOAT32_LENGTH;this.__floatView[n+c.VERTEX_OFFSETS.u]=t,this.__floatView[n+c.VERTEX_OFFSETS.v]=i},setVertexTransform:function(e,t){for(var i=e*c.VERTEX_FLOAT32_LENGTH+c.VERTEX_OFFSETS.t0,n=0;n<t.length;++n)this.__floatView[i+n]=t[n];this.__recomputeBounds()},__recomputeBounds:function(){if(0==this.__usedVertices)return this.__meshExtents.minX=0,this.__meshExtents.minY=0,this.__meshExtents.maxX=0,void(this.__meshExtents.maxY=0);for(var e=-(1/0),t=1/0,i=-(1/0),n=1/0,r=new Float32Array(2),s=0;s<this.__usedVertices;++s){var a=s*c.VERTEX_FLOAT32_LENGTH;o.transformVector3x2(this.__floatView.subarray(a,a+2),this.__floatView.subarray(a+c.VERTEX_OFFSETS.t0,a+c.VERTEX_OFFSETS.t5+1),r),e=e>r[0]?e:r[0],t=t<r[0]?t:r[0],i=i>r[1]?i:r[1],n=n<r[1]?n:r[1]}this.__meshExtents.minX=t,this.__meshExtents.minY=n,this.__meshExtents.maxX=e,this.__meshExtents.maxY=i},clearTextureRegion:function(){if(this.__textureRegion)for(var e=this.__textureRegion.uvs[0],t=this.__textureRegion.uvs[4],i=this.__textureRegion.uvs[1],n=this.__textureRegion.uvs[5],r=t-e,s=n-i,o=0;o<this.__usedVertices;++o){var a=o*c.VERTEX_FLOAT32_LENGTH,_=a+c.VERTEX_OFFSETS.u,l=a+c.VERTEX_OFFSETS.v;this.__floatView[_]=this.__floatView[_]/r-e,this.__floatView[l]=this.__floatView[l]/s-i}this.__textureRegion=null,this.__texture=null,this._hasRenderState=!1},setTextureRegion:function(e){if(this.__textureRegion)for(var t=this.__textureRegion.uvs[0],i=this.__textureRegion.uvs[4],n=this.__textureRegion.uvs[1],r=this.__textureRegion.uvs[5],s=i-t,o=r-n,a=0;a<this.__usedVertices;++a){var _=a*c.VERTEX_FLOAT32_LENGTH,l=_+c.VERTEX_OFFSETS.u,h=_+c.VERTEX_OFFSETS.v;this.__floatView[l]=this.__floatView[l]/s-t,this.__floatView[h]=this.__floatView[h]/o-n}this.__textureRegion=e,this.__texture=null,this._hasRenderState=!1;for(var t=this.__textureRegion.uvs[0],i=this.__textureRegion.uvs[4],n=this.__textureRegion.uvs[1],r=this.__textureRegion.uvs[5],s=i-t,o=r-n,a=0;a<this.__usedVertices;++a){var _=a*c.VERTEX_FLOAT32_LENGTH,l=_+c.VERTEX_OFFSETS.u,h=_+c.VERTEX_OFFSETS.v;this.__floatView[l]=this.__floatView[l]*s+t,this.__floatView[h]=this.__floatView[h]*o+n}},_setProperties:function(e,t){void 0!==e.region&&this.setTextureRegion(t.get(_.RESOURCE_TYPE,e.region));var i=e.vertices;this.setVertices(i)},_onComputeDesiredSize:function(e){e.x=this.__meshExtents.maxX-this.__meshExtents.minX,e.y=this.__meshExtents.maxY-this.__meshExtents.minY},_setGeometry:function(e){h.prototype._setGeometry.call(this,e);var t=this.__meshTransform;t.x=e.__absolutePositionX,t.y=e.__absolutePositionY,this.__scaleX&&(t.sx=e.__sizeX/(this.__meshExtents.maxX-this.__meshExtents.minX)),this.__scaleY&&(t.sy=e.__sizeY/(this.__meshExtents.maxY-this.__meshExtents.minY)),o.transform(o.IDENTITY_3x2,t.transform,t.x,t.y,t.rad,t.xshear,t.sx,t.sy,t.matrixMode,t.tx,t.ty)},__createTexture:function(e){r.isInstanceOf(this.__region,_)&&(this.__texture=u.getTextureFromDomImage(e,this.__region.image.getDOMElement()),this._hasRenderState=!0)},_draw:function(e){this.getVisibility()===l.VISIBILITY.VISIBLE&&(!this.__textureRegion||this._hasRenderState||(this.__createTexture(e),this._hasRenderState))&&(this._transform&&e.spriteBatch.pushTransform(this._transform),e.spriteBatch.pushTransform(this.__meshTransform),e.spriteBatch.addVerts(this.__texture,this.__drawVertices,this.__drawIndices),e.spriteBatch.popTransform(),this._transform&&e.spriteBatch.popTransform())}}),i.exports.validateProperties=function(e,t){r.ifDefined.assertIsNonEmptyString(e.image),e.image&&t.get(a.RESOURCE_TYPE,e.image)}}),define("thor/ui/resources/WidgetResource",["require","exports","module","thor/core/Class","thor/core/Validation","thor/resources/ResourceManager","../Widget","../ImageWidget","../HListPanel","../ListPanel","../CanvasPanel","../ScrollWidget","../ScrollBarWidget","../NineSliceWidget","../TextWidget","../ProgressBarWidget","../PopupContainerWidget","../RadialProgressWidget","../WorldWidget","../SimpleButtonWidget","../ToggleButtonWidget","../HoldableButtonWidget","../AnimatedSpriteWidget","../ComponentPositionWidget","../ShineWidget","../CarouselPanel","../MeshWidget"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=(e("thor/resources/ResourceManager"),e("../Widget")),o={ImageWidget:e("../ImageWidget"),HListPanel:e("../HListPanel"),ListPanel:e("../ListPanel"),CanvasPanel:e("../CanvasPanel"),ScrollWidget:e("../ScrollWidget"),ScrollBarWidget:e("../ScrollBarWidget"),NineSliceWidget:e("../NineSliceWidget"),TextWidget:e("../TextWidget"),ProgressBarWidget:e("../ProgressBarWidget"),PopupContainerWidget:e("../PopupContainerWidget"),RadialProgressWidget:e("../RadialProgressWidget"),WorldWidget:e("../WorldWidget"),SimpleButtonWidget:e("../SimpleButtonWidget"),ToggleButtonWidget:e("../ToggleButtonWidget"),HoldableButtonWidget:e("../HoldableButtonWidget"),AnimatedSpriteWidget:e("../AnimatedSpriteWidget"),ComponentPositionWidget:e("../ComponentPositionWidget"),ShineWidget:e("../ShineWidget"),CarouselPanel:e("../CarouselPanel"),MeshWidget:e("../MeshWidget")};i.exports=n.create({initialize:function(e,t){this.__jsonData=e,this.__resourceManager=t,this.__validateWidget(e.root)},__validateWidget:function(e){if(null!==e){r.ifDefined.assertIsNonEmptyString(e.name),r.ifDefined.assertValueInEnum(e.visibility,s.VISIBILITY);var t=o[e.type];if(!t)throw new Error("Invalid widget type in definition "+e.type);if(!t.validateProperties)throw new Error("Widget doesn't implement validateProperties for widget "+e.type);if(t.validateProperties(e.properties,this.__resourceManager),e.slots){if(!t.validateSlotProperties)throw new Error("Widget data contains slots data, but widget doesn't have validateSlotProperties for widget "+e.type);for(var i=0;i<e.slots.length;++i){var n=e.slots[i];t.validateSlotProperties(n.properties,this.__resourceManager),this.__validateWidget(n.widget)}}if(e.namedSlots){if(!t.validateNamedSlotProperties)throw new Error("Widget data contains namedSlots data, but widget doesn't have validateNamedSlotProperties for widget "+e.type);for(var a in e.namedSlots){var _=e.namedSlots[a];t.validateNamedSlotProperties(a,_.properties,this.__resourceManager),this.__validateWidget(_.widget)}}}},construct:function(){return this.__constructWidget(this.__jsonData.root)},__constructWidget:function(e){if(null===e)return s.NULL_WIDGET;var t=o[e.type],i=new t;if(i._setProperties(e.properties,this.__resourceManager),void 0!==e.name&&i.setName(e.name),void 0!==e.visibility&&i.setVisibility(e.visibility),e.slots){var n=this;e.slots.forEach(function(e){var t=n.__constructWidget(e.widget);i.addSlot(function(i){i._setProperties(e.properties,n.__resourceManager),i.setWidget(t)})})}if(e.namedSlots)for(var r in e.namedSlots){var a=e.namedSlots[r],_=this.__constructWidget(a.widget),l=i.getNamedSlot(r);l._setProperties(a.properties),l.setWidget(_)}return i},getDesiredWidth:function(){return this.__jsonData.desiredWidth},getDesiredHeight:function(){return this.__jsonData.desiredHeight}}),i.exports.RESOURCE_TYPE="widget"}),define("thor/ui/Dialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/resources/WidgetResource","thor/resources/ResourceManager","thor/audio/SoundSprite"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/ui/resources/WidgetResource"));e("thor/resources/ResourceManager"),e("thor/audio/SoundSprite");i.exports=n.create({initialize:function(e,t){this.__dialogResource=e.get(r.RESOURCE_TYPE,t),this._widget=this.__dialogResource.construct(),this.__instanceId=0,this.__dialogManager=null,this.__resolvers=[],this._result=null,this._closableByModalClick=!1,this.__closeSoundId=null,this.__soundSprite=null},_setResult:function(e){this._result=e},waitForClosed:function(){var e=this;return new Promise(function(t,i){e.__resolvers.push(t)})},isShowing:function(){return!!this.__instanceId},show:function(e){this.__instanceId||(this.__instanceId=e.showDialog(this),this.__dialogManager=e)},setCloseSoundId:function(e,t){this.__soundSprite=e,this.__closeSoundId=t},close:function(){if(!this.__instanceId)return!1;this.__soundSprite&&this.__closeSoundId&&this.__soundSprite.play(this.__closeSoundId),this.__dialogManager.hideDialog(this.__instanceId),this.__instanceId=0,this.__dialogManager=null;var e=this._result;return this.__resolvers.forEach(function(t){t(e)}),this._result=null,this.__resolvers.length=0,!0},getWidth:function(){return this.__dialogResource.getDesiredWidth()},getHeight:function(){return this.__dialogResource.getDesiredHeight()},getWidget:function(){return this._widget},getInstanceId:function(){return this.__instanceId},isClosableByModalClick:function(){return this._closableByModalClick}})}),define("thor/graphics/animation/actions/TweenAction",["require","exports","module","thor/core/Class","thor/core/Validation","../Tween","./Action"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("../Tween")),s=e("./Action");i.exports=n.create(s,{initialize:function(){this._tween=new r(0,1,0),s.prototype.initialize.call(this)},reset:function(){s.prototype.reset.call(this),this._tween.reset()},_apply:function(){},isComplete:function(){return!this._tween.isAnimating()},update:function(e){if(this._target){var t=this._tween.update(e);return this._apply(),t}return e}})}),define("thor/graphics/animation/actions/WaitAction",["require","exports","module","thor/core/Class","thor/core/Validation","./TweenAction"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./TweenAction"));i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this)},wait:function(e){this._tween.setDuration(e),this._tween.reset()}})}),define("thor/graphics/animation/actions/CallbackAction",["require","exports","module","thor/core/Class","thor/core/Validation","./Action"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Action"));i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this)},reset:function(){r.prototype.reset.call(this),this.__called=!1},setCallback:function(e){this.__callback=e,this.__called=!0},isComplete:function(){return this.__called},update:function(e){return this.__callback(),this.__called=!0,e}})}),define("thor/graphics/animation/actions/MoveByAction",["require","exports","module","thor/core/Class","thor/core/Validation","./TweenAction"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./TweenAction");i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this)},reset:function(){s.prototype.reset.call(this),this.__lastProgress=0},moveBy:function(e,t,i,n){r.ifDefined.assertIsFunction(n),this.__dx=e,this.__dy=t,this.__lastProgress=0,n&&this._tween.setEasingFunction(n),this._tween.setDuration(i),this._tween.reset()},_apply:function(){var e=+this._tween,t=e-this.__lastProgress;this.__lastProgress=e,this._target.x+=t*this.__dx,this._target.y+=t*this.__dy}})}),define("thor/graphics/animation/actions/ScaleToAction",["require","exports","module","thor/core/Class","thor/core/Validation","./TweenAction"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./TweenAction");i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__x=0,this.__y=0,this.__xOrig=0,this.__yOrig=0,this.__captured=!1},reset:function(){s.prototype.reset.call(this),this.__captured=!1},scaleTo:function(e,t,i,n){r.ifDefined.assertIsFunction(n),this.__x=e,this.__y=t,this.__xOrig=0,this.__yOrig=0,this.__captured=!1,n&&this._tween.setEasingFunction(n),this._tween.setDuration(i),this._tween.reset()},_apply:function(){this.__captured||(this.__xOrig=this._target.sx,this.__yOrig=this._target.sy,this.__captured=!0);var e=+this._tween,t=1-e;this._target.sx=e*this.__x+t*this.__xOrig,this._target.sy=e*this.__y+t*this.__yOrig}})}),define("thor/graphics/animation/actions/ScaleByAction",["require","exports","module","thor/core/Class","thor/core/Validation","./TweenAction"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./TweenAction");i.exports=n.create(s,{initialize:function(){this.__x=0,this.__y=0,this.__xFinal=1,this.__yFinal=1,this.__xOrig=1,this.__yOrig=1,this.__captured=!1,s.prototype.initialize.call(this)},reset:function(){s.prototype.reset.call(this),this.__captured=!1},scaleBy:function(e,t,i,n){r.ifDefined.assertIsFunction(n),this.__x=e,this.__y=t,this.__xFinal=1,this.__yFinal=1,this.__xOrig=1,this.__yOrig=1,this.__captured=!1,n&&this._tween.setEasingFunction(n),this._tween.setDuration(i),this._tween.reset()},_apply:function(){this.__captured||(this.__xOrig=this._target.sx,this.__yOrig=this._target.sy,this.__xFinal=this.__xOrig*this.__x,this.__yFinal=this.__yOrig*this.__y,this.__captured=!0);var e=+this._tween,t=1-e;this._target.sx=e*this.__xFinal+t*this.__xOrig,this._target.sy=e*this.__yFinal+t*this.__yOrig}})}),define("thor/graphics/animation/actions/RotateByAction",["require","exports","module","thor/core/Class","thor/core/Validation","./TweenAction"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./TweenAction");i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this)},reset:function(){s.prototype.reset.call(this),this.__lastProgress=0},rotateBy:function(e,t,i){r.ifDefined.assertIsFunction(i),this.__drad=e,this.__lastProgress=0,i&&this._tween.setEasingFunction(i),this._tween.setDuration(t),this._tween.reset()},_apply:function(){var e=+this._tween,t=e-this.__lastProgress;this.__lastProgress=e,this._target.rad+=t*this.__drad}})}),define("thor/graphics/animation/actions/MoveToAction",["require","exports","module","thor/core/Class","thor/core/Validation","./TweenAction"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./TweenAction");i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__x=0,this.__y=0,this.__xOrig=0,this.__yOrig=0,this.__captured=!1},reset:function(){s.prototype.reset.call(this),this.__captured=!1},moveTo:function(e,t,i,n){r.ifDefined.assertIsFunction(n),this.__x=e,this.__y=t,this.__xOrig=0,this.__yOrig=0,this.__captured=!1,n&&this._tween.setEasingFunction(n),this._tween.setDuration(i),this._tween.reset()},_apply:function(){this.__captured||(this.__xOrig=this._target.x,this.__yOrig=this._target.y,this.__captured=!0);var e=+this._tween,t=1-e;this._target.x=e*this.__x+t*this.__xOrig,this._target.y=e*this.__y+t*this.__yOrig}})}),define("thor/graphics/animation/actions/SequenceAction",["require","exports","module","thor/core/Class","thor/core/Validation","./Action"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Action"));i.exports=n.create(r,{initialize:function(){this._actions=[],this._index=0,r.prototype.initialize.call(this)},reset:function(){r.prototype.reset.call(this);for(var e=0;e<this._actions.length;++e)this._actions[e].reset();this._index=0},setTarget:function(e){r.prototype.setTarget.call(this,e);for(var t=0;t<this._actions.length;++t)this._actions[t].setTarget(e)},addAction:function(e){this._actions.push(e),e.setTarget(this._target)},clearActions:function(){this._actions.length=0},isComplete:function(){return this._index>=this._actions.length},update:function(e){var t=this._actions[this._index],i=t.update(e);return t.isComplete()&&++this._index<this._actions.length?this.update(i):i}})}),define("thor/graphics/animation/actions/ParallelAction",["require","exports","module","thor/core/Class","thor/core/Validation","./SequenceAction"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./SequenceAction"));i.exports=n.create(r,{initialize:function(){this._actions=[],this._index=0,r.prototype.initialize.call(this)},reset:function(){r.prototype.reset.call(this),this.__complete=!1;for(var e=0;e<this._actions.length;++e){this._actions[e].reset()}},isComplete:function(){return this.__complete},update:function(e){for(var t=!0,i=e,n=0;n<this._actions.length;++n){var r=this._actions[n];if(!r.isComplete()){var s=r.update(e);i=Math.min(i,s),t=!1}}return this.__complete=t,i}})}),define("thor/graphics/animation/actions/LoopAction",["require","exports","module","thor/core/Class","thor/core/Validation","./SequenceAction"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./SequenceAction"));i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this)},isComplete:function(){return!1},update:function(e){var t=r.prototype.update.call(this,e);return this._index>=this._actions.length&&(this.reset(),t=this.update(t)),this._index=this._index%this._actions.length,t}})}),define("thor/graphics/animation/actions/FadeToAction",["require","exports","module","thor/core/Class","thor/core/Validation","./TweenAction"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./TweenAction");i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__alpha=0,this.__alphaOrig=0},fadeTo:function(e,t,i){r.ifDefined.assertIsFunction(i),this.__alpha=e,this.__alphaOrig=-1,i&&this._tween.setEasingFunction(i),this._tween.setDuration(t),this._tween.reset()},_apply:function(){var e=+this._tween;this.__alphaOrig<0&&(this.__alphaOrig=this._target.alpha);var t=1-e;this._target.alpha=e*this.__alpha+t*this.__alphaOrig}})}),define("thor/graphics/animation/actions/FadeByAction",["require","exports","module","thor/core/Class","thor/core/Validation","./TweenAction"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./TweenAction");i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__alphaDelta=0,this.__lastProgress=0},reset:function(){s.prototype.reset.call(this),this.__lastProgress=0},fadeBy:function(e,t,i){r.ifDefined.assertIsFunction(i),this.__alphaDelta=e,this.__lastProgress=0,i&&this._tween.setEasingFunction(i),this._tween.setDuration(t),this._tween.reset()},_apply:function(){var e=+this._tween,t=e-this.__lastProgress;this.__lastProgress=e,this._target.alpha+=t*this.__alphaDelta}})}),define("thor/graphics/animation/actions/TweenCallbackAction",["require","exports","module","thor/core/Class","thor/core/Validation","./TweenAction"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./TweenAction");i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__callback=null},reset:function(){s.prototype.reset.call(this)},tweenTo:function(e,t,i,n,s){r.ifDefined.assertIsFunction(s),this.__callback=n,this._tween.setDuration(i),this._tween.setInitialValue(e),this._tween.setFinalValue(t),s&&this._tween.setEasingFunction(s),this._tween.reset()},_apply:function(){if(this.__callback){var e=+this._tween;this.__callback(e)}}})}),define("thor/graphics/animation/actions/Actions",["require","exports","module","thor/core/Class","thor/core/Validation","./Action","./WaitAction","./CallbackAction","./MoveByAction","./ScaleToAction","./ScaleByAction","./RotateByAction","./MoveToAction","./SequenceAction","./ParallelAction","./LoopAction","./FadeToAction","./FadeByAction","./TweenCallbackAction"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=(e("./Action"),e("./WaitAction")),s=e("./CallbackAction"),o=e("./MoveByAction"),a=e("./ScaleToAction"),_=e("./ScaleByAction"),l=e("./RotateByAction"),h=e("./MoveToAction"),u=e("./SequenceAction"),c=e("./ParallelAction"),d=e("./LoopAction"),g=e("./FadeToAction"),p=e("./FadeByAction"),m=e("./TweenCallbackAction");i.exports={fadeTo:function(e,t,i){n.ifDefined.assertIsFunction(i);var r=new g;return r.fadeTo(e,t,i),r},fadeBy:function(e,t,i){n.ifDefined.assertIsFunction(i);var r=new p;return r.fadeBy(e,t,i),r},rotateBy:function(e,t,i){n.ifDefined.assertIsFunction(i);var r=new l;return r.rotateBy(e,t,i),r},scaleTo:function(e,t,i,r){n.ifDefined.assertIsFunction(r);var s=new a
;return s.scaleTo(e,t,i,r),s},scaleBy:function(e,t,i,r){n.ifDefined.assertIsFunction(r);var s=new _;return s.scaleBy(e,t,i,r),s},moveBy:function(e,t,i,r){n.ifDefined.assertIsFunction(r);var s=new o;return s.moveBy(e,t,i,r),s},moveTo:function(e,t,i,r){n.ifDefined.assertIsFunction(r);var s=new h;return s.moveTo(e,t,i,r),s},wait:function(e){var t=new r;return t.wait(e),t},sequence:function(){for(var e=new u,t=0;t<arguments.length;++t)e.addAction(arguments[t]);return e},parallel:function(){for(var e=new c,t=0;t<arguments.length;++t)e.addAction(arguments[t]);return e},loop:function(){for(var e=new d,t=0;t<arguments.length;++t)e.addAction(arguments[t]);return e},callback:function(e){var t=new s;return t.setCallback(e),t},tweenCallback:function(e,t,i,r,s){n.ifDefined.assertIsFunction(s);var o=new m;return o.tweenTo(e,t,i,r,s),o}}}),define("thor/ui/DialogManager",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger","thor/math/ColorUtil","thor/ui/Panel","thor/ui/Anchor","thor/ui/Dialog","thor/ui/Widget","thor/ui/ImageWidget","thor/ui/PopupContainerWidget","thor/graphics/animation/actions/Actions","thor/graphics/resources/TextureRegionResource"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/core/Logger").getLogger(i)),s=e("thor/math/ColorUtil"),o=(e("thor/ui/Panel"),e("thor/ui/Anchor")),a=(e("thor/ui/Dialog"),e("thor/ui/Widget"),e("thor/ui/ImageWidget")),_=e("thor/ui/PopupContainerWidget"),l=e("thor/graphics/animation/actions/Actions"),h=(e("thor/graphics/resources/TextureRegionResource"),n.create(a,{initialize:function(){a.prototype.initialize.call(this)},onPointerDown:function(){return!0}})),u=n.create({initialize:function(e,t,i){this.__modalBackground=e,this.__modalOpacity=t,this.__panel=i,this.__dialogId=0,this.__slotsByDialogId={}},getModalOpacity:function(){return this.__modalOpacity},setModalOpacity:function(e){this.__modalOpacity=e},showDialog:function(e){var t=++this.__dialogId,i=this;return this.__panel.addSlot(function(n){var r=new _,a=new h;a.setTextureRegion(i.__modalBackground),a.setTintColor(s.createRGBAfloat(1,1,1,i.__modalOpacity)),r.getNamedSlot(_.NAMED_SLOT_MODAL).setWidget(a),r.showModal(e.getWidget(),e.getWidth(),e.getHeight()),n.setAnchor(new o(0,0,1,1)),n.setWidget(r),i.__slotsByDialogId[t]=n,e.isClosableByModalClick()&&i.__setModalClickable(a,e)}),r.debug("Dialog ID "+t+" shown"),this.__panel.invalidate(),t},hideDialog:function(e){var t=this.__slotsByDialogId[e];t&&(this.__panel.removeSlot(t),delete this.__slotsByDialogId[e],r.debug("Dialog ID "+e+" hidden"))},__setModalClickable:function(e,t){e.onPointerDown=function(){return e.pressed=!0,!0},e.onPointerUp=function(){return!e.pressed||(t.close(),!0)},e.onPointerOut=function(){e.pressed&&(e.pressed=!1)},e.onPointerCancel=e.onPointerOut},fadeOutModalBackground:function(e,t){var i=this.__slotsByDialogId[e];if(i){i.getWidget().getNamedSlot(_.NAMED_SLOT_MODAL).getWidget().runAction(l.fadeTo(0,t))}}});i.exports=u}),define("thor/ui/resources/WidgetResourceLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/resources/ResourceLoader","thor/resources/ResourceManager","thor/util/JSONLoader","./WidgetResource"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/resources/ResourceLoader")),s=(e("thor/resources/ResourceManager"),e("thor/util/JSONLoader")),o=e("./WidgetResource"),a=[o.RESOURCE_TYPE];i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,a),this.__resourceManager=e},guid:function(e,t){return"widget::"+t},load:function(e,t){var i=this;return new Promise(function(n,r){i.__resourceManager.loader(s.RESOURCE_TYPE).load(e,t).then(function(e){if(!e.resources)return void r("No resources block in widget");i.__resourceManager.loadBulk(e.resources).then(function(){n(new o(e,i.__resourceManager))})})})}})}),define("thor/graphics/resources/AnimatedSpriteResourceLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/resources/ResourceLoader","./TextureRegionResource","./AnimatedSpriteResource","thor/util/JSONLoader"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/resources/ResourceLoader"),o=e("./TextureRegionResource"),a=e("./AnimatedSpriteResource"),_=e("thor/util/JSONLoader"),l=[a.RESOURCE_TYPE];i.exports=n.create(s,{initialize:function(e){s.prototype.initialize.call(this,l),this.__resourceManager=e},guid:function(e,t){return"animatedSprite::"+t},load:function(e,t){var i=this;return this.__resourceManager.loader(_.RESOURCE_TYPE).load(e,t).then(function(e){return r.ifDefined.assertIsObject(e.frameLengthsMS),i.__resourceManager.loadBulk(e.resources).then(function(){for(var t=[],n=0;n<e.frames.length;++n)t.push(i.__resourceManager.get(o.RESOURCE_TYPE,e.frames[n]));return new a(t,e.framesPerSecond,e.frameLengthsMS)})})}})}),define("thor/graphics/resources/ParticleSystemResource",["require","exports","module","thor/core/Class","thor/core/Validation","./TextureRegionResource"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation");e("./TextureRegionResource");i.exports=n.create({initialize:function(e){this.sourcePositionVarianceX=e.sourcePositionVariancex,this.sourcePositionVarianceY=e.sourcePositionVariancey,this.emitAngle=e.angle,this.emitAngleVariance=e.angleVariance,this.particleLifespan=e.particleLifespan,this.particleLifespanVariance=e.particleLifespanVariance,this.maximumParticles=e.maxParticles,this.startParticleSize=e.startParticleSize,this.startParticleSizeVariance=e.startParticleSizeVariance,this.finishParticleSize=e.finishParticleSize,this.finishParticleSizeVariance=e.finishParticleSizeVariance,this.rotationStart=e.rotationStart,this.rotationStartVariance=e.rotationStartVariance,this.rotationEnd=e.rotationEnd,this.rotationEndVariance=e.rotationEndVariance,this.startColorRed=e.startColorRed,this.startColorGreen=e.startColorGreen,this.startColorBlue=e.startColorBlue,this.startColorAlpha=e.startColorAlpha,this.startColorVarianceRed=e.startColorVarianceRed,this.startColorVarianceGreen=e.startColorVarianceGreen,this.startColorVarianceBlue=e.startColorVarianceBlue,this.startColorVarianceAlpha=e.startColorVarianceAlpha,this.finishColorRed=e.finishColorRed,this.finishColorGreen=e.finishColorGreen,this.finishColorBlue=e.finishColorBlue,this.finishColorAlpha=e.finishColorAlpha,this.finishColorVarianceRed=e.finishColorVarianceRed,this.finishColorVarianceGreen=e.finishColorVarianceGreen,this.finishColorVarianceBlue=e.finishColorVarianceBlue,this.finishColorVarianceAlpha=e.finishColorVarianceAlpha,this.speed=e.speed,this.speedVariance=e.speedVariance,this.gravityX=e.gravityx,this.gravityY=-e.gravityy,this.radialAcceleration=e.radialAcceleration,this.radialAccelerationVariance=e.radialAccelVariance,this.tangentialAcceleration=e.tangentialAcceleration,this.tangentialAccelerationVariance=e.tangentialAccelVariance,this.maxRadius=e.maxRadius,this.maxRadiusVariance=e.maxRadiusVariance,this.degreesPerSecond=e.rotatePerSecond,this.degreesPerSecondVariance=e.rotatePerSecondVariance,this.emitterType=e.emitterType,r.ifDefined.assertIsNumber(e.duration),this.durationSeconds=e.duration||0,r.ifDefined.assertIsNumber(e.blendFuncSource),r.ifDefined.assertIsNumber(e.blendFuncDestination),r.ifDefined.assertIsNumber(e.yCoordFlipped),r.ifDefined.assertIsString(e.configName),r.ifDefined.assertIsString(e.textureFileName)}}),i.exports.RESOURCE_TYPE="particlesystem"}),define("thor/graphics/resources/ParticleSystemResourceLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/resources/ResourceLoader","./TextureRegionResource","./ParticleSystemResource","thor/util/JSONLoader"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/resources/ResourceLoader")),s=(e("./TextureRegionResource"),e("./ParticleSystemResource")),o=e("thor/util/JSONLoader"),a=[s.RESOURCE_TYPE];i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,a),this.__resourceManager=e},guid:function(e,t){return"particleSystem::"+t},load:function(e,t){if(this.__resourceManager.has(o.RESOURCE_TYPE,e))return Promise.resolve(new s(this.__resourceManager.get(o.RESOURCE_TYPE,e)));return this.__resourceManager.loader(o.RESOURCE_TYPE).load(e,t).then(function(e){return new s(e)})}})}),define("thor/graphics/imagecache/ImageCache",["require","exports","module","thor/core/Logger","thor/core/Class","thor/core/Validation","thor/webgl/WebGLRenderingSession","thor/webgl/Texture","thor/webgl/DynamicAtlas","../resources/DOMImageResource","../resources/TextureRegionResource"],function(e,t,i){var n=e("thor/core/Logger").getLogger(i),r=e("thor/core/Class"),s=e("thor/core/Validation"),o=(e("thor/webgl/WebGLRenderingSession"),e("thor/webgl/Texture")),a=e("thor/webgl/DynamicAtlas"),_=e("../resources/DOMImageResource"),l=e("../resources/TextureRegionResource"),h=new Uint32Array([0,0,0,0]);i.exports=r.create({initialize:function(e){this.__dynamicAtlas=new a(2048,2048);var t=document.createElement("canvas");t.width=2048,t.height=2048,t.naturalWidth=2048,t.naturalHeight=2048,t.src="ImageCache";var i=t.getContext("2d");this.__cacheCanvas=t,this.__context=i,this.__cachedTextureRegions=null,this.__pendingTexureRegions={};var n=new Float32Array(2);n[0]=10,n[1]=10;var r=new Float32Array(8);r[0]=0,r[1]=0,r[2]=0,r[3]=10/2048,r[4]=10/2048,r[5]=10/2048,r[6]=10/2048,r[7]=0,this.__cacheTexture=o.getTextureFromDomImage(e,this.__cacheCanvas),this.__cacheImageResource=new _(this.__cacheCanvas),this.__emptyAllocatedRegion=new l("ImageCache:empty",n,r,this.__cacheImageResource),this.__resetCache()},getCachedImage:function(e,t){s.ifDefined.assertIsObject(t),t=t||{};var i=this.__cachedTextureRegions[e];if(i)return Promise.resolve(i);if(this.__pendingTexureRegions[e])return this.__pendingTexureRegions[e];var n=this;return this.__pendingTexureRegions[e]=n.__loadImage(e).then(function(i){return n.__actuallyCacheImage(e,i,t)}),this.__pendingTexureRegions[e]},getEmptyRegion:function(){return this.__emptyAllocatedRegion},__actuallyCacheImage:function(e,t,i){s.ifDefined.assertIsNumber(i.maxWidth),s.ifDefined.assertIsNumber(i.maxHeight);var r,o,a=i.maxWidth||t.naturalWidth,_=i.maxHeight||t.naturalHeight;if(a<=t.naturalWidth||_<=t.naturalHeight){var u=a/t.naturalWidth,c=_/t.naturalHeight,d=Math.min(u,c);r=~~(t.naturalWidth*d),o=~~(t.naturalHeight*d)}else r=t.naturalWidth,o=t.naturalHeight;this.__pendingTexureRegions[e]&&delete this.__pendingTexureRegions[e];var g=this.__dynamicAtlas.allocateRectangle(r,o,h);if(!(g||(n.warn("Image cache full!"),this.__resetCache(),g=this.__dynamicAtlas.allocateRectangle(r,o,h))))return void n.error("Image doesn't fit in image cache even after reset!");this.__context.drawImage(t,0,0,t.naturalWidth,t.naturalHeight,h[0],h[1],h[2],h[3]),this.__cacheTexture.update();var p=new Float32Array(2);p[0]=h[2],p[1]=h[3];var m=new Float32Array(8);m[0]=h[0]/2048,m[1]=h[1]/2048,m[2]=h[0]/2048,m[3]=(h[1]+h[3])/2048,m[4]=(h[0]+h[2])/2048,m[5]=(h[1]+h[3])/2048,m[6]=(h[0]+h[2])/2048,m[7]=h[1]/2048;var f=new l("ImageCache:"+e,p,m,this.__cacheImageResource);return this.__cachedTextureRegions[e]=f,f},__loadImage:function(e){var t=document.createElement("img");t.crossOrigin="";return new Promise(function(i,n){function r(){a(null)}function s(){a("Image failed to load")}function o(){a("Image loading was aborted")}function a(e){t.removeEventListener("load",r,!1),t.removeEventListener("error",s,!1),t.removeEventListener("abort",o,!1),e?n(e):i(t)}t.addEventListener("load",r,!1),t.addEventListener("error",s,!1),t.addEventListener("abort",o,!1),t.src=e})},__resetCache:function(){this.__cachedTextureRegions={},this.__context.clearRect(0,0,this.__cacheCanvas.width,this.__cacheCanvas.height),this.__cacheTexture.update(),this.__dynamicAtlas.clear(),this.__dynamicAtlas.allocateRectangle(10,10,h)},debugDraw:function(e){this.__debugUVs=this.__debugUVs||new Float32Array([0,0,0,1,1,1,1,0]),e.spriteBatch.add(this.__cacheTexture,this.__debugUVs,new Float32Array([1,0,0,1,0,0]),new Float32Array([800,800]),4294967168)}})}),define("thor/ui/resources/NineSliceResourceLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/util/JSONLoader","thor/resources/ResourceLoader","thor/graphics/resources/DOMImageResource","thor/graphics/resources/TextureRegionResource","./NineSliceResource"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/util/JSONLoader")),s=e("thor/resources/ResourceLoader"),o=e("thor/graphics/resources/DOMImageResource"),a=e("thor/graphics/resources/TextureRegionResource"),_=e("./NineSliceResource");i.exports=n.create(s,{initialize:function(e,t,i){s.prototype.initialize.call(this,[_.RESOURCE_TYPE]),this.__resourceManager=e,this.__cacheBuster=t,this.__extensionOverride=i||".json",this.__uriPrefix=""},setUriPrefix:function(e){return this.__uriPrefix=e,this},guid:function(e,t){return"nineslice::"+t},load:function(e,t){var i=null,n=t;this.__uriPrefix&&0!==n.indexOf(this.__uriPrefix)&&(n=this.__uriPrefix+n);var s=this;return new Promise(function(t,i){if(!s.__resourceManager.has(r.RESOURCE_TYPE,e))return s.__resourceManager.loader(r.RESOURCE_TYPE).load(e,n.replace(/\.nineslice$/,s.__extensionOverride)).then(function(e){t(e)});t(s.__resourceManager.get(r.RESOURCE_TYPE,e))}).then(function(e){var t=e.image;return i=e.margins,s.__resourceManager.has(a.RESOURCE_TYPE,t)?s.__resourceManager.get(a.RESOURCE_TYPE,t):s.__resourceManager.loader(o.RESOURCE_TYPE).load(t,t).then(function(){return s.__resourceManager.get(a.RESOURCE_TYPE,t)})}).then(function(e){return new _(e,i)})}})}),define("thor/graphics/animation/skeleton/Bone",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","thor/util/StringUtil"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Validation");e("thor/util/StringUtil");i.exports=r.create(n,{initialize:function(e,t){s.ifDefined.assertIsInstanceOf(t,i.exports),n.prototype.initialize.call(this),this.name=e,this.parent=t,this.length=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.flipX=!1,this.flipY=!1,this.inheritScale=!0,this.inheritRotation=!0,this.color=2610666495},setLength:function(e){s.isDefined(e)&&(this.length=e)},setX:function(e){s.isDefined(e)&&(this.x=e)},setY:function(e){s.isDefined(e)&&(this.y=e)},setRotation:function(e){s.isDefined(e)&&(this.rotation=e)},setScaleX:function(e){s.isDefined(e)&&(this.scaleX=e)},setScaleY:function(e){s.isDefined(e)&&(this.scaleY=e)},setFlipX:function(e){s.isDefined(e)&&(this.flipX=e)},setFlipY:function(e){s.isDefined(e)&&(this.flipY=e)},setInheritScale:function(e){s.isDefined(e)&&(this.inheritScale=e)},setInheritRotation:function(e){s.isDefined(e)&&(this.inheritRotation=e)},setColor:function(e){s.isDefined(e)&&(this.color=e)}})}),define("thor/graphics/animation/skeleton/Slot",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","./Bone"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Validation");e("./Bone");i.exports=r.create(n,{initialize:function(e,t){n.prototype.initialize.call(this),this.name=e,this.bone=t,this.color=4294967295,this.attachmentName="",this.blendMode="additive"},setColor:function(e){this.color=e},setAttachmentName:function(e){s.isDefined(e)&&(this.attachmentName=e)},setBlendMode:function(e){s.isDefined(e)&&(this.blendMode=e)}})}),define("thor/graphics/animation/skeleton/attachment/AttachmentType",["require","exports","module"],function(e,t,i){i.exports={REGION:"region",BOUNDING_BOX:"boundingbox",MESH:"mesh",SKINNED_MESH:"skinnedmesh",ENTITY:"entity"}}),define("thor/graphics/animation/skeleton/attachment/Attachment",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","./AttachmentType"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class");e("thor/core/Validation"),e("./AttachmentType");i.exports=r.create(n,{initialize:function(e,t){n.prototype.initialize.call(this),this.name=e,this.type=t},getVertexCount:function(){return 0}})}),define("thor/graphics/animation/skeleton/Skin",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","./attachment/Attachment"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class");e("thor/core/Validation"),e("./attachment/Attachment");i.exports=r.create(n,{initialize:function(e){n.prototype.initialize.call(this),this.name=e,this.attachments={},this.__maxVertexCount=0},addAttachment:function(e,t,i){this.attachments[e]||(this.attachments[e]={}),this.attachments[e][t]=i,this.__maxVertexCount+=i.getVertexCount()},getAttachment:function(e,t){if(this.attachments[e])return this.attachments[e][t]},getMaxVertices:function(){return this.__maxVertexCount}})}),define("thor/graphics/animation/skeleton/Event",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Validation");i.exports=r.create(n,{initialize:function(e){n.prototype.initialize.call(this),this.name=e,this.intValue=0,this.floatValue=0,this.stringValue=""},setIntValue:function(e){s.isDefined(e)&&(this.intValue=e)},setFloatValue:function(e){s.isDefined(e)&&(this.floatValue=e)},setStringValue:function(e){s.isDefined(e)&&(this.stringValue=e)}})}),define("thor/graphics/animation/skeleton/IkConstraint",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","./Bone"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Validation");e("./Bone");i.exports=r.create(n,{initialize:function(e){n.prototype.initialize.call(this),this.name=e,this.bones=[],this.target=void 0,this.bendDirection=1,this.mix=1},addBone:function(e){this.bones.push(e)},setTarget:function(e){this.target=e},setBendDirection:function(e){s.isDefined(e)&&(this.bendDirection=e?1:-1)},setMix:function(e){s.isDefined(e)&&(this.mix=e)}})}),define("thor/graphics/animation/skeleton/SkeletalAnimation",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Validation");i.exports=r.create(n,{initialize:function(e,t,i){n.prototype.initialize.call(this),this.name=e,this.timelines=t,this.duration=i,this.bonesAffected={},this.slotsAffected={};for(var r=0,s=t.length;r<s;++r)void 0!==t[r].boneIndex&&(this.bonesAffected[t[r].boneIndex]=1),void 0!==t[r].slotIndex&&(this.slotsAffected[t[r].slotIndex]=1)},applyTimelines:function(e,t,i,n,r,o){s.assertIsObject(e),s.ifDefined.assertIsObject(r),s.ifDefined.assertIsObject(o);for(var a=this.timelines,_=0,l=a.length;_<l;++_){var h=a[_],u=1;void 0!==h.slotIndex&&o&&(u=o[h.slotIndex]),void 0!==h.boneIndex&&r&&(u=r[h.boneIndex]),void 0===u&&(u=1),0!==u&&h.applyTimeline(e,t,i,null,u,n)}}})}),define("thor/graphics/animation/skeleton/SkeletonResource",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","./Bone","./Slot","./Skin","./Event","./IkConstraint","./SkeletalAnimation"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class");e("thor/core/Validation"),e("./Bone"),e("./Slot"),e("./Skin"),e("./Event"),e("./IkConstraint"),e("./SkeletalAnimation");i.exports=r.create(n,{initialize:function(e){n.prototype.initialize.call(this),this.name="Unknown Skeleton",this.bones=[],this.slots=[],this.skins=[],this.defaultSkin=void 0,this.events=[],this.animations=[],this.ikConstraints=[],this.width=0,this.height=0,this.hash="",this.version="",this.textureAtlas=e},setName:function(e){this.name=e},addBone:function(e){this.bones.push(e)},addIkConstraint:function(e){this.ikConstraints.push(e)},addSlot:function(e){this.slots.push(e)},addSkin:function(e){this.skins.push(e),"default"===e.name&&(this.defaultSkin=e)},addEvent:function(e){this.events.push(e)},addAnimation:function(e){this.animations.push(e)},getBone:function(e){for(var t=0,i=this.bones.length;t<i;++t){var n=this.bones[t];if(n.name===e)return n}return null},getBoneIndex:function(e){for(var t=0,i=this.bones.length;t<i;++t){if(this.bones[t].name===e)return t}return-1},getSlot:function(e){for(var t=0,i=this.slots.length;t<i;++t){var n=this.slots[t];if(n.name===e)return n}return null},getSlotIndex:function(e){for(var t=0,i=this.slots.length;t<i;++t){if(this.slots[t].name===e)return t}return-1},getNumSlots:function(){return this.slots.length},getSkin:function(e){for(var t=0,i=this.skins.length;t<i;++t){var n=this.skins[t];if(n.name===e)return n}return null},getEvent:function(e){for(var t=0,i=this.events.length;t<i;++t){var n=this.events[t];if(n.name===e)return n}return null},getAnimation:function(e){for(var t=0,i=this.animations.length;t<i;++t){var n=this.animations[t];if(n.name===e)return n}return null},getIkConstraint:function(e){for(var t=0,i=this.ikConstraints.length;t<i;++t){var n=this.ikConstraints[t];if(n.name===e)return n}return null}}),i.exports.RESOURCE_TYPE="skeleton"}),define("thor/graphics/resources/LibGDXTextureAtlas",["require","exports","module","thor/core/Class","thor/core/Validation","./TextureRegion","./DOMImageResource","./ThorTextureAtlas"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./TextureRegion"),e("./DOMImageResource"),e("./ThorTextureAtlas"));i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,e),this.__format="RGBA8888",this.__filterU="Linear",this.__filterV="Linear",this.__repeat="none"},addRegion:function(e){var t=e.__x,i=e.__y,n=e.getWidth(),r=e.getHeight();e.setXy(t/this.__width,i/this.__height),e.isRotated()?e.setSize(n/this.__height,r/this.__width):e.setSize(n/this.__width,r/this.__height),this.__regions[e.getName()]=e,e.setAtlasSize(this.__width,this.__height)},setSize:function(e,t){this.__width=+e,this.__height=+t},setFormat:function(e){this.__format=e},setFilter:function(e,t){this.__filterU=e,this.__filterV=t},setRepeat:function(e){this.__repeat=e}}),i.exports.RESOURCE_TYPE="libgdxatlas"}),define("thor/graphics/animation/skeleton/attachment/MeshAttachment",["require","exports","module","thor/core/Class","thor/core/Validation","./Attachment","../../../resources/TextureRegion","./AttachmentType"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./Attachment"),o=(e("../../../resources/TextureRegion"),e("./AttachmentType"));i.exports=n.create(s,{initialize:function(e){s.prototype.initialize.call(this,e,o.MESH),this.vertices=void 0,this.uvs=void 0,this.regionUVs=void 0,this.triangles=void 0,this.regionU=0,this.regionV=0,this.regionU2=0,this.regionV2=0,this.regionRotate=!1,this.regionOffsetX=0,this.regionOffsetY=0,this.regionWidth=0,this.regionHeight=0,this.regionOriginalWidth=0,this.regionOriginalHeight=0,this.color=4294967295,this.hullLength=0,this.width=0,this.height=0,this.region=void 0},setPath:function(e){r.isDefined(e)&&(this.path=e)},setVertices:function(e){this.vertices=e},setTriangles:function(e){this.triangles=e},setRegionUVs:function(e){this.regionUVs=e},setColor:function(e){r.isDefined(e)&&(this.color=e)},setHullLength:function(e){r.isDefined(e)&&(this.hullLength=e)},setWidth:function(e){r.isDefined(e)&&(this.width=e)},setHeight:function(e){r.isDefined(e)&&(this.height=e)},setRegion:function(e){this.region=e,this.regionOffsetX=e.getOffsetX(),this.regionOffsetY=e.getOffsetY(),this.regionWidth=e.getWidth(),this.regionHeight=e.getHeight(),this.regionOriginalWidth=e.getOriginalWidth(),this.regionOriginalHeight=e.getOriginalHeight();var t=e.getUVs();this.regionU=t[0],this.regionV=t[1],this.regionU2=t[0]+t[2],this.regionV2=t[1]+t[3],this.regionRotate=e.isRotated()},updateUVs:function(){var e=this.regionU,t=this.regionV,i=this.regionU2-this.regionU,n=this.regionV2-this.regionV,r=this.regionUVs;void 0!==this.uvs&&this.uvs.length===r.length||(this.uvs=new Float32Array(r.length));var s=this.uvs;if(this.regionRotate)for(var o=0,a=s.length;o<a;o+=2)s[o]=e+r[o+1]*i,s[o+1]=t+n-r[o]*n;else for(var o=0,a=s.length;o<a;o+=2)s[o]=e+r[o]*i,s[o+1]=t+r[o+1]*n},computeWorldVertices:function(e,t){var i=e.bone,n=i.skeleton.x+i.worldX,r=i.skeleton.y+i.worldY,s=i.m00,o=i.m01,a=i.m10,_=i.m11,l=this.vertices,h=l.length;e.attachmentVerticesCount===h&&(l=e.attachmentVertices);for(var u=0;u<h;u+=2){var c=l[u],d=l[u+1];t[u]=c*s+d*o+n,t[u+1]=c*a+d*_+r}return h},getVertexCount:function(){return.5*this.vertices.length}})}),define("thor/graphics/animation/skeleton/BoneInstance",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","./Bone"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Validation");e("./Bone");i.exports=r.create(n,{initialize:function(e,t,r){s.assertIsObject(t),s.ifDefined.assertIsInstanceOf(r,i.exports),n.prototype.initialize.call(this),this.bone=e,this.skeleton=t,this.parent=r,this.children=[],this.x=0,this.y=0,this.rotation=0,this.rotationIK=0,this.scaleX=0,this.scaleY=0,this.flipX=!1,this.flipY=!1,this.m00=0,this.m01=0,this.m10=0,this.m11=0,this.worldX=0,this.worldY=0,this.worldRotation=0,this.worldScaleX=0,this.worldScaleY=0,this.worldFlipX=!1,this.worldFlipY=!1,this.setToSetupPose()},addChild:function(e){this.children.push(e)},updateWorldTransform:function(){var e=this.parent,t=this.x,i=this.y;if(void 0!==e)this.worldX=t*e.m00+i*e.m01+e.worldX,this.worldY=t*e.m10+i*e.m11+e.worldY,this.bone.inheritScale?(this.worldScaleX=e.worldScaleX*this.scaleX,this.worldScaleY=e.worldScaleY*this.scaleY):(this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY),this.worldRotation=this.bone.inheritRotation?e.worldRotation+this.rotationIK:this.rotationIK,this.worldFlipX=e.worldFlipX!==this.flipX,this.worldFlipY=e.worldFlipY!==this.flipY;else{var n=this.skeleton,r=n.flipX,s=n.flipY;this.worldX=r?-t:t,this.worldY=s?-i:i,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldFlipX=r!==this.flipX,this.worldFlipY=s!==this.flipY}var o=this.worldRotation*(Math.PI/180),a=Math.cos(o),_=Math.sin(o);this.worldFlipX?(this.m00=-a*this.worldScaleX,this.m01=_*this.worldScaleY):(this.m00=a*this.worldScaleX,this.m01=-_*this.worldScaleY),this.worldFlipY?(this.m10=-_*this.worldScaleX,this.m11=-a*this.worldScaleY):(this.m10=_*this.worldScaleX,this.m11=a*this.worldScaleY)},setToSetupPose:function(){var e=this.bone;this.x=e.x,this.y=e.y,this.rotation=e.rotation,this.rotationIK=this.rotation,this.scaleX=e.scaleX,this.scaleY=e.scaleY,this.flipX=e.flipX,this.flipY=e.flipY},worldToLocal:function(e,t,i){var n=e-this.worldX,r=t-this.worldY,s=this.m00,o=this.m01,a=this.m10,_=this.m11;this.worldFlipX!==this.worldFlipY&&(s=-s,_=-_);var l=1/(s*_-o*a);i[0]=n*s*l-r*o*l,i[1]=r*_*l-r*a*l},localToWorld:function(e,t,i){i[0]=e*this.m00+t*this.m01+this.worldX,i[1]=e*this.m10+t*this.m11+this.worldY}})}),define("thor/graphics/animation/skeleton/SlotInstance",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","./Slot","./BoneInstance"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class");e("thor/core/Validation"),e("./Slot"),e("./BoneInstance");i.exports=r.create(n,{attachmentName:null,initialize:function(e,t){n.prototype.initialize.call(this),this.slot=e,this.bone=t,this.color=4294967295,this.attachmentVerticesCount=0,this.attachment=null,this.attachmentName=null,this.name=null,this.__slotIndex=this.bone.skeleton.skeleton.slots.indexOf(this.slot),this.setToSetupPose(this.__slotIndex)},getSlotIndex:function(){return this.__slotIndex},setToSetupPose:function(e){this.color=this.slot.color,this.name=this.slot.name,this.slot.attachmentName?(this.attachmentName=this.slot.attachmentName,this.attachment=this.bone.skeleton.getAttachment(e,this.attachmentName)):(this.attachmentName=null,this.attachment=null)},changeAttachment:function(e){null===e?(this.attachmentName=null,this.attachment=null):(this.attachmentName=e,this.attachment=this.bone.skeleton.getAttachment(this.__slotIndex,this.attachmentName))},updateAttachment:function(){this.changeAttachment(this.attachmentName)}})}),define("thor/graphics/animation/skeleton/attachment/RegionAttachment",["require","exports","module","thor/core/Class","thor/core/Validation","./Attachment","../SlotInstance","../../../resources/TextureRegion","./AttachmentType"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./Attachment"),o=(e("../SlotInstance"),e("../../../resources/TextureRegion"),e("./AttachmentType"));i.exports=n.create(s,{initialize:function(e){s.prototype.initialize.call(this,e,o.REGION),this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.width=0,this.height=0,this.regionOffsetX=0,this.regionOffsetY=0,this.regionWidth=0,this.regionHeight=0,this.regionOriginalWidth=0,this.regionOriginalHeight=0,this.offset=new Float32Array(8),this.uvs=new Float32Array(8),this.color=4294967295,this.region=void 0},setPath:function(e){r.isDefined(e)&&(this.path=e)},setX:function(e){r.isDefined(e)&&(this.x=e)},setY:function(e){r.isDefined(e)&&(this.y=e)},setScaleX:function(e){r.isDefined(e)&&(this.scaleX=e)},setScaleY:function(e){r.isDefined(e)&&(this.scaleY=e)},setRotation:function(e){r.isDefined(e)&&(this.rotation=e)},setWidth:function(e){r.isDefined(e)&&(this.width=e)},setHeight:function(e){r.isDefined(e)&&(this.height=e)},setColor:function(e){r.isDefined(e)&&(this.color=e)},setRegion:function(e){this.region=e,this.regionOffsetX=e.getOffsetX(),this.regionOffsetY=e.getOffsetY(),this.regionWidth=e.getWidth(),this.regionHeight=e.getHeight(),this.regionWidth=e.getOriginalWidth(),this.regionHeight=e.getOriginalHeight(),this.regionOriginalWidth=e.getOriginalWidth(),this.regionOriginalHeight=e.getOriginalHeight();var t=e.getUVs(),i=t[0],n=t[5],r=t[4],s=t[1];e.isRotated()?(this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=i,this.uvs[3]=n,this.uvs[4]=i,this.uvs[5]=s,this.uvs[6]=r,this.uvs[7]=s):(this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i,this.uvs[3]=s,this.uvs[4]=r,this.uvs[5]=s,this.uvs[6]=r,this.uvs[7]=n)},updateOffset:function(){var e=this.width,t=this.height,i=this.scaleX,n=this.scaleY,r=e/this.regionOriginalWidth*i,s=t/this.regionOriginalHeight*n,o=.5*-e*i+this.regionOffsetX*r,a=.5*-t*n+this.regionOffsetY*s,_=o+this.regionWidth*r,l=a+this.regionHeight*s,h=this.rotation*(Math.PI/180),u=Math.cos(h),c=Math.sin(h),d=this.x,g=this.y,p=o*u+d,m=o*c,f=a*u+g,v=a*c,y=_*u+d,E=_*c,S=l*u+g,T=l*c,C=this.offset;C[0]=p-v,C[1]=f+m,C[2]=p-T,C[3]=S+m,C[4]=y-T,C[5]=S+E,C[6]=y-v,C[7]=f+E},computeWorldVertices:function(e,t){var i=e.bone,n=i.skeleton.x+i.worldX,r=i.skeleton.y+i.worldY,s=i.m00,o=i.m01,a=i.m10,_=i.m11,l=this.offset;return t[0]=l[0]*s+l[1]*o+n,t[1]=l[0]*a+l[1]*_+r,t[2]=l[2]*s+l[3]*o+n,t[3]=l[2]*a+l[3]*_+r,t[4]=l[4]*s+l[5]*o+n,t[5]=l[4]*a+l[5]*_+r,t[6]=l[6]*s+l[7]*o+n,t[7]=l[6]*a+l[7]*_+r,4},getVertexCount:function(){return 4}})}),define("thor/graphics/animation/skeleton/attachment/SkinnedMeshAttachment",["require","exports","module","thor/core/Class","thor/core/Validation","./Attachment","../../../resources/TextureRegion","./AttachmentType"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./Attachment"),o=(e("../../../resources/TextureRegion"),e("./AttachmentType"));i.exports=n.create(s,{initialize:function(e){s.prototype.initialize.call(this,e,o.SKINNED_MESH),this.bones=[],this.weights=[],this.vertices=[],this.uvs=[],this.region=void 0,this.regionUVs=[],this.regionOffsetX=0,this.regionOffsetY=0,this.regionWidth=0,this.regionHeight=0,this.regionOriginalWidth=0,this.regionOriginalHeight=0,this.color=4294967295,this.hullLength=0,this.vertexCount=0},setPath:function(e){r.isDefined(e)&&(this.path=e)},setBones:function(e){this.bones=e},setWeights:function(e){this.weights=e},setTriangles:function(e){this.triangles=e},setVertices:function(e){this.vertices=e},setRegionUVs:function(e){this.regionUVs=e},setColor:function(e){r.isDefined(e)&&(this.color=e)},setHullLength:function(e){r.isDefined(e)&&(this.hullLength=e)},setWidth:function(e){r.isDefined(e)&&(this.width=e)},setHeight:function(e){r.isDefined(e)&&(this.height=e)
},setVertexCount:function(e){this.vertexCount=e},setRegion:function(e){this.region=e,this.regionOffsetX=e.getOffsetX(),this.regionOffsetY=e.getOffsetY(),this.regionWidth=e.getWidth(),this.regionHeight=e.getHeight(),this.regionOriginalWidth=e.getOriginalWidth(),this.regionOriginalHeight=e.getOriginalHeight();var t=e.getUVs();this.regionU=t[0],this.regionV=t[1],this.regionU2=t[0]+t[2],this.regionV2=t[1]+t[3],this.regionRotate=e.isRotated()},updateUVs:function(){var e=this.regionU,t=this.regionV,i=this.regionU2-this.regionU,n=this.regionV2-this.regionV,r=this.regionUVs;void 0!==this.uvs&&this.uvs.length===r.length||(this.uvs=new Float32Array(r.length));var s=this.uvs;if(this.regionRotate)for(var o=0,a=s.length;o<a;o+=2)s[o]=e+r[o+1]*i,s[o+1]=t+n-r[o]*n;else for(var o=0,a=s.length;o<a;o+=2)s[o]=e+r[o]*i,s[o+1]=t+r[o+1]*n},computeWorldVertices:function(e,t){var i=e.bone.skeleton,n=i.bones,r=i.x,s=i.y,o=this.weights,a=this.bones,_=this.vertices,l=0;if(0!==e.attachmentVerticesCount)throw new Error("Slot attachment vertices are not supported!");for(var h=0,u=a.length,c=0;h<u;l+=2){for(var d=a[h],g=r,p=s,m=1;m<=d;++m,++c){var f=n[a[h+m]],v=_[2*c],y=_[2*c+1],E=o[c];0!==E&&(g+=(v*f.m00+y*f.m01+f.worldX)*E,p+=(v*f.m10+y*f.m11+f.worldY)*E)}h+=d+1,t[l]=g,t[l+1]=p}return l},getVertexCount:function(){return.5*this.uvs.length}})}),define("thor/graphics/animation/skeleton/attachment/BoundingBoxAttachment",["require","exports","module","thor/core/Class","./Attachment","./AttachmentType","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class"),r=e("./Attachment"),s=e("./AttachmentType");e("thor/core/Validation");i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,e,s.BOUNDING_BOX),this.vertices=[]},setVertices:function(e){this.__vertices=e}})}),define("thor/graphics/animation/skeleton/attachment/AttachmentFactory",["require","exports","module","thor/core/Validation","thor/core/Logger","../../../resources/LibGDXTextureAtlas","./MeshAttachment","./RegionAttachment","./SkinnedMeshAttachment","./BoundingBoxAttachment"],function(e,t,i){var n=(e("thor/core/Validation"),e("thor/core/Logger").getLogger(i)),r=(e("../../../resources/LibGDXTextureAtlas"),e("./MeshAttachment")),s=e("./RegionAttachment"),o=e("./SkinnedMeshAttachment"),a=e("./BoundingBoxAttachment");i.exports={createRegionAttachment:function(e,t,i,r){var o=new s(t),a=r.getRegion(i);return a?(o.setRegion(a),o):(n.warn("Missing texture region "+i+" for attachment "+t),null)},createMeshAttachment:function(e,t,i,n){var s=new r(t),o=n.getRegion(i);return o?(s.setRegion(o),s):null},createSkinnedMeshAttachment:function(e,t,i,n){var r=new o(t),s=n.getRegion(i);return s?(r.setRegion(s),r):null},createBoundingBoxAttachment:function(e,t){return new a(t)},createEntityAttachment:function(e){return new EntityAttachment(e)}}}),define("thor/graphics/animation/skeleton/timeline/Timeline",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class");e("thor/core/Validation");i.exports=r.create(n,{initialize:function(e){n.prototype.initialize.call(this),this.frameCount=e},applyTimeline:function(e,t,i,n,r){throw new Error("Timeline is abstract!")},findFrameIndex:function(e,t,i){var n=0,r=e.length/i-2;if(0===r)return i;for(var s=r>>1;;){if(e[(s+1)*i]<=t?n=s+1:r=s,n===r)return(n+1)*i;s=n+r>>1}}})}),define("thor/graphics/animation/skeleton/timeline/CurveTimeline",["require","exports","module","thor/core/Class","thor/core/Validation","./Timeline"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Timeline"));i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,e),this.curves=new Float32Array(19*(e-1))},setLinear:function(e){this.curves[19*e]=0},setStepped:function(e){this.curves[19*e]=1},setCurve:function(e,t,i,n,r){var s=.1*.1*.1,o=.1*.1*3,a=.1*.1*6,_=6*s,l=2*-t+n,h=2*-i+r,u=3*(t-n)+1,c=3*(i-r)+1,d=t*(3*.1)+l*o+u*s,g=i*(3*.1)+h*o+c*s,p=l*a+u*_,m=h*a+c*_,f=u*_,v=c*_,y=19*e,E=this.curves;E[y++]=2;for(var S=d,T=g,C=y+19-1;y<C;y+=2)E[y]=S,E[y+1]=T,d+=p,g+=m,p+=f,m+=v,S+=d,T+=g},getCurvePercent:function(e,t){var i=this.curves,n=19*e,r=i[n];if(0===r)return t;if(1===r)return 0;++n;for(var s=0,o=n,a=n+19-1;n<a;n+=2)if((s=i[n])>=t){var _,l;return n===o?(_=0,l=0):(_=i[n-2],l=i[n-1]),l+(i[n+1]-l)*(t-_)/(s-_)}var h=i[n-1];return h+(1-h)*(t-s)/(1-s)},getCurveType:function(e){return this.curves[19*e]}})}),define("thor/graphics/animation/skeleton/timeline/ColorTimeline",["require","exports","module","thor/core/Class","thor/core/Validation","thor/math/ColorUtil","./CurveTimeline"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/math/ColorUtil")),s=e("./CurveTimeline");i.exports=n.create(s,{initialize:function(e){s.prototype.initialize.call(this,e),this.slotIndex=void 0,this.frames=new Float32Array(5*e)},applyTimeline:function(e,t,i,n,s){var o=this.frames;if(!(i<o[0])){var a,_,l,h;if(i>=o[o.length+-5])a=o[o.length-4],_=o[o.length-3],l=o[o.length-2],h=o[o.length-1];else{var u=this.findFrameIndex(o,i,5),c=o[u-4],d=o[u-3],g=o[u-2],p=o[u-1],m=o[u],f=1-(i-m)/(o[u+-5]-m);f=this.getCurvePercent(u/5-1,f<0?0:f>1?1:f),a=c+f*(o[u+1]-c)&255,_=d+f*(o[u+2]-d)&255,l=g+f*(o[u+3]-g)&255,h=p+f*(o[u+4]-p)&255}var v=e.slots[this.slotIndex];v.color=s<1?(((v.color>>24&255)*(1-s)+a*s&255)<<24)+(((v.color>>16&255)*(1-s)+_*s&255)<<16)+(((v.color>>8&255)*(1-s)+l*s&255)<<8)+((255&v.color)*(1-s)+h*s&255):r.createRGBA(a,_,l,h)}},setSlotIndex:function(e){this.slotIndex=e},setFrame:function(e,t,i,n,r,s){this.frames[5*e]=t,this.frames[5*e+1]=i,this.frames[5*e+2]=n,this.frames[5*e+3]=r,this.frames[5*e+4]=s}})}),define("thor/graphics/animation/skeleton/timeline/ScaleTimeline",["require","exports","module","thor/core/Class","thor/core/Validation","./CurveTimeline"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./CurveTimeline"));i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,e),this.boneIndex=0,this.frames=new Float32Array(3*e)},applyTimeline:function(e,t,i,n,r){var s=this.frames;if(!(i<s[0])){var o=e.bones[this.boneIndex];if(i>=s[s.length-3])return o.scaleX+=(o.bone.scaleX*s[s.length-2]-o.scaleX)*r,void(o.scaleY+=(o.bone.scaleY*s[s.length-1]-o.scaleY)*r);var a=this.findFrameIndex(s,i,3),_=s[a-2],l=s[a-1],h=s[a],u=1-(i-h)/(s[a+-3]-h);u=this.getCurvePercent(a/3-1,u<0?0:u>1?1:u),o.scaleX+=(o.bone.scaleX*(_+(s[a+1]-_)*u)-o.scaleX)*r,o.scaleY+=(o.bone.scaleY*(l+(s[a+2]-l)*u)-o.scaleY)*r}},setBoneIndex:function(e){this.boneIndex=e},setFrame:function(e,t,i,n){this.frames[3*e]=t,this.frames[3*e+1]=i,this.frames[3*e+2]=n}})}),define("thor/graphics/animation/skeleton/timeline/FlipXTimeline",["require","exports","module","thor/core/Class","thor/core/Validation","./Timeline"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Timeline"));i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,e),this.boneIndex=0,this.frames=new Float32Array(3*e)},applyTimeline:function(e,t,i,n,r){},setBoneIndex:function(e){this.boneIndex=e},setFrame:function(e,t,i){this.frames[2*e]=t,this.frames[2*e+1]=i?1:0}})}),define("thor/graphics/animation/skeleton/timeline/FlipYTimeline",["require","exports","module","thor/core/Class","thor/core/Validation","./Timeline"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Timeline"));i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,e),this.boneIndex=0,this.frames=new Float32Array(3*e)},applyTimeline:function(e,t,i,n,r){},setBoneIndex:function(e){this.boneIndex=e},setFrame:function(e,t,i){this.frames[2*e]=t,this.frames[2*e+1]=i?1:0}})}),define("thor/graphics/animation/skeleton/timeline/RotateTimeline",["require","exports","module","thor/core/Class","thor/core/Validation","./CurveTimeline"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./CurveTimeline"));i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,e),this.boneIndex=0,this.frames=new Float32Array(2*e)},applyTimeline:function(e,t,i,n,r){var s=this.frames;if(!(i<s[0])){var o,a=e.bones[this.boneIndex];if(i>=s[s.length-2]){for(o=a.bone.rotation+s[s.length-1]-a.rotation;o>180;)o-=360;for(;o<-180;)o+=360;return void(a.rotation+=o*r)}var _=this.findFrameIndex(s,i,2),l=s[_-1],h=s[_],u=1-(i-h)/(s[_+-2]-h);for(u=this.getCurvePercent((_>>1)-1,u<0?0:u>1?1:u),o=s[_+1]-l;o>180;)o-=360;for(;o<-180;)o+=360;for(o=a.bone.rotation+(l+o*u)-a.rotation;o>180;)o-=360;for(;o<-180;)o+=360;a.rotation+=o*r}},setBoneIndex:function(e){this.boneIndex=e},setFrame:function(e,t,i){this.frames[2*e]=t,this.frames[2*e+1]=i}})}),define("thor/graphics/animation/skeleton/timeline/TranslateTimeline",["require","exports","module","thor/core/Class","thor/core/Validation","./CurveTimeline"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./CurveTimeline"));i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,e),this.boneIndex=0,this.frames=new Float32Array(3*e)},applyTimeline:function(e,t,i,n,r){var s=this.frames;if(!(i<s[0])){var o=e.bones[this.boneIndex];if(i>=s[s.length-3])return o.x+=(o.bone.x+s[s.length-2]-o.x)*r,void(o.y+=(o.bone.y+s[s.length-1]-o.y)*r);var a=this.findFrameIndex(s,i,3),_=s[a-2],l=s[a-1],h=s[a],u=1-(i-h)/(s[a+-3]-h);u=this.getCurvePercent(a/3-1,u<0?0:u>1?1:u),o.x+=(o.bone.x+_+(s[a+1]-_)*u-o.x)*r,o.y+=(o.bone.y+l+(s[a+2]-l)*u-o.y)*r}},setBoneIndex:function(e){this.boneIndex=e},setFrame:function(e,t,i,n){this.frames[3*e]=t,this.frames[3*e+1]=i,this.frames[3*e+2]=n}})}),define("thor/graphics/animation/skeleton/timeline/AttachmentTimeline",["require","exports","module","thor/core/Class","thor/core/Validation","./Timeline"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Timeline"));i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,e),this.slotIndex=0,this.frames=new Float32Array(e),this.attachmentNames=new Array(e)},applyTimeline:function(e,t,i,n,r){var s=e.slots[this.slotIndex];if(s&&!(this.frames.length<=0)&&!(i<this.frames[0])){var o=this.frames.length>1?this.findFrameIndex(this.frames,i,1):0,a=s.attachmentName;this.frames[o]>i&&(o-=1);var _=this.attachmentNames[o];_!==a&&s.changeAttachment(_)}},setSlotIndex:function(e){this.slotIndex=e},setFrame:function(e,t,i){this.frames[e]=t,this.attachmentNames[e]=i}})}),define("thor/graphics/animation/skeleton/IkConstraintInstance",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","./IkConstraint"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Validation");e("./IkConstraint");i.exports=r.create(n,{initialize:function(e,t){s.assertIsObject(t),n.prototype.initialize.call(this),this.constraint=e,this.skeleton=t}})}),define("thor/graphics/animation/skeleton/SkeletonInstance",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","thor/core/Logger","./BoneInstance","./SlotInstance","./SkeletonResource","./IkConstraintInstance"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Validation"),o=e("thor/core/Logger").getLogger(i),a=e("./BoneInstance"),_=e("./SlotInstance"),l=(e("./SkeletonResource"),e("./IkConstraintInstance"));i.exports=r.create(n,{initialize:function(e){n.prototype.initialize.call(this),this.color=4294967295,this.time=0,this.flipX=!1,this.flipY=!0,this.x=0,this.y=0,this.skeleton=e,this.resetSkin(),this.bones=[];for(var t=0,i=e.bones.length;t<i;++t){var r=e.bones[t],s=void 0===r.parent?void 0:this.bones[e.bones.indexOf(r.parent)],o=new a(r,this,s);s&&s.addChild(o),this.bones.push(o)}this.slots=[],this.drawOrder=[];for(var t=0,i=e.slots.length;t<i;++t){var h=e.slots[t],o=this.bones[e.bones.indexOf(h.bone)],u=new _(h,o);this.slots.push(u),this.drawOrder.push(u)}this.ikConstraints=[];for(var t=0,i=e.ikConstraints.length;t<i;++t){var c=e.ikConstraints[t];this.ikConstraints.push(new l(c,this))}},setSkin:function(e,t){s.isBoolean(t)||(t=!0);var i=this.skeleton.getSkin(e);if(null===i)return void o.warn("Invalid skin "+e+" in skeleton instance:",this);this.skin=i,t?(this.skins.length=1,this.skins[0]=i):this.skins.push(i),this.__updateAttachments()},addSkin:function(e){this.setSkin(e,!1)},removeSkin:function(e){for(var t=0,i=this.skins.length;t<i;++t){if(this.skins[t].name===e)return 1===this.skins.length?void this.setDefaultSkin():(this.skins.splice(t,1),this.skin=this.skins[this.skins.length-1],void this.__updateAttachments())}},setDefaultSkin:function(){this.skin=null,this.skins.length=0,this.__updateAttachments()},__updateAttachments:function(){for(var e=0,t=this.slots.length;e<t;++e){this.slots[e].updateAttachment()}},updateWorldTransform:function(){for(var e=this.bones,t=0,i=e.length;t<i;++t){var n=e[t];n.rotationIK=n.rotation,n.updateWorldTransform()}},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var e=this.bones,t=0,i=e.length;t<i;++t)e[t].setToSetupPose()},setSlotsToSetupPose:function(){var e=this.slots;this.drawOrder.length=0;for(var t=0,i=e.length;t<i;++t)this.drawOrder.push(e[t]),e[t].setToSetupPose(t)},getAttachment:function(e,t){for(var i=this.skins.length,n=i-1;n>=0;--n){var r=this.skins[n],s=r.getAttachment(e,t);if(s)return s}if(this.skeleton.defaultSkin)return this.skeleton.defaultSkin.getAttachment(e,t)},getSlotInstanceByName:function(e){for(var t=this.slots,i=0,n=t.length;i<n;++i)if(t[i].slot.name===e)return t[i]},resetSkin:function(){if(this.skin=null,this.skeleton.skins.length>1){var e=this.skeleton.skins;this.skin=e[1];for(var t=2,i=e.length;t<i;++t){if("Base"===e[t].name){this.skin=e[t];break}}}this.skins=[],this.skin&&this.skins.push(this.skin)}})}),define("thor/graphics/animation/skeleton/SkeletonEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","./SkeletonInstance","./Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event"),s=e("./SkeletonInstance"),o=e("./Event");i.exports=r.generateEventClass("SkeletonEvent",3490520593,{skeleton:n.generate(n.assertIsInstanceOf,s),event:n.generate(n.assertIsInstanceOf,o),context:n.generate(n.assertIsInstanceOf,Object)})}),define("thor/graphics/animation/skeleton/timeline/EventTimeline",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/EventManager","./Timeline","../SkeletonEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/event/EventManager"),e("./Timeline")),s=e("../SkeletonEvent");i.exports=n.create(r,{initialize:function(e,t){r.prototype.initialize.call(this,e),this.frames=new Float32Array(e),this.eventNames=[],this.__eventManager=t},applyTimeline:function(e,t,i,n,r,s){if(i!==t&&!(this.frames.length<=0||i<this.frames[0])){if(1===this.frames.length)return void(this.frames[0]>=t&&this.frames[0]<i&&this.__dispatchEvent(e,e.skeleton.getEvent(this.eventNames[0]),s));for(var o=0;o<this.frames.length;++o)if(!(this.frames[o]<t)){if(this.frames[o]>i)break;this.__dispatchEvent(e,e.skeleton.getEvent(this.eventNames[o]),s)}}},setFrame:function(e,t,i){this.frames[e]=t,this.eventNames[e]=i},__dispatchEvent:function(e,t,i){var n=this.__eventManager.getNewEvent(s);n.setSkeleton(e),n.setEvent(t),n.setContext(i),this.__eventManager.queueEvent(n)}})}),define("thor/graphics/animation/skeleton/timeline/DrawOrderTimeline",["require","exports","module","thor/core/Class","thor/core/Validation","./Timeline"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Timeline"));i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,e),this.frames=new Float32Array(e),this.drawOrders=new Array(e)},applyTimeline:function(e,t,i,n,r,s){if(i!==t){var o=0;this.frames.length>1&&i>this.frames[1]&&(o=this.findFrameIndex(this.frames,i,1));var a=e.drawOrder,_=e.slots,l=this.drawOrders[o];if(l)for(var h=0;h<l.length;++h)a[h]=_[l[h]];else{a.length=_.length;for(var h=0;h<_.length;++h)a[h]=_[h]}}},setFrame:function(e,t,i){this.frames[e]=t,this.drawOrders[e]=i}})}),define("thor/graphics/animation/skeleton/SkeletonLoader",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","thor/event/EventManager","thor/util/Network","thor/util/StringUtil","../../resources/LibGDXTextureAtlas","../../resources/ThorTextureAtlas","./Bone","./Slot","./Skin","./Event","./SkeletonResource","./SkeletalAnimation","./IkConstraint","./attachment/AttachmentType","./attachment/AttachmentFactory","./timeline/Timeline","./timeline/ColorTimeline","./timeline/ScaleTimeline","./timeline/FlipXTimeline","./timeline/FlipYTimeline","./timeline/RotateTimeline","./timeline/TranslateTimeline","./timeline/AttachmentTimeline","./timeline/EventTimeline","./timeline/DrawOrderTimeline"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Validation"),o=(e("thor/event/EventManager"),e("thor/util/Network")),a=e("thor/util/StringUtil"),_=(e("../../resources/LibGDXTextureAtlas"),e("../../resources/ThorTextureAtlas"),e("./Bone")),l=e("./Slot"),h=e("./Skin"),u=e("./Event"),c=e("./SkeletonResource"),d=e("./SkeletalAnimation"),g=e("./IkConstraint"),p=e("./attachment/AttachmentType"),m=e("./attachment/AttachmentFactory"),f=(e("./timeline/Timeline"),e("./timeline/ColorTimeline")),v=e("./timeline/ScaleTimeline"),y=e("./timeline/FlipXTimeline"),E=e("./timeline/FlipYTimeline"),S=e("./timeline/RotateTimeline"),T=e("./timeline/TranslateTimeline"),C=e("./timeline/AttachmentTimeline"),I=e("./timeline/EventTimeline"),w=e("./timeline/DrawOrderTimeline");i.exports=r.create(n,{initialize:function(e){s.ifDefined.assertIsNonEmptyString(e),n.prototype.initialize.call(this),this.__atlasPrefix=e||""},loadSkeleton:function(e,t,i){var n=this;return o.getJSON(e).then(function(r){return n.buildSkeleton(e,r,t,i)})},buildSkeleton:function(e,t,i,n){var r=new c(i);r.setName(e);var s=t.skeleton;s&&(r.hash=s.hash,r.version=s.spine,r.width=s.width,r.height=s.height);for(var o=t.bones,d=0,p=o.length;d<p;++d){var m=o[d],f=m.parent,v=void 0;if(f&&!(v=r.getBone(f)))throw new Error("Parent bone "+f+" not found for bone "+m.name);var y=new _(m.name,v);y.setLength(m.length),y.setX(m.x),y.setY(m.y),y.setRotation(m.rotation),y.setScaleX(m.scaleX),y.setScaleY(m.scaleY),y.setFlipX(m.flipX),y.setFlipY(m.flipY),y.setInheritScale(m.inheritScale),y.setInheritRotation(m.inheritRotation),m.color&&y.setColor(a.toHex(m.color)),r.addBone(y)}var E=t.ik;if(E)for(var d=0,p=E.length;d<p;++d){for(var S=E[d],T=new g(S.name),o=S.bones,C=0,I=o.length;C<I;++C){var w=o[C],y=r.getBone(w);if(!y)throw new Error("Cannot find bone "+w+" for ik constraint "+S.name);T.addBone(y)}var b=S.target,M=r.getBone(b);if(!M)throw new Error("Cannot find bone "+b+" which is the target of ik constraint "+S.name);T.setTarget(M),T.setBendDirection(S.bendPositive),T.setMix(S.mix),r.addIkConstraint(T)}var x=t.slots;if(x)for(var d=0,p=x.length;d<p;++d){var R=x[d],P=R.name,w=R.bone,y=r.getBone(w);if(!y)throw new Error("Cannot find bone "+w+" for slot "+P);var A=new l(P,y);R.color&&A.setColor(a.toHex(R.color)),A.setAttachmentName(R.attachment),A.setBlendMode(R.blend),r.addSlot(A)}var N=t.skins;if(N)for(var D in N){var L=N[D],O=new h(D);for(var P in L){var R=L[P],V=r.getSlotIndex(P);for(var B in R){var k=R[B],W=this.buildAttachment(O,B,k,i);W&&O.addAttachment(V,B,W)}}r.addSkin(O)}var F=t.events;if(F)for(var U in F){var G=F[U],H=new u(U);H.setIntValue(G.int),H.setFloatValue(G.float),H.setStringValue(G.string),r.addEvent(H)}var q=t.animations;if(q)for(var Y in q){var z=q[Y],X=this.buildAnimation(r,Y,z,n);r.addAnimation(X)}return r},buildAttachment:function(e,t,i,n){s.isNonEmptyString(i.name)&&(t=i.name);var r=p.REGION;s.isNonEmptyString(i.type)&&(r=i.type);var o=t;switch(s.isNonEmptyString(i.path)&&(o=i.path),o=this.__atlasPrefix+o,r){case p.REGION:var _=m.createRegionAttachment(e,t,o,n);return null===_?null:(_.setPath(o),_.setX(i.x),_.setY(i.y),_.setScaleX(i.scaleX),_.setScaleY(i.scaleY),_.setRotation(i.rotation),_.setWidth(i.width),_.setHeight(i.height),i.color&&_.setColor(a.toHex(i.color)),_.updateOffset(),_);case p.MESH:var _=m.createMeshAttachment(e,t,o,n);return null===_?null:(_.setPath(o),_.setVertices(i.vertices),_.setTriangles(i.triangles),_.setRegionUVs(i.uvs),i.color&&_.setColor(a.toHex(i.color)),_.setHullLength(2*i.hull),_.setWidth(i.width),_.setHeight(i.height),_.updateUVs(),_);case p.SKINNED_MESH:var _=m.createSkinnedMeshAttachment(e,t,o,n);if(null===_)return null;_.setPath(o);for(var l=i.uvs,h=i.vertices,u=[],c=[],d=[],g=0,f=h.length,v=0;g<f;){var y=h[g];d.push(y),++v,++g;for(var E=0;E<y;++E)d.push(h[g]),u.push(h[g+1]),u.push(h[g+2]),c.push(h[g+3]),g+=4}return _.setBones(d),_.setVertices(u),_.setWeights(c),_.setTriangles(i.triangles),_.setRegionUVs(l),_.setVertexCount(v),i.color&&_.setColor(a.toHex(i.color)),_.setHullLength(2*i.hull),_.setWidth(i.width),_.setHeight(i.height),_.updateUVs(),_;case p.BOUNDING_BOX:var _=m.createBoundingBoxAttachment(e,t);return null===_?null:(_.setVertices(i.vertices),_)}return null},buildAnimation:function(e,t,i,n){var r=[],s=0,o=i.slots;if(o)for(var _ in o){var l=e.getSlotIndex(_),h=o[_];for(var u in h){var c=h[u];switch(u){case"color":var g=new f(c.length);g.setSlotIndex(l);for(var p=0,m=c.length;p<m;++p){var b=c[p].time,M=a.toHex(c[p].color,0,8);g.setFrame(p,b,M>>24&255,M>>16&255,M>>8&255,255&M),this.buildCurve(g,p,c[p])}r.push(g),s=Math.max(s,g.frames[5*g.frameCount-5]);break;case"attachment":var g=new C(c.length);g.setSlotIndex(l);for(var p=0,m=c.length;p<m;++p){var b=c[p].time,x=c[p].name;g.setFrame(p,b,x)}r.push(g),s=Math.max(s,g.frames[g.frameCount-1]);break;default:throw new Error("Invalid timeline type "+u+" for slot "+_+" in animation "+t)}}}var R=i.bones;if(R)for(var P in R){var A=e.getBoneIndex(P);if(-1===A)throw new Error("Invalid bone "+P+" for animation "+t);var g,h=R[P];for(var u in h){var c=h[u];switch(u){case"rotate":g=new S(c.length),g.setBoneIndex(A);for(var p=0,m=c.length;p<m;++p){var b=c[p].time,N=c[p].angle;g.setFrame(p,b,N),this.buildCurve(g,p,c[p])}r.push(g),s=Math.max(s,g.frames[2*g.frameCount-2]);break;case"translate":case"scale":g="translate"===u?new T(c.length):new v(c.length),g.setBoneIndex(A);for(var p=0,m=c.length;p<m;++p){var b=c[p].time,D=c[p].x||0,L=c[p].y||0;g.setFrame(p,b,D,L),this.buildCurve(g,p,c[p])}r.push(g),s=Math.max(s,g.frames[3*g.frameCount-3]);break;case"flipX":case"flipY":g="flipX"===u?new y(c.length):new E(c.length),g.setBoneIndex(A);for(var O="flipX"===u?"x":"y",p=0,m=c.length;p<m;++p){var b=c[p].time,V=c[p][O]||!1;g.setFrame(p,b,V)}r.push(g),s=Math.max(s,g.frames[2*g.frameCount-2]);break;default:throw new Error("Invalid timeline type "+u+" for bone "+P+" in animation "+t)}}}var B=(i.ik,i.ffd,i.draworder||i.drawOrder);if(B){for(var g=new w(B.length),k=e.getNumSlots(),W=0;W<B.length;++W){var F=B[W],U=[];U.length=k;for(var p=0;p<k;++p)U[p]=-1;var G=F.offsets,H=[],q=0,Y=0;if(G)for(var p=0;p<G.length;++p){var z=G[p],l=e.getSlotIndex(z.slot);if(l===-1)throw new Error("Unknown slot named "+z.slot);for(;q!==l;)H[Y++]=q++;var X=q+z.offset;U[X]=q++}for(;q<k;)H[Y++]=q++;for(var p=k-1;p>=0;p--)U[p]===-1&&(U[p]=H[--Y]);g.setFrame(W,F.time,U)}r.push(g),s=Math.max(s,g.frames[g.frameCount-1])}var K=i.events;if(K){for(var g=new I(K.length,n),p=0,m=K.length;p<m;++p)g.setFrame(p,K[p].time,K[p].name);r.push(g),s=Math.max(s,g.frames[g.frameCount-1])}return new d(t,r,s)},buildCurve:function(e,t,i){if(i.curve){var n=i.curve;"stepped"===n?e.setStepped(t):e.setCurve(t,n[0],n[1],n[2],n[3])}}})}),define("thor/graphics/resources/SkeletonResourceLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/EventManager","./ThorTextureAtlas","thor/util/JSONLoader","thor/resources/ResourceLoader","thor/graphics/animation/skeleton/SkeletonLoader","thor/graphics/animation/skeleton/SkeletonResource"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=(e("thor/event/EventManager"),e("./ThorTextureAtlas")),o=e("thor/util/JSONLoader"),a=e("thor/resources/ResourceLoader"),_=e("thor/graphics/animation/skeleton/SkeletonLoader"),l=e("thor/graphics/animation/skeleton/SkeletonResource"),h=[l.RESOURCE_TYPE];i.exports=n.create(a,{initialize:function(e,t){a.prototype.initialize.call(this,h),this.__resourceManager=e,this.__eventManager=t},guid:function(e,t,i,n){return r.ifDefined.assertIsNonEmptyString(n),"spine::"+t},load:function(e,t,i,n,a){r.ifDefined.assertIsNonEmptyString(n),r.ifDefined.assertIsNonEmptyString(a);var l=this;return a=a||s.RESOURCE_TYPE,Promise.all([this.__resourceManager.loader(a).load(e,i),this.__resourceManager.loader(o.RESOURCE_TYPE).load(e,t)]).then(function(e){var i=e[0],r=e[1];return new _(n).buildSkeleton(t,r,i,l.__eventManager)})}})}),define("events/LevelUpEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("LevelUpEvent",3533353527,{arrRewards:n.assertIsArray})}),define("events/GameBoundsEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("GameBounds",3907824552,{width:n.assertIsNumber,height:n.assertIsNumber,canvasWidth:n.assertIsNumber})}),define("events/InputEndedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));i.exports=n.generateEventClass("InputEndedEvent",314794921,{},!0)}),define("events/InputMovedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("InputMovedEvent",3755029831,{xPercent:n.assertIsNumber,yPercent:n.assertIsNumber,resetRelativeLocation:n.assertIsBoolean},!0)}),define("events/InputStartedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));i.exports=n.generateEventClass("InputStartedEvent",1876601568,{},!0)}),define("events/InputActivateEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));i.exports=n.generateEventClass("InputActivateEvent",3533501213,{},!0)}),define("thor/core/Enum",["require","exports","module","./Validation"],function(e,t,i){e("./Validation");i.exports={create:function(e,t){var i={},n=[],r=[];for(var s in t)i[s]=t[s],r.push(t[s]),n.push(s);return i.nameFromValue=function(e){for(var t in this)if(this[t]===e)return t;return null},i.toString=function(e){var t=this.nameFromValue(e);if(null==t)throw new Error("Invalid enum value: "+e);return t},i.getName=function(){return e},i.getFields=function(){return n},i.getSortedFields=function(){return n.sort(function(e,t){return i[e]-i[t]})},i.getValues=function(){return r},i.getOrdinal=function(e){return r.indexOf(e)},i}}}),define("KeyboardInputEnum",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum");i.exports=n.create("KeyboardInputEnum",{ACTIVATE:0,UP:1,DOWN:2,LEFT:3,RIGHT:4})}),define("events/KeyboardInputEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation","KeyboardInputEnum"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));e("thor/core/Validation"),e("KeyboardInputEnum");i.exports=n.generateEventClass("KeyboardInputEvent",3486419771,{keyPressed:function(e){}})}),define("events/GameResetEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("GameResetEvent",2322317934,{isPlayingImmediately:n.ifDefined.assertIsBoolean})}),define("thor/entity/AnimatedSpriteComponent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/webgl/Texture","thor/graphics/resources/TextureRegionResource","thor/graphics/resources/AnimatedSpriteResource","./SceneComponent","./EntityComponent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/webgl/Texture")),s=(e("thor/graphics/resources/TextureRegionResource"),e("thor/graphics/resources/AnimatedSpriteResource"),e("./SceneComponent")),o=e("./EntityComponent");i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__animatedSprite=null,this.__extents=new Float32Array(2),this.__frameIndex=0,this.__elapsedTimeMS=0,this.__framePeriodMS=0,this.__onLoopCallback=void 0,this.__maxLoopCount=1/0,this.__loopCount=0,this.__textureOptions={},this.__textures=[],this.__holdOnLastFrame=!1,this.__showing=!0,this.__playing=!0},getType:function(){return"AnimatedSpriteComponent"},reset:function(){s.prototype.reset.call(this),this.__elapsedTimeMS=0,this.__loopCount=0},clone:function(e){s.prototype.clone.call(this,e),e.setAnimatedSprite(this.__animatedSprite),e.__extents.set(this.__extents),e.__frameIndex=this.__frameIndex,e.__onLoopCallback=this.__onLoopCallback,e.__maxLoopCount=this.__maxLoopCount,e.__holdOnLastFrame=this.__holdOnLastFrame,e.__showing=this.__showing,e.__playing=this.__playing},setAnimatedSprite:function(e){this.__animatedSprite=e,this.__framePeriodMS=1e3/this.__animatedSprite.getFramesPerSecond(),this.__frameIndex=0,this.__elapsedTimeMS=0,this.__loopCount=0;var t=e.getFrameAtIndex(0),i=t.getWidth(),n=t.getHeight();this._dpBoundingBox.width=i,this._dpBoundingBox.height=n,this.__textures.length=0},getFrameDimensions:function(e){var t=this.__animatedSprite.getFrameAtIndex(0);e[0]=t.getWidth(),e[1]=t.getHeight()},_initWebGL:function(e){this.__animatedSprite&&this.__recomputeTextures(e)},__recomputeTextures:function(e){var t=this.__animatedSprite.getFrames(),i=t[0],n=i.textureFilter;if(n){var s=e.gl[n];this.__textureOptions.minFilter=s,this.__textureOptions.magFilter=s}for(var o=0;o<t.length;++o)this.__textures[o]=r.getTextureFromDomImage(e,t[o].image.getDOMElement(),this.__textureOptions)},setOnLoopCallback:function(e){this.__onLoopCallback=e},clearOnLoopCallback:function(){this.__onLoopCallback=void 0},setLoopCount:function(e){this.__maxLoopCount=e},setHoldOnLastFrame:function(e){this.__holdOnLastFrame=e},play:function(){this.__playing=!0},pause:function(){this.__playing=!1},stop:function(){this.__playing=!1,this.__holdOnLastFrame?this.__frameIndex=this.__animatedSprite.getFrames().length-1:this.__frameIndex=0,this.__loopCount=0,this.__elapsedTimeMS=0},restart:function(){this.__playing=!0,this.__frameIndex=0,this.__loopCount=0,this.__elapsedTimeMS=0},show:function(){this.__showing=!0},hide:function(){this.__showing=!1},setShowing:function(e){this.__showing=e},setDefaultPlaying:function(e){this.__playing=e},drawWebGL:function(e){if(this.__animatedSprite&&this.__showing&&(!(this.__loopCount>=this.__maxLoopCount)||this.__holdOnLastFrame)){var t=this.__animatedSprite.getFrameAtIndex(this.__frameIndex);this.__extents[0]=t.getWidth(),this.__extents[1]=t.getHeight();var i=this.__textures[this.__frameIndex];i||(this.__recomputeTextures(e),i=this.__textures[this.__frameIndex]),e.spriteBatch.add(i,t.uvs,this._worldToLocalTransform,this.__extents,this._combinedTintColor)}},getElapsedTime:function(){return this.__elapsedTimeMS%this.__animatedSprite.getDurationMS()},update:function(e){if(this.__animatedSprite&&this.__playing)for(this.__elapsedTimeMS+=e,
this.__frameIndex=this.__animatedSprite.getFrameIndexAtTime(this.__elapsedTimeMS);this.__playing&&this.__elapsedTimeMS>=this.__animatedSprite.getDurationMS();)this.__loopCount++,this.__elapsedTimeMS-=this.__animatedSprite.getDurationMS(),this.__loopCount>=this.__maxLoopCount&&(this.__playing=!1,this.__holdOnLastFrame&&(this.__frameIndex=this.__animatedSprite.getFrames().length-1)),this.__onLoopCallback&&this.__onLoopCallback(this.getOwningEntity())}}),o.computeDependencies(s,{},i.exports)});define("bulletml/ActionGlobals",["require","exports","module","thor/core/Class","thor/core/Validation","thor/math/MersenneTwister"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation"),e("thor/math/MersenneTwister");i.exports=n.create({initialize:function(e){this.rank=0,this.__mersenneTwister=e,this.time=0,this.aimTarget=[0,0]},fireBullet:function(e,t,i,n,r,s,o){throw new Error("Abstract fireBullet called")},fireEvent:function(e,t){throw new Error("Abstract fireEvent called")},fireAnimation:function(e,t,i,n){throw new Error("Abstract fireAnimation called")},vanishBullet:function(e){throw new Error("Abstract vanishBullet called")},setSoundSprite:function(e){throw new Error("Abstract setSoundSprite called")},playSound:function(e,t){throw new Error("Abstract playSound called")},stopSound:function(e,t){throw new Error("Abstract stopSound called")},rand:function(){return this.__mersenneTwister.rnd()},randBetween:function(e,t){return this.rand()*(t-e)+e},spawnPowerup:function(e){throw new Error("Abstract spawnPowerup called")},spawnFuel:function(e){throw new Error("Abstract spawnFuel called")}})}),define("bulletml/BulletData",["require","exports","module","thor/core/Class"],function(e,t,i){var n=e("thor/core/Class");i.exports=n.create({initialize:function(){this.reset(),this.id=-1},clone:function e(){var e=new i.exports;return e.x=this.x,e.y=this.y,e.vx=this.vx,e.vy=this.vy,e.ax=this.ax,e.ay=this.ay,e.angularVelocity=this.angularVelocity,e.facing=this.facing,e.id=this.id,e.spawnedBy=this.spawnedBy,e.isEntity=this.isEntity,e.bulletDefinition=this.bulletDefinition,e},step:function(e){var t=this.ax*e,i=this.ay*e;this.x+=this.vx*e+.5*t*e,this.y+=this.vy*e+.5*i*e,this.vx+=t,this.vy+=i},reset:function(){this.x=0,this.y=0,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.angularVelocity=0,this.facing=0,this.spawnedBy=-1,this.isEntity=!1,this.bulletDefinition=null}})}),define("Constants",["require","exports","module"],function(e,t,i){i.exports={COLLISION_CATEGORY_PLAYER:1,COLLISION_CATEGORY_FLY_ENEMY:2,COLLISION_CATEGORY_PLAYER_BULLET:4,COLLISION_CATEGORY_ENEMY_BULLET:8,COLLISION_CATEGORY_GROUND_ENEMY:16,COLLISION_CATEGORY_PICKUP:32,COLLISION_CATEGORY_METEOR:64,COLLISION_CATEGORY_PLAYER_PICKUP:128,COLLISION_CATEGORY_LASER:256,COLLISION_CATEGORY_PLAYER_FIRED_BULLET:512,COLLISION_CATEGORY_COMPANION_BULLET:1024,COLLISION_CATEGORY_PLAYER_MISSILE:2048,COLLISION_CATEGORY_ENEMY_EMP:4096,COLLISION_CATEGORY_ALL:4294967295,TINT_INVISIBLE:4294967040,MAX_ACHIEVEMENT_TIER:3,INVENTORY_SIZE:20,BOSS_MAX_KILL_TIME:30,BOSS_BONUS_SCORE_PER_SECOND:100,BOSS_PINATA_DELAY_MS:1767,BOSS_DEATH_DELAY_MS:3e3,SFX_GAME_OVER_FADE_DURATION_SECONDS:5,PAUSE_VOLUME:.65,PAUSE_VOLUME_FADE_DURATION_SECONDS:.2,SCORE_DIGITS:7,BOSS_DIALOG_DELAY_RATIO:.05,MAX_PLAYER_HEALTH:4,MIN_ENEMY_LEVEL:1,MAX_ENEMY_LEVEL:8,HEALTH_SHOW_PERCENT:.3,HEALTH_SHOW_TIME:1e3,TOURNAMENT_UPDATE_INTERVAL:15e3,BG_SCROLL_VELOCITY:10,PLANET_SCROLL_VELOCITY:20,ASTEROID_SCROLL_VELOCITY:40,SCROLL_VELOCITY:200,PICKUP_SCROLL_VELOCITY:200,SCROLL_ACCELERATION:0,MAX_SCROLL_VELOCITY:3e3,CURRENCY_START_VELOCITY:-650,CURRENCY_ACCELERATION:2e4,CURRENCY_MAX_VELOCITY:9e3,PICKUP_ATTRACTION:1e3,PICKUP_ATTRACTION_STRONG:3e3,ENERGY_PICKUP_ATTRACTION:18e3,ENERGY_PICKUP_ATTRACTION_STRONG:24e3,GOLD_ATTRACTION:500,GOLD_ATTRACTION_STRONG:24e3,PICKUP_STRONG_RANGE_INV_SQUARED:11e-6,ENERGY_PICKUP_STRONG_RANGE_INV_SQUARED:16e-7,GOLD_PICKUP_RADIUS:100,PICKUP_MAX_PIXEL_PER_FRAME:50,BOOST_TIME:1e4,MAXIMUM_ENERGY:20,MAXIMUM_PASSIVES_WITH_CHARGE:3,CANISTER_PER_WAVE:1,CANISTER_PER_MINIBOSS:4,CANISTER_PER_BOSS:8,UPGRADE_ZONE_UPPER_BOUND:.3,UPGRADE_ZONE_LOWER_BOUND:.6,UPGRADE_ZONE_LEFT_BOUND:.2,UPGRADE_ZONE_RIGHT_BOUND:.8,ENTITY_DESPAWN_BUFFER_Y:400,CURRENCY_SPREAD_X:250,CURRENCY_SPREAD_Y:750,UPGRADE_SPREAD:80,NUTELLA:1337,SPAWN_POWERUP_NO_MORE_THAN_THIS_SECONDS:20,SPAWN_WAVE_POWERUP_NO_MORE_THAN_THIS_SECONDS:15,UNITS_TO_METERS:.01,SPAWN_WIDTH_PERCENTAGE:.5,SPAWN_HEIGHT_PERCENTAGE:.5,GAME_WIDTH_UNITS:12,GAME_HEIGHT_UNITS:20,UNITS_TO_SDP:128,GAME_AREA_WIDTH:1536,GAME_AREA_HEIGHT:2560,MAP_WIDTH_UNITS:16,MAP_BUFFER:-256,LS_FARTHEST:"V_FARTHEST",LS_TOTAL_ENEMIES:"V_TOTAL_ENEMIES",LS_HAS_SUBSCRIBED:"V_SUBSCRIBED",LS_SCORE:"V_SCORE",LS_POINTS:"V_POINTS",LS_MISSION_PROGRESS:"V_MISSION_PROGRESS",LS_LAST_MISSION_ID:"V_LAST_MISSION_ID",LS_OPEN_WEB_USER_ID:"V_OPEN_WEB_UUID",LS_OPEN_WEB_AUTH_TOKEN:"V_OPEN_WEB_AUTH",LS_EVENT_NAME:"V_EVENT_NAME",LS_EVENT_HIGHSCORE:"V_EVENT_HIGHSCORE",LS_EVENT_USERNAME:"V_EVENT_USERNAME",MAX_SHIP_VELOCITY:7500,SHIP_SMALL_TILT_VELOCITY:150,SHIP_LARGE_TILT_VELOCITY:300,PLAYER_COLLISION_RADIUS:25,PLAYER_PICKUP_COLLISION_RADIUS:50,INSTANT_ZAP_COLLISION_RADIUS:10,PLAYER_COLLISION_SHIELD_RADIUS:50,PLAYER_COLLISION_GRAZE_RADIUS:75,CLOSE_DISTANCE:100,ENEMY_MISSILE_MIN_VELOCITY:700,SHIELD_UPGRADE_HEALTH_BUMP:1,PLAYER_EXPLOSION_LIFETIME:720,STAY_ON_SCREEN_PATH_INTRO:"spawnLoop1_61",STAY_ON_SCREEN_PATH_LOOP:"spawnLoop1_60",DIFFICULTY_RAMP_TIME:120,DIFFICULTY_RAMP_DELAY:15,AXIS_MASK_X:1,AXIS_MASK_Y:2,ON_SCREEN_ENEMY_CHANCE:.2,RECORDING_INTERVAL_MS:200,MIN_RATIO_REPLAYS_LOADED:.1,MAX_REPLAY_AGE_MS:6e4,MAX_BOSS_SPEED:300,DEBUG_PATHS:!1,DEBUG_ON_SCREEN_ENEMY_PATHS:!1,GRID_Z_INDEX:0,STARFIELD_Z_INDEX:0,PLANET_Z_INDEX:1,ASTEROID_Z_INDEX:2,BOTTOM_LAYER_Z_INDEX:3,MID_LAYER_Z_INDEX:4,TOP_LAYER_Z_INDEX:5,BULLETS_Z_INDEX:6,MISSILES_Z_INDEX:6,DEBRIS_Z_INDEX:6,DEATH_ANIMATION_Z_INDEX:7,FLYER_Z_INDEX:8,FLYER_ATTACHMENT_Z_INDEX:9,PERMANENT_FLYER_Z_INDEX:10,MINIBOSS_Z_INDEX:11,ENERGY_BALLS_Z_INDEX:12,METEOR_Z_INDEX:13,CURRENCY_Z_INDEX:14,SCORE_Z_INDEX:15,UPGRADE_Z_INDEX:16,EXPLOSION_Z_INDEX:17,GHOST_Z_INDEX:18,DRONE_Z_INDEX:19,PLAYER_Z_INDEX:20,PLAYER_EXPLOSION_Z_INDEX:21,HIT_Z_INDEX:22,SCT_Z_INDEX:23,DEFAULT_FIRING_INTERVAL:200,DEFAULT_PLAYER_BULLET_DAMAGE:20,COST_TO_CONTINUE:100,GHOST_ALPHA:102,LIVE_GHOST_ALPHA:63.75,FREE_VAULTS_REQUIRED_FLIGHTS:4,COINS_SYMBOL:"~",PARTS_SYMBOL:">",TOKENS_SYMBOL:"`",SHIP_ENTITY_NAME:"Ship07Player",DUMMY_SHIP_ENTITY_NAME:"Ship07",DEFAULT_TINT:[1,1,1,1],START_TINT:[34/255,242/255,119/255,1],END_TINT:[50/255,202/255,253/255,1],BLANK_MAP:"Blank_Stage",SPACE_MAP:["Space_BG"],PLANET_MAP:["Blank_Stage","stage01_planet_00","stage01_planet_01","stage01_planet_02","stage01_planet_03"],ASTEROID_MAP:["Blank_Stage","Blank_Body","stage01_asteroids_00","stage01_asteroids_01"],BOTTOM_MAP:["Blank_Stage","stage01_02_00","stage01_02_01","stage01_02_02","stage01_02_03","stage01_02_04","stage01_02_05","stage01_02_06"],MID_MAP:["Blank_Stage","stage01_01_00","stage01_01_01","stage01_01_02","stage01_01_03","stage01_01_04","stage01_01_05","stage01_01_06"],TOP_MAP:["Blank_Stage","stage01_00_00","stage01_00_01","stage01_00_02","stage01_00_03","stage01_00_04","stage01_00_05","stage01_00_06"],LEVEL_START_BUFFER:-5,SHIP_OVERLAY_OFFSET:0,SHIP_INITIAL_JUMP_OFFSET:-125,SHIP_INITIAL_JUMP_DURATION_MS:250,MAX_STATIC_CHARGES:3,GOLD_MULTIPLIER:5,ANIMATION_TRIGGER_DELAY_MS:3e3,TRACKING_ITEM_IDS:{unknown:1,skin:2,continue:3},HALF_PI:Math.PI/2,HALF_PI_NEG:-Math.PI/2,PLAYER_PROJECTILE_DISABLE_TIME_SECONDS:1.5,REWARD_TYPE_NAMES:{goldMultipliers:"Coin Multiplier",slotUnlock:"Card Slot",COINS:"Coins",GOLD:"Coins",PARTS:"Parts",TOKENS:"Loot Chest",CARD_SLOT:"Card Slot",COIN_MULTIPLIER:"Coin Multiplier",GUN_POWERUP:"Gun Power-up",MISSILE_POWERUP:"Missile Power-up",COMPANION_POWERUP:"Companion Power-up"},REWARD_TYPE_DESCRIPTIONS:{goldMultipliers:"Additional bonus coins",slotUnlock:"Unlocked new card slot",COINS:"Used for skins & upgrades",GOLD:"Used for skins & upgrades",PARTS:"Used for upgrades",TOKENS:"Open from home screen",CARD_SLOT:"Unlocked new card slot",COIN_MULTIPLIER:"Additional bonus coins",GUN_POWERUP:"Unlocked",MISSILE_POWERUP:"Unlocked",COMPANION_POWERUP:"Unlocked"}}}),define("ResourceTypes",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum");i.exports=n.create("ResourceTypes",{HEALTH:1,GOLD:2,DAMAGE:3,ENEMY_DEATH_COUNT:4,SCORE:5,UPGRADE_CHANCE:6,UPGRADE:7,EXPLODE_ON_DEATH:8,UPGRADE_TYPE:9,SHIELD_STRENGTH:10,GOLD_PICKUP:11,CURRENCY_AFTER_WAVE:12,CURRENCY_MIN:13,CURRENCY_MAX:14,SCORE_WAVE_KILL:15,ENERGY:16,ENERGY_PICKUP:17,INVULNERABILITY:18,MISSION_COIN_COLLECT:19,MISSION_DISTANCE:20,MISSION_MINE_SHIP:21,MISSION_PURPLE_SHIP:22,FUEL:23,EXPLOSION_SCALE:24})}),define("BulletManager",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/webgl/Texture","thor/math/MatrixUtil","thor/math/MatrixOrderings","thor/util/JSONLoader","thor/util/RingBuffer","thor/audio/SoundSprite","thor/resources/ResourceManager","thor/graphics/resources/TextureRegionResource","thor/graphics/resources/AnimatedSpriteResource","thor/entity/World","thor/entity/Entity","thor/entity/EntityManager","thor/entity/SceneComponent","thor/entity/EntityComponent","Constants","ResourceTypes"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i)),s=e("thor/core/Validation"),o=e("thor/webgl/Texture"),a=e("thor/math/MatrixUtil"),_=e("thor/math/MatrixOrderings"),l=e("thor/util/JSONLoader"),h=e("thor/util/RingBuffer"),u=(e("thor/audio/SoundSprite"),e("thor/resources/ResourceManager"),e("thor/graphics/resources/TextureRegionResource")),c=e("thor/graphics/resources/AnimatedSpriteResource"),d=(e("thor/entity/World"),e("thor/entity/Entity"),e("thor/entity/EntityManager"),e("thor/entity/SceneComponent")),g=e("thor/entity/EntityComponent"),p=e("Constants"),m=e("ResourceTypes"),f=new Float32Array(a.IDENTITY_3x2),v=new Float32Array(a.IDENTITY_3x2),y=p.HALF_PI,E={yellow_square_bullet001:"blue_square_bullet001",yellow_star_bullet001:"blue_star_bullet001",yellow_square_trail_bullet001:"blue_square_trail_bullet001",yellow_star_trail_bullet001:"blue_star_trail_bullet001",blue_square_bullet001:"green_square_bullet001",blue_star_bullet001:"green_star_bullet001",blue_square_trail_bullet001:"green_square_trail_bullet001",blue_star_trail_bullet001:"green_star_trail_bullet001",green_square_bullet001:"purple_square_bullet001",green_star_bullet001:"purple_star_bullet001",green_square_trail_bullet001:"purple_square_trail_bullet001",green_star_trail_bullet001:"purple_star_trail_bullet001"};i.exports=n.create(d,{__bulletBuffer:null,__arrBullets:null,__poolSize:null,__entityManager:null,__gameBounds:null,__arrBulletsToExpire:null,__textures:null,__sounds:null,initialize:function(e,t){d.prototype.initialize.call(this),this.setSortOrder(p.BULLETS_Z_INDEX),this.__entityManager=e,this.__poolSize=t,this.__bulletDataByType=null,this.__gameTimer=0,this.__enemyBulletsEnabled=!0,this.__usingPlayerDamageBonusImages=!1,this.__playerBulletsEnabled=!0,this.__bulletDrawListIndex=0,this.__lastBulletDrawListIndex=0,this.__arrBulletsToExpire=[],this.__gameBounds={width:1,height:1,widthBuffer:0,heightBuffer:0}},getType:function(){return"BulletManager"},init:function(e,t,i){this.__resourceManager=t,this.__bulletDataByType=i;var n=this.__entityManager.createEntity(),r=this.__entityManager.addComponent(n,"SceneComponent",!0),s=this.__entityManager.addComponent(n,"BulletComponent",!0);this.__entityManager.addComponent(n,"ActionComponent",!0);this.__entityManager.addComponent(n,"ResourceComponent",!0),this.__entityManager.addComponent(n,"CollisionComponent",!0),s.setBounds(this.__gameBounds.width,this.__gameBounds.height,this.__gameBounds.widthBuffer,this.__gameBounds.heightBuffer),n.setRootComponent(r),this.__bulletTemplate=n,this.__arrBullets=new Array(this.__poolSize),this.__activeBulletComponents=new Array(this.__poolSize),this.__bulletData=new Array(this.__poolSize),this.__bulletRootData=new Array(this.__poolSize),this.__bulletDrawList=new Array(this.__poolSize),this.__bulletDrawListIndex=0,this.__bulletBuffer=new h(new Array(this.__poolSize),this.__poolSize);for(var o=0;o<this.__poolSize;o++){var a=e.spawnEntity(n,{noActivate:!0}),_=a.getComponent("BulletComponent");_.setBulletIndex(o),this.__arrBullets[o]=a,this.__bulletRootData[o]=a.getRootComponent().__data,this.__bulletBuffer.add(_)}for(var l in this.__bulletDataByType){var u=this.__bulletDataByType[l];u.scale=u.scale||1;var c=u.uri;this.__setRegionPropertiesForData(u,c)}},setSoundSprite:function(e){this.__sounds=e},_initWebGL:function(e){for(var t in this.__bulletDataByType){var i=this.__bulletDataByType[t];if(!i.texture){var n;n=i.region?i.region:i.sprite.getFrameAtIndex(0),i.texture=o.getTextureFromDomImage(e,n.image.getDOMElement())}}},resetBulletData:function(e){if(s.ifDefined.assertIsBoolean(e),(e=e||!1)!==this.__usingPlayerDamageBonusImages){this.__usingPlayerDamageBonusImages=e,this.__bulletDataByType=this.__resourceManager.get(l.RESOURCE_TYPE,"data/bullets");for(var t in this.__bulletDataByType){var i=this.__bulletDataByType[t];i.scale=i.scale||1;var n=i.category&p.COLLISION_CATEGORY_PLAYER_FIRED_BULLET,r=i.uri;if(n&&e){var o=E[i.region.name];s.isNonEmptyString(o)&&(r=o)}this.__setRegionPropertiesForData(i,r)}}},__setRegionPropertiesForData:function(e,t){if(e.animated){e.sprite=this.__resourceManager.get(c.RESOURCE_TYPE,t);var i=e.sprite.getFrameAtIndex(0);e.halfWidth=.5*i.dimensions[0]*e.scale,e.halfHeight=.5*i.dimensions[1]*e.scale}else e.region=this.__resourceManager.get(u.RESOURCE_TYPE,t),e.halfWidth=.5*e.region.dimensions[0]*e.scale,e.halfHeight=.5*e.region.dimensions[1]*e.scale},setBounds:function(e,t){this.__gameBounds.width=e,this.__gameBounds.height=t,this.__gameBounds.widthBuffer=.4*e/2,this.__gameBounds.heightBuffer=.4*t/2,this.__bulletTemplate&&this.__bulletTemplate.getComponent("BulletComponent").setBounds(this.__gameBounds.width,this.__gameBounds.height,this.__gameBounds.widthBuffer,this.__gameBounds.heightBuffer)},setBulletDamage:function(e,t){this.__bulletDataByType[e].damage=t},getBulletData:function(e){return this.__bulletDataByType[e]},getEnemyBulletsEnabled:function(){return this.___enemyBulletsEnabled},setEnemyBulletsEnabled:function(e){this.__enemyBulletsEnabled=e},getPlayerBulletsEnabled:function(){return this.__playerBulletsEnabled},setPlayerBulletsEnabled:function(e){this.__playerBulletsEnabled=e},spawnBullet:function(e,t,i,n){var s=e.id,o=this.__bulletDataByType[s];if(!o)return r.error(s+" is not a valid type of bullet."),null;var a=this.__bulletBuffer.remove();if(!a)return r.error("Bullet pool is empty"),null;var _=o.mask,l=o.category,h=o.scale;if(l===p.COLLISION_CATEGORY_ENEMY_BULLET){if(!this.__enemyBulletsEnabled)return null;this.__sounds&&this.__sounds.play("enemy_gun")}if(l===p.COLLISION_CATEGORY_PLAYER_BULLET&&!this.__playerBulletsEnabled)return null;a.setIsAlive(!0),a.setBulletType(s),a.setSpawnTime(this.__gameTimer),a.getBulletData().bulletDefinition=e,a._siblings.ResourceComponent.setResource(m.DAMAGE,e.damage||o.damage),a._siblings.SceneComponent.setTranslation(t,i);var u=a._siblings.CollisionComponent;u.setMask(_),u.setCategory(l),u.setRadius(o.radius*h),u.setOffset(o.offsetX*h,o.offsetY*h);var c=a.getOwningEntity();return this.__entityManager.activateEntity(c),this.__activeBulletComponents[a.getBulletIndex()]=a,this.__bulletData[a.getBulletIndex()]=this.__bulletDataByType[s],c},expireBulletIndex:function(e){this.__arrBulletsToExpire.push(e)},expireAllBullets:function(){for(var e=0;e<this.__arrBullets.length;++e)this.expireBulletIndex(e)},expireBulletsWithMask:function(e){for(var t=this.__arrBullets.length,i=0;i<t;++i){if(this.__arrBullets[i].getComponent("BulletComponent").isAlive()){this.__bulletData[i].category&e&&this.expireBulletIndex(i)}}},processExpiredBullets:function(){for(var e=0;e<this.__arrBulletsToExpire.length;++e){var t=this.__arrBulletsToExpire[e],i=this.__arrBullets[t],n=i.getComponent("ActionComponent"),r=i.getComponent("BulletComponent");r.isAlive()&&(n.clearAction(),r.setIsAlive(!1),r.getBulletData().reset(),this.__activeBulletComponents[t]=null,this.__entityManager.deactivateEntity(i),i.getRootComponent().removeFromParent(),this.__bulletBuffer.add(r))}this.__arrBulletsToExpire.length=0},update:function(e){this.__gameTimer+=.001*e;for(var t,i,n,r,s=this.__activeBulletComponents.length,o=0;o<s;++o)(r=this.__activeBulletComponents[o])&&(n=r.__bulletData,t=n.ax*e,i=n.ay*e,n.x+=n.vx*e+.5*t*e,n.y+=n.vy*e+.5*i*e,n.vx+=t,n.vy+=i,n.ax=0,n.ay=0)},debugDraw:function(e){for(var t=this.__activeBulletComponents.length,i=0;i<t;++i){var n=this.__activeBulletComponents[i];if(n){var r,s=n.__bulletData,o=this.__bulletData[i],a=s.x+o.offsetX,_=s.y+o.offsetY,l=o.radius*o.scale;switch(o.category){case p.COLLISION_CATEGORY_PLAYER_BULLET:r=16777215;break;case p.COLLISION_CATEGORY_ENEMY_BULLET:r=4294902015;break;default:r=4294967295}e.lineBatch.addCircle(a-l,_-l,l,this._worldToLocalTransform,r,4)}}},__approxAtan2:function(e,t){if(0==t)return e>0?y:0==e?0:-y;var i,n=e/t;if(Math.abs(n)<1){if(i=n/(1+.28*n*n),t<0)return e<0?i-Math.PI:i+Math.PI}else if(i=y-n/(n*n+.28),e<0)return i-Math.PI;return i},drawWebGL:function(e){var t=this._worldToLocalTransform;v.set(t);for(var i=t[0],n=t[3],r=this.__activeBulletComponents.length,s=0;s<r;++s){var o=this.__activeBulletComponents[s];if(o){var l=this.__bulletData[s],h=this.__bulletRootData[s],u=l.region?l.region:l.sprite.getFrameAtTime(this.__gameTimer-o.getSpawnTime());if(l.faceVelocity){var c=this.__approxAtan2(o.__bulletData.vy,o.__bulletData.vx)-y;a.transform(t,f,h[2]-l.halfWidth,h[3]-l.halfHeight,c,0,l.scale,l.scale,_.TRS),e.spriteBatch.add(l.texture,u.uvs,f,u.dimensions,this._tintColor)}else v[0]=i*l.scale,v[3]=n*l.scale,v[4]=(h[2]+t[4]-l.halfWidth)*i,v[5]=(h[3]+t[5]-l.halfHeight)*n,e.spriteBatch.add(l.texture,u.uvs,v,u.dimensions,this._tintColor)}}this.__lastBulletDrawListIndex=this.__bulletDrawListIndex,this.__bulletDrawListIndex=0}}),g.computeDependencies(g,{},i.exports)}),define("thor/util/RingBufferPool",["require","exports","module","thor/core/Class","thor/core/Validation","thor/util/RingBuffer"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/util/RingBuffer"));i.exports=n.create({initialize:function(e,t){this.__ringBuffer=new r(new Array(e),e);for(var i=0;i<e;++i){var n=new t;this.__ringBuffer.add(n)}this.__constructor=t},remove:function(){var e=this.__ringBuffer.remove();if(!e){var t=this.__ringBuffer.getMaximumCount(),i=t+.5*t;this.__ringBuffer.resize(i);for(var n=0;n<t;++n)this.__ringBuffer.add(new this.__constructor);e=this.__ringBuffer.remove()}return e},add:function(e){this.__ringBuffer.add(e)}})}),define("bulletml/Action",["require","exports","module","thor/core/Class"],function(e,t,i){var n=e("thor/core/Class");i.exports=n.create({initialize:function(){},run:function(e,t,i,n,r){},isComplete:function(e){return!0},getInitialState:function(e,t){},disposeState:function(e){}})}),define("bulletml/ActionState",["require","exports","module","thor/core/Class"],function(e,t,i){var n=e("thor/core/Class");i.exports=n.create({initialize:function(){this.reset()},reset:function(){}})}),define("bulletml/NumberParam",["require","exports","module","thor/core/Enum","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Enum"),r=e("thor/core/Class"),s=(e("thor/core/Validation"),n.create("Type",{ABSOLUTE:1,RELATIVE:2,SEQUENCE:3,AIM:4,FACING:5})),o={absolute:s.ABSOLUTE,relative:s.RELATIVE,sequence:s.SEQUENCE,aim:s.AIM,facing:s.FACING},a=/^\s*params\[(\d+)\]\s*$/,_={};_[s.ABSOLUTE]={},_[s.RELATIVE]={},_[s.SEQUENCE]={},_[s.AIM]={},_[s.FACING]={};var l={};l[s.ABSOLUTE]={},l[s.RELATIVE]={},l[s.SEQUENCE]={},l[s.AIM]={},l[s.FACING]={};var h=r.create({initialize:function(e){this.type=e},getValue:function(e){}}),u=r.create(h,{initialize:function(e,t){h.prototype.initialize.call(this,t),this.value=e,_[t][e]=this},getValue:function(e){return this.value}}),c=r.create(h,{initialize:function(e,t){h.prototype.initialize.call(this,t),this.expressionFunction=e},getValue:function(e){return this.expressionFunction(e)}});h.fromNumber=function(e,t){return t||(t=s.ABSOLUTE),new u(e,t)},h.fromNode=function(e,t){var i,n=o[e.getAttribute("type")||"absolute"],r=e.textContent,s=+r;if("number"!=typeof s||isNaN(s)){var h=a.exec(r);if(h)s=t[h[1]],i=_[n][s]||new u(s,n);else{for(var d=t.length,g=0;g<d;++g)r=r.replace("params["+g+"]",t[g]);if(!(i=l[n][r])){i=new c(new Function("globals","return "+r),n),l[n][r]=i}}}else i=_[n][s]||new u(s,n);return i},i.exports=h,i.exports.Type=s}),define("bulletml/SequenceAction",["require","exports","module","thor/core/Class","thor/core/Validation","thor/util/RingBufferPool","bulletml/Action","bulletml/ActionState","./NumberParam","./ActionGlobals"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/util/RingBufferPool"),o=e("bulletml/Action"),a=e("bulletml/ActionState"),_=e("./NumberParam"),l=(e("./ActionGlobals"),n.create(a,{initialize:function(){a.prototype.initialize.call(this)},reset:function(){this.repeatCount=0,this.currentActionIndex=0,this.actionStates=[]}})),h=new s(128,l);i.exports=n.create(o,{initialize:function(e){this.__actions=e,this.__repeatCount=_.fromNumber(0)},getInitialState:function(e,t){r.ifDefined.assertIsInstanceOf(t,l);var i=t||h.remove();i.repeatCount=this.__repeatCount.getValue(e),i.currentActionIndex=0;for(var n=0;n<this.__actions.length;++n)i.actionStates[n]=this.__actions[n].getInitialState(e,i.actionStates[n]);return i},disposeState:function(e){for(var t=this.__actions.length,i=0;i<t;++i)e.actionStates[i]=this.__actions[i].disposeState(e.actionStates[i]);e.reset(),h.add(e)},repeat:function(e){this.__repeatCount=e},run:function(e,t,i,n,r){var s=e,o=i.currentActionIndex;do{if(o===this.__actions.length){if(!(i.repeatCount>0))return i.currentActionIndex=o,s;i.repeatCount--,o=0;for(var a=0;a<this.__actions.length;++a)i.actionStates[a]=this.__actions[a].getInitialState(n,i.actionStates[a])}var _=this.__actions[o],l=i.actionStates[o];s=_.run(s,e,l,n,r),o++}while(_.isComplete(l));return i.currentActionIndex=o-1,s},isComplete:function(e){return e.currentActionIndex===this.__actions.length&&0===e.repeatCount}})}),define("bulletml/BulletDefinition",["require","exports","module","thor/core/Enum","thor/core/Class","thor/core/Validation","./SequenceAction","./NumberParam"],function(e,t,i){var n=e("thor/core/Enum"),r=e("thor/core/Class"),s=(e("thor/core/Validation"),e("./SequenceAction"),e("./NumberParam"),n.create("BulletType",{BULLET:1,ENTITY:2}));i.exports=r.create({initialize:function(e,t){this.id=e,this.type=t,this.speed=null,this.direction=null,this.action=null,this.metadata=null,this.events=null,this.damage=0},setSpeed:function(e){this.speed=e},setDirection:function(e){this.direction=e},setAction:function(e){this.action=e},setDamage:function(e){this.damage=e},setMetadata:function(e){this.metadata=e},setEvents:function(e){this.events=e}}),i.exports.BulletType=s}),define("events/SpawnBulletMLEntityEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","bulletml/Action","bulletml/BulletDefinition"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");e("bulletml/Action"),e("bulletml/BulletDefinition");i.exports=r.generateEventClass("SpawnBulletMLEntity",1969678134,{x:n.assertIsNumber,y:n.assertIsNumber,vx:n.assertIsNumber,vy:n.assertIsNumber,parentId:n.ifDefined.assertIsNumber,angularVelocity:n.assertIsNumber,bulletDefinition:function(e){},waveId:n.assertIsNumber})}),define("events/BulletMLEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","bulletml/BulletData"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");e("bulletml/BulletData");i.exports=r.generateEventClass("BulletMLEvent",3884576433,{bulletData:function(e){},bulletEventType:n.assertIsString})}),define("UpgradeTypeEnum",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum");i.exports=n.create("UpgradeTypeEnum",{SHIELD_BOOST:1,FUEL_PICKUP:2,SYSTEM_UPGRADE:3})}),define("events/SpawnUpgradeEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation","UpgradeTypeEnum"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event")),r=e("thor/core/Validation");e("UpgradeTypeEnum");i.exports=n.generateEventClass("SpawnUpgrade",828660495,{x:r.assertIsNumber,y:r.assertIsNumber,upgradeType:function(e){}})}),define("thor/entity/SpriteComponent",["require","exports","module","thor/core/Class","thor/core/Logger","thor/webgl/Texture","thor/core/Validation","thor/graphics/resources/TextureRegionResource","./SceneComponent","./EntityComponent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/webgl/Texture")),s=e("thor/core/Validation"),o=(e("thor/graphics/resources/TextureRegionResource"),e("./SceneComponent")),a=e("./EntityComponent");i.exports=n.create(o,{initialize:function(){o.prototype.initialize.call(this),this.__region=null,this.__uvs=new Float32Array([0,0,0,1,1,1,1,0]),this.__extents=new Float32Array(2),this.__textureOptions={},this.__leftClipRatio=null},getType:function(){return"SpriteComponent"},clone:function(e){o.prototype.clone.call(this,e),e.__region=this.__region,e.__uvs.set(this.__uvs),e.__extents.set(this.__extents),e.__textureOptions=this.__textureOptions},reset:function(){this.__leftClipRatio=null,o.prototype.reset.call(this)},setTextureRegion:function(e){var t=this.__centered;t&&this.setCentered(!1),this.__region=e;var i=e.dimensions[0],n=e.dimensions[1];this._dpBoundingBox.width=i,this._dpBoundingBox.height=n,this.__extents[0]=i,this.__extents[1]=n,this.__uvs.set(e.uvs),this.__uvWidth=this.__uvs[4]-this.__uvs[0],this.__originalWidth=i,s.isNumber(this.__leftClipRatio)&&this.setClipAmountTowardsLeft(this.__leftClipRatio),this.__texture=null,t&&this.setCentered(!0)},getWidth:function(){return this._dpBoundingBox.width},getHeight:function(){return this._dpBoundingBox.height},setWidth:function(e){var t=this.__centered;t&&this.setCentered(!1),this.__extents[0]=e,this._dpBoundingBox.width=e,t&&this.setCentered(!0)},setHeight:function(e){var t=this.__centered;t&&this.setCentered(!1),this.__extents[1]=e,this._dpBoundingBox.height=e,t&&this.setCentered(!0)},scaleToFit:function(e,t){var i=e/this.__extents[0],n=t/this.__extents[1];i>n?t=this.__extents[1]*i:e=this.__extents[0]*n;var r=this.__centered;r&&this.setCentered(!1),this.__extents[0]=e,this.__extents[1]=t,this._dpBoundingBox.width=e,this._dpBoundingBox.height=t,r&&this.setCentered(!0)},getRegion:function(){return this.__region},setClipAmountTowardsLeft:function(e){s.isNumber(this.__originalWidth)||(this.__originalWidth=this.__extents[0]),s.isNumber(this.__uvWidth)||(this.__uvWidth=this.__uvs[4]-this.__uvs[0]);var t=this.__originalWidth*e,i=this.__uvWidth*e;this.setWidth(t),this.__uvs[4]=this.__uvs[0]+i,this.__uvs[6]=this.__uvs[4],this.__leftClipRatio=e},_initWebGL:function(e){if(this.__region){var t=this.__region.textureFilter;if(t){var i=e.gl[t];this.__textureOptions.minFilter=i,this.__textureOptions.magFilter=i}this.__texture=r.getTextureFromDomImage(e,this.__region.image.getDOMElement(),this.__textureOptions)}},debugDraw:function(e){e.lineBatch.addRect(0,0,this.__extents[0],this.__extents[1],this._worldToLocalTransform,this.__tintColor)},drawWebGL:function(e){this.__region&&(this.__texture||(this.__texture=r.getTextureFromDomImage(e,this.__region.image.getDOMElement())),e.spriteBatch.add(this.__texture,this.__uvs,this._worldToLocalTransform,this.__extents,this._combinedTintColor))}}),a.computeDependencies(o,{},i.exports)}),define("gameplay/BulletManagerActionGlobals",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/event/EventManager","thor/entity/EntityManager","thor/entity/AnimatedSpriteComponent","bulletml/ActionGlobals","bulletml/BulletData","BulletManager","bulletml/BulletDefinition","thor/entity/EntityDestroyedEvent","events/SpawnBulletMLEntityEvent","events/BulletMLEvent","events/SpawnUpgradeEvent","ResourceTypes","thor/entity/SpriteComponent","thor/entity/SceneComponent","thor/math/ColorUtil","thor/audio/SoundSprite","UpgradeTypeEnum"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=(e("thor/event/EventManager"),e("thor/entity/EntityManager"),e("thor/entity/AnimatedSpriteComponent")),a=e("bulletml/ActionGlobals"),_=(e("bulletml/BulletData"),e("BulletManager"),e("bulletml/BulletDefinition")),l=e("thor/entity/EntityDestroyedEvent"),h=e("events/SpawnBulletMLEntityEvent"),u=e("events/BulletMLEvent"),c=e("events/SpawnUpgradeEvent"),d=e("ResourceTypes"),g=(e("thor/entity/SpriteComponent"),e("thor/entity/SceneComponent"),e("thor/math/ColorUtil")),p=(e("thor/audio/SoundSprite"),e("UpgradeTypeEnum")),m=Math.PI/180;i.exports=n.create(a,{initialize:function(e,t,i,n){a.prototype.initialize.call(this,e),this.__bulletManager=t,this.__eventManager=i,this.__entityManager=n,this.setTracing(!1),this.__sounds=null},setSoundSprite:function(e){this.__sounds=e},playSound:function(e,t){this.__sounds&&this.__sounds.play(e,{loop:t})},stopSound:function(e,t){this.__sounds&&this.__sounds.stop(e,{fadeOutDuration:t})},vanishBullet:function(e){var t=e.id,i=this.__entityManager.getEntity(t);if(i){var n=i.getComponent("BulletComponent");if(n)return void this.__bulletManager.expireBulletIndex(n.getBulletIndex());var r=this.__eventManager.getNewEvent(l);r.setEntityId(t),this.__eventManager.queueEvent(r)}},toggleVulnerability:function(e){var t=e.id,i=this.__entityManager.getEntity(t);if(i){var n=i.getComponent("ResourceComponent");if(n){var r=n.getResource(d.INVULNERABILITY);null===r||0===r?n.setResource(d.INVULNERABILITY,1):n.setResource(d.INVULNERABILITY,0)}}},toggleCollision:function(e){var t=e.id,i=this.__entityManager.getEntity(t);if(i){var n=i.getComponent("CollisionComponent");n&&n.setEnabled(!n.getEnabled());var r=i.getComponent("RectCollisionComponent");r&&r.setEnabled(!r.getEnabled())}},getSpriteAlphaTint:function(e,t){var i=e.id,n=this.__entityManager.getEntity(i);if(n){var s=n.getComponentByName(t);return s?g.getA(s.getTintColor()):(r.warn("Attempted to get tint of an entity with no SpriteComponent: "+e.id),0)}return 0},setSpriteAlphaTint:function(e,t,i){var n=e.id,s=this.__entityManager.getEntity(n);if(s){var o=s.getComponentByName(t);if(!o)return void r.warn("Attempted to set tint of an entity with no SpriteComponent: "+e.id);o.setAlphaTint(i)}},getSpriteTint:function(e,t){var i=e.id,n=this.__entityManager.getEntity(i);if(n){return n.getComponentByName(t).getTintColor()}return 0},setSpriteTint:function(e,t,i){var n=e.id,r=this.__entityManager.getEntity(n);if(r){r.getComponentByName(t).setTintColor(i)}},setTracing:function(e){this.fireBullet=e?this._fireBulletTracing:this._fireBullet},_fireBulletTracing:function(e,t,i,n,s,o){r.debug("BulletML Fire: "+e+" "+t+" "+~~i[0]+" "+~~i[1]),this._fireBullet(e,t,i,n,s,o)},_fireBullet:function(e,t,i,n,r,s,o){var a=e*m,l=Math.sin(a),u=Math.cos(a),c=t*u,d=t*l;if(r.type===_.BulletType.ENTITY){var g=this.__eventManager.getNewEvent(h);g.setX(n[0]),g.setY(n[1]),g.setVx(c),g.setVy(d),g.setAngularVelocity(i),g.setBulletDefinition(r),g.setWaveId(o.spawnedBy),o.isEntity&&g.setParentId(o.id),this.__eventManager.queueEvent(g)}else{var p=this.__bulletManager.spawnBullet(r,n[0],n[1],s);if(!p)return;var f=p.getComponent("BulletComponent"),v=f.getBulletData();v.x=n[0],v.y=n[1],v.vx=c,v.vy=d;var y=p.getComponent("ActionComponent");y.setBulletData(v),r.action?y.setAction(r.action):y.setAction(null)}},fireEvent:function(e,t){var i=this.__eventManager.getNewEvent(u);i.setBulletEventType(e),i.setBulletData(t.clone()),this.__eventManager.queueEvent(i)},fireAnimation:function(e,t,i,n){
s.ifDefined.assertIsNonEmptyString(e);var a=n.id,_=this.__entityManager.getEntity(a);if(_){var l;if(!(l=e?_.getComponentByName(e):_.getComponentBy(o.COMPONENT_TYPE)))return void r.warn("Tried to fire an animation but no animated sprite component was found.");l.setHoldOnLastFrame(t),l.setLoopCount(i?1/0:1),l.show(),l.restart(),i||l.setOnLoopCallback(function(){l.hide()})}},spawnPowerup:function(e){var t=this.__eventManager.getNewEvent(c);t.setX(e.x),t.setY(e.y),t.setUpgradeType(p.SYSTEM_UPGRADE),this.__eventManager.queueEvent(t)},spawnFuel:function(e){var t=this.__eventManager.getNewEvent(c);t.setX(e.x),t.setY(e.y),t.setUpgradeType(p.FUEL_PICKUP),this.__eventManager.queueEvent(t)}})}),define("bulletml/FireAction",["require","exports","module","thor/core/Class","thor/core/Validation","thor/util/RingBufferPool","./Action","./ActionState","./NumberParam","./BulletDefinition"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/util/RingBufferPool")),s=e("./Action"),o=e("./ActionState"),a=e("./NumberParam"),_=(e("./BulletDefinition"),[0,0]),l=180/Math.PI,h=Math.PI/180,u=n.create(o,{initialize:function(){o.prototype.initialize.call(this)},reset:function(){this.direction=0,this.speed=0,this.angularVelocity=0,this.previousFire=null,this.bulletPreviousFire=null}}),c=new r(128,u);i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__direction=null,this.__speed=null,this.__angularVelocity=null,this.__bullet=null,this.__xOffset=null,this.__yOffset=null},getInitialState:function(e,t){var i=t||c.remove();return i.direction=this.__direction.getValue(e),i.speed=this.__speed.getValue(e),i.angularVelocity=this.__angularVelocity.getValue(e)*h,i},disposeState:function(e){e.reset(),c.add(e)},setXOffset:function(e){this.__xOffset=e},setYOffset:function(e){this.__yOffset=e},setDirection:function(e){this.__direction=e},setSpeed:function(e){this.__speed=e},setAngularVelocity:function(e){this.__angularVelocity=e},setBullet:function(e){this.__bullet=e},run:function(e,t,i,n,r){var s=this.__bullet.direction,o=this.__bullet.speed?this.__bullet.speed.getValue(n):0,h=0;if(this.__direction.type===a.Type.ABSOLUTE||this.__direction.type===a.Type.RELATIVE)h=i.direction;else if(this.__direction.type===a.Type.SEQUENCE)null===i.previousFire?(h=i.direction,i.previousFire=i.direction):(h=i.previousFire+i.direction,i.previousFire=h);else if(this.__direction.type===a.Type.FACING)h=i.direction+r.facing;else if(this.__direction.type===a.Type.AIM){var u=Math.atan2(n.aimTarget[1]-r.y,n.aimTarget[0]-r.x);h=u*l+i.direction}if(s)if(s.type===a.Type.ABSOLUTE)h=s.getValue(n);else if(s.type===a.Type.RELATIVE)h+=s.getValue(n);else if(s.type===a.Type.SEQUENCE)null!==i.bulletPreviousFire&&(h=i.bulletPreviousFire+s.getValue(n)),i.bulletPreviousFire=h;else if(s.type===a.Type.AIM){var u=Math.atan2(n.aimTarget[1]-r.y,n.aimTarget[0]-r.x);h=u*l+s.getValue(n)}_[0]=r.x,_[1]=r.y,this.__xOffset&&(_[0]+=this.__xOffset.getValue(n)),this.__yOffset&&(_[1]+=this.__yOffset.getValue(n));var c=i.speed+o;return n.fireBullet(h,c,i.angularVelocity,_,this.__bullet,n.time,r),e}})}),define("bulletml/WaitAction",["require","exports","module","thor/core/Class","thor/core/Validation","thor/util/RingBufferPool","./Action","bulletml/ActionState","./NumberParam"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/util/RingBufferPool")),s=e("./Action"),o=e("bulletml/ActionState"),a=(e("./NumberParam"),n.create(o,{initialize:function(){o.prototype.initialize.call(this)},reset:function(){this.timer=0}})),_=new r(128,a);i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this)},getInitialState:function(e,t){var i=t||_.remove();return i.timer=this.__time.getValue(e),i},disposeState:function(e){_.add(e)},setTime:function(e){this.__time=e},run:function(e,t,i,n,r){var s=i.timer;return i.timer=Math.max(0,s-e),e-(s-i.timer)},isComplete:function(e){return e.timer<=0}})}),define("bulletml/AccelAction",["require","exports","module","thor/core/Enum","thor/core/Class","thor/core/Validation","./Action","bulletml/ActionState","./NumberParam"],function(e,t,i){var n=(e("thor/core/Enum"),e("thor/core/Class")),r=(e("thor/core/Validation"),e("./Action")),s=e("bulletml/ActionState"),o=(e("./NumberParam"),n.create(s,{initialize:function(){s.prototype.initialize.call(this)},reset:function(){this.elapsed=0,this.term=0,this.ax=0,this.ay=0}}));i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.__term=null,this.__vertical=null,this.__horizontal=null},getInitialState:function(e,t){var i=t||new o,n=this.__vertical.getValue(e),r=this.__horizontal.getValue(e);return i.term=this.__term.getValue(e),i.ax=r/i.term,i.ay=n/i.term,i.elapsed=0,i},setTerm:function(e){this.__term=e},setVertical:function(e){this.__vertical=e},setHorizontal:function(e){this.__horizontal=e},isComplete:function(e){return e.elapsed>=e.term},run:function(e,t,i,n,r){if(0===t)return e;var s=i.term-i.elapsed,o=Math.min(e,s);return r.ax+=i.ax*o/t,r.ay+=i.ay*o/t,i.elapsed+=o,e-o}})}),define("bulletml/MoveByAction",["require","exports","module","thor/core/Class","thor/core/Validation","thor/util/RingBufferPool","./Action","bulletml/ActionState","./NumberParam"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/util/RingBufferPool")),s=e("./Action"),o=e("bulletml/ActionState"),a=(e("./NumberParam"),n.create(o,{initialize:function(){o.prototype.initialize.call(this)},reset:function(){this.vx_initial=null,this.vy_initial=null,this.dx=null,this.dy=null,this.vx=null,this.vy=null,this.elapsed=0,this.term=0}})),_=new r(128,a);i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this)},getInitialState:function(e,t){var i=t||_.remove();return i.reset(),i.term=this.__term.getValue(e),i.term<0&&(i.term=0),i.dx=this.__x.getValue(),i.dy=this.__y.getValue(),0===i.term?(i.vx=i.dx,i.vy=i.dy):(i.vx=i.dx/i.term,i.vy=i.dy/i.term),i},disposeState:function(e){e.reset(),_.add(e)},setTerm:function(e){this.__term=e},setX:function(e){this.__x=e},setY:function(e){this.__y=e},isComplete:function(e){return e.elapsed>=e.term},run:function(e,t,i,n,r){var s=i.elapsed;return i.elapsed=Math.min(i.term,i.elapsed+e),r.vx=i.vx,r.vy=i.vy,e-Math.max(0,i.elapsed-s)}})}),define("bulletml/EventAction",["require","exports","module","thor/core/Enum","thor/core/Class","thor/core/Validation","thor/event/EventManager","./Action","bulletml/ActionState","bulletml/BulletData"],function(e,t,i){var n=(e("thor/core/Enum"),e("thor/core/Class")),r=(e("thor/core/Validation"),e("thor/event/EventManager"),e("./Action")),s=e("bulletml/ActionState"),o=(e("bulletml/BulletData"),n.create(s,{initialize:function(){s.prototype.initialize.call(this)},reset:function(){this.eventFired=!1,this.eventType=null}}));i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.__eventType=null},getInitialState:function(e,t){var i=t||new o;return i.eventFired=!1,i.eventType=this.__eventType,i},setType:function(e){this.__eventType=e},isComplete:function(e){return e.eventFired},run:function(e,t,i,n,r){return i.eventFired||(n.fireEvent(i.eventType,r),i.eventFired=!0),e}})}),define("bulletml/VanishAction",["require","exports","module","thor/core/Class","thor/core/Validation","./Action"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Action"));i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this)},getInitialState:function(){return null},isComplete:function(e){return!0},run:function(e,t,i,n,r){return n.vanishBullet(r),e}})}),define("bulletml/AnimationAction",["require","exports","module","thor/core/Class","thor/core/Validation","thor/util/RingBufferPool","./Action","bulletml/ActionState"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/util/RingBufferPool")),s=e("./Action"),o=e("bulletml/ActionState"),a=n.create(o,{initialize:function(){o.prototype.initialize.call(this)},reset:function(){this.animationTriggered=!1,this.componentName=null,this.stopOnLastFrame=!1,this.loop=!1}}),_=new r(128,a);i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__componentName=null,this.__stopOnLastFrame=!1,this.__loop=!1},getInitialState:function(e,t){var i=t||_.remove();return i.reset(),i.animationTriggered=!1,i.componentName=this.__componentName,i.stopOnLastFrame=this.__stopOnLastFrame,i.loop=this.__loop,i},disposeState:function(e){e.reset(),_.add(e)},setStopOnLastFrame:function(e){this.__stopOnLastFrame=e},setLoop:function(e){this.__loop=e},setComponentName:function(e){this.__componentName=e},isComplete:function(e){return e.animationTriggered},run:function(e,t,i,n,r){return i.animationTriggered||(n.fireAnimation(i.componentName,i.stopOnLastFrame,i.loop,r),i.animationTriggered=!0),e}})}),define("bulletml/SetVelocityAction",["require","exports","module","thor/core/Enum","thor/core/Class","thor/core/Validation","thor/util/RingBufferPool","./Action","bulletml/ActionState","./NumberParam"],function(e,t,i){var n=(e("thor/core/Enum"),e("thor/core/Class")),r=(e("thor/core/Validation"),e("thor/util/RingBufferPool")),s=e("./Action"),o=e("bulletml/ActionState"),a=(e("./NumberParam"),Math.PI/180),_=n.create(o,{initialize:function(){o.prototype.initialize.call(this)},reset:function(){this.direction=0,this.speed=0}}),l=new r(128,_);i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__direction=null,this.__speed=null},getInitialState:function(e,t){var i=t||l.remove();return i.direction=this.__direction.getValue(e),i.speed=this.__speed.getValue(e),i},disposeState:function(e){e.reset(),l.add(e)},setDirection:function(e){this.__direction=e},setSpeed:function(e){this.__speed=e},isComplete:function(e){return!0},run:function(e,t,i,n,r){var s=i.direction*a;return r.vx=i.speed*Math.cos(s),r.vy=i.speed*Math.sin(s),e}})}),define("bulletml/ParallelAction",["require","exports","module","thor/core/Class","thor/core/Validation","bulletml/Action","bulletml/ActionState","./NumberParam","./ActionGlobals","thor/util/RingBufferPool"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("bulletml/Action"),o=e("bulletml/ActionState"),a=(e("./NumberParam"),e("./ActionGlobals"),e("thor/util/RingBufferPool")),_=n.create(o,{initialize:function(){o.prototype.initialize.call(this)},reset:function(){this.actionsRemaining=0,this.actionStates=[],this.completedActions=[]}}),l=new a(128,_);i.exports=n.create(s,{initialize:function(e){this.__actions=e},getInitialState:function(e,t){r.ifDefined.assertIsInstanceOf(t,_);for(var i=t||l.remove(),n=this.__actions.length,s=0;s<n;++s)i.actionStates[s]=this.__actions[s].getInitialState(e,i.actionStates[s]),i.completedActions[s]=!1;return i.actionsRemaining=n,i},disposeState:function(e){for(var t=0,i=this.__actions.length;t<i;++t)e.actionStates[t]=this.__actions[t].disposeState(e.actionStates[t]);e.reset(),l.add(e)},run:function(e,t,i,n,r){for(var s=e,o=0,a=this.__actions.length;o<a;++o){var _=i.actionStates[o];if(!i.completedActions[o]){var l=this.__actions[o],h=l.run(e,e,_,n,r);s=Math.min(h,s),l.isComplete(_)&&(i.completedActions[o]=!0,i.actionsRemaining--)}}return s},isComplete:function(e){return 0===e.actionsRemaining}})}),define("bulletml/PlaySoundAction",["require","exports","module","thor/core/Class","thor/core/Validation","./Action"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Action"));i.exports=n.create(r,{initialize:function(){this.__soundName=null,this.__loop=!1},setSoundName:function(e){this.__soundName=e},setLoop:function(e){this.__loop=e},getInitialState:function(){return null},run:function(e,t,i,n,r){return n.playSound(this.__soundName,this.__loop),e},isComplete:function(e){return!0}})}),define("bulletml/SpawnFuelAction",["require","exports","module","thor/core/Class","thor/core/Validation","./Action"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Action"));i.exports=n.create(r,{initialize:function(){this.__soundName=null,this.__loop=!1},getInitialState:function(){return null},run:function(e,t,i,n,r){return n.spawnFuel(r),e},isComplete:function(e){return!0}})}),define("bulletml/StopSoundAction",["require","exports","module","thor/core/Class","thor/core/Validation","./NumberParam","./Action"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./NumberParam"),e("./Action"));i.exports=n.create(r,{initialize:function(){this.__soundName=null,this.__fadeOutDuration=0},setSoundName:function(e){this.__soundName=e},setFadeOutDuration:function(e){this.__fadeOutDuration=e},getInitialState:function(){return null},run:function(e,t,i,n,r){return n.stopSound(this.__soundName,this.__fadeOutDuration.getValue(n)),e},isComplete:function(e){return!0}})}),define("bulletml/ChangeTintAction",["require","exports","module","thor/core/Enum","thor/core/Class","thor/core/Logger","thor/math/ColorUtil","thor/core/Validation","./Action","bulletml/ActionState","./NumberParam","./ActionGlobals","thor/util/RingBufferPool"],function(e,t,i){var n=(e("thor/core/Enum"),e("thor/core/Class")),r=(e("thor/core/Logger").getLogger(i),e("thor/math/ColorUtil")),s=e("thor/core/Validation"),o=e("./Action"),a=e("bulletml/ActionState"),_=(e("./NumberParam"),e("./ActionGlobals"),e("thor/util/RingBufferPool")),l=n.create(a,{initialize:function(){a.prototype.initialize.call(this)},reset:function(){this.elapsed=0,this.term=0,this.tintStart=null,this.tintEnd=null,this.spriteName=null}}),h=new _(16,l);i.exports=n.create(o,{initialize:function(){o.prototype.initialize.call(this),this.__tint={r:null,g:null,b:null,a:null},this.__spriteName=null,this.__termMS=null},getInitialState:function(e,t){s.ifDefined.assertIsInstanceOf(t,l);var i=t||h.remove();i.reset(),i.term=this.__termMS.getValue(e),i.term<=0&&(i.term=1);var n=this.__tint.r.getValue(e),o=this.__tint.g.getValue(e),a=this.__tint.b.getValue(e),_=this.__tint.a.getValue(e),u=r.createRGBA(n,o,a,_);return i.tintEnd=u,i.spriteName=this.__spriteName,i.elapsed=0,i},disposeState:function(e){e.reset(),h.add(e)},setTerm:function(e){this.__termMS=e},setTintColor:function(e,t,i,n){this.__tint.r=e,this.__tint.g=i,this.__tint.b=t,this.__tint.a=n},setSprite:function(e){this.__spriteName=e},isComplete:function(e){return e.elapsed>=e.term},run:function(e,t,i,n,s){null===i.tintStart&&(i.tintStart=n.getSpriteTint(s,i.spriteName)),i.elapsed+=e;var o,a;i.elapsed>=i.term?(o=i.elapsed-i.term,a=1):(o=0,a=i.elapsed/i.term);var _=r.lerp(i.tintStart,i.tintEnd,a);return n.setSpriteTint(s,i.spriteName,_),o}})}),define("bulletml/ChangeSpeedAction",["require","exports","module","thor/core/Enum","thor/core/Class","thor/core/Validation","thor/util/RingBufferPool","./Action","bulletml/ActionState","./NumberParam"],function(e,t,i){var n=(e("thor/core/Enum"),e("thor/core/Class")),r=(e("thor/core/Validation"),e("thor/util/RingBufferPool")),s=e("./Action"),o=e("bulletml/ActionState"),a=(e("./NumberParam"),n.create(o,{initialize:function(){o.prototype.initialize.call(this)},reset:function(){this.ax=null,this.ay=null,this.elapsed=0,this.term=0,this.speed=0}})),_=new r(128,a);i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this)},getInitialState:function(e,t){var i=t||_.remove();return i.reset(),i.term=this.__term.getValue(e),i.term<=0&&(i.term=1),i.speed=this.__speed.getValue(e),i},disposeState:function(e){e.reset(),_.add(e)},setTerm:function(e){this.__term=e},setSpeed:function(e){this.__speed=e},isComplete:function(e){return e.elapsed>=e.term},run:function(e,t,i,n,r){if(0===t)return e;if(null===i.ax){var s=r.vx+t*r.ax,o=r.vy+t*r.ay,a=Math.atan2(o,s),_=s,l=o,h=Math.cos(a)*i.speed,u=Math.sin(a)*i.speed,c=1/i.term;i.ax=(h-_)*c,i.ay=(u-l)*c}var d=i.term-i.elapsed,g=Math.min(e,d);return r.ax+=i.ax*g/t,r.ay+=i.ay*g/t,i.elapsed+=g,e-g}})}),define("bulletml/SpawnPowerupAction",["require","exports","module","thor/core/Class","thor/core/Validation","./Action"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Action"));i.exports=n.create(r,{initialize:function(){this.__soundName=null,this.__loop=!1},getInitialState:function(){return null},run:function(e,t,i,n,r){return n.spawnPowerup(r),e},isComplete:function(e){return!0}})}),define("bulletml/ChangeDirectionAction",["require","exports","module","thor/core/Enum","thor/core/Class","thor/core/Validation","./Action","bulletml/ActionState","./NumberParam"],function(e,t,i){var n=(e("thor/core/Enum"),e("thor/core/Class")),r=(e("thor/core/Validation"),e("./Action")),s=e("bulletml/ActionState"),o=(e("./NumberParam"),Math.PI/180),a=n.create(s,{initialize:function(){s.prototype.initialize.call(this)},reset:function(){this.ax=null,this.ay=null,this.elapsed=0,this.term=0,this.direction=0}});i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.__term=null,this.__direction=null},getInitialState:function(e,t){var i=t||new a;return i.reset(),i.term=this.__term.getValue(e),i.term<=0&&(i.term=1),i.direction=this.__direction.getValue(e),i.elapsed=0,i},setTerm:function(e){this.__term=e},setDirection:function(e){this.__direction=e},isComplete:function(e){return e.elapsed>=e.term},run:function(e,t,i,n,r){if(0===t)return e;if(null===i.ax){var s=r.vx+t*r.ax,a=r.vy+t*r.ay,_=Math.sqrt(s*s+a*a),l=i.direction*o,h=s,u=a,c=Math.cos(l)*_,d=Math.sin(l)*_,g=1/i.term;i.ax=(c-h)*g,i.ay=(d-u)*g}var p=i.term-i.elapsed,m=Math.min(e,p);return r.ax+=i.ax*m/t,r.ay+=i.ay*m/t,i.elapsed+=m,e-m}})}),define("bulletml/ToggleCollisionAction",["require","exports","module","thor/core/Class","thor/core/Validation","./Action"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Action"));i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this)},getInitialState:function(){return null},isComplete:function(e){return!0},run:function(e,t,i,n,r){return n.toggleCollision(r),e}})}),define("bulletml/ChangeAlphaTintAction",["require","exports","module","thor/core/Enum","thor/core/Class","thor/core/Validation","./Action","bulletml/ActionState","./NumberParam","./ActionGlobals","thor/util/RingBufferPool"],function(e,t,i){var n=(e("thor/core/Enum"),e("thor/core/Class")),r=e("thor/core/Validation"),s=e("./Action"),o=e("bulletml/ActionState"),a=(e("./NumberParam"),e("./ActionGlobals"),e("thor/util/RingBufferPool")),_=n.create(o,{initialize:function(){o.prototype.initialize.call(this)},reset:function(){this.elapsed=0,this.term=0,this.alphaStart=null,this.alphaEnd=null,this.spriteName=null}}),l=new a(128,_);i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__alpha=null,this.__spriteName=null,this.__termMS=null},getInitialState:function(e,t){r.ifDefined.assertIsInstanceOf(t,_);var i=t||l.remove();return i.reset(),i.term=this.__termMS.getValue(e),i.term<=0&&(i.term=1),i.alphaEnd=this.__alpha.getValue(e),i.spriteName=this.__spriteName,i.elapsed=0,i},disposeState:function(e){e.reset(),l.add(e)},setTerm:function(e){this.__termMS=e},setAlpha:function(e){this.__alpha=e},setSprite:function(e){this.__spriteName=e},isComplete:function(e){return e.elapsed>=e.term},run:function(e,t,i,n,r){null===i.alphaStart&&(i.alphaStart=n.getSpriteAlphaTint(r,i.spriteName)),i.elapsed+=e;var s,o;i.elapsed>=i.term?(s=i.elapsed-i.term,o=1):(s=0,o=i.elapsed/i.term);var a=o*i.alphaEnd+(1-o)*i.alphaStart;return n.setSpriteAlphaTint(r,i.spriteName,a),s}})}),define("bulletml/ToggleVulnerabilityAction",["require","exports","module","thor/core/Class","thor/core/Validation","./Action"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Action"));i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this)},getInitialState:function(){return null},isComplete:function(e){return!0},run:function(e,t,i,n,r){return n.toggleVulnerability(r),e}})}),define("bulletml/ChangeAngularVelocityAction",["require","exports","module","thor/core/Enum","thor/core/Class","thor/core/Validation","./Action","bulletml/ActionState","./NumberParam","./ActionGlobals","thor/util/RingBufferPool"],function(e,t,i){var n=(e("thor/core/Enum"),e("thor/core/Class")),r=e("thor/core/Validation"),s=e("./Action"),o=e("bulletml/ActionState"),a=(e("./NumberParam"),e("./ActionGlobals"),e("thor/util/RingBufferPool")),_=Math.PI/180,l=n.create(o,{initialize:function(){o.prototype.initialize.call(this)},reset:function(){this.elapsed=0,this.term=0,this.startingAngularVelocity=null,this.finalAngularVelocity=null}}),h=new a(16,l);i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__angularVelocity=null,this.__term=null},getInitialState:function(e,t){r.ifDefined.assertIsInstanceOf(t,l);var i=t||h.remove();return i.reset(),i.term=this.__term.getValue(e),i.term<=0&&(i.term=1),i.finalAngularVelocity=this.__angularVelocity.getValue(e)*_,i.elapsed=0,i},disposeState:function(e){e.reset(),h.add(e)},setTerm:function(e){this.__term=e},setAngularVelocity:function(e){this.__angularVelocity=e},isComplete:function(e){return e.elapsed>=e.term},run:function(e,t,i,n,r){null===i.startingAngularVelocity&&(i.startingAngularVelocity=r.angularVelocity),i.elapsed+=e;var s,o;return i.elapsed>=i.term?(s=i.elapsed-i.term,o=1):(s=0,o=i.elapsed/i.term),r.angularVelocity=o*i.finalAngularVelocity+(1-o)*i.startingAngularVelocity,s}})}),define("bulletml/BulletMLResource",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/EventManager","./FireAction","./WaitAction","./AccelAction","./MoveByAction","./EventAction","./NumberParam","./VanishAction","./SequenceAction","./AnimationAction","./SetVelocityAction","./ParallelAction","./PlaySoundAction","./SpawnFuelAction","./StopSoundAction","./ChangeTintAction","./BulletDefinition","./ChangeSpeedAction","./SpawnPowerupAction","./ChangeDirectionAction","./ToggleCollisionAction","./ChangeAlphaTintAction","./ToggleVulnerabilityAction","./ChangeAngularVelocityAction"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=(e("thor/event/EventManager"),e("./FireAction")),o=e("./WaitAction"),a=e("./AccelAction"),_=e("./MoveByAction"),l=e("./EventAction"),h=e("./NumberParam"),u=e("./VanishAction"),c=e("./SequenceAction"),d=e("./AnimationAction"),g=e("./SetVelocityAction"),p=e("./ParallelAction"),m=e("./PlaySoundAction"),f=e("./SpawnFuelAction"),v=e("./StopSoundAction"),y=e("./ChangeTintAction"),E=e("./BulletDefinition"),S=e("./ChangeSpeedAction"),T=e("./SpawnPowerupAction"),C=e("./ChangeDirectionAction"),I=e("./ToggleCollisionAction"),w=e("./ChangeAlphaTintAction"),b=e("./ToggleVulnerabilityAction"),M=e("./ChangeAngularVelocityAction");i.exports=n.create({initialize:function(e){if("bulletml"!==e.nodeName)throw new Error("BulletML definition must have a `bulletml` tag as the root");this.__root=e,this.__bulletTypesUsed=[],this.__fireCount=0;var t=this.__findByLabel("top");if(!t||"action"!==t.nodeName)throw new Error("No `top` action found");var i=this.__parseSequenceAction(t,[]),n={},r=this.__findByTagName("metadata");if(r)for(var s=r.childNodes.length,o=0;o<s;++o){var a=r.childNodes[o];1===a.nodeType&&(n[a.nodeName]=a.textContent.trim())}this.__metadata=n,this.__topAction=i,delete this.__root},getAction:function(){return this.__topAction},getFireCount:function(){return this.__fireCount},getMetadata:function(){return this.__metadata},getBulletTypesUsed:function(){return this.__bulletTypesUsed},__findByTagName:function(e){for(var t=this.__root.childNodes.length,i=0;i<t;++i){var n=this.__root.childNodes[i];if(1===n.nodeType&&e===n.nodeName)return n}return null},__findByLabel:function(e){for(var t=this.__root.childNodes.length,i=0;i<t;++i){var n=this.__root.childNodes[i];if(1===n.nodeType){if(e===n.getAttribute("label"))return n}}return null},__findChild:function(e,t){for(var i=e.childNodes.length,n=0;n<i;++n){var r=e.childNodes[n];if(1===r.nodeType&&r.nodeName===t)return r}return null},__parseNumberParam:function(e,t,i,n){var r=this.__findChild(e,t);return r?h.fromNode(r,i):h.fromNumber(n,h.Type.ABSOLUTE)},__parseInstantaneousEvent:function(e,t,i){for(var n=null,r=0,s=t.childNodes.length;r<s;r++){var o=t.childNodes[r];if(1===o.nodeType){if("action"!==o.nodeName)throw new Error("`"+e+"` events must have a single `action` child.");if(null!==n)throw new Error("`"+e+"` events must have a single `action` child.");n=o}}return this.__parseSequenceAction(n,i)},__parseEvents:function(e,t){for(var i={},n=0,r=e.childNodes.length;n<r;n++){var s=e.childNodes[n];if(1===s.nodeType){var o=null;switch(s.nodeName){case"death":o=this.__parseInstantaneousEvent("death",s,t),i.death=o;break;case"childKilled":o=this.__parseInstantaneousEvent("childKilled",s,t),i.childKilled=o;break;case"allChildrenKilled":o=this.__parseInstantaneousEvent("allChildrenKilled",s,t),i.allChildrenKilled=o;break;case"siblingKilled":o=this.__parseInstantaneousEvent("siblingKilled",s,t),i.siblingKilled=o;break;case"parentKilled":o=this.__parseInstantaneousEvent("parentKilled",s,t),i.parentKilled=o;break;default:throw new Error("Unknown event type encountered: "+s.nodeName)}}}return i},__parseAction:function(e,t){for(var i=[],n=e.childNodes.length,r=0;r<n;++r){var s=e.childNodes[r];if(1===s.nodeType){var a=null;switch(s.nodeName){case"repeat":a=this.__parseRepeat(s,t);break;case"fire":a=this.__parseFire(s,t);break;case"fireRef":a=this.__parseRef("fire",s);break;case"changeSpeed":a=this.__parseChangeSpeed(s,t);break;case"changeDirection":a=this.__parseChangeDirection(s,t);break;case"setVelocity":a=this.__parseSetVelocity(s,t);break;case"moveBy":a=this.__parseMoveBy(s,t);break;case"playSound":a=this.__parsePlaySound(s,t);break;case"stopSound":a=this.__parseStopSound(s,t);break;case"toggleVulnerability":a=new b;break;case"toggleCollision":a=new I;break;case"changeAlphaTint":a=this.__parseChangeAlphaTint(s,t);break;case"changeTint":a=this.__parseChangeTint(s,t);break;case"parallelAction":a=this.__parseParallelAction(s,t);break;case"accel":a=this.__parseAccel(s,t);break;case"changeAngularVelocity":a=this.__parseChangeAngularVelocity(s,t);break;case"wait":var _=h.fromNode(s,t);a=new o,a.setTime(_);break;case"vanish":a=new u;break;case"action":a=this.__parseSequenceAction(s,t);break;case"actionRef":a=this.__parseRef("action",s);break;case"event":a=this.__parseEvent(s,t);break;case"animation":a=this.__parseAnimation(s,t);break;case"spawnFuel":a=this.__parseSpawnFuel(s,t);break;case"spawnPowerup":a=this.__parseSpawnPowerup(s,t);break;default:throw new Error("Unknown tag encountered: "+s.nodeName)}i.push(a)}}return i},__parseSequenceAction:function(e,t){return new c(this.__parseAction(e,t))},__parseParallelAction:function(e,t){return new p(this.__parseAction(e,t))},__parseFire:function(e,t){var i=this.__findChild(e,"direction"),n=this.__findChild(e,"speed"),r=this.__findChild(e,"angularVelocity"),o=this.__findChild(e,"bullet"),a=this.__findChild(e,"bulletRef"),_=this.__findChild(e,"offset");if(!o&&!a)throw new Error("`fire` has no child `bullet` or `bulletRef`");var l;l=i?h.fromNode(i,t):h.fromNumber(0,h.Type.ABSOLUTE);var u;u=n?h.fromNode(n,t):h.fromNumber(0,h.Type.ABSOLUTE);var c;c=r?h.fromNode(r,t):h.fromNumber(0,h.Type.ABSOLUTE);var d=new s;d.setDirection(l),d.setSpeed(u),d.setAngularVelocity(c);var g;if(o?g=this.__parseBullet(o,t):a&&(g=this.__parseRef("bullet",a)),_){var p=this.__findChild(_,"x"),m=this.__findChild(_,"y");p&&d.setXOffset(h.fromNode(p,t)),m&&d.setYOffset(h.fromNode(m,t))}return this.__fireCount++,d.setBullet(g),d},__parseBullet:function(e,t){var i=this.__findChild(e,"direction"),n=this.__findChild(e,"speed"),s=this.__findChild(e,"type"),o=this.__findChild(e,"damage"),a=this.__findChild(e,"metadata");if(!s)throw new Error("`bullet` tag is missing `type`");var _=s.textContent;this.__bulletTypesUsed.indexOf(_)===-1&&this.__bulletTypesUsed.push(_);var l,u=s.getAttribute("class");if("bullet"!==u&&u){if("entity"!==u)throw new Error("`type` tag has unknown `class` value: "+u);l=E.BulletType.ENTITY}else l=E.BulletType.BULLET;var c=new E(_,l);if(i&&c.setDirection(h.fromNode(i,t)),n&&c.setSpeed(h.fromNode(n,t)),o){var d=Number(o.textContent);if(!r.isNumber(d))throw new Error("Bullet damage was not a number: `"+o.textContent+"`");c.setDamage(d)}var g={};if(a)for(var p=0,m=a.childNodes.length;p<m;++p){var f=a.childNodes[p];if(1===f.nodeType){var v=f.textContent.trim(),y=f.getAttribute("type")||"number";if("number"==y){var S=+v;if(!r.isNumber(S))throw new Error("Number metadata `"+f.nodeName+"` was not a number: `"+v+"`");g[f.nodeName]=+v}else if("string"==y)g[f.nodeName]=v;else{if("boolean"!=y)throw new Error("Unknown metadata type of `"+y+"` in `"+f.nodeName+"`");var T=!!v;if(!r.isBoolean(T))throw new Error("Number metadata `"+f.nodeName+"` was not a boolean: `"+v+"`");g[f.nodeName]=T}}}c.setMetadata(g);var C=this.__findChild(e,"action");C&&c.setAction(this.__parseSequenceAction(C,t));var I=this.__findChild(e,"events");return I&&c.setEvents(this.__parseEvents(I,t)),c},__parseAccel:function(e,t){var i,n=this.__findChild(e,"horizontal"),r=this.__findChild(e,"vertical");i=n?h.fromNode(n,t):h.fromNumber(0,h.Type.ABSOLUTE);var s;s=r?h.fromNode(r,t):h.fromNumber(0,h.Type.ABSOLUTE);var o,_=this.__findChild(e,"term");o=_?h.fromNode(_,t):h.fromNumber(0,h.Type.ABSOLUTE);var l=new a;return l.setVertical(s),l.setHorizontal(i),l.setTerm(o),l},__parseEvent:function(e,t){var i=e.getAttribute("type");if(null===i)throw new Error("Event tags must have a `type` attribute");var n=new l;return n.setType(i),n},__parseAnimation:function(e,t){var i,n="true"===e.getAttribute("stopOnLastFrame"),s="true"===e.getAttribute("loop"),o=this.__findChild(e,"componentName");if(o&&(i=o.innerHTML,!r.isNonEmptyString(i)))throw new Error("`animation` `componentName` was empty");var a=new d;return a.setStopOnLastFrame(n),a.setLoop(s),i&&a.setComponentName(i),a},__parsePlaySound:function(e,t){var i=this.__findChild(e,"soundName");if(!i)throw new Error("`playSound` has no `soundName` child");var n=i.textContent,r="true"===e.getAttribute("loop"),s=new m;return s.setSoundName(n),s.setLoop(r),s},__parseStopSound:function(e,t){var i=this.__findChild(e,"soundName");if(!i)throw new Error("`stopSound` has no `soundName` child");var n=i.textContent,r=this.__findChild(e,"fadeOutDuration"),s=r?h.fromNode(r,t):h.fromNumber(0,h.Type.ABSOLUTE),o=new v;return o.setSoundName(n),o.setFadeOutDuration(s),o},__parseChangeSpeed:function(e,t){var i=this.__findChild(e,"speed");if(!i)throw new Error("`changeSpeed` had no `speed` child");var n,r=h.fromNode(i,t),s=this.__findChild(e,"term");n=s?h.fromNode(s,t):h.fromNumber(0,h.Type.ABSOLUTE);var o=new S;return o.setSpeed(r),o.setTerm(n),o},__parseChangeAlphaTint:function(e,t){var i=this.__findChild(e,"alpha");if(!i)throw new Error("`changeAlphaTint` has no `alpha` child");var n=h.fromNode(i,t),r=this.__findChild(e,"sprite");if(!r)throw new Error("`changeAlphaTint` has no `sprite` child");var s=r.textContent,o=this.__findChild(e,"term"),a=o?h.fromNode(o,t):h.fromNumber(0,h.Type.ABSOLUTE),_=new w;return _.setAlpha(n),_.setSprite(s),_.setTerm(a),_},__parseChangeTint:function(e,t){var i=this.__parseNumberParam(e,"r",t,0),n=this.__parseNumberParam(e,"g",t,0),r=this.__parseNumberParam(e,"b",t,0),s=this.__parseNumberParam(e,"a",t,255),o=this.__findChild(e,"sprite");if(!o)throw new Error("`changeAlphaTint` has no `sprite` child");var a=o.textContent,_=this.__parseNumberParam(e,"term",t,0),l=new y;return l.setTintColor(i,n,r,s),l.setSprite(a),l.setTerm(_),l},__parseChangeAngularVelocity:function(e,t){var i=this.__findChild(e,"angularVelocity");if(!i)throw new Error("`changeAngularVelocity` has no `angularVelocity` child");var n=h.fromNode(i,t),r=this.__findChild(e,"term"),s=r?h.fromNode(r,t):h.fromNumber(0,h.Type.ABSOLUTE),o=new M;return o.setAngularVelocity(n),o.setTerm(s),o},__parseChangeDirection:function(e,t){var i=this.__findChild(e,"direction");if(!i)throw new Error("`changeDirection` had no `direction` child");var n,r=this.__findChild(e,"term");n=r?h.fromNode(r,t):h.fromNumber(0,h.Type.ABSOLUTE)
;var s=h.fromNode(i,t),o=new C;return o.setTerm(n),o.setDirection(s),o},__parseSetVelocity:function(e,t){var i=this.__findChild(e,"direction");if(!i)throw new Error("`setVelocity` had no `direction` child");var n=this.__findChild(e,"speed");if(!n)throw new Error("`setVelocity` had no `speed` child");var r=h.fromNode(i,t),s=h.fromNode(n,t),o=new g;return o.setDirection(r),o.setSpeed(s),o},__parseRef:function(e,t){var i=t.getAttribute("label");if(null===i)throw new Error("Ref tags must have a `label` attribute");if("top"===i)throw new Error("Cannot reference `top` action");for(var n=[],s=t.childNodes.length,o=0;o<s;++o){var a=t.childNodes[o];if(1===a.nodeType){if("param"!==a.nodeName)throw new Error("Ref nodes must only contain `param` nodes");var _=Number(a.textContent);if(!r.isNumber(_))throw new Error("`param` must contain a number, instead got: "+a.textContent);n.push(_)}}var l={action:this.__parseSequenceAction,bullet:this.__parseBullet,fire:this.__parseFire},h=this.__findByLabel(i);if(!h)throw new Error("Referenced "+e+" `"+i+"` not found");if(h.nodeName!==e)throw new Error("Referenced "+e+" `"+i+"` was not a "+e+", it was "+h.nodeName);return l[e].call(this,h,n)},__parseRepeat:function(e,t){for(var i=[],n=e.childNodes.length,r=0;r<n;++r){var s=e.childNodes[r];1===s.nodeType&&i.push(s)}if(2!==i.length)throw new Error("`repeat` must have exactly two children");var o=i[0],a=i[1];if("times"!==o.nodeName)throw new Error("First child of `repeat` must be `times`");var _,l=h.fromNode(o,t);if("action"===a.nodeName)_=this.__parseSequenceAction(a,t);else{if("actionRef"!==a.nodeName)throw new Error("Second child of `repeat` must be `action` or `actionRef`");_=this.__parseRef("action",a)}var u=new c([_]);return u.repeat(l),u},__parseMoveBy:function(e,t){var i=this.__parseNumberParam(e,"x",t,0),n=this.__parseNumberParam(e,"y",t,0),r=this.__parseNumberParam(e,"term",t,1),s=new _;return s.setX(i),s.setY(n),s.setTerm(r),s},__parseSpawnFuel:function(e,t){return new f},__parseSpawnPowerup:function(e,t){return new T}}),i.exports.RESOURCE_TYPE="bulletml"}),define("bulletml/BulletMLLoader",["require","exports","module","thor/core/Class","thor/core/Validation","thor/util/XMLLoader","thor/resources/ResourceLoader","./BulletMLResource"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/util/XMLLoader")),s=e("thor/resources/ResourceLoader"),o=e("./BulletMLResource"),a=[o.RESOURCE_TYPE];i.exports=n.create(s,{initialize:function(e){s.prototype.initialize.call(this,a),this.__resourceManager=e},guid:function(e,t){return"bulletml-"+t},load:function(e,t){var i=this;return new Promise(function(n,s){i.__resourceManager.has(r.RESOURCE_TYPE,e)?n(i.__resourceManager.get(r.RESOURCE_TYPE,e)):i.__resourceManager.loader(r.RESOURCE_TYPE).load(e,t).then(function(){n(i.__resourceManager.get(r.RESOURCE_TYPE,e))})}).then(function(e){return new o(e)})}})}),define("gameplay/GamePopupTypeEnum",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum");i.exports=n.create("GamePopupTypeEnum",{RUN_1_INTRO:0,FUEL_MISSION_COMPLETE:1,RUN_2_INTRO:2,MINIBOSS_MISSION_COMPLETE:3})}),define("gameplay/LevelGroupTypeEnum",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum");i.exports=n.create("LevelGroupTypeEnum",{NORMAL:1,BOSS:2,MINIBOSS:3,HAZARD:4})}),define("gameplay/LevelSectionTypeEnum",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum");i.exports=n.create("LevelSectionTypeEnum",{ENEMY_WAVE:1,LOOP:2,TIMED_WAVE:3,POPUP_DIALOG:4})}),define("gameplay/Level",["require","exports","module","thor/core/Class","thor/core/Validation","gameplay/GamePopupTypeEnum","gameplay/LevelGroupTypeEnum","gameplay/LevelSectionTypeEnum"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("gameplay/GamePopupTypeEnum")),s=e("gameplay/LevelGroupTypeEnum"),o=e("gameplay/LevelSectionTypeEnum"),a=n.create({initialize:function(){this.type=o.ENEMY_WAVE,this.groupId=0,this.initialDelay=0,this.numSpawns=0,this.spawnInterval=0,this.speedIncrease=1,this.goldChance=1,this.goldDropped=1,this.drop=!1,this.loopIndex=0,this.waveDelay=0,this.killDelay=0,this.sectionTime=0,this.popupType=r.getValues()[0]}}),_=n.create({initialize:function(e){this.name=e,this.type=s.NORMAL,this.baseHealth=1,this.baseValue=1,this.waves={}}}),l=n.create({initialize:function(){this.weight=1,this.enabled=!0}});_.Wave=l;var h=n.create({initialize:function(e){this.name=e,this.groups={},this.sections=[],this.fuel={}},validate:function(e){var t=null;0===this.sections.length&&(t||(t=[])).push("Levels need at least one section");for(var i=0;i<this.sections.length;++i){var n=this.sections[i];n.type!=o.ENEMY_WAVE||n.groupId||(t||(t=[])).push("Section "+i+" has no group set")}for(var r=Object.keys(this.groups),i=0;i<r.length;++i){var s=this.groups[r[i]];if(0===Object.keys(s.waves).length)(t||(t=[])).push("Group "+s.name+" needs at least one wave");else for(var a in s.waves)e.has("bulletml",a)||(t||(t=[])).push('Group "'+s.name+'" uses pattern "'+a+"\" which isn't loaded")}return t}});h.fromObject=function(e){var t=new h(e.name),i=e.fuel||{};return Object.keys(i).forEach(function(e){var n=i[e];t.fuel[e]=n}),Object.keys(e.groups).forEach(function(i){var n=e.groups[i],r=new _(n.name);for(var s in r)r[s]=n[s];t.groups[i]=r}),t.sections=e.sections.map(function(e){var t=new a;for(var i in t)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}),t},h.Section=a,h.Group=_,h.RESOURCE_TYPE="level",i.exports=h}),define("gameplay/LevelLoader",["require","exports","module","thor/core/Class","thor/core/Validation","gameplay/Level","thor/util/JSONLoader","thor/util/BulkXMLLoader","thor/resources/ResourceLoader"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("gameplay/Level")),s=(e("thor/util/JSONLoader"),e("thor/util/BulkXMLLoader"),e("thor/resources/ResourceLoader")),o=[r.RESOURCE_TYPE];i.exports=n.create(s,{initialize:function(e){s.prototype.initialize.call(this,o),this.__resourceManager=e},guid:function(e,t){return r.RESOURCE_TYPE+"-"+t},load:function(e,t){var i={json:[{name:e,parameters:[t]}]},n=this;return this.__resourceManager.loadBulk(i).then(function(){var t=n.__resourceManager.get("json",e),i=r.fromObject(t),s={};for(var o in i.groups){var a=i.groups[o];for(var _ in a.waves)s[_]=!0}var l={bulletml:Object.keys(s).map(function(e){return{name:e,parameters:[e+".xml"]}})};return n.__resourceManager.loadBulk(l).then(function(){return i})})}})}),define("thor/entity/UiComponent",["require","exports","module","thor/core/Class","thor/core/Logger","thor/webgl/Texture","thor/core/Validation","thor/ui/UiRoot","thor/math/MatrixUtil","./SceneComponent","./EntityComponent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/webgl/Texture"),e("thor/core/Validation"),e("thor/ui/UiRoot"),e("thor/math/MatrixUtil")),s=e("./SceneComponent"),o=(e("./EntityComponent"),new Float32Array(16));r.identity4x4(o),i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__uiRoot=null},getType:function(){return"UiComponent"},debugDraw:function(e){this.__uiRoot&&e.lineBatch.addRect(0,0,this.__uiRoot.__uiWidth,this.__uiRoot.__uiHeight,this._worldToLocalTransform,this.__tintColor)},setUiRoot:function(e){this.__uiRoot=e},updateTransform:function(){s.prototype.updateTransform.call(this),this.__uiRoot&&(o[0]=this._worldToLocalTransform[0],o[1]=this._worldToLocalTransform[1],o[4]=this._worldToLocalTransform[2],o[5]=this._worldToLocalTransform[3],o[12]=this._worldToLocalTransform[4]*this.__uiRoot.getScale(),o[13]=this._worldToLocalTransform[5]*this.__uiRoot.getScale(),this.__uiRoot.setTransform(o))},drawWebGL:function(e){this.__uiRoot&&this.__uiRoot.draw(e)}})}),define("thor/entity/SkeletonComponent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger","thor/webgl/Shader","thor/webgl/Buffer","thor/webgl/Texture","thor/webgl/shaders/SpriteBatch","thor/math/ColorUtil","thor/math/MatrixUtil","thor/graphics/animation/skeleton/SkeletonInstance","./SceneComponent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/core/Logger").getLogger(i),o=(e("thor/webgl/Shader"),e("thor/webgl/Buffer"),e("thor/webgl/Texture")),a=e("thor/webgl/shaders/SpriteBatch"),_=e("thor/math/ColorUtil"),l=(e("thor/math/MatrixUtil"),e("thor/graphics/animation/skeleton/SkeletonInstance")),h=e("./SceneComponent"),u={},c=a.VERTEX_OFFSETS,d=a.VERTEX_LENGTH,g=a.VERTEX_FLOAT32_LENGTH,p=a.VERTEX_UINT8_LENGTH,m=new Float32Array(16);i.exports=n.create(h,{initialize:function(){h.prototype.initialize.call(this),this.__animations={},this.__drawBones=!1,this.__drawMeshWireframe=!1,this.__drawAttachments=!0,this.__vertexFormat=null,this.__vertexTmp=[],this.__vertexTmp2=[],this.__tmpVertexData=new Float32Array(400),this.__defaultAnimation=null,this.__currentAnimation=null,this.__animationMixins=[],this.__mixinAttachments={},this.__animationElapsedTime=0,this.__tintColor=4294967295,this.__showDefaultAnimation=!0,this.__stopOnAnimationEnd=!1,this.__animationEndedCallback=void 0,this.__playbackRate=1,this.__animationsQueue=[],this.__enabled=!0},reset:function(){h.prototype.reset.call(this),this.__animations={},this.__defaultAnimation=null,this.__currentAnimation=null,this.__animationMixins=[],this.__mixinAttachments={},this.__animationElapsedTime=0,this.__tintColor=4294967295,this.__showDefaultAnimation=!0,this.__stopOnAnimationEnd=!1,this.__animationEndedCallback=void 0,this.__playbackRate=1,this.__animationsQueue=[],this.__enabled=!0,this.__skeleton.resetSkin()},setTintColor:function(e){this.__tintColor=e},getTintColor:function(){return this.__tintColor},getType:function(){return"SkeletonComponent"},setSkeleton:function(e){this.__skeleton=e},getSize:function(e){e[0]=this.__skeleton.skeleton.width,e[1]=this.__skeleton.skeleton.height},setAnimationEndedCallback:function(e){this.__animationEndedCallback=e},clearAnimationEndedCallback:function(){delete this.__animationEndedCallback},setPlaybackRate:function(e){this.__playbackRate=e},setDefaultAnimation:function(e){var t=this.__skeleton.skeleton.getAnimation(e);if(null===t)throw new Error("Invalid animation name "+e);return this.__defaultAnimation===t?this:(this.__defaultAnimation=t,this.__currentAnimation||this.playAnimation(e),this)},playAnimation:function(e,t,i){if(!this.__enabled)return this;r.ifDefined.assertIsBoolean(t),r.ifDefined.assertIsBoolean(i);var n=this.__skeleton.skeleton.getAnimation(e);if(null===n)throw new Error("Invalid animation name "+e);return this.__showDefaultAnimation=!t,this.__stopOnAnimationEnd=!!i,this.__currentAnimation=n,this.__animationElapsedTime=0,this.__skeleton.setToSetupPose(),this.update(0),this},queueAnimation:function(e){return this.__animationsQueue.push(e),this},setEnabled:function(e){this.__enabled=e},getCurrentAnimationName:function(){return this.__currentAnimation?this.__currentAnimation.name:""},addAnimation:function(e,t){throw new Error("Animation blending is no longer supported")},mixAnimation:function(e,t){var i=this.__skeleton.skeleton.getAnimation(e);if(null===i)throw new Error("Invalid animation name "+e);this.__animationMixins.push({time:0,animation:i,repeat:!!t});for(var n in i.slotsAffected)this.__mixinAttachments[n]=0;this.__skeleton.setToSetupPose(),this.update(0)},unmixAnimation:function(e){for(var t=0,i=this.__animationMixins.length;t<i;++t){var n=this.__animationMixins[t];if(n.animation.name===e){for(var r in n.animation.slotsAffected)delete this.__mixinAttachments[r];if(0===t)return this.__animationMixins.length=0,!0;for(++t;t<i;++t)this.__animationMixins[t-1]=this.__animationMixins[t];return this.__animationMixins.length-=1,this.__skeleton.setToSetupPose(),this.update(0),!0}}return!1},getAnimationNames:function(){return this.__skeleton.skeleton.animations.map(function(e){return e.name})},getAnimationDuration:function(e){var t=this.__skeleton.skeleton.getAnimation(e);if(null===t)throw new Error("Invalid animation name "+e);return t.duration},setSkin:function(e){this.__skeleton.setSkin(e,!0)},addSkin:function(e){this.__skeleton.addSkin(e)},removeSkin:function(e){this.__skeleton.removeSkin(e)},resetSkin:function(){this.__skeleton.setDefaultSkin()},getActiveSkin:function(){return this.__skeleton.skin},_initWebGL:function(e){var t=this.__skeleton.skeleton.textureAtlas;this.texture=o.getTextureFromDomImage(e,t.getImage().getDOMElement());for(var i=this.__skeleton.skeleton.defaultSkin,n=i.getMaxVertices(),r=0,_=this.__skeleton.skeleton.skins,l=0;l<_.length;++l){var h=_[l];h!==i&&(r=Math.max(r,h.getMaxVertices()))}n+=r,s.debug("[SkeletonComponent - "+this.__skeleton.skeleton.name+"] Allocating buffer for "+n+" vertices");var u=n/4,c=6*u-2;this.__vertexData=new ArrayBuffer(d*n),this.__indexData=new Uint16Array(c),this.__vertexDataFloat32=new Float32Array(this.__vertexData),this.__vertexDataUint8=new Uint8Array(this.__vertexData);for(var l=0;l<n;++l)this.__vertexDataFloat32.set(a.IDENTITY_VERTEX,l*g)},update:function(e){if(this.__currentAnimation){var t=e*this.__playbackRate;this.__animationElapsedTime;this.__animationElapsedTime+=t;var i=.001*this.__animationElapsedTime,n=this.__currentAnimation,r=n.duration;n.applyTimelines(this.__skeleton,i-.001*t,i,this,u,this.__mixinAttachments);var s=n.bonesAffected,o=(n.slotsAffected,i);i=.001*t;for(var a=0;a<this.__animationMixins.length;++a){var _=this.__animationMixins[a],n=_.animation,l=_.time+i;_.time=l;var h=n.duration;if(l>h){if(!_.repeat){this.unmixAnimation(n.name)&&--a;continue}for(;l>h;)l-=h;_.time=0}var c={};for(var d in n.bonesAffected)c[d]=1;for(var d in s)c[d]=0;n.applyTimelines(this.__skeleton,l-i,l,c,this,u)}if(o>r){if(this.__stopOnAnimationEnd?this.__currentAnimation=null:this.__showDefaultAnimation&&this.__defaultAnimation?this.playAnimation(this.__defaultAnimation.name,!1):this.playAnimation(n.name,!0),this.__animationEndedCallback){var g=this.__animationEndedCallback;this.__animationEndedCallback=void 0,g()}if(0!==this.__animationsQueue.length){var p=this.__animationsQueue.shift();this.playAnimation(p,!0)}}else this.__skeleton.updateWorldTransform()}},clone:function(e){h.prototype.clone.call(this,e);var t=new l(this.__skeleton.skeleton);e.setSkeleton(t)},drawWebGL:function(e){this.__drawAttachments&&this.__drawAttachmentsWebGL(e),this.__drawBones&&(e.lineBatch.end(),e.spriteBatch.saveModelView(m),e.lineBatch.setModelView(m),this.__drawBonesWebGL(e),e.lineBatch.end(),e.lineBatch.setModelView()),this.__drawMeshWireframe&&(e.lineBatch.end(),e.spriteBatch.saveModelView(m),e.lineBatch.setModelView(m),this.__drawMeshWireframeWebGL(e),e.lineBatch.end(),e.lineBatch.setModelView())},__drawBonesWebGL:function(e){for(var t=this.__vertexTmp,i=this.__vertexTmp2,n=this.__skeleton.drawOrder,r=0,s=n.length;r<s;++r){var o=n[r];if(o.attachment){var a=o.bone,_=a.bone.length;a.localToWorld(0,0,t),a.localToWorld(_,0,i),e.lineBatch.addRect(t[0]-5,t[1]-5,10,10,this._worldToLocalTransform,a.bone.color,5),e.lineBatch.addLine(t[0],t[1],i[0],i[1],this._worldToLocalTransform,a.bone.color,3)}}e.lineBatch.addLine(-50,0,50,0,this._worldToLocalTransform,65535,5),e.lineBatch.addLine(0,-50,0,50,this._worldToLocalTransform,65535,5),e.lineBatch.addRect(45,-5,10,10,this._worldToLocalTransform,4278190335,5),e.lineBatch.addRect(-5,45,10,10,this._worldToLocalTransform,4278190335,5)},__drawMeshWireframeWebGL:function(e){for(var t=this.__skeleton.drawOrder,i=this.__tmpVertexData,n=0,r=t.length;n<r;++n){var s=t[n];if(s.attachment){var o=s.attachment,a=s.bone;switch(o.type){case"boundingbox":break;case"region":var _=15728776;o.computeWorldVertices(s,i),e.lineBatch.addLine(i[0],i[1],i[2],i[3],this._worldToLocalTransform,_,2),e.lineBatch.addLine(i[2],i[3],i[4],i[5],this._worldToLocalTransform,_,2),e.lineBatch.addLine(i[4],i[5],i[6],i[7],this._worldToLocalTransform,_,2),e.lineBatch.addLine(i[6],i[7],i[0],i[1],this._worldToLocalTransform,_,2),e.lineBatch.addLine(i[0],i[1],i[4],i[5],this._worldToLocalTransform,_,2);break;case"mesh":case"skinnedmesh":for(var _=4042260616,l=(o.computeWorldVertices(a,i),o.triangles),h=l.length,u=0;u<h;u+=3){var c=l[u+0],d=l[u+1],g=l[u+2];e.lineBatch.addLine(i[2*c],i[2*c+1],i[2*d],i[2*d+1],this._worldToLocalTransform,_,2),e.lineBatch.addLine(i[2*d],i[2*d+1],i[2*g],i[2*g+1],this._worldToLocalTransform,_,2),e.lineBatch.addLine(i[2*g],i[2*g+1],i[2*c],i[2*c+1],this._worldToLocalTransform,_,2)}break;case"entity":var p=o.rootComponent;e.lineBatch.addRect(-10,-10,20,20,p._worldToLocalTransform,15790216,5);var m=p.getAttachmentWidth(),f=p.getAttachmentHeight();e.lineBatch.addLine(0,0,m,0,p._worldToLocalTransform,15790216,2),e.lineBatch.addLine(m,0,m,f,p._worldToLocalTransform,15790216,2),e.lineBatch.addLine(m,f,0,f,p._worldToLocalTransform,15790216,2),e.lineBatch.addLine(0,f,0,0,p._worldToLocalTransform,15790216,2),p.debugDraw(e)}}}},__drawAttachmentsWebGL:function(e){for(var t=this.__skeleton.drawOrder,i=this.__tmpVertexData,n=0,r=0,s=0,o=t.length;s<o;++s){var a=t[s];if(a.attachment){var l=a.attachment;if("boundingbox"!==l.type)if("entity"!==l.type){var h=a.color;4294967295!==this.__tintColor&&(h=_.multiplyColors(this.__tintColor,h));var u=l.computeWorldVertices(a,i),d=l.uvs,m=l.color;4294967295!==m&&(h=_.multiplyColors(m,h));for(var f=0;f<u;++f){var v=(n+f)*g,y=(n+f)*p,E=f<<1;this.__vertexDataFloat32[v+c.x]=i[E],this.__vertexDataFloat32[v+c.y]=i[E+1],this.__vertexDataFloat32[v+c.u]=d[E],this.__vertexDataFloat32[v+c.v]=d[E+1],_.writeToUint8Array(h,this.__vertexDataUint8,y+c.r),this.__vertexDataFloat32.set(this._worldToLocalTransform,v+c.t0)}switch(l.type){case"region":this.__indexData[r+0]=n+0,this.__indexData[r+1]=n+1,this.__indexData[r+2]=n+3,this.__indexData[r+3]=n+2,this.__indexData[r+4]=n+2,this.__indexData[r+5]=n+4,r+=6;break;case"mesh":case"skinnedmesh":throw new Error("Mesh and Skinned Mesh attachment types are not supported!")}n+=u}else{var S=this.__indexData.subarray(0,r),T=this.__vertexDataFloat32.subarray(0,n*g);e.spriteBatch.addVerts(this.texture,T,S),l.rootComponent.drawWebGL(e);var n=0,r=0}}}if(0!==r){var S=this.__indexData.subarray(0,r),T=this.__vertexDataFloat32.subarray(0,n*g);e.spriteBatch.addVerts(this.texture,T,S)}}})}),define("thor/graphics/animation/skeleton/RegionAttachmentComponent",["require","exports","module","thor/core/Class","thor/entity/SceneComponent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/entity/SceneComponent"),s=new Array(8);i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.__slot=null,this.__attachment=null,this.__attachmentWidth=0,this.__attachmentHeight=0},setSlot:function(e){return this.__slot=e,this},setAttachment:function(e){return this.__attachment=e,this},update:function(e){if(this.__slot&&this.__attachment){this.__attachment.computeWorldVertices(this.__slot,s);var t=s[2],i=s[3],n=s[6],r=s[7];this.__attachmentWidth=Math.abs(n-t),this.__attachmentHeight=Math.abs(r-i),this.setTranslation(t,i),this.setAlphaTint(this.__slot.attachment?255:0),this.updateTransform()}},getAttachmentWidth:function(){return this.__attachmentWidth},getAttachmentHeight:function(){return this.__attachmentHeight},debugDraw:function(e){if(this.__slot&&this.__attachment){this.__attachment.computeWorldVertices(this.__slot,s);var t=s[2],i=s[3],n=s[0]-t,r=s[1]-i,o=s[2]-t,a=s[3]-i,_=s[4]-t,l=s[5]-i,h=s[6]-t,u=s[7]-i;e.lineBatch.addRect(n-2,r-2,4,4,this._worldToLocalTransform,4278190335,2),e.lineBatch.addRect(o-2,a-2,4,4,this._worldToLocalTransform,16711935,2),e.lineBatch.addRect(_-2,l-2,4,4,this._worldToLocalTransform,4294902015,2),e.lineBatch.addRect(h-2,u-2,4,4,this._worldToLocalTransform,4294967295,2)}},drawWebGL:function(e){for(var t=this.getChildren(),i=0,n=t.length;i<n;++i)this.__drawWebGLHelper(e,t[i])},__drawWebGLHelper:function(e,t){t.drawWebGL(e);for(var i=t.getChildren(),n=0,r=i.length;n<r;++n)this.__drawWebGLHelper(e,i[n])}})}),define("thor/graphics/particle/Particle",["require","exports","module","thor/core/Class"],function(e,t,i){var n=e("thor/core/Class");i.exports=n.create({positionX:null,positionY:null,startPositionX:null,startPositionY:null,directionX:null,directionY:null,colorR:null,colorG:null,colorB:null,colorA:null,deltaColorR:null,deltaColorG:null,deltaColorB:null,deltaColorA:null,rotation:null,rotationDelta:null,radialAcceleration:null,tangentialAcceleration:null,size:null,sizeDelta:null,timeToLive:null,matrix:null,initialize:function(){this.timeToLive=0,this.matrix=new Float32Array([1,0,0,1,0,0])}})}),define("thor/entity/ParticleSystemComponent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/math/ColorUtil","thor/math/MatrixUtil","thor/math/MersenneTwister","thor/webgl/Texture","thor/graphics/particle/Particle","thor/graphics/resources/TextureRegionResource","thor/graphics/resources/ParticleSystemResource","./World","./SceneComponent","./EntityComponent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/math/ColorUtil")),s=e("thor/math/MatrixUtil"),o=(e("thor/math/MersenneTwister"),e("thor/webgl/Texture")),a=e("thor/graphics/particle/Particle"),_=(e("thor/graphics/resources/TextureRegionResource"),e("thor/graphics/resources/ParticleSystemResource"),e("./World"),e("./SceneComponent")),l=(e("./EntityComponent"),Math.PI/180),h=new Float32Array(2),u=[0,0];new Float32Array(s.IDENTITY_3x2);i.exports=n.create(_,{__mersenneTwister:null,__particleSystem:null,__particles:null,__numActiveParticles:null,__spawnPointX:null,__spawnPointY:null,__spawnEmitDeltaTime:null,__worldSpaceParticles:null,initialize:function(e,t){this.__world=t,_.prototype.initialize.call(this),this.__mersenneTwister=e,this.__particles=[],this.__numActiveParticles=0,this.__spawnEmitDeltaTime=0,this.__spawnPointX=0,this.__spawnPointY=0,this.__worldSpaceParticles=!1,this.__uvs=new Float32Array([0,0,0,1,1,1,1,0]),this.__texture=null,this.__region=null,this.__loop=!0,this.__elapsedSeconds=0},reset:function(){this.__numActiveParticles=0,this.__spawnEmitDeltaTime=0,this.__spawnPointX=0,this.__spawnPointY=0,this.__loop=!0,this.__elapsedSeconds=0;for(var e=0;e<this.__particles.length;++e)this.__particles[e].timeToLive=0;_.prototype.reset.call(this)},clone:function(e){if(_.prototype.clone.call(this,e),e.__uvs=this.__uvs,e.__region=this.__region,e.__particleSystem=this.__particleSystem,e.__worldSpaceParticles=this.__worldSpaceParticles,e.__loop=this.__loop,e.__particles.length<e.__particleSystem.maximumParticles){var t=e.__particles.length;e.__particles.length=e.__particleSystem.maximumParticles;for(var i=t;i<e.__particles.length;++i)e.__particles[i]=new a}},setParticleSystem:function(e){if(0!==e.emitterType)throw new Error("Only emitter type 0 supported for now");this.__particleSystem=e,this.__loop=e.durationSeconds<=0},setTextureRegion:function(e){var t=e.dimensions[0],i=e.dimensions[1];this._dpBoundingBox.width=t,this._dpBoundingBox.height=i,this.__region=e,this.__uvs.set(e.uvs)},getType:function(){return"ParticleSystemComponent"},setSpawnPoint:function(e,t){this.__spawnPointX=e,this.__spawnPointY=t},setWorldSpaceParticles:function(e){this.__worldSpaceParticles=e},_initWebGL:function(e){_.prototype._initWebGL.call(this,e),this.__region&&(this.__texture=o.getTextureFromDomImage(e,this.__region.image.getDOMElement()))},debugDraw:function(e){var t;t=this.__worldSpaceParticles?this.getOwningEntity().getRootComponent().getParent():this._parent,e.lineBatch.addRect(this.__spawnPointX,this.__spawnPointY,20,20,t._worldToLocalTransform,16711935)},drawWebGL:function(e){for(var t=0;t<this.__particles.length;++t){var i=this.__particles[t];if(!(i.timeToLive<=0)){h[0]=h[1]=i.size;var n=r.createRGBAfloat(i.colorR,i.colorG,i.colorB,i.colorA);e.spriteBatch.add(this.__texture,this.__uvs,i.matrix,h,n)}}},update:function(e){var t=e/1e3,i=!0;this.__loop||(this.__elapsedSeconds>this.__particleSystem.durationSeconds?i=!1:this.__elapsedSeconds+=t);var n,r=this.__particleSystem.particleLifespan/this.__particleSystem.maximumParticles;if(n=this.__worldSpaceParticles?this.__world.getScene().getRootComponent():this._parent,this.__worldSpaceParticles){var o=this._worldToLocalTransform;n.getTranslation(u),this.__spawnPointX=o[4]-u[0],this.__spawnPointY=o[5]-u[1]}if(this.__numActiveParticles<this.__particleSystem.maximumParticles&&(this.__spawnEmitDeltaTime+=t),i)for(;this.__numActiveParticles<this.__particleSystem.maximumParticles&&this.__spawnEmitDeltaTime>r;)this.__spawnParticle(),this.__spawnEmitDeltaTime-=r;for(var a=0;a<this.__particles.length;++a){var _=this.__particles[a],h=_.timeToLive;if(_.timeToLive-=t,_.timeToLive<=0)h>0&&this.__numActiveParticles--;else{if(0===this.__particleSystem.emitterType){_.positionX-=_.startPositionX,_.positionY-=_.startPositionY;var c=0,d=0,g=Math.sqrt(_.positionX*_.positionX+_.positionY*_.positionY);if(0!==g)var c=_.positionX/g,d=_.positionY/g;var p=-d,m=c;c*=_.radialAcceleration,d*=_.radialAcceleration,p*=_.tangentialAcceleration,m*=_.tangentialAcceleration;var f=(c+p+this.__particleSystem.gravityX)*t,v=(d+m+this.__particleSystem.gravityY)*t;_.directionX+=f,_.directionY+=v,_.positionX+=_.startPositionX+_.directionX*t,_.positionY+=_.startPositionY+_.directionY*t}_.positionX+=_.directionX*t,_.positionY+=_.directionY*t,_.colorR+=_.deltaColorR*t,_.colorG+=_.deltaColorG*t,_.colorB+=_.deltaColorB*t,_.colorA+=_.deltaColorA*t,_.size+=_.sizeDelta*t,_.rotation+=_.rotationDelta*t;var y=_.rotation*l,E=Math.sin(y),S=Math.cos(y),T=.5*_.size;_.matrix[0]=S,_.matrix[1]=E,_.matrix[2]=-E,_.matrix[3]=S,_.matrix[4]=_.positionX-T,_.matrix[5]=_.positionY-T,s.multiply3x2(n._worldToLocalTransform,_.matrix,_.matrix)}}},__spawnParticle:function(){if(!(this.__numActiveParticles>=this.__particleSystem.maximumParticles)){for(var e=-1,t=this.__particles.length,i=0;i<t;++i)if(this.__particles[i].timeToLive<=0){e=i;break}if(e===-1)throw new Error("Inconsistent particle state in "+this.getName());this.__numActiveParticles++;var n=this.__particles[e];n.positionX=this.__spawnPointX+this.__calculateVariance(this.__particleSystem.sourcePositionVarianceX),n.positionY=this.__spawnPointY+this.__calculateVariance(this.__particleSystem.sourcePositionVarianceY),n.startPositionX=n.positionX,n.startPositionY=n.positionY;var r=this.__particleSystem.emitAngle+this.__calculateVariance(this.__particleSystem.emitAngleVariance),s=r*l,o=Math.cos(s),a=Math.sin(s),_=this.__particleSystem.speed+this.__calculateVariance(this.__particleSystem.speedVariance);n.directionX=o*_,n.directionY=a*_,n.timeToLive=Math.max(1e-4,this.__particleSystem.particleLifespan+this.__calculateVariance(this.__particleSystem.particleLifespanVariance)),n.colorR=this.__particleSystem.startColorRed+this.__calculateVariance(this.__particleSystem.startColorVarianceRed),n.colorG=this.__particleSystem.startColorGreen+this.__calculateVariance(this.__particleSystem.startColorVarianceGreen),n.colorB=this.__particleSystem.startColorBlue+this.__calculateVariance(this.__particleSystem.startColorVarianceBlue),n.colorA=this.__particleSystem.startColorAlpha+this.__calculateVariance(this.__particleSystem.startColorVarianceAlpha);var h=this.__particleSystem.finishColorRed+this.__calculateVariance(this.__particleSystem.finishColorVarianceRed),u=this.__particleSystem.finishColorGreen+this.__calculateVariance(this.__particleSystem.finishColorVarianceGreen),c=this.__particleSystem.finishColorBlue+this.__calculateVariance(this.__particleSystem.finishColorVarianceBlue),d=this.__particleSystem.finishColorAlpha+this.__calculateVariance(this.__particleSystem.finishColorVarianceAlpha);n.deltaColorR=(h-n.colorR)/n.timeToLive,n.deltaColorG=(u-n.colorG)/n.timeToLive,n.deltaColorB=(c-n.colorB)/n.timeToLive,n.deltaColorA=(d-n.colorA)/n.timeToLive,n.rotation=this.__particleSystem.rotationStart+this.__calculateVariance(this.__particleSystem.rotationStartVariance);var g=this.__particleSystem.rotationEnd+this.__calculateVariance(this.__particleSystem.rotationEndVariance);n.rotationDelta=(g-n.rotation)/n.timeToLive,n.radialAcceleration=this.__particleSystem.radialAcceleration+this.__calculateVariance(this.__particleSystem.radialAccelerationVariance),n.tangentialAcceleration=this.__particleSystem.tangentialAcceleration+this.__calculateVariance(this.__particleSystem.tangentialAccelerationVariance),n.size=this.__particleSystem.startParticleSize+this.__calculateVariance(this.__particleSystem.startParticleSizeVariance);var p=this.__particleSystem.finishParticleSize+this.__calculateVariance(this.__particleSystem.finishParticleSizeVariance);n.sizeDelta=(p-n.size)/n.timeToLive}},__calculateVariance:function(e){return e*(2*this.__mersenneTwister.real()-1)}})}),define("thor/graphics/animation/TweenGroup",["require","exports","module","thor/core/Class","thor/core/Validation","./Tweenable","./EasingFunctions"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("./Tweenable");e("./EasingFunctions");i.exports=n.create(s,{initialize:function(){this._tweenables=[]},reset:function(){this._tweenables.length=0},hasTweenable:function(e){for(var t=0;t<this._tweenables.length;++t)if(this._tweenables[t].tweenable===e)return!0;return!1},addTweenable:function(e,t,i){r.ifDefined.assertIsFunction(t),r.ifDefined.assertIsFunction(i),this._tweenables.push({tweenable:e,tickCallback:t,doneCallback:i})},isAnimating:function(){for(var e=0;e<this._tweenables.length;++e)if(this._tweenables[e].tweenable.isAnimating())return!0;return!1},update:function(e){for(var t=0;t<this._tweenables.length;++t){var i=this._tweenables[t];i.tweenable.update(e),i.tickCallback&&i.tickCallback(i.tweenable),i.tweenable.isAnimating()||(this._tweenables.splice(t,1),t--,i.doneCallback&&i.doneCallback(i.tweenable))}}})}),define("components/SCTComponent",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Validation","thor/graphics/animation/Tween","thor/graphics/animation/TweenGroup","thor/event/EventManager","thor/graphics/animation/EasingFunctions","thor/entity/EntityComponent","thor/entity/EntityDestroyedEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Validation"),e("thor/graphics/animation/Tween")),s=e("thor/graphics/animation/TweenGroup"),o=(e("thor/event/EventManager"),e("thor/graphics/animation/EasingFunctions")),a=e("thor/entity/EntityComponent"),_=e("thor/entity/EntityDestroyedEvent"),l={SceneComponent:{required:!0}};i.exports=n.create(a,{initialize:function(e){a.prototype.initialize.call(this),this.__eventManager=e,this.__defaultTintColor=4294967295,this.__tweenGroup=new s,this.__fadeInTween=new r(0,255,200,o.interpolateLinear),this.__fadeOutTween=new r(255,0,200,o.interpolateLinear),this.__translateInTween=new r(0,-160,200,o.interpolateLinear),this.__translateMidTween=new r(0,-160,400,o.interpolateLinear),this.__translateOutTween=new r(0,-160,200,o.interpolateLinear),this.__scaleTween=new r(1,1,1,o.stiffelastic),this.reset()},clone:function(e){e.reset(),e.__defaultTintColor=this.__defaultTintColor},reset:function(){a.prototype.reset.call(this),this.__tweenGroup.reset(),this.__originalX=0,this.__originalY=0,this.__originSet=!1,this.__fadeInTween.reset(),this.__opacityTween=this.__fadeInTween,this.__scaleTween.reset(),this.__fadeOutTween.reset(),this.__translateInTween.reset(),this.__translateMidTween.reset(),this.__translateOutTween.reset(),this.__scaleTween.setFinalValue(1)},setInDistance:function(e){this.__translateInTween.setFinalValue(e)},setMidDistance:function(e){this.__translateMidTween.setFinalValue(e)},setOutDistance:function(e){this.__translateOutTween.setFinalValue(e)},setScale:function(e){this.__scaleTween.setFinalValue(e)},setTintColor:function(e){this.__defaultTintColor=e},startSCT:function(e,t){var i=this;this.__originalX=e,this.__originalY=t,this._siblings.SceneComponent.setTintColor(i.__defaultTintColor),this.__tweenGroup.addTweenable(this.__scaleTween),this.__tweenGroup.addTweenable(this.__fadeInTween),this.__tweenGroup.addTweenable(this.__translateInTween,null,function(e){
i.__tweenGroup.addTweenable(i.__translateMidTween,null,function(e){i.__opacityTween=i.__fadeOutTween,i.__tweenGroup.addTweenable(i.__fadeOutTween,null),i.__tweenGroup.addTweenable(i.__translateOutTween,null,function(e){var t=i.__eventManager.getNewEvent(_);t.setEntityId(i.getOwningEntity().getId()),i.__eventManager.queueEvent(t)})})})},getType:function(){return"SCTComponent"},update:function(e){this.__tweenGroup.update(e),this._siblings.SceneComponent.setTranslation(this.__originalX,this.__originalY+this.__translateInTween+this.__translateMidTween+this.__translateOutTween);var t=+this.__scaleTween;this._siblings.SceneComponent.setScale(t,t),this._siblings.SceneComponent.setAlphaTint(+this.__opacityTween)}}),a.computeDependencies(a,l,i.exports)}),define("components/TextComponent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/math/MatrixUtil","thor/entity/EntityComponent","thor/entity/SceneComponent","thor/graphics/resources/BitmapFont","thor/webgl/Texture"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/math/MatrixUtil"),o=e("thor/entity/EntityComponent"),a=e("thor/entity/SceneComponent"),_=e("thor/graphics/resources/BitmapFont"),l=e("thor/webgl/Texture"),h=new Float32Array(s.IDENTITY_3x2),u=new Float32Array(s.IDENTITY_3x2);i.exports=n.create(a,{initialize:function(){a.prototype.initialize.call(this),this.__bitmapFont=null,this.__texture=null,this.__text="",this.__textWidth=0,this.__textHeight=0,this.__xAlignment=0,this.__yAlignment=0,this.__uvs=new Float32Array([0,0,0,1,1,1,1,0]),this.__extents=new Float32Array(2)},clone:function(e){a.prototype.clone.call(this,e),e.__bitmapFont=this.__bitmapFont,e.__text=this.__text,e.__textWidth=this.__textWidth,e.__textHeight=this.__textHeight,e.__xAlignment=this.__xAlignment,e.__yAlignment=this.__yAlignment},reset:function(){a.prototype.reset.call(this),this.__bitmapFont=null,this.__texture=null,this.__text="",this.__textWidth=0,this.__textHeight=0,this.__xAlignment=0,this.__yAlignment=0},setFont:function(e){this.__bitmapFont=e},setText:function(e){this.__text=e,this.__textWidth=0,this.__textHeight=this.__bitmapFont.__topOverhang+this.__bitmapFont.__lineHeight;for(var t=0,i=0;i<this.__text.length;++i){var n=this.__text.charCodeAt(i),r=0;t&&this.__bitmapFont.__kerningByOrdinal[t]&&this.__bitmapFont.__kerningByOrdinal[t][n]&&(r=this.__bitmapFont.__kerningByOrdinal[t][n]);var s=this.__bitmapFont.__charsByOrdinal[n];s&&(i===this.__text.length-1?this.__textWidth+=s.width+r:this.__textWidth+=s.xAdvance+r,t=n)}this._dpBoundingBox.width=this.__textWidth,this._dpBoundingBox.height=this.__textHeight},setAlignment:function(e,t){this.__xAlignment=e,this.__yAlignment=t},getType:function(){return"TextComponent"},_initWebGL:function(e){r.isInstanceOf(this.__bitmapFont,_)&&(this.__texture=l.getTextureFromDomImage(e,this.__bitmapFont.getDOMElement()))},debugDraw:function(e){e.lineBatch.addRect(0,0,this.__textWidth,this.__textHeight,this._worldToLocalTransform,65535,4)},drawWebGL:function(e){for(var t=0-this.__xAlignment*this.__textWidth,i=this.__bitmapFont.__topOverhang-this.__yAlignment*this.__textHeight,n=0,r=0;r<this.__text.length;++r){var o=this.__text.charCodeAt(r),a=0;n&&this.__bitmapFont.__kerningByOrdinal[n]&&this.__bitmapFont.__kerningByOrdinal[n][o]&&(a=this.__bitmapFont.__kerningByOrdinal[n][o]);var _=this.__bitmapFont.__charsByOrdinal[o],l=this.__bitmapFont.getOrdinalTextureRegion(o);_&&l&&(this.__uvs.set(l.uvs),this.__extents[0]=_.width,this.__extents[1]=_.height,h[4]=t,h[5]=i+_.yOffset,s.multiply3x2(this._worldToLocalTransform,h,u),e.spriteBatch.add(this.__texture,this.__uvs,u,this.__extents,this._combinedTintColor)),t+=_.xAdvance+a,n=o}}}),o.computeDependencies(a,{},i.exports)}),define("components/BlinkComponent",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/entity/EntityComponent","thor/graphics/resources/AnimatedSpriteResource"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/entity/EntityComponent")),s=(e("thor/graphics/resources/AnimatedSpriteResource"),{SceneComponent:{}});i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.reset()},reset:function(){r.prototype.reset.call(this),this.__blinkingTimer=0,this.__blinkingTint=4289374975},clone:function(e){r.prototype.clone.call(this,e),e.__blinkingTint=this.__blinkingTint},getType:function(){return"BlinkComponent"},startBlinking:function(e){this.__blinkingTimer=e,this._siblings.SceneComponent.setTintColor(this.__blinkingTint)},setBlinkingTint:function(e){this.__blinkingTint=e},update:function(e){0!==this.__blinkingTimer&&(this.__blinkingTimer-=e,this.__blinkingTimer<=0&&(this.__blinkingTimer=0,this._siblings.SceneComponent.setTintColor(4294967295)))}}),r.computeDependencies(r,s,i.exports)}),define("components/DriftComponent",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/entity/EntityComponent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/entity/EntityComponent")),s={SceneComponent:{required:!0},TimedDespawnComponent:{required:!0}};i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.reset()},clone:function(e){e.__startingSpreadX=this.__startingSpreadX,e.__startingSpreadY=this.__startingSpreadY,e.__spreadX=this.__startingSpreadX,e.__spreadY=this.__startingSpreadY,e.__spreadFactorX=this.__spreadFactorX,e.__spreadFactorY=this.__spreadFactorY,e.__periodMS=this.__periodMS,e.__position=[],e.__initialDriftPeriodMS=this.__initialDriftPeriodMS,e.__initialDriftDelayMS=this.__initialDriftDelayMS},reset:function(){r.prototype.reset.call(this),this.__spreadX=0,this.__spreadY=0,this.__startingSpreadX=0,this.__startingSpreadY=0,this.__spreadFactorX=0,this.__spreadFactorY=0,this.__startDriftingLeft=!1,this.__driftCount=0,this.__periodMS=0,this.__elapsedMS=0,this.__position=[],this.__initialDriftX=0,this.__initialDriftY=0,this.__initialDrifting=!1,this.__initialDriftPeriodMS=0,this.__initialDriftDelayMS=0},setInitialDrift:function(e,t){this.__initialDriftX=e,this.__initialDriftY=t,this.__initialDrifting=!0},setInitialDriftDelayMS:function(e){this.__initialDriftDelayMS=e},setInitialDriftPeriodMS:function(e){this.__initialDriftPeriodMS=e},setStartingSpreadX:function(e){this.__startingSpreadX=e,this.__spreadX=e},setStartingSpreadY:function(e){this.__startingSpreadY=e,this.__spreadY=e},setSpreadFactorX:function(e){this.__spreadFactorX=e},setSpreadFactorY:function(e){this.__spreadFactorY=e},setStartDriftingLeft:function(e){this.__startDriftingLeft=e},setPeriodMS:function(e){this.__periodMS=e},getType:function(){return"DriftComponent"},update:function(e){if(this.__elapsedMS+=e,!(this.__elapsedMS<0)){var t,i,n=this._siblings.SceneComponent;if(0===this.__position.length&&n.getTranslation(this.__position),this.__initialDrifting){t=this.__elapsedMS/this.__initialDriftPeriodMS,i=Math.min(t,1)-1;var r=1-i*i;return n.setTranslation(this.__position[0]+r*this.__initialDriftX,this.__position[1]+r*this.__initialDriftY),void(t>=1&&(this.__elapsedMS=-1*this.__initialDriftDelayMS,n.getTranslation(this.__position),this.__initialDrifting=!1))}t=this.__elapsedMS/this.__periodMS;var s=~~t,o=this.__startDriftingLeft?-1:1;s%2==1&&(o*=-1);var a,_;0===s?(a=.5*this.__startingSpreadX,_=.5*this.__startingSpreadY):(a=this.__spreadX,_=this.__spreadY,s!==this.__driftCount&&(this.__spreadX*=this.__spreadFactorX,this.__spreadY*=this.__spreadFactorY,this.__driftCount=s)),i=t%1-1;var l=i<.5?2*i*i:(4-2*i)*i-1,h=l*a*o,u=i*i*_,c=h*e,d=u*e;this.__position[0]+=c,this.__position[1]+=d,n.setTranslation(this.__position[0],this.__position[1])}}}),r.computeDependencies(r,s,i.exports)}),define("components/FlashComponent",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/entity/EntityComponent","thor/graphics/animation/EasingFunctions"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/entity/EntityComponent")),s=e("thor/graphics/animation/EasingFunctions"),o={SceneComponent:{required:!0}};i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.reset()},getType:function(){return"FlashComponent"},reset:function(){r.prototype.reset.call(this),this.__elapsedMS=0,this.__peakDurationMS=0,this.__transitionDurationMS=0},clone:function(e){r.prototype.clone.call(this,e),e.__peakDurationMS=this.__peakDurationMS,e.__transitionDurationMS=this.__transitionDurationMS},update:function(e){this.__elapsedMS+=e;var t=0,i=0;this.__elapsedMS<=this.__transitionDurationMS?(t=this.__elapsedMS/this.__transitionDurationMS,i=255*s.easeOut(t)):this.__elapsedMS<=this.__transitionDurationMS+this.__peakDurationMS?i=255:this.__elapsedMS<=2*this.__transitionDurationMS+this.__peakDurationMS?(t=(this.__elapsedMS-(this.__transitionDurationMS+this.__peakDurationMS))/this.__transitionDurationMS,i=255-255*s.easeIn(t)):i=0,this._siblings.SceneComponent.setAlphaTint(i)},setTransitionDurationMS:function(e){this.__transitionDurationMS=e},getTransitionDurationMS:function(){return this.__transitionDurationMS},setPeakDurationMS:function(e){this.__peakDurationMS=e},getPeakDurationMS:function(){return this.__peakDurationMS}}),r.computeDependencies(r,o,i.exports)}),define("components/ActionComponent",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/event/EventManager","thor/entity/SceneComponent","thor/entity/EntityComponent","thor/entity/EntityDestroyedEvent","bulletml/BulletData","bulletml/ActionGlobals","bulletml/SequenceAction"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i),e("thor/core/Validation")),s=(e("thor/event/EventManager"),e("thor/entity/SceneComponent"),e("thor/entity/EntityComponent")),o=e("thor/entity/EntityDestroyedEvent"),a=e("bulletml/BulletData"),_=(e("bulletml/ActionGlobals"),e("bulletml/SequenceAction")),l={SceneComponent:{required:!0}},h=180/Math.PI;i.exports=n.create(s,{initialize:function(e,t){s.prototype.initialize.call(this),this.__action=null,this.__actionState=null,this.__bulletData=null,this.__destroyWhenDone=!1,this.__active=!0,this.__actionGlobals=e,this.__eventManager=t,this.__scratchBulletData=new a},setAction:function(e){r.ifDefined.assertIsInstanceOf(e,_),this.__action&&this.__actionState&&this.__action.disposeState(this.__actionState),this.__action=e,this.__actionState=null},clearAction:function(){this.__action&&this.__actionState&&this.__action.disposeState(this.__actionState),this.__action=null,this.__actionState=null},setBulletData:function(e){this.__bulletData=e},setDestroyWhenDone:function(e){this.__destroyWhenDone=e},setActive:function(e){this.__active=e},reset:function(){s.prototype.reset.call(this),this.__action&&this.__actionState&&this.__action.disposeState(this.__actionState),this.__action=null,this.__actionState=null,this.__bulletData=null,this.__destroyWhenDone=!1},clone:function(e){s.prototype.clone.call(this,e),e.__action=this.__action,e.__destroyWhenDone=this.__destroyWhenDone},getType:function(){return"ActionComponent"},fireEvent:function(e){if(this.__bulletData){var t=this.__bulletData.bulletDefinition.events;if(t){var i=t[e];if(i){var n=i.getInitialState(this.__actionGlobals);i.run(1/0,1/0,n,this.__actionGlobals,this.__bulletData)}}}},update:function(e){if(this.__active){var t=this.__action,i=this.__bulletData;if(t){var n=this.__actionState;n||(n=t.getInitialState(this.__actionGlobals),this.__actionState=n);if(t.isComplete(n)){if(this.__destroyWhenDone){var r=this.getOwningEntity(),s=this.__eventManager.getNewEvent(o);s.setEntityId(r.getId()),this.__eventManager.queueEvent(s)}}else{var a=this._siblings.SceneComponent.__data;this.__scratchPosition;i?t.run(e,e,n,this.__actionGlobals,i):(this.__scratchBulletData.x=a[2],this.__scratchBulletData.y=a[3],this.__scratchBulletData.facing=a[6]*h,t.run(e,e,n,this.__actionGlobals,this.__scratchBulletData))}}}}}),s.computeDependencies(s,l,i.exports)}),define("components/BulletComponent",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Validation","thor/entity/SceneComponent","thor/entity/EntityComponent","bulletml/BulletData","../BulletManager"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Validation"),e("thor/entity/SceneComponent"),e("thor/entity/EntityComponent")),s=e("bulletml/BulletData"),o=(e("../BulletManager"),{SceneComponent:{required:!0},ActionComponent:{required:!0},CollisionComponent:{required:!0},ResourceComponent:{required:!0}}),a=180/Math.PI;i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this),this.__bulletIndex=null,this.__bulletData=new s,this.__isAlive=!1,this.__bulletManager=e,this.__spawnTime=0,this.__bulletType=null,this.__bounds={width:0,height:0,widthBuffer:0,heightBuffer:0,right:0,bottom:0}},reset:function(){r.prototype.reset.call(this),this.__isAlive=!1,this.__bulletData.reset()},setOwningEntity:function(e){r.prototype.setOwningEntity.call(this,e),this.__bulletData.id=e.getId()},clone:function(e){e.__bounds=this.__bounds},setSpawnTime:function(e){this.__spawnTime=e},getSpawnTime:function(){return this.__spawnTime},getBulletData:function(){return this.__bulletData},getBulletType:function(e){return this.__bulletType},setBulletType:function(e){this.__bulletType=e},setBounds:function(e,t,i,n){this.__bounds.width=e,this.__bounds.height=t,this.__bounds.widthBuffer=i,this.__bounds.heightBuffer=n,this.__bounds.right=e+i,this.__bounds.bottom=t+n},setBulletIndex:function(e){this.__bulletIndex=e},getBulletIndex:function(){return this.__bulletIndex},setIsAlive:function(e){this.__isAlive=e},isAlive:function(){return this.__isAlive},getType:function(){return"BulletComponent"},update:function(e){var t=this.__bulletData,i=t.angularVelocity*e,n=this._siblings.SceneComponent,r=n.__data,s=t.x,o=t.y;r[2]=s,r[3]=o;var _=r[6];_+=i,r[6]=_,n.__dirtyTransform=!0,this.__bulletData.facing=_*a;var l=this.__bounds;(s<-l.widthBuffer||o<0||s>l.right||o>l.bottom)&&this.__bulletManager.expireBulletIndex(this.__bulletIndex)}}),r.computeDependencies(r,o,i.exports)}),define("components/FollowComponent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger","Constants","thor/event/EventManager","thor/entity/EntityManager","thor/entity/Entity","thor/entity/SceneComponent","thor/entity/EntityComponent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=(e("thor/core/Logger").getLogger(i),e("Constants")),o=(e("thor/event/EventManager"),e("thor/entity/EntityManager"),e("thor/entity/Entity"),e("thor/entity/SceneComponent")),a=e("thor/entity/EntityComponent"),_=[0,0],l=[0,0],h={SceneComponent:{}};i.exports=n.create(a,{initialize:function(e,t){a.prototype.initialize.call(this),this.__entityManager=e,this.__eventManager=t,this.__targetSceneComponent=null,this.__targetEntityId=-1,this.__maxSpeed=0,this.__axis=0},clone:function(e){e.reset(),e.__targetSceneComponent=this.__targetSceneComponent,e.__targetEntityId=this.__targetEntityId,e.__axis=this.__axis,e.__maxSpeed=0},reset:function(){a.prototype.reset.call(this),this.__targetSceneComponent=null,this.__targetEntityId=-1,this.__axis=0,this.__maxSpeed=0},getType:function(){return"FollowComponent"},getMaxSpeed:function(){return this.__maxSpeed},setMaxSpeed:function(e){this.__maxSpeed=e},setAxis:function(e){this.__axis=e},setTargetEntity:function(e){var t=e.getComponent("SceneComponent");if(!r.isInstanceOf(t,o))throw new Erorr("FollowComponent's target must have a SceneComponent");this.__targetSceneComponent=t,this.__targetEntityId=e.getId()},update:function(e){var t;if(this.__targetEntityId&&(t=this.__entityManager.getEntity(this.__targetEntityId)),t&&this.__targetSceneComponent){this._siblings.SceneComponent.getTranslation(_),this.__targetSceneComponent.getTranslation(l);var i=0,n=0;if(this.__axis&s.AXIS_MASK_X&&(i=l[0]-_[0]),this.__axis&s.AXIS_MASK_Y&&(n=l[1]-_[1]),0!==i||0!==n){var r=i,o=n;if(this.__maxSpeed>0){var a=Math.sqrt(i*i+n*n),h=1/Math.sqrt(i*i+n*n),u=i*h,c=n*h,d=Math.min(a,.001*e*this.__maxSpeed);r=u*d,o=c*d}this._siblings.SceneComponent.setTranslation(_[0]+r,_[1]+o)}}}}),a.computeDependencies(a,h,i.exports)}),define("components/LookAtComponent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/entity/Entity","thor/entity/EntityComponent","thor/entity/EntityManager","thor/entity/SceneComponent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=(e("thor/entity/Entity"),e("thor/entity/EntityComponent")),o=(e("thor/entity/EntityManager"),e("thor/entity/SceneComponent")),a={SceneComponent:{required:!0}},_=2*Math.PI,l=[0,0],h=[0,0],u=2*Math.PI;i.exports=n.create(s,{initialize:function(e){s.prototype.initialize.call(this),this.__targetSceneComponent=null,this.__previousDirection=null,this.__previousDirectionValid=null,this.__maxTrackingSpeed=null,this.__retargetCallback=null,this.__defaultLookAtDirection=0,this.__rotationOffset=0,this.__targetDirection=0,this.__entityManager=e,this.reset()},clone:function(e){e.reset(),e.__rotationOffset=this.__rotationOffset,e.__maxTrackingSpeed=this.__maxTrackingSpeed,e.__defaultLookAtDirection=this.__defaultLookAtDirection,e.__targetDirection=this.__targetDirection},reset:function(){s.prototype.reset.call(this),this.__previousDirection=0,this.__previousDirectionValid=!1,this.__maxTrackingSpeed=u,this.__targetEntityId=null,this.__targetSceneComponent=null,this.__retargetCallback=null},setTargetEntity:function(e){if(this.__targetSceneComponent=e.getComponent("SceneComponent"),!r.isInstanceOf(this.__targetSceneComponent,o))throw new Error("LookAtComponent's target entity must have a SceneComponent");this.__targetEntityId=e.getId()},setDefaultLookAtDirection:function(e){this.__defaultLookAtDirection=e,this.__targetDirection=e},getTargetDirection:function(){return this.__targetDirection},clearTarget:function(){this.__targetSceneComponent=null},setMaxTrackingSpeed:function(e){this.__maxTrackingSpeed=e},getType:function(){return"LookAtComponent"},getDirection:function(){return this.__previousDirection},setDirection:function(e){this.__previousDirection=e,this.__previousDirectionValid=!1},setRotationOffset:function(e){this.__rotationOffset=e},faceTargetImmediate:function(){var e;if(this.__targetSceneComponent){this._siblings.SceneComponent.getTranslation(l),this.__targetSceneComponent.getTranslation(h);var t=h[0]-l[0],i=h[1]-l[1];e=Math.atan2(i,t)}else e=this.__defaultLookAtDirection;this.__targetDirection=e,this._siblings.SceneComponent.setRotation(e+this.__rotationOffset),this.__previousDirection=e,this.__previousDirectionValid=!0},debugDraw:function(e){this.__targetSceneComponent&&(this._siblings.SceneComponent.getTranslation(l),this.__targetSceneComponent.getTranslation(h),e.lineBatch.addLine(l[0],l[1],h[0],h[1],this._siblings.SceneComponent._parent._worldToLocalTransform,4278190335,4))},update:function(e){var t=null;this.__targetEntityId&&(t=this.__entityManager.getEntity(this.__targetEntityId)),null===this.__retargetCallback||t||(this.__retargetCallback(this.getOwningEntity()),this.__targetEntityId&&(t=this.__entityManager.getEntity(this.__targetEntityId)));var i,n;if(t&&this.__targetSceneComponent){this._siblings.SceneComponent.getTranslation(l),this.__targetSceneComponent.getTranslation(h),i=h[0]-l[0],n=h[1]-l[1];var r=Math.atan2(n,i)}else r=this.__previousDirection;if(this.__targetDirection=r,!this.__previousDirectionValid||this.__previousDirection!==r){var s=e*this.__maxTrackingSpeed*.001;Math.abs(r-this.__previousDirection)%_>s&&(r=(this.__previousDirection-r+_)%_>Math.PI?this.__previousDirection+s:this.__previousDirection-s),this._siblings.SceneComponent.setRotation(r+this.__rotationOffset),this.__previousDirection=r,this.__previousDirectionValid=!0}},setRetargetCallback:function(e){this.__retargetCallback=e}}),s.computeDependencies(s,a,i.exports)}),define("components/RotateComponent",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/entity/EntityComponent","thor/entity/SpriteComponent","thor/entity/SceneComponent"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/entity/EntityComponent")),s=(e("thor/entity/SpriteComponent"),e("thor/entity/SceneComponent")),o=2*Math.PI;i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__velocity=0,this.__parentComponent=null},getType:function(){return"RotateComponent"},clone:function(e){e.reset(),e.__velocity=this.__velocity,e.__parentComponent=this.__parentComponent},reset:function(){r.prototype.reset.call(this),this.__velocity=0,this.__parentComponent=null},getVelocity:function(){return this.__velocity},setVelocity:function(e){this.__velocity=e},update:function(e){var t=this.getRotation();t=(t+.001*e*this.__velocity)%o,this.setRotation(t)}})}),define("components/ResourceComponent",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","thor/entity/EntityComponent"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=e("thor/core/Validation"),s=e("thor/entity/EntityComponent");i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__resources={}},reset:function(){s.prototype.reset.call(this);for(var e in this.__resources)delete this.__resources[e]},getType:function(){return"ResourceComponent"},clone:function(e){e.reset();for(var t in this.__resources)e.__resources[t]=this.__resources[t]},modifyResource:function(e,t,i){if(!r.isDefined(this.__resources[e]))return-1;var n=Math.max(0,this.__resources[e]+t);return this.__resources[e]=n,n},getResource:function(e){return r.isNumber(this.__resources[e])?this.__resources[e]:null},setResource:function(e,t){this.__resources[e]=t},deleteResource:function(e){delete this.__resources[e]}}),s.computeDependencies(s,{},i.exports)}),define("events/CollisionEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("CollisionEvent",1968594557,{entityIdA:n.assertIsNumber,entityIdB:n.assertIsNumber})}),define("CollisionManager",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/event/EventManager","thor/debug/PerformanceOverlay","events/CollisionEvent"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Logger").getLogger(i),o=(e("thor/core/Validation"),e("thor/event/EventManager"),e("thor/debug/PerformanceOverlay")),a=e("events/CollisionEvent"),_=r.create({initialize:function(){this.x=0,this.y=0,this.entityId=0,this.type=0,this.radius=0,this.height=0,this.rotation=0}}),l=r.create({initialize:function(){this.entityIdA=0,this.entityIdB=0}}),h={x:0,y:0,width:0,height:0},u={x:0,y:0,radius:0,sqrRadius:0};i.exports=r.create(n,{__colliders:null,__colliderIndex:null,__eventManager:null,initialize:function(e,t){this.__eventManager=e,this.__colliders=new Array(t);for(var i=0;i<t;++i)this.__colliders[i]=new _;this.__collisions=new Array(t);for(var i=0;i<t;++i)this.__collisions[i]=new l;this.__colliderCollisionMasks=new Array(t),this.__colliderIndex=0,this.__maxColliders=t;var n=o.getInstance();this.update=n.addInstrumentedTask("Collision Update",this.update.bind(this),1e3,2,5)},addCollider:function(e,t,i,n,r,o){if(this.__colliderIndex===this.__maxColliders)return s.error("Maximum colliders exceeded for this frame, dropping entityId = "+n),!1;var a=this.__colliders[this.__colliderIndex];return a.x=e,a.y=t,a.entityId=n,a.type=0,a.radius=i,a.rotation=0,this.__colliderCollisionMasks[this.__colliderIndex]=r<<16|65535&o,this.__colliderIndex++,!0},addRectCollider:function(e,t,i,n,r,o,a,_){if(this.__colliderIndex===this.__maxColliders)return s.error("Maximum colliders exceeded for this frame, dropping entityId = "+o),!1;var l=this.__colliders[this.__colliderIndex];return l.x=e,l.y=t,l.entityId=o,l.type=1,l.radius=i,l.height=n,l.rotation=r,this.__colliderCollisionMasks[this.__colliderIndex]=a<<16|65535&_,this.__colliderIndex++,!0},update:function(e){for(var t,i=this.__collisions,n=this.__colliders,r=this.__colliderCollisionMasks,s=0,o=Math.abs,_=Math.cos,l=Math.sin,c=this.__colliderIndex,d=0;d<c;++d)for(var g=r[d],p=4294967295&(g<<16|g>>16),m=n[d],f=m.x,v=m.y,y=m.type,E=m.radius,S=d+1;S<c;++S){var T=r[S]&p;if(0!=(T>>16|T)){var C=n[S],I=C.x,w=C.y,b=C.type,M=!1;if(y||b)if(y&&b){var x=.5*E,R=.5*C.radius,P=.5*m.height,A=.5*C.height;o(I-f)<=x+R&&o(w-v)<=P+A&&(M=!0)}else{var N;y?(h.x=f,h.y=v,h.width=E,h.height=m.height,N=m.rotation,u.x=I,u.y=w,u.radius=C.radius):(h.x=I,h.y=w,h.width=C.radius,h.height=C.height,N=C.rotation,u.x=f,u.y=v,u.radius=E),u.sqrRadius=u.radius*u.radius;var D=.5*h.width,L=.5*h.height,O=1.5*(D+L)+u.radius,V=o(u.x-h.x),B=o(u.y-h.y),k=V+B;if(k<O){if(0!==N){var W=_(N),F=l(N),U=u.x-h.x,G=u.y-h.y,H=W*U-F*G+h.x,q=F*U+W*G+h.y;u.x=H,u.y=q,V=o(u.x-h.x),B=o(u.y-h.y)}if(V<D+u.radius&&B<L+u.radius)if(V<=D||B<=L)M=!0;else{var Y=V-D,z=B-L,X=Y*Y+z*z;M=X<=u.sqrRadius}}}else{var K=C.radius,U=I-f,G=w-v,j=K+E;U*U+G*G<j*j&&(M=!0)}M&&(t=i[s],t.entityIdA=m.entityId,t.entityIdB=C.entityId,s++)}}for(var Q=this.__eventManager,Z=0;Z<s;++Z){t=i[Z];var J=Q.getNewEvent(a);J.setEntityIdA(t.entityIdA),J.setEntityIdB(t.entityIdB),Q.queueEvent(J)}this.__colliderIndex=0}})}),define("components/CollisionComponent",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","thor/entity/SceneComponent","thor/entity/EntityComponent","../CollisionManager"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=(e("thor/core/Validation"),e("thor/entity/SceneComponent"),e("thor/entity/EntityComponent")),s=(e("../CollisionManager"),{SceneComponent:{required:!0}});i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this),this.__collisionManager=e,this.__radius=1,this.__category=0,this.__mask=0,this.__offsetX=0,this.__offsetY=0,this.__isEnabled=!0,this.__rotationEnabled=!1},clone:function(e){r.prototype.clone.call(this,e),e.__radius=this.__radius,e.__category=this.__category,e.__mask=this.__mask,e.__offsetX=this.__offsetX,e.__offsetY=this.__offsetY,e.__isEnabled=this.__isEnabled,e.__rotationEnabled=this.__rotationEnabled},getMask:function(){return this.__mask},getCategory:function(){return this.__category},setRadius:function(e){this.__radius=e},setRotationEnabled:function(e){this.__rotationEnabled=e},setOffset:function(e,t){this.__offsetX=e,this.__offsetY=t},setMask:function(e){this.__mask=e},getEnabled:function(){return this.__isEnabled},setEnabled:function(e){this.__isEnabled=e},setCategory:function(e){this.__category=e},getType:function(){return"CollisionComponent"},debugDraw:function(e){e.lineBatch.addCircle(this.__offsetX-this.__radius,this.__offsetY-this.__radius,this.__radius,this._siblings.SceneComponent._worldToLocalTransform,4294902015,4)},update:function(e){if(this.__isEnabled){var t,i,n=this._siblings.SceneComponent;if(this.__rotationEnabled){var r=n.__data[6],s=Math.cos(r),o=Math.sin(r);t=this.__offsetX*s-this.__offsetY*o,i=this.__offsetX*o+this.__offsetY*s}else t=this.__offsetX,i=this.__offsetY;this.__collisionManager.addCollider(n.__data[2]+t,n.__data[3]+i,this.__radius,this.getOwningEntity().getId(),this.__category,this.__mask)}}}),r.computeDependencies(r,s,i.exports)}),define("components/ShieldComponent",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","thor/math/ColorUtil","thor/audio/SoundSprite","thor/entity/Entity","thor/entity/EntityComponent","thor/entity/AnimatedSpriteComponent","../components/ResourceComponent","../components/CollisionComponent","../ResourceTypes","../Constants"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=(e("thor/core/Validation"),e("thor/math/ColorUtil")),s=(e("thor/audio/SoundSprite"),e("thor/entity/Entity"),e("thor/entity/EntityComponent")),o=e("thor/entity/AnimatedSpriteComponent"),a=(e("../components/ResourceComponent"),e("../components/CollisionComponent"),e("../ResourceTypes"),e("../Constants"),{ResourceComponent:{},CollisionComponent:{}});i.exports=n.create(o,{initialize:function(){o.prototype.initialize.call(this),this.__sounds=null,this.__shieldUpSoundName=null,this.__isShieldEnabled=!1},setSoundSprite:function(e){this.__sounds=e},setShieldUpSoundName:function(e){this.__shieldUpSoundName=e},getType:function(){return"ShieldComponent"},clone:function(e){o.prototype.clone.call(this,e),e.__isShieldEnabled=this.__isShieldEnabled,e.__sounds=this.__sounds,e.__shieldUpSoundName=this.__shieldUpSoundName},enableShield:function(){this.__isShieldEnabled=!0,this._tintColor=r.setA(this._tintColor,255),this.__sounds&&this.__sounds.play(this.__shieldUpSoundName)},disableShield:function(){this._tintColor=r.setA(this._tintColor,0),this.__isShieldEnabled=!1},drawWebGL:function(e){this.__isShieldEnabled&&o.prototype.drawWebGL.call(this,e)},update:function(e){o.prototype.update.call(this,e)}}),s.computeDependencies(s,a,i.exports)}),define("components/ThrustComponent",["require","exports","module","thor/core/Base","thor/core/Class","thor/entity/Entity","thor/core/Validation","thor/entity/SceneComponent","thor/entity/EntityComponent"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=(e("thor/entity/Entity"),e("thor/core/Validation"),e("thor/entity/SceneComponent"),e("thor/entity/EntityComponent")),s={SceneComponent:{},LookAtComponent:{required:!1}},o=[0,0];i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.__sceneComponent=null,this.__velocity={x:0,y:0},this.__maxVelocity=1/0,this.__maxVelocitySq=1/0,this.__minVelocity=0,this.__minVelocitySq=0,this.__acceleration=0},clone:function(e){e.__maxVelocity=this.__maxVelocity,e.__minVelocity=this.__minVelocity,e.__maxVelocitySq=this.__maxVelocitySq,e.__minVelocitySq=this.__minVelocitySq,e.__acceleration=this.__acceleration},setAcceleration:function(e){this.__acceleration=e},setMaxVelocity:function(e){this.__maxVelocity=e,this.__maxVelocitySq=e*e},setMinVelocity:function(e){this.__minVelocity=e,this.__minVelocitySq=e*e},getType:function(){return"ThrustComponent"},debugDraw:function(e){if(this._siblings.SceneComponent.getTranslation(o),this._siblings.LookAtComponent){var t=this._siblings.LookAtComponent.getTargetDirection();e.lineBatch.addLine(o[0],o[1],o[0]+this.__acceleration*Math.cos(t)/5,o[1]+this.__acceleration*Math.sin(t)/5,this._siblings.SceneComponent._parent._worldToLocalTransform,4278255615,8)}e.lineBatch.addLine(o[0],o[1],o[0]+this.__velocity.x/5,o[1]+this.__velocity.y/5,this._siblings.SceneComponent._parent._worldToLocalTransform,4294902015,4)},goToMinimumVelocity:function(){var e=this._siblings.SceneComponent.getRotation(),t=Math.cos(e),i=Math.sin(e),n=this.__velocity;n.x=t*this.__minVelocity,n.y=i*this.__minVelocity},update:function(e){this._siblings.SceneComponent.getTranslation(o);var t=this._siblings.SceneComponent.getRotation(),i=Math.cos(t),n=Math.sin(t),r=.001*e,s=this.__acceleration*i*r,a=this.__acceleration*n*r,_=this.__velocity;_.x+=s,_.y+=a;var l,h=_.x*_.x+_.y*_.y;h>this.__maxVelocitySq&&(l=Math.sqrt(h),_.x=_.x/l*this.__maxVelocity,_.y=_.y/l*this.__maxVelocity);var u=this.__velocity.x*r,c=this.__velocity.y*r;this._siblings.SceneComponent.setTranslation(o[0]+u,o[1]+c)}}),r.computeDependencies(r,s,i.exports)}),define("components/AttractComponent",["require","exports","module","thor/core/Base","thor/core/Class","thor/entity/Entity","thor/core/Validation","thor/entity/EntityManager","thor/entity/SceneComponent","thor/entity/EntityComponent","thor/math/MathHelper","../Constants"],function(e,t,i){
var n=(e("thor/core/Base"),e("thor/core/Class")),r=(e("thor/entity/Entity"),e("thor/core/Validation"),e("thor/entity/EntityManager"),e("thor/entity/SceneComponent"),e("thor/entity/EntityComponent")),s=e("thor/math/MathHelper"),o=e("../Constants"),a={SceneComponent:{required:!0},SprayMovementComponent:{required:!1}},_=[0,0],l=[0,0];i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this),this.__entityManager=e,this.__targetEntityId=null,this.__attractionMultiplier=o.PICKUP_ATTRACTION,this.__attractionMultiplierStrong=o.PICKUP_ATTRACTION_STRONG,this.__strongRangeInvSquared=o.PICKUP_STRONG_RANGE_INV_SQUARED},reset:function(){r.prototype.reset.call(this),this.__targetEntityId=null,this.__attractionMultiplier=o.PICKUP_ATTRACTION,this.__attractionMultiplierStrong=o.PICKUP_ATTRACTION_STRONG,this.__strongRangeInvSquared=o.PICKUP_STRONG_RANGE_INV_SQUARED},clone:function(e){r.prototype.clone.call(this,e),e.__targetEntityId=this.__targetEntityId,e.__attractionMultiplier=this.__attractionMultiplier,e.__attractionMultiplierStrong=this.__attractionMultiplierStrong,e.__strongRangeInvSquared=this.__strongRangeInvSquared},setTargetEntityId:function(e){this.__targetEntityId=e},setAttractionMultiplier:function(e,t,i){this.__attractionMultiplier=e,this.__attractionMultiplierStrong=t,this.__strongRangeInvSquared=i},getType:function(){return"AttractComponent"},update:function(e){if(this.__targetEntityId){var t=this.__entityManager.getEntity(this.__targetEntityId),i=t?t.getRootComponent():null;if(i){this._siblings.SceneComponent.getTranslation(_),i.getTranslation(l);var n=l[0]-_[0],r=l[1]-_[1],a=1/(n*n+r*r),h=a<this.__strongRangeInvSquared?this.__attractionMultiplier:this.__attractionMultiplierStrong;a>=this.__strongRangeInvSquared&&this._siblings.SprayMovementComponent&&(this.__entityManager.removeComponent(this.getOwningEntity(),this._siblings.SprayMovementComponent),this._siblings.SprayMovementComponent=null);var u=a*h,c=n*Math.abs(n)*a,d=r*Math.abs(r)*a,g=c*u*e*e,p=d*u*e*e;Math.abs(g)>o.PICKUP_MAX_PIXEL_PER_FRAME&&(g=o.PICKUP_MAX_PIXEL_PER_FRAME*s.sign(g)),Math.abs(p)>o.PICKUP_MAX_PIXEL_PER_FRAME&&(p=o.PICKUP_MAX_PIXEL_PER_FRAME*s.sign(p));var m=_[0]+g,f=_[1]+p;this._siblings.SceneComponent.setTranslation(m,f)}}}}),r.computeDependencies(r,a,i.exports)}),define("components/shader/TileMap.vs",["require","exports","module"],function(e,t,i){i.exports=["#version 100","","uniform mat4 projection;","uniform mat4 modelview;","","attribute vec4 vertex;","attribute vec4 texture;","","varying vec4 textureBlend;","varying vec2 vTextureCoord;","","void main(void) {","\tgl_Position = projection * modelview * vec4(vertex.x, vertex.y, 0.0, 1.0);","   textureBlend = texture;","\tvTextureCoord = vertex.zw;","}"].join("\n")}),define("components/shader/TileMap.fs",["require","exports","module"],function(e,t,i){i.exports=["#version 100","","uniform sampler2D tilemap0;","uniform sampler2D tilemap1;","uniform sampler2D tilemap2;","uniform sampler2D tilemap3;","","varying mediump vec2 vTextureCoord;","varying lowp vec4 textureBlend;","","uniform lowp vec4 startColour;","uniform lowp vec4 endColour;","","uniform lowp float screenHeight;","","void main(void) {","\tlowp float ratio = gl_FragCoord.y / screenHeight;","\tlowp vec4 tint = mix(startColour, endColour, ratio);","\t","\tgl_FragColor = (textureBlend.x * texture2D(tilemap0, vTextureCoord) + ","                  textureBlend.y * texture2D(tilemap1, vTextureCoord) + ","                  textureBlend.z * texture2D(tilemap2, vTextureCoord) + ","                  textureBlend.w * texture2D(tilemap3, vTextureCoord)) * ","                  tint; ","}"].join("\n")}),define("components/TileMapComponent",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Validation","thor/webgl/Shader","thor/webgl/Texture","thor/webgl/Buffer","thor/math/MatrixUtil","thor/math/MathHelper","thor/entity/SceneComponent","thor/entity/EntityComponent","thor/graphics/resources/TextureRegionResource","./shader/TileMap.vs","./shader/TileMap.fs","./../Constants"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Device"),s=(e("thor/core/Validation"),e("thor/webgl/Shader")),o=e("thor/webgl/Texture"),a=e("thor/webgl/Buffer"),_=e("thor/math/MatrixUtil"),l=e("thor/math/MathHelper"),h=e("thor/entity/SceneComponent"),u=e("thor/entity/EntityComponent"),c=(e("thor/graphics/resources/TextureRegionResource"),e("./shader/TileMap.vs")),d=e("./shader/TileMap.fs"),g=e("./../Constants"),p={},m=new Uint16Array([0,2,1,0,3,2]),f=null;i.exports=n.create(h,{initialize:function(){h.prototype.initialize.call(this),this.__name="",this.__arrObjects=[],this.__mapData=null,this.__indexCount=0,this.__textureRegions=null,this.__indexBuffer=null,this.__vertexBuffer=null,this.__textures=null,this.__modelview=new Float32Array(16),this.__modelview.set(_.IDENTITY_4x4,0),this.__savedModelview=new Float32Array(16),this.__startColour,this.__endColour},setTileMapData:function(e,t,i,n){if("left-down"!==t.renderorder)throw new Error("Render order of "+t.renderorder+" is not supported. Only left-down is supported.");if(t.tilesets.length>4)throw new Error("Only 4 unique tilesets are supported per map");if(t.tilesets.length!==i.length)throw new Error("Number of texture regions does not match tileset count.");this.__name=e,this.__mapData=t,this.__textureRegions=i;var r=n.gl,a=n.cachedGl;f||(f=new s(r,a,"TileMap",c,d)),this.__shader=f,this.__textures=this.__textureRegions.map(function(e){return l.isPowerOf2(e.getWidth())&&l.isPowerOf2(e.getHeight())?o.getTextureFromDomImage(n,e.image.getDOMElement(),{mipmap:!0,minFilter:r.LINEAR_MIPMAP_LINEAR,wrapRepeatS:!1,wrapRepeatT:!1}):o.getTextureFromDomImage(n,e.image.getDOMElement(),{mipmap:!1,minFilter:r.LINEAR,wrapRepeatS:!1,wrapRepeatT:!1})}),this.__buildCommandList(r,a)},register:function(e){if(!this.__textureRegions||!this.__name||!this.__mapData)throw new Error("TileMap has no data set");h.prototype.register.call(this,e)},clone:function(e){h.prototype.clone.call(this,e),e.__name=this.__name,e.__arrObjects=this.__arrObjects,e.__mapData=this.__mapData,e.__indexCount=this.__indexCount,e.__textureRegions=this.__textureRegions,e.__vertexBuffer=this.__vertexBuffer,e.__indexBuffer=this.__indexBuffer,e.__textures=this.__textures,e.__shader=this.__shader},getType:function(){return"TileMapComponent"},__addObjectsFromLayer:function(e){for(var t=e.objects.length,i=0;i<t;i++){var n=e.objects[i],r={x:n.x,y:n.y,name:n.name,id:n.id};this.__arrObjects.push(r)}},getObjects:function(){return this.__arrObjects},getName:function(){return this.__name},getWidth:function(){return this.__mapData.width*this.__mapData.tilewidth},getHeight:function(){return this.__mapData.height*this.__mapData.tileheight},__buildCommandList:function(e,t){this.__batchSize=0;var i={};this.__mapData.tilesets.forEach(function(e,t){for(var n,r=e.imageheight,s=e.imagewidth,o=e.tileheight,a=e.tilewidth,_=r/o,l=s/a,h=_*l*8,u=new Float32Array(4*h),c=1/l,d=1/_,g=0;g<_*l;++g){n=e.firstgid+g;var p=g%l,m=~~(g/l),f=p/l,v=m/_,y=8*g*4,E=u.subarray(y,y+4);E[0]=f,E[1]=v,E[2]=f+c,E[3]=v+d,i[n+0]=E,i[n+1073741824]=E,i[n+2147483648]=E,i[n+3221225472]=E,i[n+536870912]=E,i[n+1610612736]=E,i[n+2684354560]=E,i[n+3758096384]=E}});for(var n=this.__mapData.layers.length,r=0,s=0;s<n;s++){var o=this.__mapData.layers[s];"tilelayer"===o.type&&(r+=o.data.length),"objectgroup"===o.type&&this.__addObjectsFromLayer(o)}var _=new Float32Array(32*r);this.__indexCount=6*r;for(var l=new Uint16Array(this.__indexCount),h=0,s=0;s<n;s++){var o=this.__mapData.layers[s];if("tilelayer"===o.type)for(var u=o.data,c=u.length,d=(o.height,o.width),p=0;p<c;++p,++h){var f=u[p];if(0!==f){var v=i[f];if(!v)throw new Error("No uvs for tile id: "+f);for(var y,E=this.__mapData.tilesets.length-1;E>=0&&(y=this.__mapData.tilesets[E],!(y.firstgid<=f));--E);var S,T=y.tileheight,C=y.tilewidth,I=~~(p/d)*T,w=p%d*C+g.MAP_BUFFER/2,b=0===E?1:0,M=1===E?1:0,x=2===E?1:0,R=3===E?1:0,P=w,A=I,N=v[0],D=v[1],L=w,O=I+T,V=v[0],B=v[3],k=w+C,W=I+T,F=v[2],U=v[3],G=w+C,H=I,q=v[2],Y=v[1],z=!!(2147483648&f),X=!!(1073741824&f),K=!!(536870912&f),j=z,Q=X;K&&(S=V,V=q,q=S,S=B,B=Y,Y=S,j=X,Q=z),j&&(S=N,N=F,F=S,S=V,V=q,q=S),Q&&(S=D,D=U,U=S,S=B,B=Y,Y=S);var Z=4*h*8;_[Z+0+0]=P,_[Z+0+1]=A,_[Z+0+2]=N,_[Z+0+3]=D,_[Z+0+4]=b,_[Z+0+5]=M,_[Z+0+6]=x,_[Z+0+7]=R,_[Z+8+0]=L,_[Z+8+1]=O,_[Z+8+2]=V,_[Z+8+3]=B,_[Z+8+4]=b,_[Z+8+5]=M,_[Z+8+6]=x,_[Z+8+7]=R,_[Z+16+0]=k,_[Z+16+1]=W,_[Z+16+2]=F,_[Z+16+3]=U,_[Z+16+4]=b,_[Z+16+5]=M,_[Z+16+6]=x,_[Z+16+7]=R,_[Z+24+0]=G,_[Z+24+1]=H,_[Z+24+2]=q,_[Z+24+3]=Y,_[Z+24+4]=b,_[Z+24+5]=M,_[Z+24+6]=x,_[Z+24+7]=R;var J=4*h,$=6*h;l[$+0]=m[0]+J,l[$+1]=m[1]+J,l[$+2]=m[2]+J,l[$+3]=m[3]+J,l[$+4]=m[4]+J,l[$+5]=m[5]+J}}}this.__indexBuffer=new a(e,t,a.Type.ELEMENT_BUFFER,l,{usage:e.STATIC_DRAW}),this.__vertexBuffer=new a(e,t,a.Type.ARRAY_BUFFER,_,{usage:e.STATIC_DRAW})},drawWebGL:function(e){e.spriteBatch.saveModelView(this.__savedModelview);var t=e.gl,i=e.cachedGl,n=e.mainCamera,s=this.__shader.uniforms,o=this.__shader.attributes;this.__shader.__program;this.__shader.activate();for(var a=0;a<this.__textures.length;++a)this.__textures[a].bind(a);var l=this.__modelview;switch(l[0]=this._worldToLocalTransform[0],l[1]=this._worldToLocalTransform[1],l[4]=this._worldToLocalTransform[2],l[5]=this._worldToLocalTransform[3],l[10]=1,l[12]=this._worldToLocalTransform[4],l[13]=this._worldToLocalTransform[5],l[15]=1,_.multiply4x4(this.__savedModelview,l,l),i.uniformMatrix4fv(s.projection,!1,n.getMatrix()),i.uniformMatrix4fv(s.modelview,!1,l),i.uniform1i(s.tilemap0,0),this.__textures.length){case 4:i.uniform1i(s.tilemap1,1),i.uniform1i(s.tilemap2,2),i.uniform1i(s.tilemap3,3);break;case 3:i.uniform1i(s.tilemap1,1),i.uniform1i(s.tilemap2,2),i.uniform1i(s.tilemap3,0);break;case 2:i.uniform1i(s.tilemap1,1),i.uniform1i(s.tilemap2,0),i.uniform1i(s.tilemap3,0);break;case 1:i.uniform1i(s.tilemap1,0),i.uniform1i(s.tilemap2,0),i.uniform1i(s.tilemap3,0)}this.__mapData.hasTint?(this.__startColour=g.START_TINT,this.__endColour=g.END_TINT):(this.__startColour=g.DEFAULT_TINT,this.__endColour=g.DEFAULT_TINT),t.uniform4fv(s.startColour,this.__startColour),t.uniform4fv(s.endColour,this.__endColour),t.uniform1f(s.screenHeight,r.cssViewportHeight),this.__indexBuffer.bind(),this.__vertexBuffer.bind(),i.vertexAttribPointer(o.vertex,4,t.FLOAT,!1,32,0),i.vertexAttribPointer(o.texture,4,t.FLOAT,!1,32,16),t.drawElements(t.TRIANGLES,this.__indexCount,t.UNSIGNED_SHORT,0)}}),u.computeDependencies(h,p,i.exports)}),define("components/AttachToComponent",["require","exports","module","thor/core/Class","thor/entity/Entity","thor/core/Validation","thor/entity/SceneComponent","thor/entity/EntityComponent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/entity/Entity"),e("thor/core/Validation"),e("thor/entity/SceneComponent"),e("thor/entity/EntityComponent")),s={SceneComponent:{required:!0}},o=[0,0];i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.__xOffset=0,this.__yOffset=0,this.__targetSceneComponent=null,this.__followRotation=!0},clone:function(e){e.__xOffset=this.__xOffset,e.__yOffset=this.__yOffset,e.__followRotation=this.__followRotation},reset:function(){r.prototype.reset.call(this),this.__targetSceneComponent=null,this.__xOffset=0,this.__yOffset=0,this.__followRotation=!0},setFollowRotation:function(e){this.__followRotation=e},setTargetEntityAndOffset:function(e,t,i){var n=e.getRootComponent();if(!n)throw new Error("Target entity has no TargetSceneComponent");this.__targetSceneComponent=n,this.__xOffset=t,this.__yOffset=i},getType:function(){return"AttachToComponent"},update:function(e){if(this.__targetSceneComponent){this.__targetSceneComponent.getTranslation(o);var t=this.__targetSceneComponent.getRotation(),i=Math.cos(t),n=Math.sin(t),r=this.__xOffset*i-this.__yOffset*n,s=this.__xOffset*n+this.__yOffset*i;this._siblings.SceneComponent.setTranslation(o[0]+r,o[1]+s),this.__followRotation&&this._siblings.SceneComponent.setRotation(t)}}}),r.computeDependencies(r,s,i.exports)}),define("components/BulletMLComponent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/entity/SceneComponent","thor/entity/EntityComponent","thor/event/EventManager","thor/entity/EntityDestroyedEvent","Constants","bulletml/BulletData","../BulletManager"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/entity/SceneComponent"),e("thor/entity/EntityComponent")),s=(e("thor/event/EventManager"),e("thor/entity/EntityDestroyedEvent"),e("Constants")),o=e("bulletml/BulletData"),a=(e("../BulletManager"),{SceneComponent:{required:!0}}),_=180/Math.PI,l=s.HALF_PI;i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this),this.__eventManager=e,this.__bulletData=new o,this.__faceVelocity=!1,this.__faceVelocityRotationOffset=0,this.__parentId=-1,this.__childIds=[],this.__prevVx=0,this.__prevVy=0},reset:function(){r.prototype.reset.call(this),this.__bulletData.reset(),this.__parentId=-1,this.__childIds.length=0,this.__prevVx=0,this.__prevVy=0},setOwningEntity:function(e){r.prototype.setOwningEntity.call(this,e),this.__bulletData.id=e.getId(),this.__bulletData.isEntity=!0},setFaceVelocity:function(e){this.__faceVelocity=e},setFaceVelocityRotationOffset:function(e){this.__faceVelocityRotationOffset=e},setParentId:function(e){this.__parentId=e},getParentId:function(){return this.__parentId},setChildIds:function(e){this.__childIds=e},addChildId:function(e){this.__childIds.push(e)},resetChildIds:function(){this.__childIds.length=0},getChildIds:function(){return this.__childIds},removeChildId:function(e){var t=this.__childIds.indexOf(e);return!(t<0)&&(this.__childIds.splice(t,1),!0)},clone:function(e){e.__faceVelocity=this.__faceVelocity,e.__faceVelocityRotationOffset=this.__faceVelocityRotationOffset},getBulletData:function(){return this.__bulletData},getType:function(){return"BulletMLComponent"},__approxAtan2:function(e,t){if(0==t)return e>0?l:0==e?0:-l;var i,n=e/t;if(Math.abs(n)<1){if(i=n/(1+.28*n*n),t<0)return e<0?i-Math.PI:i+Math.PI}else if(i=l-n/(n*n+.28),e<0)return i-Math.PI;return i},update:function(e){var t=this.__bulletData;t.step(e),t.ax=0,t.ay=0;var i=this._siblings.SceneComponent;t.facing=i.getRotation()*_;var n=t.angularVelocity*e;if(this.__faceVelocity){var r=t.vx,s=t.vy;if(this.__prevVx!==r||this.__prevVy!==s){var o=this.__approxAtan2(s,r)+this.__faceVelocityRotationOffset;i.setRotation(o),this.__prevVx=r,this.__prevVy=s}}else 0!==n&&i.rotate(n);t.facing=i.getRotation()*_;var a=t.x,l=t.y;i.setTranslation(a,l)}}),r.computeDependencies(r,a,i.exports)}),define("components/SoundLoopComponent",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/audio/SoundSprite","thor/entity/EntityComponent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/audio/SoundSprite"),e("thor/entity/EntityComponent"));i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.__sounds=null,this.__loopTimerMS=0,this.reset()},getType:function(){return"SoundLoopComponent"},reset:function(){this.__elapsedMS=0,this.__loopTimeMS=0,this.__soundName=null,this.__initialDelayMS=0,this.__loopTimerMS=0},clone:function(e){e.__sounds=this.__sounds,e.__elapsedMS=this.__elapsedMS,e.__loopTimeMS=this.__loopTimeMS,e.__soundName=this.__soundName,e.setInitialDelayMS(this.__initialDelayMS)},update:function(e){this.__loopTimerMS-=e,this.__loopTimerMS<=0&&(this.__loopTimerMS=this.__loopTimeMS,this.__sounds&&this.__soundName&&this.__sounds.play(this.__soundName))},setSoundSprite:function(e){this.__sounds=e},setSoundName:function(e){this.__soundName=e},setLoopTimeMS:function(e){this.__loopTimeMS=e},setInitialDelayMS:function(e){this.__initialDelayMS=e,this.__loopTimerMS=e}}),r.computeDependencies(r,{},i.exports)}),define("components/DelayEventComponent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation","thor/event/EventManager","thor/entity/EntityComponent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/event/Event"),e("thor/core/Validation"),e("thor/event/EventManager"),e("thor/entity/EntityComponent")),s={};i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this),this.__eventManager=e,this.__delay=1/0,this.__event=null,this.reset()},reset:function(){r.prototype.reset.call(this),this.__delay=1/0,this.__event=null},clone:function(e){e.__delay=this.__delay,e.__event=this.__event},getType:function(){return"DelayEventComponent"},setDelay:function(e){this.__delay=~~(1e3*e)},getDelay:function(){return this.__delay/1e3},setEvent:function(e){this.__event=e},getEvent:function(){return this.__event},update:function(e){this.__delay>0&&(this.__delay-=e,this.__delay<=0&&null!==this.__event&&this.__eventManager.queueEvent(this.__event))}}),r.computeDependencies(r,s,i.exports)}),define("thor/math/Path",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Device","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/core/Device"),o=e("thor/core/Validation");i.exports=r.create(n,{__arrPoints:null,__arrTValues:null,__arrSegmentPoints:null,__arrMidpoints:null,__tension:null,__bias:null,__continuity:null,__pathSpeed:null,initialize:function(e,t,i,r){o.isDefined(e)?this.__tension=e:this.__tension=.7,o.isDefined(t)?this.__bias=t:this.__bias=-.5,o.isDefined(i)?this.__continuity=i:this.__continuity=0,o.isDefined(r)?this.__pathSpeed=r:this.__pathSpeed=1,this.__arrPoints=[],this.__arrTValues=[],this.__arrSegmentPoints=[],this.__arrMidpoints=[],n.prototype.initialize.call(this)},setTension:function(e){this.__tension=e,this.setPoints(this.__arrPoints.slice(0))},getTension:function(){return this.__tension},setBias:function(e){this.__bias=e,this.setPoints(this.__arrPoints.slice(0))},getBias:function(){return this.__bias},setContinuity:function(e){this.__continuity=e,this.setPoints(this.__arrPoints.slice(0))},getContinuity:function(){return this.__continuity},destroy:function(){this.__arrPoints.length=0,this.__arrPoints=null,this.__arrTValues.length=0,this.__arrTValues=null,n.prototype.destroy.call(this)},getBounds:function(e){for(var t=1/0,i=1/0,n=-(1/0),r=-(1/0),o=this.getPoints(),a=0,_=o.length;a<_;++a){var l=o[a],h=s.sdpToDp(l.x),u=s.sdpToDp(l.y);t=Math.min(t,h),i=Math.min(i,u),n=Math.max(n,h),r=Math.max(r,u)}e.x=t,e.y=i,e.width=n-t,e.height=r-i},__createSubSplinePoints:function(e,t,i,n,r,s,o,a){var _=this.__tension,l=this.__bias,h=this.__continuity,u=(1-_)*(1+l)*(1+h)*.5,c=(1-_)*(1-l)*(1-h)*.5,d=(i.x-e.x)*u+(r.x-i.x)*c,g=(i.y-e.y)*u+(r.y-i.y)*c,p=(1-_)*(1+l)*(1-h)*.5,m=(1-_)*(1-l)*(1+h)*.5,f=(r.x-i.x)*p+(o.x-r.x)*m,v=(r.y-i.y)*p+(o.y-r.y)*m;return[{x:i.x,y:i.y},{x:i.x+d,y:i.y+g},{x:r.x-f,y:r.y-v},{x:r.x,y:r.y}]},__segmentLength:function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},__computePathLength:function(e,t){var i=t-e;if(0===i)return 0;for(var n=0,r=i/20,s=e+r,o=this.getPosition(e),a={x:o.x,y:o.y},_={x:o.x,y:o.y},l=0;l<20;l++){a.x=_.x,a.y=_.y;var o=this.getPosition(s);_.x=o.x,_.y=o.y;n+=this.__segmentLength(a,_),s+=r}return n},getPoints:function(){return this.__arrPoints},setPoints:function(e){this.__arrPoints.length=0;var t=e.length;if(t<=0)throw new Error("Not enough points to make a path.");if(1===t)e[1]=e[0],e[2]=e[0];else if(2===t){var i=e[0],n=e[1],r={x:.5*(i.x+n.x),y:.5*(i.y+n.y)};e[0]=i,e[2]=n,e[1]=r}this.__arrPoints=e;for(var s=0,t=e.length,o=[],a=0;a<t-1;a++){var _=this.__segmentLength(e[a],e[a+1]);o.push(_),s+=_}0===s&&(s=1);for(var l=[0],h=0,a=1;a<t-1;a++)h+=o[a-1],l[a]=h/s;l[t-1]=1,this.__arrTValues=l;var u=[],c=this.__createSubSplinePoints(e[0],l[0],e[0],l[0],e[1],l[1],e[2],l[2]);u.push(c);for(var a=0;a<t-3;a++){var c=this.__createSubSplinePoints(e[a],l[a],e[a+1],l[a+1],e[a+2],l[a+2],e[a+3],l[a+3]);u.push(c)}var d=t-3,c=this.__createSubSplinePoints(e[d],l[d],e[d+1],l[d+1],e[d+2],l[d+2],e[d+2],l[d+2]);u.push(c),this.__arrSegmentPoints=u,this.__arrMidpoints.length=0;for(var a=0;a<3;a++)this.__arrMidpoints.push({x:0,y:0});for(var g=[],p=0,a=0;a<t-1;a++){var m=this.__arrTValues[a],f=this.__arrTValues[a+1],v=this.__computePathLength(m,f);g.push(v),p+=v}var y=[0];h=0;for(var a=1;a<t-1;a++)h+=g[a-1],y[a]=h/p;y[t-1]=1,this.__arrTValues=y},setPathSpeed:function(e){this.__pathSpeed=e},getPathSpeed:function(){return this.__pathSpeed},getPosition:function(e){var t=this.__arrPoints.length;if(e<=0)return this.__arrPoints[0];if(e>=1)return this.__arrPoints[t-1];var i;for(i=0;i<t-1&&!(this.__arrTValues[i+1]>e);i++);var n=this.__arrSegmentPoints[i],r=this.__arrTValues[i];e=(e-r)/(this.__arrTValues[i+1]-r);var s=1-e;return this.__arrMidpoints[0].x=n[0].x*s+n[1].x*e,this.__arrMidpoints[0].y=n[0].y*s+n[1].y*e,this.__arrMidpoints[1].x=n[1].x*s+n[2].x*e,this.__arrMidpoints[1].y=n[1].y*s+n[2].y*e,this.__arrMidpoints[2].x=n[2].x*s+n[3].x*e,this.__arrMidpoints[2].y=n[2].y*s+n[3].y*e,this.__arrMidpoints[0].x=this.__arrMidpoints[0].x*s+this.__arrMidpoints[1].x*e,this.__arrMidpoints[0].y=this.__arrMidpoints[0].y*s+this.__arrMidpoints[1].y*e,this.__arrMidpoints[1].x=this.__arrMidpoints[1].x*s+this.__arrMidpoints[2].x*e,this.__arrMidpoints[1].y=this.__arrMidpoints[1].y*s+this.__arrMidpoints[2].y*e,this.__arrMidpoints[0].x=this.__arrMidpoints[0].x*s+this.__arrMidpoints[1].x*e,this.__arrMidpoints[0].y=this.__arrMidpoints[0].y*s+this.__arrMidpoints[1].y*e,this.__arrMidpoints[0]}})}),define("components/FollowPathComponent",["require","exports","module","thor/math/Path","thor/core/Class","thor/core/Validation","thor/event/EventManager","thor/entity/EntityComponent","thor/entity/EntityDestroyedEvent"],function(e,t,i){var n=(e("thor/math/Path"),e("thor/core/Class")),r=(e("thor/core/Validation"),e("thor/event/EventManager"),e("thor/entity/EntityComponent")),s=e("thor/entity/EntityDestroyedEvent"),o={SceneComponent:{required:!0}};i.exports=n.create(r,{__path:null,__introPath:null,__isLooped:null,__percent:null,__prevPercent:null,__mainVelocity:null,__introVelocity:null,__isPointing:null,__rotationOffset:null,__currentPath:null,__currentVelocity:null,initialize:function(e){r.prototype.initialize.call(this),this.__eventManager=e,this.reset()},clone:function(e){e.reset(),e.__isPointing=this.__isPointing,e.__isLooped=this.__isLooped,e.__mainVelocity=this.__mainVelocity,e.__introVelocity=this.__introVelocity,e.__currentVelocity=this.__currentVelocity,e.__percent=this.__percent,e.__currentVelocity=this.__currentPath,e.__rotationOffset=this.__rotationOffset},reset:function(){r.prototype.reset.call(this),this.__isLooped=!1,this.__isPointing=!0,this.__mainVelocity=2e-4,this.__introVelocity=2e-4,this.__currentVelocity=2e-4,this.__rotationOffset=0,this.__percent=0,this.__currentPath=this.__path},resetToIntro:function(){this.__percent=0,this.__currentPath=this.__introPath,this.__currentVelocity=this.__introVelocity},setIntroPath:function(e){this.__introPath=e},setPercent:function(e){this.__percent=e},setPath:function(e){this.__path=e,this.__currentPath=this.__path},setIsLooped:function(e){this.__isLooped=e},setIsPointing:function(e){this.__isPointing=e},setVelocity:function(e){if(e<0)throw new Error("Must have a positive velocity");this.__mainVelocity=e,this.__currentVelocity=this.__mainVelocity},setIntroVelocity:function(e){if(e<0)throw new Error("Must have a positive intro velocity");this.__introVelocity=e},setVelocityMultiplier:function(e){this.setVelocity(2e-4*e)},setIntroVelocityMultiplier:function(e){this.setIntroVelocity(2e-4*e)},setRotationOffset:function(e){this.__rotationOffset=e},getType:function(){return"FollowPathComponent"},update:function(e){if(this.__currentPath){if(this.__percent+=this.__currentVelocity*e,this.__percent>1)if(this.__isLooped)this.__percent=this.__percent%1,this.__currentPath=this.__path,this.__currentVelocity=this.__mainVelocity;else{this.__percent=1;var t=this.__eventManager.getNewEvent(s);t.setEntityId(this.getOwningEntity().getId()),this.__eventManager.queueEvent(t)}if(this.__percent!==this.__prevPercent){var i=this.__currentPath.getPosition(this.__percent);if(this._siblings.SceneComponent.setTranslation(i.x,i.y),this.__prevPercent=this.__percent,this.__isPointing){var n=i.x,r=i.y;i=this.__currentPath.getPosition(this.__percent-.001),n-=i.x,r-=i.y;var o=Math.atan2(r,n);this._siblings.SceneComponent.setRotation(o+this.__rotationOffset)}}}}}),r.computeDependencies(r,o,i.exports)}),define("components/MoveTowardsComponent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/entity/SceneComponent","thor/entity/EntityComponent","../Constants"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/entity/SceneComponent"),e("thor/entity/EntityComponent")),s=e("../Constants"),o=s.CLOSE_DISTANCE,a=1/o,_=s.MAX_SHIP_VELOCITY,l=_*_,h={SceneComponent:{required:!0}},u=[0,0];i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.__target={x:0,y:0},this.__velocity=0},setPosition:function(e,t){this.__target.x=e,this.__target.y=t},moveTowards:function(e,t){this.__target.x=e,this.__target.y=t},moveTowardsRelative:function(e,t){this.__target.x+=e,this.__target.y+=t},getTarget:function(){return this.__target},getType:function(){return"MoveTowardsComponent"},getVelocity:function(){return this.__velocity},stop:function(){this._siblings.SceneComponent.getTranslation(u),this.__target.x=u[0],this.__target.y=u[1]},setMaxVelocity:function(e){_=e,l=_*_},update:function(e){if(this._siblings.SceneComponent.getTranslation(u),u[0]!==this.__target.x||u[1]!==this.__target.y){var t=this.__target.x,i=this.__target.y,n=t-u[0],r=i-u[1],s=Math.atan2(r,n),l=Math.sqrt(n*n+r*r),h=_;l<o&&(h=h*l*a),this.__velocity=h;var c=Math.min(l,h*e*.001),d=Math.cos(s)*c,g=Math.sin(s)*c;u[0]+=d,u[1]+=g,this._siblings.SceneComponent.setTranslation(u[0],u[1]),d<0&&(this.__velocity*=-1)}else this.__velocity=0}}),r.computeDependencies(r,h,i.exports)}),define("components/SoundOnEventComponent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/audio/SoundSprite","thor/audio/SoundManager","thor/entity/EntityComponent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=(e("thor/audio/SoundSprite"),e("thor/audio/SoundManager")),o=e("thor/entity/EntityComponent");i.exports=n.create(o,{initialize:function(){o.prototype.initialize.call(this),this.__sounds=null,this.__soundNamesByEvent={},this.__soundOptionsByEvent={},this.__loopingSoundInstanceIds=[]},getType:function(){return"SoundOnEventComponent"},reset:function(){o.prototype.reset.call(this);for(var e=0;e<this.__loopingSoundInstanceIds.length;++e){var t=this.__loopingSoundInstanceIds[e];s.stopSoundByInstanceId(t)}this.__loopingSoundInstanceIds.length=0},clone:function(e){e.__sounds=this.__sounds,e.__soundNamesByEvent=this.__soundNamesByEvent,e.__soundOptionsByEvent=this.__soundOptionsByEvent},setSoundSprite:function(e){this.__sounds=e},setEventSound:function(e,t,i){r.isObject(i)&&(this.__soundOptionsByEvent[e]=i),this.__soundNamesByEvent[e]?this.__soundNamesByEvent[e].push(t):this.__soundNamesByEvent[e]=[t]},playSound:function(e){var t=this.__soundNamesByEvent[e];if(this.__sounds&&t){var i=t[Math.floor(Math.random()*t.length)],n=this.__soundOptionsByEvent[e],r=this.__sounds.play(i,n);r&&n&&n.loop&&this.__loopingSoundInstanceIds.push(r)}}}),o.computeDependencies(o,{},i.exports)}),define("components/KillChildrenComponent",["require","exports","module","thor/core/Class","thor/entity/Entity","thor/core/Validation","thor/event/EventManager","thor/entity/EntityComponent","thor/entity/EntityDestroyedEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/entity/Entity"),e("thor/core/Validation"),e("thor/event/EventManager"),e("thor/entity/EntityComponent")),s=e("thor/entity/EntityDestroyedEvent");i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this),this.__deathList=[],this.__eventManager=e},reset:function(){r.prototype.reset.call(this);for(var e=this.__deathList.length,t=0;t<e;t++){var i=this.__deathList[t],n=this.__eventManager.getNewEvent(s);n.setEntityId(i.getId()),this.__eventManager.queueEvent(n)}this.__deathList.length=0},getType:function(){return"KillChildrenComponent"},addChild:function(e){this.__deathList.push(e)}}),r.computeDependencies(r,{},i.exports)}),define("components/TimedDespawnComponent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/EventManager","thor/entity/EntityComponent","thor/entity/EntityDestroyedEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/event/EventManager"),e("thor/entity/EntityComponent")),s=e("thor/entity/EntityDestroyedEvent");i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this),this.__eventManager=e,this.reset()},clone:function(e){e.__timer=this.__timer,e.__lifetimeMS=this.__lifetimeMS,e.__destroyedByPlayer=this.__destroyedByPlayer},reset:function(){r.prototype.reset.call(this),this.__timer=1/0,this.__lifetimeMS=0,this.__destroyedByPlayer=!1},setDestroyedByPlayer:function(e){this.__destroyedByPlayer=e},setLifetimeMS:function(e){this.__timer=e,this.__lifetimeMS=e},setLifetime:function(e){this.__timer=1e3*e,this.__lifetimeMS=1e3*e},getLifetimeMS:function(){return this.__lifetimeMS},getRemainingLifetime:function(){return this.__timer},getType:function(){return"TimedDespawnComponent"},update:function(e){if(this.__timer-=e,this.__timer<=0){var t=this.__eventManager.getNewEvent(s);t.setEntityId(this.getOwningEntity().getId()),t.setDestroyedByPlayer(this.__destroyedByPlayer),this.__eventManager.queueEvent(t)}}}),r.computeDependencies(r,{},i.exports)}),define("events/TargetPositionReachedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("TargetPositionReachedEvent",2895358405,{x:n.isNumber,y:n.isNumber,entityId:n.isNumber})}),define("components/MoveToTargetComponent",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/event/EventManager","thor/entity/SceneComponent","thor/entity/EntityComponent","events/TargetPositionReachedEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/event/EventManager"),e("thor/entity/SceneComponent"),e("thor/entity/EntityComponent")),s=e("events/TargetPositionReachedEvent"),o=[0,0],a={SceneComponent:{}};i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this),this.__eventManager=e,this.__targetPosition=[0,0],this.__maxSpeed=0,this.__targetReached=!0},clone:function(e){e.reset(),e.__maxSpeed=this.__maxSpeed,e.__targetPosition=this.__targetPosition,e.__targetReached=this.__targetReached},reset:function(){r.prototype.reset.call(this),this.__maxSpeed=0,this.__targetPosition=[0,0],this.__targetReached=!0},getType:function(){return"MoveToTargetComponent"},getMaxSpeed:function(){return this.__maxSpeed},setMaxSpeed:function(e){this.__maxSpeed=e},setTargetPosition:function(e,t){this.__targetPosition[0]=e,this.__targetPosition[1]=t,this.__targetReached=!1},update:function(e){if(!this.__targetReached){this._siblings.SceneComponent.getTranslation(o);var t=this.__targetPosition[0]-o[0],i=this.__targetPosition[1]-o[1];if(Math.abs(t)<.01&&Math.abs(i)<.01){this.__targetReached=!0;var n=this.__eventManager.getNewEvent(s);return n.setX(this.__targetPosition[0]),n.setY(this.__targetPosition[1]),n.setEntityId(this.getOwningEntity().getId()),void this.__eventManager.queueEvent(n)}var r=t,a=i;if(this.__maxSpeed>0){var _=Math.sqrt(t*t+i*i),l=1/_,h=t*l,u=i*l,c=Math.min(_,.001*e*this.__maxSpeed);r=h*c,a=u*c}this._siblings.SceneComponent.setTranslation(o[0]+r,o[1]+a)}}}),r.computeDependencies(r,a,i.exports)}),
define("components/RectCollisionComponent",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","thor/entity/SceneComponent","thor/entity/EntityComponent","../CollisionManager"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=(e("thor/core/Validation"),e("thor/entity/SceneComponent"),e("thor/entity/EntityComponent")),s=(e("../CollisionManager"),{SceneComponent:{required:!0}}),o=[0,0],a=[1,1];i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this),this.__collisionManager=e,this.__width=10,this.__height=10,this.__category=0,this.__mask=0,this.__offsetX=0,this.__offsetY=0,this.__isEnabled=!0},clone:function(e){r.prototype.clone.call(this,e),e.__width=this.__width,e.__height=this.__height,e.__category=this.__category,e.__mask=this.__mask,e.__offsetX=this.__offsetX,e.__offsetY=this.__offsetY,e.__isEnabled=this.__isEnabled},getMask:function(){return this.__mask},getCategory:function(){return this.__category},setWidth:function(e){this.__width=e},getWidth:function(){return this.__width},setHeight:function(e){this.__height=e},getHeight:function(){return this.__height},setOffset:function(e,t){this.__offsetX=e,this.__offsetY=t},setMask:function(e){this.__mask=e},getEnabled:function(){return this.__isEnabled},setEnabled:function(e){this.__isEnabled=e},setCategory:function(e){this.__category=e},getType:function(){return"RectCollisionComponent"},debugDraw:function(e){e.lineBatch.addRect(this.__offsetX-this.__width/2,this.__offsetY-this.__height/2,this.__width,this.__height,this._siblings.SceneComponent._worldToLocalTransform,4294902015,4)},update:function(e){this.__isEnabled&&(0===this.__width&&0===this.__height||(this._siblings.SceneComponent.getTranslation(o),this._siblings.SceneComponent.getScale(a),this.__collisionManager.addRectCollider(o[0]+this.__offsetX,o[1]+this.__offsetY,this.__width*a[0],this.__height*a[1],this._siblings.SceneComponent.getRotation()*-1,this.getOwningEntity().getId(),this.__category,this.__mask)))}}),r.computeDependencies(r,s,i.exports)}),define("components/SprayMovementComponent",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Device","thor/core/Validation","thor/entity/SceneComponent","thor/entity/EntityComponent"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=(e("thor/core/Device"),e("thor/core/Validation")),s=(e("thor/entity/SceneComponent"),e("thor/entity/EntityComponent")),o={SceneComponent:{}},a=[0,0];i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__velocityX=0,this.__initialVelocityX=0,this.__accelerationX=0,this.__velocityY=-100,this.__initialVelocityY=-100,this.__accelerationY=0,this.__minVelocityX=-(1/0),this.__maxVelocityX=1/0,this.__minVelocityY=-(1/0),this.__maxVelocityY=1/0,this.__minimumX=-(1/0),this.__maximumX=1/0,this.__startHeight=0},reset:function(){s.prototype.reset.call(this),this.__velocityX=0,this.__initialVelocityX=0,this.__velocityY=0,this.__initialVelocityY=0,this.__accelerationX=0,this.__minVelocityX=-(1/0),this.__maxVelocityX=1/0,this.__accelerationY=0,this.__minVelocityY=-(1/0),this.__maxVelocityY=1/0,this.__minimumX=-(1/0),this.__maximumX=1/0,this.__startHeight=0,this.__remainderX=0,this.__remainderY=0},clone:function(e){e.__velocityX=this.__initialVelocityX,e.__initialVelocityX=this.__initialVelocityX,e.__velocityY=this.__initialVelocityY,e.__initialVelocityY=this.__initialVelocityY,e.__accelerationX=this.__accelerationX,e.__minVelocityX=this.__minVelocityX,e.__maxVelocityX=this.__maxVelocityX,e.__accelerationY=this.__accelerationY,e.__minVelocityY=this.__minVelocityY,e.__maxVelocityY=this.__maxVelocityY,e.__minimumX=this.__minimumX,e.__maximumX=this.__maximumX,e.__startHeight=this.__startHeight},setVelocityX:function(e){this.__velocityX=e,this.__initialVelocityX=e},getVelocityX:function(){return this.__velocityX},setAccelerationX:function(e){this.__accelerationX=e},setMinVelocityX:function(e){this.__minVelocityY=e},setMaxVelocityX:function(e){this.__maxVelocityX=e},setVelocityY:function(e){this.__velocityY=e,this.__initialVelocityY=e},getVelocityY:function(){return this.__velocityY},setAccelerationY:function(e){this.__accelerationY=e},setMinVelocityY:function(e){this.__minVelocityY=e},setMaxVelocityY:function(e){this.__maxVelocityY=e},setStartHeight:function(e){this.__startHeight=e},setXBounds:function(e,t){this.__minimumX=e,this.__maximumX=t},getType:function(){return"SprayMovementComponent"},update:function(e){this._siblings.SceneComponent.getTranslation(a),this.__accelerationX&&(this.__velocityX+=.001*this.__accelerationX),this.__velocityX=Math.min(Math.max(this.__velocityX,this.__minVelocityX),this.__maxVelocityX),this.__accelerationY&&(this.__velocityY+=.001*this.__accelerationY),this.__velocityY=Math.min(Math.max(this.__velocityY,this.__minVelocityY),this.__maxVelocityY);var t=a[0],i=a[1];t+=this.__velocityX*e*.001,i+=this.__velocityY*e*.001,r.isNumber(this.__minimumX)&&t<=this.__minimumX&&this.__velocityX<0?(this.__velocityX=0,t=this.__minimumX,r.isNumber(this.__accelerationX)&&(this.__accelerationX=0)):r.isNumber(this.__maximumX)&&t>=this.__maximumX&&this.__velocityX>0&&(this.__velocityX=0,t=this.__maximumX,r.isNumber(this.__accelerationX)&&(this.__accelerationX=0)),this._siblings.SceneComponent.setTranslation(t,i)}}),s.computeDependencies(s,o,i.exports)}),define("SystemType",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum");i.exports=n.create("SystemType",{GUN:1,MISSILE:2,COMPANION:4})}),define("components/SystemUpgradeComponent",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/entity/EntityComponent","thor/entity/AnimatedSpriteComponent","SystemType","thor/graphics/resources/TextureRegionResource"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/entity/EntityComponent")),s=e("thor/entity/AnimatedSpriteComponent"),o=e("SystemType"),a=(e("thor/graphics/resources/TextureRegionResource"),{TimedDespawnComponent:{required:!0}}),_=o.getFields().length;i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.reset()},clone:function(e){s.prototype.clone.call(this,e),e.__periodMS=this.__periodMS,e.__loopPeriodMS=this.__loopPeriodMS,e.__fadeFrames=this.__fadeFrames,e.__fadeAlpha=this.__fadeAlpha,e.__framesPerSystem=this.__framesPerSystem,e.__startingFrameIndex=this.__startingFrameIndex,e.__virtualFrameIndex=this.__virtualFrameIndex,e.__lockedUpgrades=this.__lockedUpgrades,e._updateFramesPerSystem()},reset:function(){s.prototype.reset.call(this),this.__periodMS=0,this.__loopPeriodMS=0,this.__fadeFrames=1,this.__fadeAlpha=0,this.__framesPerSystem=0,this.__startingFrameIndex=0,this.__virtualFrameIndex=0,this.__lockedUpgrades=0},setAnimatedSprite:function(e){s.prototype.setAnimatedSprite.call(this,e)},setStartingSystem:function(e){var t=o.getOrdinal(e);if(t===-1)throw new Error("Tried spawning a system upgrade with a system type that doesn't exist: "+e);this.__startingFrameIndex=this.__framesPerSystem*t,this.__frameIndex=this.__startingFrameIndex},setLockedUpgrades:function(e){this.__lockedUpgrades=e},getSystem:function(){var e=~~(this.__frameIndex/this.__framesPerSystem);return o.getFields()[e]},setPeriodMS:function(e){this.__periodMS=e,this.__loopPeriodMS=this.__periodMS*_,this._updateFramesPerSystem()},setFadeFrames:function(e){this.__fadeFrames=e},setFadeAlpha:function(e){this.__fadeAlpha=e},getType:function(){return"SystemUpgradeComponent"},_updateFramesPerSystem:function(){this.__animatedSprite&&(this.__framesPerSystem=this.__animatedSprite.getFramesPerSecond()/1e3*this.__periodMS,this.__framesPerFade=this.__framesPerSystem/2)},isLastLoop:function(){return this._siblings.TimedDespawnComponent.getRemainingLifetime()<=this.__loopPeriodMS},update:function(e){if(this.__animatedSprite&&this.__playing)for(this.__elapsedTimeMS+=e;this.__elapsedTimeMS>=this.__framePeriodMS;){this.__virtualFrameIndex++;var t=this.__startingFrameIndex+this.__virtualFrameIndex;if(t%this.__framesPerSystem==0)for(var i=~~(t/this.__framesPerSystem)%_;1<<i&this.__lockedUpgrades;)this.__virtualFrameIndex+=this.__framesPerSystem,i=(i+1)%_;var n=this.__animatedSprite.getFrames().length;if(this.__virtualFrameIndex>=n&&(this.__virtualFrameIndex-=n,this.__loopCount++,this.__loopCount>=this.__maxLoopCount&&this.__holdOnLastFrame&&(this.__virtualFrameIndex=n-1),this.__onLoopCallback&&this.__onLoopCallback(this.getOwningEntity())),this.__elapsedTimeMS-=this.__framePeriodMS,this.__frameIndex=(this.__startingFrameIndex+this.__virtualFrameIndex)%n,this.isLastLoop()){var r=~~(this.__virtualFrameIndex%(2*this.__fadeFrames)/this.__fadeFrames),s=r?this.__fadeAlpha:255;this.setAlphaTint(s)}}}}),r.computeDependencies(r,a,i.exports)}),define("events/ReplayEndedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("ReplayEndedEvent",2717443412,{entityId:n.assertIsNumber})}),define("components/ReplayPositionComponent",["require","exports","module","thor/math/Path","thor/core/Class","thor/core/Validation","thor/event/EventManager","thor/entity/EntityComponent","thor/entity/EntityDestroyedEvent","thor/graphics/resources/TextureRegionResource","../Constants","events/ReplayEndedEvent"],function(e,t,i){var n=(e("thor/math/Path"),e("thor/core/Class")),r=e("thor/core/Validation"),s=(e("thor/event/EventManager"),e("thor/entity/EntityComponent")),o=(e("thor/entity/EntityDestroyedEvent"),e("thor/graphics/resources/TextureRegionResource")),a=e("../Constants"),_=e("events/ReplayEndedEvent"),l={SceneComponent:{required:!0}};i.exports=n.create(s,{initialize:function(e){s.prototype.initialize.call(this),this.__eventManager=e,this.__previousPosition={x:0,y:0},this.__previousSlope={x:0,y:0},this.__time=0,this.__idxPosition=0,this.__arrPositions=[],this.__isPlaying=!1,this.__profileRegion=null,this.reset()},clone:function(e){s.prototype.clone.call(this,e),e.__arrPositions=[];for(var t=0,i=this.__arrPositions.length;t<i;t++){var n=this.__arrPositions[t];e.__arrPositions.push({x:n.x,y:n.y,t:n.t,c:n.c})}e.__idxPosition=this.__idxPosition},reset:function(){s.prototype.reset.call(this),this.__time=0,this.__isPlaying=!1,this.__arrPositions=[],this.__previousPosition.x=0,this.__previousPosition.y=0,this.__previousSlope.x=0,this.__previousSlope.y=0,this.__idxPosition=0,this.__profileRegion=null},getType:function(){return"ReplayPositionComponent"},__processPositions:function(){for(var e=this.__arrPositions.length,t=0;t<e;t++){var i=this.__arrPositions[t];r.isNumber(i.c)||(i.c=1)}},setReplay:function(e){r.ifDefined.assertIsInstanceOf(e.playerProfileRegion,o),this.setPositions(e.positions),this.__playerProfileRegion=e.playerProfileRegion},getPlayerProfileRegion:function(){return this.__playerProfileRegion},setPositions:function(e){for(var t=e.length,i=0;i<t;i++){var n=e[i];r.ifDefined.assertIsNumber(n.c)}this.__arrPositions=e,this.__idxPosition=0,this.__processPositions()},__findPositionIndex:function(){for(var e=this.__arrPositions[this.__idxPosition+1];e&&e.t<this.__time;)this.__idxPosition++,e=this.__arrPositions[this.__idxPosition+1];return this.__idxPosition},play:function(){this.__isPlaying=!0,this.__time=0,this.__previousPosition.x=this.__arrPositions[0].x,this.__previousPosition.y=this.__arrPositions[0].y,this.__previousSlope.x=0,this.__previousSlope.y=0,this.__idxPosition=0},setPaused:function(e){this._siblings.SceneComponent.setAlphaTint(e?0:a.GHOST_ALPHA),this.__isPlaying=!e},update:function(e){if(this.__isPlaying){this.__time+=e;var t=this.__findPositionIndex(this.__time),i=this.__arrPositions[t];if(i){var n,r=this.__time-i.t,s=r/a.RECORDING_INTERVAL_MS,o=~~s;if(i.c>1?(s-=o,n=o<i.c?i:this.__arrPositions[t+1]):n=this.__arrPositions[t+1],!n){n=i;var l=this.__eventManager.getNewEvent(_,1);l.setEntityId(this.getOwningEntity().getId()),this.__eventManager.queueEvent(l)}var h=1-s,u=i.x*h+n.x*s,c=i.y*h+n.y*s,d=this.__previousPosition,g=d.x,p=d.y,m=this.__previousSlope,f=m.x,v=m.y,y=.7*u+(1-.7)*(g+f),E=.7*c+(1-.7)*(p+v),S=.5*(g-y)+.5*f,T=.5*(p-E)+.5*v;d.x=y,d.y=E,m.x=S,m.y=T,this._siblings.SceneComponent.setTranslation(y,E)}}}}),s.computeDependencies(s,l,i.exports)}),define("components/RecordPositionComponent",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","thor/event/EventManager","thor/entity/SceneComponent","thor/entity/EntityComponent","../Constants"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=e("thor/core/Validation"),s=(e("thor/event/EventManager"),e("thor/entity/SceneComponent"),e("thor/entity/EntityComponent")),o=e("../Constants"),a={SceneComponent:{}},_=[0,0];i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.__sceneComponent=null,this.__arrPositions=null,this.__timer=null,this.__intervalTimer=null,this.__isRecording=null,this.__arrPositions=[],this.reset()},reset:function(){s.prototype.reset.call(this),this.__sceneComponent=null,this.__arrPositions=[],this.__isRecording=!1,this.__timer=0,this.__intervalTimer=0},startRecording:function(e){if(r.ifDefined.assertIsArray(e),this.__isRecording=!0,this.__intervalTimer=o.RECORDING_INTERVAL_MS,e&&e.length)if(this.__arrPositions=e,e.length){var t=e[e.length-1],i=o.RECORDING_INTERVAL_MS*(t.count-1);this.__timer=t.time+i}else this.__timer=0},pauseRecording:function(){this.__isRecording=!1},getType:function(){return"RecordPositionComponent"},getPositions:function(){return this.__arrPositions},update:function(e){if(this.__isRecording){this.__timer+=e,this.__intervalTimer+=e,this._siblings.SceneComponent.getTranslation(_);_[0],_[1];if(!(this.__intervalTimer<o.RECORDING_INTERVAL_MS)){this.__intervalTimer=0;var t=this.__arrPositions[this.__arrPositions.length-1];t&&Math.abs(_[0]-t.x)<1&&Math.abs(_[1]-t.y)<1?t.count++:this.__arrPositions.push({x:~~_[0],y:~~_[1],count:1,time:this.__timer})}}}}),s.computeDependencies(s,a,i.exports)}),define("components/PositionDespawnComponent",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","thor/core/Device","thor/event/EventManager","thor/entity/SceneComponent","thor/entity/SpriteComponent","thor/entity/EntityComponent","thor/entity/EntityDestroyedEvent"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=e("thor/core/Validation"),s=e("thor/core/Device"),o=(e("thor/event/EventManager"),e("thor/entity/SceneComponent"),e("thor/entity/SpriteComponent"),e("thor/entity/EntityComponent")),a=e("thor/entity/EntityDestroyedEvent"),_={SceneComponent:{},SpriteComponent:{required:!1},AnimatedSpriteComponent:{required:!1}},l=[0,0],h=[0,0];i.exports=n.create(o,{initialize:function(e){o.prototype.initialize.call(this),this.__eventManager=e,this.__despawnMinX=-(1/0),this.__despawnMaxX=1/0,this.__despawnMinY=-(1/0),this.__despawnMaxY=1/0,this.__gameScaleFactor=1,this.__spritesMinX=0,this.__spritesMaxX=0,this.__spritesMinY=0,this.__spritesMaxY=0,this.reset()},reset:function(){o.prototype.reset.call(this),this.__despawnMinX=-(1/0),this.__despawnMaxX=1/0,this.__despawnMinY=-(1/0),this.__despawnMaxY=1/0,this.__gameScaleFactor=1,this.__spritesMinX=0,this.__spritesMaxX=0,this.__spritesMinY=0,this.__spritesMaxY=0},clone:function(e){e.__despawnMinX=this.__despawnMinX,e.__despawnMaxX=this.__despawnMaxX,e.__despawnMinY=this.__despawnMinY,e.__despawnMaxY=this.__despawnMaxY,e.__gameScaleFactor=this.__gameScaleFactor,e.__spritesMinX=this.__spritesMinX,e.__spritesMaxX=this.__spritesMaxX,e.__spritesMinY=this.__spritesMinY,e.__spritesMaxY=this.__spritesMaxY},getType:function(){return"PositionDespawnComponent"},setMaxDespawnXPosition:function(e){this.__despawnMaxX=e},setMaxDespawnYPosition:function(e){this.__despawnMaxY=e},setMinDespawnXPosition:function(e){this.__despawnMinX=e},setMinDespawnYPosition:function(e){this.__despawnMinY=e},setBounds:function(e){this.__despawnMinX=0,this.__despawnMaxX=e.width,this.__despawnMinY=0,this.__despawnMaxY=e.height,this.__gameScaleFactor=e.width/e.canvasWidth*s.pixelScale},entityChanged:function(){o.prototype.entityChanged.call(this),this.__spritesMinX=1/0,this.__spritesMaxX=-(1/0),this.__spritesMinY=1/0,this.__spritesMaxY=-(1/0);var e=[0,0],t=[1,1];for(var i in this._siblings){var n,s,a=this._siblings[i];if(a&&"SpriteComponent"===a.getType()?(a.getTranslation(e),a.getScale(t),n=a.getWidth()/2*t[0],s=a.getHeight()/2*t[1]):a&&"AnimatedSpriteComponent"===a.getType()&&(a.getTranslation(e),a.getScale(t),a.getFrameDimensions(h),n=h[0]/2*t[0],s=h[1]/2*t[1]),r.isNumber(n)&&r.isNumber(s)){var _=e[0]-n;_<this.__spritesMinX&&(this.__spritesMinX=_),_=e[0]+n,_>this.__spritesMaxX&&(this.__spritesMaxX=_),_=e[1]-s,_<this.__spritesMinY&&(this.__spritesMinY=_),_=e[1]+s,_>this.__spritesMaxY&&(this.__spritesMaxY=_)}}},update:function(){if(this._siblings.SceneComponent.getTranslation(l),l[0]<=this.__despawnMinX+this.__spritesMinX*this.__gameScaleFactor||l[0]>=this.__despawnMaxX+this.__spritesMaxX*this.__gameScaleFactor||l[1]<=this.__despawnMinY+this.__spritesMinY*this.__gameScaleFactor||l[1]>=this.__despawnMaxY+this.__spritesMaxY*this.__gameScaleFactor){var e=this.__eventManager.getNewEvent(a);e.setEntityId(this.getOwningEntity().getId()),this.__eventManager.queueEvent(e)}}}),o.computeDependencies(o,_,i.exports)}),define("components/AnimationControllerComponent",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/entity/EntityComponent","thor/graphics/resources/AnimatedSpriteResource"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/entity/EntityComponent")),s=(e("thor/graphics/resources/AnimatedSpriteResource"),{AnimatedSpriteComponent:{}});i.exports=n.create(r,{initialize:function(){r.prototype.initialize.call(this),this.__animations={},this.__boundLoopCallback=this.__loopCallback.bind(this)},__loopCallback:function(e){this.notify("default")},clone:function(e){e.__animations=this.__animations},setAnimations:function(e){for(var t in e)var i=e[t];this.__animations=e},getType:function(){return"AnimationControllerComponent"},notify:function(e){var t=this.__animations[e];if(t){var i=this._siblings.AnimatedSpriteComponent;switch(t.loop){case"hold":i.setLoopCount(1),i.clearOnLoopCallback(),i.setHoldOnLastFrame(!0);break;case"reset":i.setLoopCount(1),i.setOnLoopCallback(this.__boundLoopCallback),i.setHoldOnLastFrame(!1);break;case"loop":default:i.setLoopCount(1/0),i.clearOnLoopCallback(),i.setHoldOnLastFrame(!1)}i.setAnimatedSprite(t.sprite)}}}),r.computeDependencies(r,s,i.exports)}),define("events/SpawnEntityEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","thor/entity/Entity","thor/math/Path","thor/audio/SoundSprite"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event"),s=(e("thor/entity/Entity"),e("thor/math/Path"),e("thor/audio/SoundSprite"));i.exports=r.generateEventClass("SpawnEntity",3802306106,{x:n.assertIsNumber,y:n.assertIsNumber,entityType:n.assertIsNonEmptyString,soundSprite:function(e){n.ifDefined.assertIsInstanceOf(e,s)},soundName:n.ifDefined.assertIsNonEmptyString})}),define("components/IntervalSpawnerComponent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/audio/SoundSprite","thor/event/EventManager","thor/entity/EntityComponent","thor/entity/SceneComponent","components/LookAtComponent","components/AnimationControllerComponent","events/SpawnEntityEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/audio/SoundSprite"),e("thor/event/EventManager"),e("thor/entity/EntityComponent")),s=(e("thor/entity/SceneComponent"),e("components/LookAtComponent"),e("components/AnimationControllerComponent"),e("events/SpawnEntityEvent")),o={SceneComponent:{},LookAtComponent:{required:!1},AnimationControllerComponent:{required:!1}},a=[0,0];i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this),this.__eventManager=e,this.__gameSize={width:0,height:0},this.__spawnOffset={x:0,y:0},this.__spawnLookAt=!1,this.__interval=1/0,this.__anticipationInterval=1/0,this.__entityType=null,this.__spawnTimer=1/0,this.__sounds=null,this.__soundName=null,this.__allowOffscreenSpawns=!0,this.__maxSpawns=0,this.__sequenceOffsetX=0,this.__sequenceModuloX=1/0,this.__numSpawned=0,this.__shouldSpawnImmediate=!1,this.reset()},reset:function(){r.prototype.reset.call(this),this.__entityType=null,this.__interval=1/0,this.__anticipationInterval=1/0,this.__spawnTimer=1/0,this.__allowOffscreenSpawns=!0,this.__gameSize.width=0,this.__gameSize.height=0,this.__spawnLookAt=!1,this.__spawnOffset.x=0,this.__spawnOffset.y=0,this.__numSpawned=0,this.__maxSpawns=0,this.__shouldSpawnImmediate=!1,this.__sequenceOffsetX=0,this.__sequenceModuloX=1/0},clone:function(e){e.__sounds=this.__sounds,e.__soundName=this.__soundName,e.__entityType=this.__entityType,e.__interval=this.__interval,e.__anticipationInterval=this.__anticipationInterval,e.__spawnTimer=this.__spawnTimer,e.__allowOffscreenSpawns=this.__allowOffscreenSpawns,e.__gameSize.width=this.__gameSize.width,e.__gameSize.height=this.__gameSize.height,e.__spawnLookAt=this.__spawnLookAt,e.__spawnOffset.x=this.__spawnOffset.x,e.__spawnOffset.y=this.__spawnOffset.y,e.__maxSpawns=this.__maxSpawns,e.__shouldSpawnImmediate=this.__shouldSpawnImmediate,e.__sequenceOffsetX=this.__sequenceOffsetX,e.__sequenceModuloX=this.__sequenceModuloX},setAllowOffscreenSpawns:function(e){this.__allowOffscreenSpawns=e},setSequenceOffsetX:function(e){this.__sequenceOffsetX=e},setSequenceOffsetModuloX:function(e){this.__sequenceModuloX=e},setGameSize:function(e,t){this.__gameSize.width=e,this.__gameSize.height=t},setSpawnOffset:function(e,t){this.__spawnOffset.x=e,this.__spawnOffset.y=t},setSpawnSound:function(e,t){this.__sounds=e,this.__soundName=t},setInterval:function(e){this.__interval=e,this.__shouldSpawnImmediate||(this.__spawnTimer=this.__interval)},getInterval:function(){return this.__interval},setAnticipationInterval:function(e){this.__anticipationInterval=e},getAnticipationInterval:function(){return this.__anticipationInterval},setEntityType:function(e){this.__entityType=e},getType:function(){return"IntervalSpawnerComponent"},setMaxSpawns:function(e){this.__maxSpawns=e},setSpawnLookAt:function(e){this.__spawnLookAt=e},setSpawnImmediate:function(e){this.__shouldSpawnImmediate=e,e&&(this.__spawnTimer=0)},update:function(e){if(!(this.__maxSpawns>0&&this.__numSpawned>=this.__maxSpawns)){var t=!1;if(this.__spawnTimer>this.__anticipationInterval&&(t=!0),this.__spawnTimer-=e,t&&this._siblings.AnimationControllerComponent&&this.__spawnTimer<this.__anticipationInterval&&this._siblings.AnimationControllerComponent.notify("anticipate"),this.__spawnTimer<=0){this._siblings.SceneComponent.getTranslation(a);var i=a[0],n=a[1];if(!this.__allowOffscreenSpawns&&(i<0||n<0||i>this.__gameSize.width||n>this.__gameSize.height))return;var r,o,_=this.__spawnOffset.x,l=this.__spawnOffset.y;if(this._siblings.LookAtComponent){var h=this._siblings.LookAtComponent.getTargetDirection(),u=-Math.sin(h),c=Math.cos(h);r=i+l*u-_*c,o=n+l*c+_*u}else r=(i+_+this.__numSpawned*this.__sequenceOffsetX)%this.__sequenceModuloX,o=n+l;var d=this.__eventManager.getNewEvent(s);d.setX(r),d.setY(o),d.setEntityType(this.__entityType),d.setSoundSprite(this.__sounds),d.setSoundName(this.__soundName),this.__eventManager.queueEvent(d),this.__numSpawned++,this._siblings.AnimationControllerComponent&&this._siblings.AnimationControllerComponent.notify("fire"),this.__spawnTimer=this.__interval}}}}),r.computeDependencies(r,o,i.exports)}),define("events/BackgroundScrollTopEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("BackgroundScrollTop",2248160707,{entityId:n.assertIsNumber,startOffset:n.assertIsNumber})}),define("events/BackgroundScrollBottomEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("BackgroundScrollBottom",2987466084,{entityId:n.assertIsNumber})}),define("components/BackgroundMovementComponent",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Device","thor/core/Validation","thor/event/EventManager","thor/entity/SceneComponent","thor/entity/EntityComponent","thor/entity/EntityDestroyedEvent","events/BackgroundScrollTopEvent","events/BackgroundScrollBottomEvent"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=e("thor/core/Device"),s=(e("thor/core/Validation"),e("thor/event/EventManager"),e("thor/entity/SceneComponent"),e("thor/entity/EntityComponent")),o=e("thor/entity/EntityDestroyedEvent"),a=e("events/BackgroundScrollTopEvent"),_=e("events/BackgroundScrollBottomEvent"),l={SceneComponent:{}},h=[0,0];i.exports=n.create(s,{initialize:function(e){s.prototype.initialize.call(this),this.__eventManager=e,this.__velocity=100,this.__velocitySource=null,this.__startHeight=0,this.__topEventHeight=0,this.__bottomEventHeight=0,this.__hasTopEventFired=!1,this.__hasBottomEventFired=!1,this.__destroyOnLeave=!1,this.__remainder=0},reset:function(){s.prototype.reset.call(this),this.__startHeight=0,this.__fireTopEvent=!1,this.__fireBottomEvent=!1,this.__topEventHeight=0,this.__bottomEventHeight=0,this.__velocitySource=null,this.__hasTopEventFired=!1,this.__hasBottomEventFired=!1,this.__remainder=0},clone:function(e){e.__velocity=this.__velocity,e.__destroyOnLeave=this.__destroyOnLeave},setVelocitySource:function(e){this.__velocitySource=e},setDestroyOnLeave:function(e){this.__destroyOnLeave=e,this.setFireEvents(!0)},setFireEvents:function(e){this.__fireTopEvent=e,this.__fireBottomEvent=e},setFireTopEvent:function(e){this.__fireTopEvent=e},setFireBottomEvent:function(e){this.__fireBottomEvent=e},setVelocity:function(e){this.__velocity=e},setStartHeight:function(e){this.__startHeight=e},setTopEventHeight:function(e){this.__topEventHeight=e,this.setFireTopEvent(!0)},setBottomEventHeight:function(e){this.__bottomEventHeight=e,this.setFireBottomEvent(!0)},resetToStart:function(){this._siblings.SceneComponent.getTranslation(h),this._siblings.SceneComponent.setTranslation(h[0],this.__startHeight),this.__hasTopEventFired=!1,this.__hasBottomEventFired=!1,this.__remainder=0},getType:function(){return"BackgroundMovementComponent"},update:function(e){this._siblings.SceneComponent.getTranslation(h),this.__velocitySource&&(this.__velocity=this.__velocitySource());var t=h[0],i=h[1],n=this.__velocity*e*.001;this.__remainder+=n;for(var s=r.scaleFactorY,l=0;this.__remainder>s;)this.__remainder-=s,l+=s;if(i+=l,this.__fireTopEvent&&!this.__hasTopEventFired&&i>this.__topEventHeight){var u=this.__eventManager.getNewEvent(a,1);u.setEntityId(this.getOwningEntity().getId()),u.setStartOffset(1+~~l),this.__eventManager.queueEvent(u),this.__hasTopEventFired=!0}if(this.__fireBottomEvent&&!this.__hasBottomEventFired&&i>this.__bottomEventHeight){var c=this.__eventManager.getNewEvent(_,1);if(c.setEntityId(this.getOwningEntity().getId()),this.__eventManager.queueEvent(c),this.__hasBottomEventFired=!0,this.__destroyOnLeave){var d=this.__eventManager.getNewEvent(o);d.setEntityId(this.getOwningEntity().getId()),this.__eventManager.queueEvent(d)}}this.__remainder+=i-~~i,this._siblings.SceneComponent.setTranslation(t,~~i)}}),s.computeDependencies(s,l,i.exports)}),define("components/TemporaryInvincibilityComponent",["require","exports","module","thor/core/Class","thor/core/Logger","thor/math/ColorUtil","thor/core/Validation","thor/entity/EntityComponent","thor/graphics/animation/EasingFunctions","Constants","ResourceTypes"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/math/ColorUtil")),s=e("thor/core/Validation"),o=e("thor/entity/EntityComponent"),a=e("thor/graphics/animation/EasingFunctions"),_=(e("Constants"),e("ResourceTypes")),l={SceneComponent:{required:!0},ResourceComponent:{required:!0}};i.exports=n.create(o,{initialize:function(){o.prototype.initialize.call(this),this.reset()},getType:function(){return"TemporaryInvincibilityComponent"},reset:function(){o.prototype.reset.call(this),this.__durationMS=0,this.__pulseDurationMS=0,this.__timeRemainingMS=0,this.__targetTint=4294967295,this.__originalTint=4294967295},clone:function(e){o.prototype.clone.call(this,e),e.__durationMS=this.__durationMS,e.__pulseDurationMS=this.__pulseDurationMS,e.__timeRemainingMS=this.__timeRemainingMS,e.__targetTint=this.__targetTint,e.__originalTint=this.__originalTint},startInvincibility:function(){this.__timeRemainingMS=this.__durationMS,this.__originalTint=this._siblings.SceneComponent.getTintColor(),this._siblings.ResourceComponent.setResource(_.INVULNERABILITY,1)},stopInvincibility:function(){this.__timeRemainingMS=0,this._siblings.SceneComponent.setTintColor(this.__originalTint),this._siblings.ResourceComponent.setResource(_.INVULNERABILITY,0)},setDurationMS:function(e){this.__durationMS=e},setPulseDurationMS:function(e){this.__pulseDurationMS=e},setTargetTint:function(e){s.isNonEmptyString(e)&&(e=parseInt(e,16)),this.__targetTint=e},update:function(e){if(!(this.__timeRemainingMS<=0)){if(this.__timeRemainingMS-=e,this.__timeRemainingMS<=0)return void this.stopInvincibility();var t,i=Math.max(0,this.__durationMS-this.__timeRemainingMS),n=i/this.__pulseDurationMS%1;t=n<.5?a.interpolateCubic(2*n):a.interpolateCubic(2*(1-n));var s=r.lerp(this.__initialTint,this.__targetTint,t);this._siblings.SceneComponent.setTintColor(s)}}}),o.computeDependencies(o,l,i.exports)}),define("events/DeactivateLaserEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("DeactivateLaserEvent",234234,{cardId:n.assertIsNonEmptyString})}),define("components/LaserBeamComponent",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","thor/audio/SoundSprite","thor/event/EventManager","../events/DeactivateLaserEvent","thor/entity/Entity","thor/entity/EntityComponent","thor/entity/AnimatedSpriteComponent","thor/entity/SceneComponent","thor/webgl/Texture","../components/ResourceComponent","../components/RectCollisionComponent","../ResourceTypes","../Constants"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=(e("thor/core/Validation"),e("thor/audio/SoundSprite"),e("thor/event/EventManager"),e("../events/DeactivateLaserEvent")),s=(e("thor/entity/Entity"),e("thor/entity/EntityComponent")),o=(e("thor/entity/AnimatedSpriteComponent"),e("thor/entity/SceneComponent"),e("thor/webgl/Texture"),e("../components/ResourceComponent"),e("../components/RectCollisionComponent"),e("../ResourceTypes")),a=(e("../Constants"),{ResourceComponent:{},SceneComponent:{},AnimatedSpriteComponent:{},RectCollisionComponent:{}});i.exports=n.create(s,{initialize:function(e){s.prototype.initialize.call(this),this.__eventManager=e,this.__laserDuration=0,this.__laserDamage=0,this.__durationTimer=0,this.__frameCount=-1,this.__frameTimer=0,this.__shipPositionScratch=[0,0],this.__laserSprites=[],this.__beamSprite=null,this.__eruptionSprite=null,this.__impactSprite=null,this.__beamOffset=0,this.__beamMidHeight=0,this.__tintColor=4294967295},setLaserData:function(e,t){this.__laserDamage=e,this.__laserDuration=t,this.__durationTimer=t,this._siblings.ResourceComponent.setResource(o.DAMAGE,this.__laserDamage),
this.getOwningEntity().getComponentsOfType("AnimatedSpriteComponent",this.__laserSprites);for(var i=0,n=this.__laserSprites.length;i<n;++i){var r=this.__laserSprites[i];switch(r.getName()){case"impact":this.__impactSprite=r;break;case"eruption":this.__eruptionSprite=r;break;case"beam":this.__beamSprite=r}}if(this.__impactSprite&&this.__eruptionSprite&&this.__beamSprite){var s=[0,0];this.__beamSprite.getFrameDimensions(s),this.__beamMidHeight=s[1];this.__eruptionSprite.setTranslation(0,-186);this._siblings.RectCollisionComponent.setWidth(2*this.__beamSprite._dpBoundingBox.width),this.__beamOffset=this.__eruptionSprite._dpBoundingBox.height/2- -186+76}},resetDuration:function(e){this.__laserDuration=e,this.__durationTimer=e},getType:function(){return"LaserBeamComponent"},clone:function(e){s.prototype.clone.call(this,e),e.__laserDuration=this.__laserDuration,e.__laserDamage=this.__laserDamage,e.__durationTimer=this.__durationTimer,e.__frameCount=this.__frameCount,e.__frameTimer=this.__frameTimer,e.__shipPositionScratch=this.__shipPositionScratch,e.__beamOffset=this.__beamOffset},__deactivateLaser:function(){var e=this.__eventManager.getNewEvent(r);e.setCardId("laser_gun"),this.__eventManager.queueEvent(e)},__frameUpdate:function(e){if(this.__impactSprite&&this.__eruptionSprite&&this.__beamSprite){this.__impactSprite.setTranslation(0,-this.__shipPositionScratch[1]);var t=this.__shipPositionScratch[1],i=t/this.__beamMidHeight;this.__beamSprite.setScale(2,i),this.__beamSprite.setTranslation(0,this.__shipPositionScratch[1]/-2-this.__beamOffset),this.__frameTimer+=.032*e,this.__frameTimer>=8&&(this.__frameTimer=0)}},__collisionUpdate:function(){var e=this._siblings.RectCollisionComponent;e.setHeight(2*this.__shipPositionScratch[1]),e.setOffset(this.__shipPositionScratch[0],this.__shipPositionScratch[1])},setTintColor:function(e){this.__tintColor=e,this.getOwningEntity().getRootComponent().setTintColor(this.__tintColor)},update:function(e){this.__durationTimer>0&&(this.__durationTimer-=.001*e),this.__durationTimer<=0&&this.__deactivateLaser(),this._siblings.SceneComponent.getParent().getTranslation(this.__shipPositionScratch),this.__collisionUpdate(),this.__frameUpdate(e)}}),s.computeDependencies(s,a,i.exports)}),define("components/ExpandingAOEComponent",["require","exports","module","thor/core/Base","thor/core/Class","thor/core/Validation","thor/audio/SoundSprite","thor/event/EventManager","thor/entity/Entity","thor/entity/EntityComponent","thor/entity/SpriteComponent","thor/entity/SceneComponent","thor/webgl/Texture","thor/entity/EntityDestroyedEvent","../components/ResourceComponent","../components/CollisionComponent","../ResourceTypes","../Constants"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=(e("thor/core/Validation"),e("thor/audio/SoundSprite"),e("thor/event/EventManager"),e("thor/entity/Entity"),e("thor/entity/EntityComponent")),s=(e("thor/entity/SpriteComponent"),e("thor/entity/SceneComponent"),e("thor/webgl/Texture"),e("thor/entity/EntityDestroyedEvent")),o=(e("../components/ResourceComponent"),e("../components/CollisionComponent"),e("../ResourceTypes"),e("../Constants")),a=3*o.GAME_AREA_HEIGHT,_={ResourceComponent:{},SceneComponent:{},SpriteComponent:{},CollisionComponent:{}};i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this),this.__eventManager=e,this.__alphaTint=0,this.__destroyFlag=!1,this.__spriteScale=1},getType:function(){return"ExpandingAOEComponent"},clone:function(e){r.prototype.clone.call(this,e),e.__alphaTint=this.__alphaTint,e.__destroyFlag=this.__destroyFlag,e.__spriteScale=this.__spriteScale},__destroyOwningEntity:function(){var e=this.getOwningEntity(),t=this.__eventManager.getNewEvent(s);t.setEntityId(e.getId()),this.__eventManager.triggerEvent(t)},update:function(e){var t=this._siblings.SpriteComponent,i=this._siblings.CollisionComponent,n=(100+.5*e)/100;this.__spriteScale*=n;var r=t._dpBoundingBox.height*this.__spriteScale;i.setRadius(r),t.scale(n,n),this.__alphaTint+=.75*e,t.setAlphaTint(this.__alphaTint),r>a&&!this.__destroyFlag&&(this.__destroyFlag=!0,this.__destroyOwningEntity())}}),r.computeDependencies(r,_,i.exports)}),define("components/GlowingSpriteComponent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/entity/EntityComponent","thor/entity/SpriteComponent","../Constants"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/entity/EntityComponent")),s=e("thor/entity/SpriteComponent");e("../Constants");i.exports=n.create(s,{initialize:function(){s.prototype.initialize.call(this),this.reset()},reset:function(){s.prototype.reset.call(this),this.__isGlowEnabled=!1,this.__halfCycleDuration=0,this.__targetAlpha=0,this.__glowTimer=0,this.setAlphaTint(0)},getType:function(){return"GlowingSpriteComponent"},clone:function(e){s.prototype.clone.call(this,e),e.__isGlowEnabled=this.__isGlowEnabled,e.__halfCycleDuration=this.__halfCycleDuration,e.__targetAlpha=this.__targetAlpha},setGlowEnabled:function(e){this.__isGlowEnabled=e},setHalfCycleDuration:function(e){this.__halfCycleDuration=e},setTargetAlpha:function(e){this.__targetAlpha=e},update:function(e){if(this.__isGlowEnabled){this.__glowTimer+=e;var t,i=this.__glowTimer/this.__halfCycleDuration;t=i%2<1?i%1:1-i%1;var n=this.__targetAlpha*t*t*(3-2*t);this.setAlphaTint(n)}}}),r.computeDependencies(s,{},i.exports)}),define("thor/util/Timing",["require","exports","module","thor/core/Validation"],function(e,t,i){e("thor/core/Validation");i.exports={delayGenerator:function(e){return function(t){return i.exports.delay(e,t)}},delay:function(e,t){return t?new Promise(function(i,n){setTimeout(function(){i(t)},e)}):new Promise(function(t,i){setTimeout(t,e)})}}}),define("events/ExplodePlayerEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("ExplodePlayer",2406455472,{x:n.assertIsNumber,y:n.assertIsNumber,entityId:n.assertIsNumber},!0)}),define("events/HideMenuUIEvent",["require","exports","module","thor/core/Class","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));i.exports=n.generateEventClass("HideMenuUI",2436396067,{},!0)}),define("events/ShowMenuUIEvent",["require","exports","module","thor/core/Class","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));i.exports=n.generateEventClass("ShowMenuUI",1163928393,{},!0)}),define("ui/TransitionTargetEnum",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum");i.exports=n.create("TransitionTargetEnum",{HOME_SCREEN:0,STORE:1})}),define("events/GameEndStatsEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation","ui/TransitionTargetEnum"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));e("thor/core/Validation"),e("ui/TransitionTargetEnum");i.exports=n.generateEventClass("GameEndStats",3754898591,{transitionTarget:function(e){}})}),define("events/AudioMuteChangedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("AudioMuteChangedEvent",678530146,{category:n.assertIsNumber,enabled:n.assertIsBoolean})}),define("events/FriendScoresLoadedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("FriendScoresLoadedEvent",554447566,{friends:n.assertIsArray})}),define("ui/MusicTypeEnum",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum"),r=n.create("MusicTypeEnum",{INTRO:1,GAMEPLAY:2});i.exports=r}),define("events/ChangeMusicEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","ui/MusicTypeEnum"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));e("ui/MusicTypeEnum");i.exports=n.generateEventClass("ChangeMusicEvent",2322317951,{musicType:function(e){}})}),define("gameplay/Tournament",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation");i.exports=n.create({initialize:function(e,t,i,n,r,s,o,a){this.id=e,this.created=t,this.duration=i,this.joinDuration=n,this.seed=r,this.scores=s,this.invited=o,this.maxSize=a},getTimeRemaining:function(e){var t=~~(Date.now()/1e3),i=t+e,n=i-this.created;return this.duration-n},getJoinTimeRemaining:function(e){var t=~~(Date.now()/1e3),i=t+e,n=i-this.created;return this.joinDuration-n}})}),define("events/GameStartingEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","gameplay/Tournament"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event"),s=e("gameplay/Tournament");i.exports=r.generateEventClass("GameStartingEvent",2883188033,{isFUE:n.assertIsBoolean,seed:n.ifDefined.assertIsNumber,tournament:function(e){n.ifDefined.assertIsInstanceOf(e,s)}})}),define("events/ReturnToFacebookEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));e("thor/core/Validation");i.exports=n.generateEventClass("ReturnToFacebookEvent",3004348331,{})}),define("events/TransitionUIStateEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("TransitionUIStateEvent",1995800263,{state:n.assertIsString,argument:n.ifDefined.assertIsObject})}),define("thor/debug/FPSTracker",["require","exports","module","thor/core/Class","thor/core/Scheduler"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Scheduler"),s=n.create({initialize:function(e,t,i,n){this.mean=e,this.min=t,this.max=i,this.standardDeviation=n}});i.exports=n.create({initialize:function(){this.__animationTaskId=null,this.__frames=0,this.__timer=0,this.__min=1/0,this.__max=0,this.__measurementCount=0,this.__oldMean=0,this.__newMean=0,this.__oldVariance=0,this.__newVariance=0},__reset:function(){this.__min=1/0,this.__max=0,this.__measurementCount=0,this.__oldMean=0,this.__newMean=0,this.__oldVariance=0,this.__newVariance=0,this.__frames=0,this.__timer=0},beginTracking:function(){this.__animationTaskId&&r.removeAnimationTask(this.__animationTaskId),this.__reset(),this.__animationTaskId=r.addAnimationTask(this.__animationTask.bind(this))},endTracking:function(){if(!this.__animationTaskId)throw new Error("Tracking ended without being stared");r.removeAnimationTask(this.__animationTaskId),this.__animationTaskId=null;var e=this.__measurementCount>0?this.__newMean:0,t=this.__measurementCount>1?this.__newVariance/(this.__measurementCount-1):0,i=Math.sqrt(t);i=Math.sqrt(i/this.__measurementCount);var n=new s(e,this.__min,this.__max,i);return this.__reset(),n},__animationTask:function(e,t){if(!(t>1e3)&&(++this.__frames,this.__timer+=t,this.__timer>1e3)){var i=this.__frames/1;this.__measurementCount++,1===this.__measurementCount?(this.__oldMean=i,this.__newMean=i,this.__oldVariance=0):(this.__newMean=this.__oldMean+(i-this.__oldMean)/this.__measurementCount,this.__newVariance=this.__oldVariance+(i-this.__oldMean)*(i-this.__newMean),this.__oldMean=this.__newMean,this.__oldVariance=this.__newVariance),i<this.__min&&(this.__min=i),i>this.__max&&(this.__max=i),this.__frames=0,this.__timer-=1e3}}}),i.exports.FPSStats=s}),define("thor/util/Timer",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation");return n.create({initialize:function(e){r.ifDefined.assertIsNumber(e),r.isDefined(e)?this.remaining=e:this.remaining=0},set:function(e){this.remaining=e},complete:function(){return this.remaining<=0},update:function(e){return this.remaining-=e,this.remaining<=0}})}),define("gameplay/WaveInfo",["require","exports","module","thor/core/Class","thor/core/Validation","thor/entity/Entity","gameplay/LevelGroupTypeEnum"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Validation"),e("thor/entity/Entity"),e("gameplay/LevelGroupTypeEnum");i.exports=n.create({initialize:function(e,t,i,n,r,s,o,a){this.id=null,this.enemyDrops=t,this.baseValue=i,this.energyDropIndex=s,this.baseHealth=n,this.totalValue=0,this.length=e,this.entitiesById={},this.spawnedCount=0,this.activeEntities=0,this.playerDestroyedCount=0,this.timeSpawned=null,this.type=r,this.goldChance=o,this.goldDropped=a},isComplete:function(){return 0===this.activeEntities&&this.spawnedCount===this.length},addEntity:function(e,t){this.entitiesById[e.getId()]=e,this.spawnedCount++,this.activeEntities++,this.totalValue+=t},setId:function(e){this.id=e},setTimeSpawned:function(e){this.timeSpawned=e}})}),define("events/WaveSpawnedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","gameplay/WaveInfo","bulletml/BulletMLResource"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));e("gameplay/WaveInfo"),e("bulletml/BulletMLResource");i.exports=n.generateEventClass("WaveSpawned",2753602301,{waveInfo:function(e){},spawnerResource:function(e){}})}),define("events/GameContinueEvent",["require","exports","module","thor/core/Class","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));i.exports=n.generateEventClass("GameContinueEvent",659348357,{})}),define("events/GameStartedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","gameplay/Tournament"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event"),s=e("gameplay/Tournament");i.exports=r.generateEventClass("GameStartedEvent",3754898586,{isFUE:n.assertIsBoolean,seed:n.ifDefined.assertIsNumber,tournament:function(e){n.ifDefined.assertIsInstanceOf(e,s)},wasContinue:n.assertIsBoolean})}),define("events/ComboUpdateEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("ComboUpdateEvent",2015779506,{count:n.assertIsNumber,multiplier:n.assertIsNumber,bonus:n.assertIsNumber})}),define("events/PlayerHealthEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("PlayerHealthEvent",2186697426,{oldHealth:n.assertIsNumber,newHealth:n.assertIsNumber,maxHealth:n.assertIsNumber,wasHit:n.ifDefined.assertIsBoolean})}),define("events/PlayerEnergyEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("PlayerEnergyEvent",32432432,{oldEnergy:n.assertIsNumber,newEnergy:n.assertIsNumber})}),define("events/PlayerDebrisEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("PlayerDebris",3223506125,{x:n.assertIsNumber,y:n.assertIsNumber,userId:n.assertIsNonEmptyString})}),define("events/ExplodeEntityEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("ExplodeEntity",23942498,{x:n.assertIsNumber,y:n.assertIsNumber,entityId:n.assertIsNumber,scale:n.ifDefined.assertIsNumber})}),define("events/ShockEntityEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("ShockEntity",2124380343,{entityId:n.ifDefined.assertIsNumber})}),define("events/GoldChangedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("GoldChanged",635735836,{gold:n.assertIsNumber},!0)}),define("events/ScoreChangedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("ScoreChanged",635734556,{score:n.assertIsNumber,totalScore:n.assertIsNumber})}),define("events/HidePlayerShipEvent",["require","exports","module","thor/core/Class","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));i.exports=n.generateEventClass("HidePlayerShip",2249142993,{})}),define("events/BossEntityCreatedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","thor/entity/Entity"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));e("thor/entity/Entity");i.exports=n.generateEventClass("BossEntityCreatedEvent",3329145774,{bossEntity:function(e){}},!0)}),define("events/BossTimerUpdateEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("BossTimerUpdateEvent",2624049451,{timeRemaining:n.assertIsNumber})}),define("events/BossSpawnedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));i.exports=n.generateEventClass("BossSpawnedEvent",539051248,{},!0)}),define("events/MinibossSpawnedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));i.exports=n.generateEventClass("MinibossSpawnedEvent",539051249,{})}),define("events/BossKilledEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));i.exports=n.generateEventClass("BossKilledEvent",539051246,{},!0)}),define("events/BossPinataEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("BossPinataEvent",539051245,{entityId:n.assertIsNumber})}),define("events/BossCompleteEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));i.exports=n.generateEventClass("BossCompleteEvent",539051244,{})}),define("events/ActivateLaserEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("ActivateLaserEvent",547577,{cardId:n.assertIsNonEmptyString})}),define("events/DisableProjectilesEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("DisableProjectilesEvent",699,{timer:n.assertIsNumber})}),define("events/SystemUpgradeComboEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","SystemType"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event"),s=e("SystemType");i.exports=r.generateEventClass("SystemUpgradeComboEvent",547579,{systemType:function(e){return n.assertIsInEnum(e,s)},comboLength:n.assertIsNumber})}),define("events/LevelSectionChangedEvent",["require","exports","module","thor/core/Validation","thor/event/Event","gameplay/Level"],function(e,t,i){var n=e("thor/core/Validation"),r=e("thor/event/Event"),s=e("gameplay/Level");i.exports=r.generateEventClass("LevelSectionChanged",4125221378,{level:function(e){n.assertIsInstanceOf(e,s)},index:n.assertIsNumber})}),define("events/CompleteGameEndingEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));i.exports=n.generateEventClass("CompleteGameEndingEvent",539051258,{},!0)}),define("events/PlayerDoneExplodingEvent",["require","exports","module","thor/core/Class","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));i.exports=n.generateEventClass("PlayerDoneExplodingEvent",321779196,{})}),define("gameplay/WeightedSelector",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/math/MersenneTwister"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation");e("thor/math/MersenneTwister");i.exports=n.create({initialize:function(e,t,i){t||(t=i),s.ifDefined.assertIsObject(t),s.ifDefined.assertIsObject(i),this.__mersenneTwister=e,this.__choicesObject=i,t?this.setWeights(t):(this.__weights=null,this.__totalWeight=0)},setWeights:function(e){var t=0;for(var i in e){if(this.__choicesObject&&!this.__choicesObject[i])throw new Error("Invalid choice type: `"+i+"`");t+=e[i]}t<=0&&r.warn("Invalid total weight, total weight was 0. This selector will failed when used."),this.__totalWeight=t,this.__weights=e},getNext:function(){if(!this.__weights)throw new Error("No weights set on WeightedSelector");var e=this.__mersenneTwister.rnd()*this.__totalWeight,t=0;for(var i in this.__weights){var n=this.__weights[i];if(0!==n){if(t+n>=e)return i;t+=n}}throw new Error("Weighted selector failed, were there any weights set?")}})}),define("events/SpawnPopupDialogEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation","gameplay/GamePopupTypeEnum"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));e("thor/core/Validation"),e("gameplay/GamePopupTypeEnum");i.exports=n.generateEventClass("SpawnPopupDialog",1529941742,{popupType:function(e){}},!0)}),define("gameplay/LevelSequencer",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger","events/WaveSpawnedEvent","Constants","bulletml/BulletMLResource","gameplay/WaveInfo","gameplay/WeightedSelector","gameplay/Level","gameplay/GamePopupTypeEnum","gameplay/LevelGroupTypeEnum","gameplay/LevelSectionTypeEnum","events/SpawnEntityEvent","events/SpawnPopupDialogEvent","events/LevelSectionChangedEvent","UpgradeTypeEnum"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/core/Logger").getLogger(i),o=e("events/WaveSpawnedEvent"),a=(e("Constants"),e("bulletml/BulletMLResource")),_=e("gameplay/WaveInfo"),l=e("gameplay/WeightedSelector"),h=(e("gameplay/Level"),e("gameplay/GamePopupTypeEnum")),u=e("gameplay/LevelGroupTypeEnum"),c=e("gameplay/LevelSectionTypeEnum"),d=(e("events/SpawnEntityEvent"),e("events/SpawnPopupDialogEvent")),g=e("events/LevelSectionChangedEvent"),p=e("UpgradeTypeEnum");i.exports=n.create({initialize:function(e,t,i,n){this.__eventManager=e,this.__resourceManager=t,this.__running=!1,this.__level=null,this.__sectionIndex=0,this.__sectionDelayTimer=0,this.__sectionSpawnTimer=0,this.__spawnsRemaining=0,this.__sectionDropWaveIndex=0,this.__gameLogic=i,this.__mersenneTwister=n,this.__groupWeightedSelector=new l(n),this.__lastWaveInfo=null,this.__sectionTimer=0,this.__waveDelayTimer=0,this.__killDelayTimer=0,this.__spawnCount=0,this.__loopCount=0},reset:function(){this.__running=!1,this.__level=null,this.__sectionIndex=0,this.__sectionDelayTimer=0,this.__sectionSpawnTimer=0,this.__spawnsRemaining=0,this.__sectionDropWaveIndex=0,this.__lastWaveInfo=null,this.__sectionTimer=0,this.__waveDelayTimer=0,this.__killDelayTimer=0,this.__spawnCount=0,this.__loopCount=0},getLevel:function(){return this.__level},getLoopCount:function(){return this.__loopCount},timeToNextBoss:function(){if(!this.__level||!this.__running)return 0;var e=this.__level.sections[this.__sectionIndex],t=this.__sectionDelayTimer;e.type===c.TIMED_WAVE?t+=this.__sectionTimer:e.type===c.ENEMY_WAVE&&(t+=this.__sectionSpawnTimer+this.__spawnsRemaining*e.spawnInterval);for(var i=[],n=this.__sectionIndex+1;n<this.__level.sections.length;++n)switch(e=this.__level.sections[n],e.type){case c.TIMED_WAVE:var r=this.__level.groups[e.groupId];if(r.type===u.BOSS)return t;t+=e.sectionTime;break;case c.ENEMY_WAVE:var r=this.__level.groups[e.groupId];if(r.type===u.BOSS)return t;t+=e.initialDelay+e.numSpawns*e.spawnInterval;break;case c.LOOP:if(i.indexOf(n)!==-1)return 0;i.push(n),n=e.loopIndex;break;case c.POPUP_DIALOG:}return t},clearLevel:function(){this.__running=!1,this.__level=null},setLevel:function(e){var t=e.validate(this.__resourceManager);t?s.error("Level not valid: "+t.reduce(function(e,t){return e+", "+t})):this.__level=e},play:function(e){if(r.ifDefined.assertIsNumber(e),e=e||0,!this.__level)return void s.error("No level set, not playing");this.__goToSection(e),this.__running=!0},nextSection:function(){return!!this.__running&&(this.__sectionIndex++,this.__sectionIndex===this.__level.sections.length?(this.__running=!1,!1):(this.__goToSection(this.__sectionIndex),!0))},isLastSection:function(){return!!this.__level&&this.__sectionIndex>=this.__level.sections.length-1},__goToSection:function(e){if(!this.__level.sections[e])throw new Error("Invalid section index for current level: "+e);this.__sectionIndex=e;var t=this.__level.sections[this.__sectionIndex];switch(t.type){case c.TIMED_WAVE:case c.ENEMY_WAVE:var i=this.__level.groups[t.groupId];if(!i)throw new Error("Section "+e+" specified invalid group ID: "+t.groupId);var n={};for(var r in i.waves){var o=i.waves[r];o.enabled&&(n[r]=o.weight)}if(0===Object.keys(n).length)throw new Error("Section "+e+" has no waves in it's group: "+t.groupId);this.__groupWeightedSelector.setWeights(n),t.type===c.ENEMY_WAVE?(this.__sectionDelayTimer=t.initialDelay||0,this.__spawnsRemaining=t.numSpawns,this.__sectionDropWaveIndex=~~(this.__mersenneTwister.rnd()*t.numSpawns)):(this.__sectionDelayTimer=0,this.__spawnCount=0,this.__sectionTimer=t.sectionTime,this.__lastWaveInfo=null);break;case c.POPUP_DIALOG:case c.LOOP:this.__sectionDelayTimer=t.initialDelay||0}this.__sectionSpawnTimer=0;var a=this.__eventManager.getNewEvent(g);a.setLevel(this.__level),a.setIndex(e),this.__eventManager.queueEvent(a),s.debug("Moved to section "+e)},isRunning:function(){return this.__running},resume:function(){!this.__level||this.__sectionIndex>=this.__level.sections.length||(this.__running=!0)},stop:function(){this.__running=!1},__handleSpawn:function(e,t){var i=this.__groupWeightedSelector.getNext(),n=this.__resourceManager.get(a.RESOURCE_TYPE,i),l=+n.getMetadata().waveLength;if(!r.isNumber(l))return s.warn("Spawn pattern `"+i+"` had no waveLength metadata set, not spawning anything and skipping section"),void this.nextSection();var h=this.__level.groups[e.groupId],u=h.baseHealth,d=h.baseValue||u,g=[];e.drop&&t===this.__sectionDropWaveIndex&&(g[l-1]=p.SYSTEM_UPGRADE);var m=~~(this.__mersenneTwister.rnd()*l),f=new _(l,g,d,u,h.type,m,e.goldChance,e.goldDropped),v=this.__eventManager.getNewEvent(o);switch(v.setWaveInfo(f),v.setSpawnerResource(n),this.__eventManager.queueEvent(v),this.__lastWaveInfo=f,e.type){case c.TIMED_WAVE:this.__waveDelayTimer=e.waveDelay,this.__killDelayTimer=e.killDelay,this.__spawnCount++;break;case c.ENEMY_WAVE:this.__spawnsRemaining--}},__sendPopupDialogEvent:function(e){s.debug("Popup Dialog of type ",h.nameFromValue(e));var t=this.__eventManager.getNewEvent(d);t.setPopupType(e),this.__eventManager.queueEvent(t)},update:function(e){if(this.__running){if(this.__sectionDelayTimer>0){if(this.__sectionDelayTimer-=e,!(this.__sectionDelayTimer<=0))return;e=-this.__sectionDelayTimer}var t=this.__level.sections[this.__sectionIndex];switch(t.type){case c.TIMED_WAVE:if(this.__lastWaveInfo?this.__lastWaveInfo.isComplete()?(this.__waveDelayTimer-=e,this.__waveDelayTimer<=0&&this.__handleSpawn(t,this.__spawnCount)):(this.__killDelayTimer-=e,this.__killDelayTimer<=0&&this.__handleSpawn(t,this.__spawnCount)):this.__handleSpawn(t,this.__spawnCount),this.__sectionTimer-=e,this.__sectionTimer<=0){var i=Math.abs(this.__sectionTimer);return this.nextSection(),void(i>0&&this.update(i))}break;case c.ENEMY_WAVE:if(this.__sectionSpawnTimer>0){if(this.__sectionSpawnTimer-=e,!(this.__sectionSpawnTimer<=0))return;e=-this.__sectionSpawnTimer}if(0===this.__spawnsRemaining)return this.nextSection(),void(e>0&&this.update(e));this.__handleSpawn(t,t.numSpawns-this.__spawnsRemaining),this.__sectionSpawnTimer=t.spawnInterval;break;case c.LOOP:this.__loopCount++,this.__goToSection(t.loopIndex),this.update(e),s.debug("Looped to section "+t.loopIndex);break;case c.POPUP_DIALOG:this.__sendPopupDialogEvent(t.popupType),this.nextSection()}}}})}),define("GameStats",["require","exports","module","thor/core/Class","thor/core/Validation","SystemType"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("SystemType")),s={Bruiser:"bruiser",Frigate:"destroyer",Destroyer:"frigate",Gunship:"gunship",Telepopo:"telepopo",Sneakkun:"sneakkun"};i.exports=n.create({initialize:function(){this.lasersUsed=0,this.goldSpawned=0,this.goldDropsCollected=0,this.fuel=0,this.fuelSpawned=0,this.runTime=0,this.numContinues=0,this.maxKillStreak=0,this.totalKills=0,this.kills={},this.kills.boss=0,this.kills.miniboss=0;for(var e in s)this.kills[s[e]]=0;this.laser=0,this.upgradeCombos=0,this.upgrades=0,this.upgradesByType={};for(var t=r.getValues(),i=0,n=t.length;i<n;++i){var o=t[i];this.upgradesByType[o]=0}},trackContinue:function(){++this.numContinues},trackGoldSpawned:function(e){this.goldSpawned+=e},trackCollectGold:function(){++this.goldDropsCollected},trackKill:function(e){var t=s[e];++this.totalKills,t&&++this.kills[t]},trackBossKill:function(){++this.kills.boss},trackMinibossKill:function(){++this.kills.miniboss},trackUpgradeCombo:function(){++this.upgradeCombos},trackSystemUpgrade:function(e){++this.upgrades,++this.upgradesByType[e]},trackFuel:function(){++this.fuel},trackFuelSpawned:function(){++this.fuelSpawned},trackLaser:function(){++this.laser},trackKillStreak:function(e){this.maxKillStreak=Math.max(this.maxKillStreak,e)}})}),define("MapManager",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/entity/World","thor/util/JSONLoader","thor/graphics/Surface","thor/graphics/resources/TextureRegionResource","thor/math/MersenneTwister","Constants","components/TileMapComponent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/entity/World"),e("thor/util/JSONLoader")),s=e("thor/graphics/Surface"),o=e("thor/graphics/resources/TextureRegionResource"),a=(e("thor/math/MersenneTwister"),e("Constants")),_=e("components/TileMapComponent");i.exports=n.create({initialize:function(e,t){if(this.__mersenneTwister=e,this.__mapComponentsByName={},this.__mapSections={},this.__world=t,this.__lastStage=0,
t.getSurface().getMode()!==s.DrawingMode.WEBGL)throw new Error("WebGL is the only supported map mode");this.__getDistanceFunction=function(){return 0}},setDistanceFunction:function(e){this.__getDistanceFunction=e},init:function(e,t){for(var i=this.__world.getSurface().getRenderer(),n=0;n<e.mapSections.length;++n){var s=e.mapSections[n],a=t.get(r.RESOURCE_TYPE,"maps/"+s),l=a.tilesets.map(function(e){return t.get(o.RESOURCE_TYPE,"maps/"+e.image)}),h=new _;h.setTileMapData(s,a,l,i),h.register(this.__world),this.__mapComponentsByName[s]=h}this.__mapSections=e.layers},getMapLayer:function(e){return this.__mapComponentsByName[e]},getMapSection:function(e,t){return this.__mapSections[e][t]},getBlankMap:function(){return a.BLANK_MAP},getEndingMap:function(e){var t=this.__mapSections[e];return t[t.length-1]},getRandomMap:function(e){var t,i=this.__mapSections[e],n=i.length;return"Top"===e||"Bottom"===e?(t=~~(this.__mersenneTwister.random()*(n-2)+2),"Top"===e&&(this.__lastStage=t)):t="Mid"==e?this.__lastStage:~~(this.__mersenneTwister.random()*n),i[t]}})}),define("EntityFactory",["require","exports","module","thor/core/Base","thor/core/Class","thor/config/Config","thor/core/Logger","thor/core/Validation","thor/resources/ResourceManager","thor/util/JSONLoader","thor/util/RingBuffer","thor/math/MatrixOrderings","thor/entity/World","thor/entity/Entity","thor/event/EventManager","thor/entity/EntityManager","thor/entity/EntityDestroyedEvent","thor/audio/SoundSprite","Constants","ResourceTypes","UpgradeTypeEnum"],function(e,t,i){var n=e("thor/core/Base"),r=e("thor/core/Class"),s=e("thor/config/Config"),o=e("thor/core/Logger").getLogger(i),a=e("thor/core/Validation"),_=(e("thor/resources/ResourceManager"),e("thor/util/JSONLoader")),l=(e("thor/util/RingBuffer"),e("thor/math/MatrixOrderings")),h=(e("thor/entity/World"),e("thor/entity/Entity"),e("thor/event/EventManager"),e("thor/entity/EntityManager"),e("thor/entity/EntityDestroyedEvent")),u=(e("thor/audio/SoundSprite"),e("Constants")),c=e("ResourceTypes"),d=e("UpgradeTypeEnum"),g=/\$\{(.+)\}$/,p=(s.RESOURCE_DATA_PREFIX,[]);i.exports=r.create(n,{initialize:function(e,t){this.__entityManager=t,this.__eventManager=e,this.__entityTemplatesByType={},this.__createdEntityIds={},e.registerEventHandler(h.EVENT_TYPE,this.__entityDestroyedEventHandler.bind(this))},getEntityTemplates:function(){return this.__entityTemplatesByType},getEntityTemplate:function(e){return this.__entityTemplatesByType[e]},__entityDestroyedEventHandler:function(e){this.__createdEntityIds[e.getEntityId()]&&delete this.__createdEntityIds[e.getEntityId()]},clearEntities:function(){for(var e in this.__createdEntityIds){var t=this.__eventManager.getNewEvent(h);t.setEntityId(+e),this.__eventManager.queueEvent(t)}},clearEntitiesWithType:function(e){for(var t in this.__createdEntityIds){if(this.__createdEntityIds[t]===e){var i=this.__eventManager.getNewEvent(h);i.setEntityId(+t),this.__eventManager.queueEvent(i)}}},getCreatedEntityIds:function(){return this.__createdEntityIds},init:function(e,t){for(var i=e.entities,n=[],r=0;r<i.length;++r)i[r].active&&n.push(i[r]);this._getResource=t.get.bind(t),n.map(this.__createEntityTemplate,this).filter(a.isObject).forEach(function(e){this.__entityTemplatesByType[e.type]=e.templateEntity},this),o.debug("Loaded entities"),o.debug(this.__entityTemplatesByType)},__createEntityTemplate:function(e){var t=e.name,i={},n=this.__entityManager.createEntity(),r=this._getResource(_.RESOURCE_TYPE,"entities/"+t);this.__populateEntity(t,n,r,i);var s=n.getComponent("SceneComponent");return s?(s.setMatrixMode(l.TRS),n.setRootComponent(s),{type:t,templateEntity:n}):(o.warn("Entity definition for "+t+" had no root component"),null)},__populateEntity:function(e,t,i,n){for(var r=i.imports||p,s=i.mixins||p,a=0;a<r.length;++a){var l=r[a],h=this._getResource(_.RESOURCE_TYPE,"entities/"+l);this.__populateEntity(l,t,h,n)}for(var m=0;m<i.components.length;++m){var f=i.components[m],v=this.__entityManager.addComponent(t,f.type,!0);if(!v)return void o.warn("Couldn't create component of type "+f.type+" in "+e);if(f.name&&(n[f.name]&&o.warn("Duplicate name `"+f.name+"` in definition for "+e),v.setName(f.name),n[f.name]=v),f.attachTo){if(!v.attachTo)return void o.warn("Component "+f.type+" has no attachTo method");var y=n[f.attachTo];if(!y)return void o.warn("attachTo target `"+f.attachTo+"` was not found on this entity");v.attachTo(y)}for(var E=0;E<f.properties.length;++E){var S=f.properties[E],T="set"+S.name;if(!v[T])return void o.warn(e+" is missing property "+S.name);var C=S.arguments.map(function(e){return g.test(e)?new Function("Constants","ResourceTypes","UpgradeTypeEnum","getResource","me","return "+g.exec(e)[1]+";")(u,c,d,this._getResource,this):e},this);v[T].apply(v,C)}}for(var I=0;I<s.length;++I){var w=s[I],b=this._getResource(_.RESOURCE_TYPE,"entities/"+w);this.__populateEntity(w,t,b,n)}},createEntity:function(e,t,i){var n=this.__entityTemplatesByType[e];if(!n)return o.error("No template for enemy of type "+e),null;var r=t.spawnEntity(n,i),s=r.getComponent("SoundOnEventComponent");return s&&s.playSound("enter_screen"),this.__createdEntityIds[r.getId()]=e,r},getEntityManager:function(){return this.__entityManager}})}),define("events/NewSectionEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("NewSectionEvent",800835216,{backgroundId:n.assertIsNonEmptyString})}),define("events/DifficultyOverrideEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("DifficultyOverrideEvent",2200514478,{difficulty:n.assertIsNumber})}),define("TiledBackground",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/event/EventManager","thor/entity/World","thor/entity/Entity","thor/entity/EntityManager","thor/entity/EntityDestroyedEvent","thor/math/MersenneTwister","events/NewSectionEvent","events/GameBoundsEvent","events/DifficultyOverrideEvent","events/BackgroundScrollTopEvent","events/BackgroundScrollBottomEvent","Constants","GameLogic","MapManager","EntityFactory","ResourceTypes"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation")),s=(e("thor/event/EventManager"),e("thor/entity/World"),e("thor/entity/Entity"),e("thor/entity/EntityManager"),e("thor/entity/EntityDestroyedEvent")),o=(e("thor/math/MersenneTwister"),e("events/NewSectionEvent")),a=e("events/GameBoundsEvent"),_=e("events/DifficultyOverrideEvent"),l=e("events/BackgroundScrollTopEvent"),h=e("events/BackgroundScrollBottomEvent");e("Constants"),e("GameLogic"),e("MapManager"),e("EntityFactory"),e("ResourceTypes");i.exports=n.create({__activeMapEntityIds:null,initialize:function(e,t,i,n,r,s,o,u,c,d){this.__id=e,this.__mapManager=t,this.__eventManager=i,this.__entityManager=n,this.__entityFactory=r,this.__world=s,this.__scene=o,this.__entitySpawnOptions={attachParent:this.__scene.getRootComponent()},this.__gameBounds={width:d.width,height:d.height},this.__sdpScrollVelocity=500,this.__activeMapEntityIds=[],this.__isPlatform="Top"===this.__id||"Mid"===this.__id||"Bottom"==this.__id,this.__eventManager.registerEventHandler(l.EVENT_TYPE,this.__scrollTopEventHandler.bind(this)),this.__eventManager.registerEventHandler(h.EVENT_TYPE,this.__scrollBottomEventHandler.bind(this)),i.registerEventHandler(_.EVENT_TYPE,this.__difficultyOverrideEventHandler.bind(this)),i.registerEventHandler(a.EVENT_TYPE,this.__gameBoundsEventHandler.bind(this)),this.__mapTemplatesByName={};for(var g=0;g<u.length;++g){var p=u[g],m=this.__entityManager.createEntity();this.__entityManager.addComponent(m,"BackgroundMovementComponent",!0);var f=this.__mapManager.getMapLayer(p),v=this.__entityManager.clone(f);v.setSortOrder(c),v.setScale(2,2),m.setRootComponent(v),this.__mapTemplatesByName[p]=m}this.__nextSections=[],this.__lastSection=this.__mapManager.getBlankMap()},clearMaps:function(){for(;this.__activeMapEntityIds.length>0;){var e=this.__activeMapEntityIds[0];this.__removeMap(e)}this.__nextSections=[],this.__lastSection=this.__mapManager.getBlankMap()},queueNewMap:function(e,t){r.ifDefined.assertIsBoolean(t);var i;i=0===this.__nextSections.length?this.__getConnectingSection():this.__nextSections.shift(),this.__lastSection=i;var n;n=this.__mapTemplatesByName[i];var s=this.__world.spawnEntity(n,this.__entitySpawnOptions),a=s.getRootComponent(),_=a.getHeight(),l=s.getComponent("BackgroundMovementComponent");l.setVelocity(this.__sdpScrollVelocity);var h=-_+e;l.setStartHeight(h),l.setTopEventHeight(0),l.setBottomEventHeight(this.__gameBounds.height),t&&l.setFireTopEvent(!1),l.resetToStart(),this.__activeMapEntityIds.push(s.getId());var u=this.__eventManager.getNewEvent(o,1);return u.setBackgroundId(this.__id),this.__eventManager.triggerEvent(u),_},__getConnectingSection:function(){var e=this.__mapManager.getBlankMap();return this.__isPlatform&&this.__lastSection===this.__mapManager.getEndingMap(this.__id)||"Planet"===this.__id&&this.__lastSection!==e?e:this.__isPlatform&&this.__lastSection===e?this.__mapManager.getMapSection(this.__id,0):this.__mapManager.getRandomMap(this.__id)},setNextSection:function(e){var t=this.__mapManager.getMapSection(this.__id,e);this.__nextSections.push(t)},__removeMap:function(e){var t=this.__entityManager.getEntity(e);if(!t)throw new Error("Could not find map entity "+e+" to remove.");this.__activeMapEntityIds.splice(this.__activeMapEntityIds.indexOf(t.getId()),1);var i=this.__eventManager.getNewEvent(s);i.setEntityId(e),this.__eventManager.triggerEvent(i)},__scrollBottomEventHandler:function(e){if(this.__activeMapEntityIds.indexOf(e.getEntityId())!==-1){var t=e.getEntityId();this.__removeMap(t)}},__scrollTopEventHandler:function(e){if(this.__activeMapEntityIds.indexOf(e.getEntityId())!==-1){e.getEntityId();this.queueNewMap(e.getStartOffset())}},__gameBoundsEventHandler:function(e){this.__gameBounds.width=e.getWidth(),this.__gameBounds.height=e.getHeight();var t=this.__gameBounds.height;this.__activeMapEntityIds.forEach(function(e){this.__entityManager.getEntity(e).getComponent("BackgroundMovementComponent").setBottomEventHeight(t)},this)},setScrollVelocity:function(e){this.__sdpScrollVelocity=e,this.__activeMapEntityIds.forEach(function(t){var i=this.__entityManager.getEntity(t);if(i){var n=i.getComponent("BackgroundMovementComponent");n&&n.setVelocity(e)}},this)},__difficultyOverrideEventHandler:function(e){var t=e.getDifficulty();this.__difficultyOverride=t}})}),define("ManagerRepository",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=n.create({initialize:function(){},addType:function(e,t,i){function n(e){o.call(this,e)}function o(e){if(this[a])return void r.warn("Attempted to overwrite manager "+a);this[a]=e}var a="__"+t[0].toLocaleString()+t.slice(1);this["get"+t]=function(){return this[a]},window.ASSERTIONS?this["set"+t]=n:this["set"+t]=o,s.isInstanceOf(i,e)&&this["set"+t].call(this,i)}});i.exports=new o}),define("cards/CardEffectEnum",["require","exports","module","thor/core/Enum","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Enum"),r=(e("thor/core/Validation"),n.create("CardEffectEnum",{DAMAGE_REDUCTION_PERCENT:1,FUEL_CAPSULE_INCREASE_PERCENT:2,FUEL_CAPACITY_INCREASE_PERCENT:3,FUEL_CONSUMPTION_DECREASE_PERCENT:4,ALL_DAMAGE_INCREASE_PERCENT:5,BULLET_DAMAGE_INCREASE_PERCENT:6,MISSILE_DAMAGE_INCREASE_PERCENT:7,COMPANION_DAMAGE_INCREASE_PERCENT:8,STATIC_SHOCK:9,ACTIVE_ABILITY_INCREASE_SECONDS:10,COLLECTION_RADIUS_INCREASE_PERCENT:11,DEATH_EXPLOSION_DAMAGE:12,RETURN_TO_LIFE_SECONDS:13,ENERGY_COST_REDUCTION_PERCENT:14})),s={};return s[r.DAMAGE_REDUCTION_PERCENT]="X% Damage Reduction",s[r.FUEL_CAPSULE_INCREASE_PERCENT]="Fuel in Capsules Increased by X%",s[r.FUEL_CAPACITY_INCREASE_PERCENT]="Increase Fuel Capacity by X%",s[r.FUEL_CONSUMPTION_DECREASE_PERCENT]="Fuel is Consumed X% Slower",s[r.ALL_DAMAGE_INCREASE_PERCENT]="All Damage Increased by X%",s[r.BULLET_DAMAGE_INCREASE_PERCENT]="Increases Bullet Damage by X%",s[r.MISSILE_DAMAGE_INCREASE_PERCENT]="Increases Missile Damage by X%",s[r.COMPANION_DAMAGE_INCREASE_PERCENT]="Increases Companion Damage by X%",s[r.STATIC_SHOCK]="Hurls a lightning bolt at the nearest enemy dealing X damage",s[r.ACTIVE_ABILITY_INCREASE_SECONDS]="Increase Active Ability Duration by X Seconds",s[r.COLLECTION_RADIUS_INCREASE_PERCENT]="Increase Coin Collection Radius by X%",s[r.DEATH_EXPLOSION_DAMAGE]="Player gains immunity and continues to glide for X second after running out of fuel",s[r.RETURN_TO_LIFE_SECONDS]="Return to life for X seconds after death",s[r.ENERGY_COST_REDUCTION_PERCENT]="Energy Costs Reduced by X%",r.getName=function(e){return s[e]},r}),define("mission/DifficultyType",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum");i.exports=n.create("DifficultyType",{NORMAL:0,CHALLENGE:1})}),define("mission/MissionCategory",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum"),r=n.create("MissionCategory",{KILL:0,COLLECT:1,SKILL:2});i.exports=r}),define("mission/MissionType",["require","exports","module","thor/core/Enum","thor/core/Validation","mission/MissionCategory","SystemType"],function(e,t,i){var n=e("thor/core/Enum"),r=(e("thor/core/Validation"),e("mission/MissionCategory")),s=e("SystemType"),o=n.create("MissionType",{KILL_BRUISER:0,KILL_DESTROYER:1,KILL_FRIGATE:2,KILL_BOSS:3,KILL_ENEMY:4,COLLECT_GOLD:5,COLLECT_FUEL:6,MISSILE_UPGRADES:7,GUN_UPGRADES:8,COMPANION_UPGRADES:9,KILL_MINIBOSS:10});i.exports=o;var a={};a[o.KILL_BRUISER]={singular:"Destroy {requirement} Bruiser",plural:"Destroy {requirement} Bruisers"},a[o.KILL_DESTROYER]={singular:"Destroy {requirement} Destroyer",plural:"Destroy {requirement} Destroyers"},a[o.KILL_FRIGATE]={singular:"Destroy {requirement} Frigate",plural:"Destroy {requirement} Frigates"},a[o.KILL_BOSS]={singular:"Destroy {requirement} Boss",plural:"Destroy {requirement} Bosses"},a[o.KILL_ENEMY]={singular:"Destroy {requirement} of any enemy type",plural:"Destroy {requirement} of any enemy type"},a[o.COLLECT_GOLD]={singular:"Collect {requirement} Coin",plural:"Collect {requirement} Coins"},a[o.COLLECT_FUEL]={singular:"Collect {requirement} Fuel Cell",plural:"Collect {requirement} Fuel Cells"},a[o.MISSILE_UPGRADES]={singular:"Collect {requirement} Missile Power Up",plural:"Collect {requirement} Missile Power Ups"},a[o.GUN_UPGRADES]={singular:"Collect {requirement} Gun Power Up",plural:"Collect {requirement} Gun Power Ups"},a[o.COMPANION_UPGRADES]={singular:"Collect {requirement} Companion Power Up",plural:"Collect {requirement} Companion Power Ups"},a[o.KILL_MINIBOSS]={singular:"Destroy {requirement} Miniboss",plural:"Destroy {requirement} Minibosses"},i.exports.DESCRIPTION_TEXT=a;var _={};_[o.KILL_BRUISER]=r.KILL,_[o.KILL_DESTROYER]=r.KILL,_[o.KILL_FRIGATE]=r.KILL,_[o.KILL_BOSS]=r.KILL,_[o.KILL_ENEMY]=r.KILL,_[o.COLLECT_GOLD]=r.COLLECT,_[o.COLLECT_FUEL]=r.COLLECT,_[o.MISSILE_UPGRADES]=r.COLLECT,_[o.GUN_UPGRADES]=r.COLLECT,_[o.COMPANION_UPGRADES]=r.COLLECT,_[o.KILL_MINIBOSS]=r.KILL,i.exports.CATEGORY=_;var l={};l[s.GUN]=o.GUN_UPGRADES,l[s.MISSILE]=o.MISSILE_UPGRADES,l[s.COMPANION]=o.COMPANION_UPGRADES,i.exports.getBySystemUpgrade=function(e){return l[e]};var h={};h[o.KILL_BRUISER]="icon_destroy_x_bruisers",h[o.KILL_DESTROYER]="icon_destroy_x_destroyers",h[o.KILL_FRIGATE]="icon_destroy_x_frigates",h[o.KILL_BOSS]="icon_destroy_x_boss",h[o.KILL_ENEMY]="icon_destroy_x_enemies",h[o.COLLECT_GOLD]="icon_collect_x_coins",h[o.COLLECT_POINTS]="icon_collect_x_stars",h[o.COLLECT_FUEL]="icon_collect_x_fuel",h[o.MISSILE_UPGRADES]="icon_collect_x_missiles",h[o.GUN_UPGRADES]="icon_collect_x_bullets",h[o.COMPANION_UPGRADES]="icon_collect_x_companions",i.exports.getIcon=function(e){return h[e]}}),define("mission/TrackingType",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum"),r=n.create("TrackingType",{WITHOUT_GETTING_HIT:0,IN_A_RUN:1,TOTAL:2});i.exports=r;var s={};s[r.WITHOUT_GETTING_HIT]=" without getting hit",s[r.IN_A_RUN]=" in a single run",s[r.TOTAL]="",i.exports.DESCRIPTION_POSTFIX=s}),define("mission/Mission",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","Constants","./DifficultyType","./MissionType","./TrackingType"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("Constants"),e("./DifficultyType"),e("./MissionType"),e("./TrackingType");i.exports=n.create({initialize:function(e,t,i,n,r){this.level=e,this.difficulty=t,this.type=i,this.tracking=n,this.requirement=r}})}),define("mission/MissionInstance",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/util/StringUtil","Constants","mission/Mission","mission/MissionType","mission/TrackingType","mission/DifficultyType"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=e("thor/util/StringUtil"),a=(e("Constants"),e("mission/Mission"),e("mission/MissionType")),_=e("mission/TrackingType"),l=e("mission/DifficultyType"),h=n.create({initialize:function(e,t,i,n){s.ifDefined.assertIsNumber(t),s.ifDefined.assertIsBoolean(i),s.ifDefined.assertIsNumber(n),t=t||0,i=i||!1,this.level=e.level,this.difficulty=e.difficulty,this.type=e.type,this.tracking=e.tracking,this.requirement=e.requirement,this.progress=Math.min(t||0,this.requirement),this.remaining=Math.max(0,this.requirement-this.progress),this.completed=i||this.progress>=this.requirement,this.redeemed=i,this.recentlyCompleted=!1,this.__oldProgress=null,this.__oldCompleted=null,this.previousProgress=n||0},reset:function(){this.completed||(this.previousProgress=this.progress,this.progress=0,this.remaining=this.requirement)},increment:function(){return this.completed||(++this.progress,this.remaining=Math.max(0,this.requirement-this.progress),this.completed=this.progress>=this.requirement,r.trace("incremented progress for mission",this)),this.completed},toString:function(){return"{"+l.toString(this.difficulty)+", "+a.toString(this.type)+", "+_.toString(this.tracking)+"} "+this.progress+"/"+this.requirement},isEphemeral:function(){return this.tracking===_.IN_A_RUN||this.tracking===_.WITHOUT_GETTING_HIT},getDescription:function(){var e,t=a.DESCRIPTION_TEXT[this.type];e=1===this.requirement?t.singular:t.plural;var i=e+_.DESCRIPTION_POSTFIX[this.tracking]+".";return o.interpolate(i,this)},getRemaining:function(){return o.interpolate(" {remaining} left to go.",this)},getBestProgress:function(){return o.interpolate(" Best run {progress}.",this)},getProgress:function(){return o.interpolate(" This run {progress}.",this)},storePreRunProgress:function(){this.__oldProgress=this.progress,this.__oldCompleted=this.completed},revertPreRunProgress:function(){this.progress=this.__oldProgress,this.completed=this.__oldCompleted,this.remaining=Math.max(0,this.requirement-this.progress)}});i.exports=h,i.exports.toWire=function(e){return{key:[e.level,e.difficulty,e.type,e.tracking],progress:e.progress,completed:e.completed,redeemed:e.redeemed,previousProgress:e.previousProgress}},i.exports.fromWire=function(e,t){s.assertIsObject(e);var n=t.key,r=t.progress||0,o=t.redeemed||!1,a=t.previousProgress||0,_=e.getMission.apply(e,n);return _?new i.exports(_,r,o,a):null}}),define("events/MissionCompleteEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("MissionCompleteEvent",1575148069,{missionInstance:n.assertIsObject})}),define("mission/MissionSet",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/util/Alert","thor/platforms/Google","thor/analytics/Seidr","ManagerRepository","./Mission","./MissionInstance","./DifficultyType","./MissionType","./TrackingType","SystemType","events/MissionCompleteEvent"],function(e,t,i){function n(e){for(var t=e.length-1;t>=0;--t){var i=~~(Math.random()*(t+1)),n=e[i];e[i]=e[t],e[t]=n}}var r=e("thor/core/Class"),s=e("thor/core/Logger").getLogger(i),o=e("thor/core/Validation"),a=e("thor/util/Alert"),_=e("thor/platforms/Google"),l=e("thor/analytics/Seidr"),h=e("ManagerRepository"),u=(e("./Mission"),e("./MissionInstance")),c=e("./DifficultyType"),d=e("./MissionType"),g=e("./TrackingType"),p=(e("SystemType"),e("events/MissionCompleteEvent")),m={};m[c.CHALLENGE]=1,m[c.NORMAL]=2;var f=Object.keys(m).reduce(function(e,t){return m[t]+e},0),v={};v.Bruiser=d.KILL_BRUISER,v.Frigate=d.KILL_DESTROYER,v.Destroyer=d.KILL_FRIGATE,v.$Boss=d.KILL_BOSS,v.$Miniboss=d.KILL_MINIBOSS;var y=r.create({initialize:function(e,t,i,n,r,s,o){this.__storageManager=h.getStorageManager(),this.__playerManager=h.getPlayerManager(),this.__missionManager=h.getMissionManager(),this.__eventManager=h.getEventManager(),this.__completedEpochMS=i,this.__completedSets=n,this.__lifetimeCompletedMissions=r,this.__level=e,this.__pool=t,this.__current=s,this.__createdEpochMS=o,this.__missionsByTracking=null,this.__missionByType=null,this.__active=null,this.__completed=[],this.__verifyMissions()},__verifyMissions:function(){var e=this;this.__missionsByTracking={},this.__missionByType={},this.__active=[],this.__completed=[],this.__indexMissions();var t={};for(var i in m)t[i]=m[i];for(var n=0,r=this.__current.length;n<r;++n){t[this.__current[n].difficulty]--}var o=!1;c.getValues().forEach(function(i){for(var n=t[i],r=0;r<n;++r){o=!0,s.log("Drawing missing",c.nameFromValue(i));var a=e.__draw(i);if(!a)throw s.error("Unable to draw a mission"),"Unable to draw a mission";e.__missionByType[a.type]=a,e.__current.push(a)}}),o&&(this.__completedSets=this.__current.reduce(function(e,t){return e+(t.completed?1:0)},0),this.__completedEpochMS=0,this.__indexMissions()),this.__sortMissions()},__sortMissions:function(){this.__current&&this.__current.sort(function(e,t){var i=e.difficulty-t.difficulty;return 0!==i?i:e.type-t.type})},isComplete:function(){return 0===this.__active.length},getCompletedSets:function(){return this.__completedSets},getCompleted:function(){return this.__completed},getCompletedEpochMS:function(){return this.__completedEpochMS},setCompletedEpochMS:function(e){this.__completedEpochMS=e},getMissions:function(){return this.__current},swap:function(e){var t=this;if(this.__playerManager.getPlayerGold()<100)return Promise.reject("Insufficient gold");var i=this.__current[e];if(i.completed)return Promise.reject("Trying to discard a completed mission");var n=this.__draw(i.difficulty);if(!n)return Promise.reject("No mission could be drawn");var r=this.__missionsByTracking[i.tracking],s=r.indexOf(i);r.splice(s,1);var o=this.__active.indexOf(i);return this.__active.splice(o,1),delete this.__missionByType[i.type],this.__current[e]=n,this.__missionsByTracking[n.tracking].push(n),this.__missionByType[n.type]=n,this.__active.push(n),this.__sortMissions(),this.__playerManager.spendGold(100,"mission_swap").then(function(){_.trackEvent("gqs","Mission Stop",{playerLevel:t.__playerManager.getPlayerLevel(),playerXP:t.__playerManager.getPlayerXP(),gold:t.__playerManager.getPlayerGold(),missionType:i.type}),l.event("Mission Stop",{contextId:t.__playerManager.getContextId(),playerLevel:t.__playerManager.getPlayerLevel(),playerXP:t.__playerManager.getPlayerXP(),gold:t.__playerManager.getPlayerGold(),missionType:i.type});var e=t.toWire(),r={};return r.mission_set=e,t.__storageManager.setDataAsync(r).then(function(){return n})})},redeem:function(){for(var e=0,t=0,i=[],n=0,r=this.__completed.length;n<r;++n){var s=this.__completed[n];if(!s.redeemed){s.redeemed=!0;var o=this.__missionManager.getReward(s.level);i.push(s),e+=o.gold,t+=o.xp}}return i.length>0&&this.__completed.length>=f&&(this.__completedEpochMS=Date.now(),++this.__completedSets),i},trackKill:function(e){s.trace("trackKill",e);var t=!1,i=v[e];o.isInEnum(i,d)&&(t=this.__increment(i)||t),(t=this.__increment(d.KILL_ENEMY)||t)&&this.__pruneCompleted()},trackBossKill:function(){this.trackKill("$Boss")},trackMinibossKill:function(){this.trackKill("$Miniboss")},trackCollectPoints:function(){this.__track(d.COLLECT_POINTS)},trackCollectGold:function(){this.__track(d.COLLECT_GOLD)},trackCollectFuel:function(){this.__track(d.COLLECT_FUEL)},trackSystemUpgrade:function(e){var t=d.getBySystemUpgrade(e);if(!o.isInEnum(t,d))return void s.warn("No achievement associated with system type: "+e);this.__track(t)},handlePlayerDamaged:function(){for(var e=this.__missionsByTracking[g.WITHOUT_GETTING_HIT],t=0,i=e.length;t<i;++t){e[t].reset()}},resetEphemeralMissions:function(){for(var e=0,t=this.__active.length;e<t;++e){var i=this.__active[e];i.isEphemeral()&&i.reset()}},__track:function(e){this.__increment(e)&&(h.getFUEManager().completedMission(),this.__pruneCompleted())},__increment:function(e){var t=this.__missionByType[e];if(!t)return!1;var i=t.increment();if(i){this.__lifetimeCompletedMissions++,this.__missionByType[t.type]=null;var n=this.__missionsByTracking[t.tracking],r=n.indexOf(t);r>=0&&n.splice(r,1)}return i},setStartingRunProperties:function(){for(var e=0;e<this.__current.length;e++)this.__current[e].storePreRunProgress()},revertMissionProgress:function(){for(var e=0;e<this.__current.length;e++)this.__current[e].revertPreRunProgress(),this.__current[e].recentlyCompleted=!1;this.__verifyMissions()},__pruneCompleted:function(){for(var e=this.__active.length-1;e>=0;--e){var t=this.__active[e];if(t.completed){t.recentlyCompleted=!0,this.__completed.push(this.__active.splice(e,1)[0]);var i=this.__eventManager.getNewEvent(p);i.setMissionInstance(t),this.__eventManager.queueEvent(i)}}},advance:function(e,t,i){o.ifDefined.assertIsBoolean(i),i=i||!1;var r=this;this.__current.length=0,this.__missionByType={};for(var a in m)for(var _=+a,l=this.__pool[_],h=0;h<m[_];++h){0===l.length&&(l=this.__missionManager.getPool(e,_),n(l),this.__pool[_]=l);var u=this.__draw(_);u&&(this.__missionByType[u.type]=u,this.__current.push(u))}if(this.__current.length!==f&&s.error("Do not have "+f+" missions in current after advance, only have "+this.__current.length),this.__createdEpochMS=Date.now(),this.__indexMissions(!0),t&&(this.__completedSets=0),i)return Promise.resolve(this);var c=this.toWire(),d={};return d.mission_set=c,this.__storageManager.setDataAsync(d).then(function(){return r})},__draw:function(e){var t=this.__drawFromPool(e);return t&&(_.trackEvent("gqs","Mission Start",{playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),missionType:t.type}),l.event("Mission Start",{contextId:this.__playerManager.getContextId(),playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),missionType:t.type})),t},__drawFromPool:function(e){var t=this,i=this.__pool[e];Array.isArray(i)||a.showMessageModal("CAUGHT Mission Set Error","Mission Set __pool is missing key "+e+": "+JSON.stringify(this.__pool));for(var n=0,r=i.length;n<r;++n){var o=i[n],_=o[2];if(!this.__missionByType[_]){var l=this.__getMissionByKey(o);if(!l)continue;var h=new u(l);return i.splice(n,1),h}}if(i=this.__missionManager.getPool(this.__level,e).filter(function(e){var i=e[2];return!t.__missionByType[i]}),0===i.length)return s.error("Not enough unique mission types"),null;var c=~~(Math.random()*i.length),o=i[c],l=this.__getMissionByKey(o);return i.splice(c,1),this.__pool[e]=i,new u(l)},__getMissionByKey:function(e){return this.__missionManager.getMission.apply(this.__missionManager,e)},__indexMissions:function(e){if(o.ifDefined.assertIsBoolean(e),this.__active.length=0,this.__completed.length=0,!e)for(var t=d.getValues(),i=0,n=t.length;i<n;++i){var r=t[i];this.__missionByType[r]=null}for(var s=g.getValues(),i=0,n=s.length;i<n;++i){var a=s[i];this.__missionsByTracking[a]=[]}for(var i=0,n=this.__current.length;i<n;++i){var _=this.__current[i];e||(this.__missionByType[_.type]=_),this.__missionsByTracking[_.tracking].push(_),_.completed?this.__completed.push(_):this.__active.push(_)}},prettyPrint:function(){for(var e=0,t=this.__current.length;e<t;++e){var i=this.__current[e],n=i.level,r=c.nameFromValue(i.difficulty),o=d.nameFromValue(i.type),a=g.nameFromValue(i.tracking),_=i.progress,l=i.requirement;s.log(n,r,o,a,_+"/"+l,i.completed,i.redeemed)}},toWire:function(){var e=this.__current.map(u.toWire);return{level:this.__level,pool:this.__pool,current:e,completedEpochMS:this.__completedEpochMS,completedSets:this.__completedSets,createdEpochMS:this.__createdEpochMS,lifetimeCompletedMissions:this.__lifetimeCompletedMissions}},appendToWire:function(e){e.mission_set=this.toWire()},getLifetimeCompletedMissions:function(){return this.__lifetimeCompletedMissions},computeResetEpochMS:function(){if(!h.getFUEManager().isMissionResetEnabled(this))return Date.now()+31536e6;var e=new Date,t=new Date;return t.setHours(4),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),e.getHours()>=4&&t.setDate(t.getDate()+1),+t},computeMissionStartEpochMS:function(){if(!h.getFUEManager().isMissionResetEnabled(this))return Date.now()+31536e6;var e=this.computeResetEpochMS();if(this.__completedSets>=3)return e;var t=this.__completedEpochMS+144e5;return Math.min(e,t)},shouldDailyReset:function(){if(!h.getFUEManager().isMissionResetEnabled(this))return!1;var e=this.computeResetEpochMS(),t=new Date(e);t.setDate(t.getDate()-1);var i=+t;return this.__createdEpochMS<i}});return y.STORAGE_KEY="mission_set",y.fromWire=function(e){o.ifDefined.assertIsObject(e);var t=h.getMissionManager(),i=h.getStorageManager(),r=h.getPlayerManager();if(o.isNonEmptyObject(e)&&o.isObject(e.pool)&&o.isNumber(e.createdEpochMS)){for(var a=!1,_=c.getValues(),l=0,d=_.length;l<d;++l){var g=_[l],p=e.pool[g]||[];e.pool[g]=p;for(var m=0,v=p.length;m<v;++m){var E=p[m];if(!t.getMission.apply(t,E)){s.warn("Serialized mission pool has unknown mission {"+E.join(", ")+"}, resetting mission pool"),p=t.getPool(E[0],g),n(p),e.pool[g]=p,a=!0;break}}}var S=e.current.map(u.fromWire.bind(void 0,t));S=S.filter(function(e){return null!==e}),a=a||S.length<f;try{var T=new y(e.level,e.pool,e.completedEpochMS,e.completedSets,e.lifetimeCompletedMissions||0,S,e.createdEpochMS);if(T.shouldDailyReset()&&(T.advance(r.getPlayer().level,!0,!0),a=!0),a){var C={};return C.mission_set=T.toWire(),i.setDataAsync(C).then(function(){return T})}return Promise.resolve(T)}catch(e){if("Unable to draw a mission"!==e)throw e;s.warn("Resetting missions due to draw failure")}}var p={},I=r.getPlayer().level;p[c.CHALLENGE]=t.getPool(I,c.CHALLENGE),n(p[c.CHALLENGE]),p[c.NORMAL]=t.getPool(I,c.NORMAL),n(p[c.NORMAL]);var S=[],T=new y(I,p,0,0,0,[],Date.now()),C={};return T.appendToWire(C),i.setDataAsync(C).then(function(){return T})},y.MISSION_DELAY_SECONDS=14400,y.MISSIONS_PER_SET=f,y.MAX_COMPLETED_SETS=3,y.MISSION_RESTART_HOUR=4,y.SWAP_COST=100,y}),define("thor/util/ModelUtils",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/core/Logger").getLogger(i);return{sortedNumericalKeys:function(e){return Object.keys(e).map(function(e){return+e}).sort(function(e,t){return e-t})},fromExistingWithDefaults:function e(t,i,s,o,a){for(var _ in s)s.hasOwnProperty(_)&&(n.isDefined(i[_])&&typeof i[_]==typeof s[_]?(t[_]=i[_],(n.isObject(s[_])||n.isArray(s[_]))&&o<a&&e(t[_],i[_],s[_],o+1,a)):(n.isUndefined(i[_])||typeof i[_]==typeof s[_]||r.warn("Existing field `"+_+"` had wrong type, replacing with default"),t[_]=s[_]))}}}),
define("StorageManager",["require","exports","module","thor/core/Class","thor/core/Logger","thor/config/Config","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Logger").getLogger(i),e("thor/config/Config"),e("thor/core/Validation");i.exports=n.create({initialize:function(){window.isFacebook()?(this.setDataAsync=this.__setDataAsyncFB,this.getDataAsync=this.__getDataAsyncFB):(this.setDataAsync=this.__setDataAsyncWeb,this.getDataAsync=this.__getDataAsyncWeb)},__setDataAsyncWeb:function(e){return new Promise(function(t,i){setTimeout(function(){var n;try{n=JSON.parse(localStorage.getItem("FB_LS_DATA_OBJ"))||{};for(var r in e)n[r]=e[r];localStorage.setItem("FB_LS_DATA_OBJ",JSON.stringify(n)),t(!0)}catch(e){i(e)}},200*Math.random())})},__setDataAsyncFB:function(e){return FBInstant.player.setDataAsync(e)},__getDataAsyncWeb:function(e){return new Promise(function(t,i){setTimeout(function(){var n;try{n=JSON.parse(localStorage.getItem("FB_LS_DATA_OBJ"))||{};for(var r={},s=0,o=e.length;s<o;s++){var a=e[s];n.hasOwnProperty(a)&&(r[a]=n[a])}t(n)}catch(e){i(e)}},200*Math.random())})},__getDataAsyncFB:function(e){return FBInstant.player.getDataAsync(e)}})}),define("player/CurrencyTypeEnum",["require","exports","module","thor/core/Enum","thor/core/Validation","Constants"],function(e,t,i){var n=e("thor/core/Enum"),r=(e("thor/core/Validation"),e("Constants")),s=n.create("CurrencyTypeEnum",{GOLD:0,PARTS:1,TOKENS:2});i.exports=s;var o={};o[s.GOLD]=25,o[s.PARTS]=0,o[s.TOKENS]=0,i.exports.DEFAULT_CURRENCY_AMOUNTS=o;var a={};a[s.GOLD]=r.COINS_SYMBOL,a[s.PARTS]=r.PARTS_SYMBOL,a[s.TOKENS]=r.TOKENS_SYMBOL,i.exports.CURRENCY_SYMBOLS=a,i.exports.getSymbol=function(e){return a[e]}}),define("raid/Raid",["require","exports","module","thor/core/Class","thor/core/Logger","thor/util/ModelUtils","mission/MissionType","mission/MissionType"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/util/ModelUtils")),s=e("mission/MissionType"),s=e("mission/MissionType"),o=n.create({initialize:function(){this.generation=0,this.created=0,this.duration=0,this.end=0,this.type=s.getValues()[0],this.progress=0,this.population=0,this.isRedeemed=!1},isExpired:function(){return!(!this.end||!this.created)&&Date.now()>this.end}}),a=new o;a.type=s.KILL_BRUISER,Object.freeze(a),o.fromWire=function(e){var t=new o;return r.fromExistingWithDefaults(t,e,a),t},i.exports=o}),define("raid/RaidSpec",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Logger").getLogger(i),e("thor/core/Validation");i.exports=n.create({initialize:function(e){this.__requirements=e},getTier:function(e){for(var t=0,i=this.__requirements.length;t<i;++t){if(this.__requirements[t]>e)break}return t-1},getRequirement:function(e){return e>=this.__requirements.length||e<0?-1:this.__requirements[e]},getProgression:function(e){var t,i=this.getMaxTier(),n=this.getTier(e);t=n>=i?this.getRequirement(i-1):n>=0?this.getRequirement(n):0;var r=Math.min(n+1,this.getMaxTier()),s=this.getRequirement(r),o=s-t;return{tier:n,progress:e,requirement:s,relativeProgress:Math.min(e-t,o),relativeRequirement:o}},getMaxTier:function(){return this.__requirements.length-1},clone:function(){return new i.exports(this.__requirements.slice())}});var r=n.create(i.exports,{initialize:function(){i.exports.prototype.initialize.call([])},getTier:function(){return 0},getMaxTier:function(){return 0},getProgression:function(e){return{tier:-1,progress:e,relativeProgress:0,relativeRequirement:1}}}),s=new r;Object.freeze(s),i.exports.NULL_INSTANCE=s}),define("raid/RaidState",["require","exports","module","thor/core/Enum","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Enum");e("thor/core/Validation");i.exports=n.create("RaidState",{PENDING:0,ACTIVE:1,COMPLETED:2})}),define("raid/RaidUpdatedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));i.exports=n.generateEventClass("RaidUpdatedEvent",2717443413,{},!0)}),define("raid/RewardInfo",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class");e("thor/core/Logger").getLogger(i),e("thor/core/Validation");i.exports=n.create({initialize:function(e,t){this.rewards={};for(var i in e)this.rewards[i]=e[i];this.generations=t.slice(),Object.freeze(this.rewards),Object.freeze(this.generations),Object.freeze(this)},hasRewards:function(){return!!(this.rewards.gold||this.rewards.parts||this.rewards.tokens)},isRedeemable:function(){return this.generations.length>0}}),i.exports.DEFAULT_REWARD_INFO=new i.exports({gold:0,parts:0,tokens:0},[])}),define("ui/CommonActions",["require","exports","module","thor/core/Validation","thor/graphics/animation/actions/Actions","thor/graphics/animation/EasingFunctions","thor/ui/Widget","thor/audio/SoundSprite"],function(e,t,i){var n=e("thor/core/Validation"),r=e("thor/graphics/animation/actions/Actions"),s=e("thor/graphics/animation/EasingFunctions"),o=(e("thor/ui/Widget").VISIBILITY,e("thor/audio/SoundSprite")),a={createDialogBlinkIn:function(e){n.ifDefined.assertIsNumber(e),n.isNumber(e)||(e=294);var t=e/7;return r.sequence(r.fadeTo(0,0),r.fadeTo(.09,t),r.fadeTo(.46,t),r.fadeTo(.24,t),r.fadeTo(.73,t),r.fadeTo(.47,t),r.fadeTo(.86,t),r.fadeTo(1,t))},createDialogBlinkOut:function(){return r.sequence(r.fadeTo(1,0),r.fadeTo(.86,42),r.fadeTo(.47,42),r.fadeTo(.73,42),r.fadeTo(.24,42),r.fadeTo(.46,42),r.fadeTo(.09,42),r.fadeTo(0,42))},createGlowHit:function(){return r.sequence(r.fadeTo(1,34),r.wait(136),r.fadeTo(.87,68),r.fadeTo(1,34),r.fadeTo(.67,68),r.fadeTo(.8,34),r.fadeTo(.47,68),r.fadeTo(.6,34),r.fadeTo(.27,68),r.fadeTo(.4,34),r.fadeTo(0,68))},createShake:function(e,t,i,n){for(var s=r.sequence(),o=0;o<e;++o){var a=(Math.random()-.5)*t*2,_=(Math.random()-.5)*i*2;s.addAction(r.moveBy(a,_,n)),s.addAction(r.moveBy(-a,-_,n))}return s},createPulse:function(e,t){n.ifDefined.assertIsNumber(t);var i=~~(e/2),o=r.sequence(r.fadeTo(0,0),r.fadeTo(1,i,s.easeInOut));return n.isNumber(t)&&o.addAction(r.wait(t)),o.addAction(r.fadeTo(0,i,s.easeInOut)),o},expandOptionsWidget:function(e){var t=e.findSingleWidgetWithName("btn_info"),i=e.findWidgetsWithName("btn_equip");i=i[0]||null;var n=e.findWidgetsWithName("divider");n=n[0]||null;t.runAction(r.sequence(r.fadeTo(0,0),r.wait(80),a.createDialogBlinkIn())),t.getTransform().alpha=0,i&&(i.runAction(r.sequence(r.fadeTo(0,0),r.wait(80),a.createDialogBlinkIn())),i.getTransform().alpha=0),n&&(n.runAction(r.sequence(r.fadeTo(0,0),r.wait(80),a.createDialogBlinkIn())),n.getTransform().alpha=0),e.runAction(r.sequence(r.fadeTo(0,0),r.scaleTo(1,.7,0),r.parallel(r.fadeTo(1,80),r.scaleTo(1,1,80)))),e.getTransform().alpha=0},blinkButton:function(e,t){var i={};e.getNamedSlotNames().forEach(function(n){var r=e.getNamedSlot(n).getWidget();t.forEach(function(e){var t=r.findSingleWidgetWithName(e);i[e]=t.getTintColor(),t.setTintColor(4294967295)})}),e.runAction(r.sequence(r.wait(30),r.fadeTo(0,110),r.callback(function(){e.getNamedSlotNames().forEach(function(n){var r=e.getNamedSlot(n).getWidget();t.forEach(function(e){r.findSingleWidgetWithName(e).setTintColor(i[e])})})})),!0,!0)},createScaleOut:function(e){return n.ifDefined.assertIsNumber(e),n.isNumber(e)||(e=200),r.sequence(r.parallel(r.scaleTo(1,1,0,s.interpolateCubic),r.fadeTo(1,0,s.interpolateCubic)),r.parallel(r.scaleTo(2.4,2.4,e,s.interpolateCubic),r.fadeTo(0,e,s.interpolateCubic)))},createShrinkIn:function(e){return n.ifDefined.assertIsNumber(e),n.isNumber(e)||(e=200),r.sequence(r.parallel(r.scaleTo(2.4,2.4,0,s.interpolateCubic),r.fadeTo(0,0,s.interpolateCubic)),r.parallel(r.scaleTo(1,1,e,s.interpolateCubic),r.fadeTo(1,e,s.interpolateCubic)))},createGrowIn:function(e){return n.ifDefined.assertIsNumber(e),n.isNumber(e)||(e=200),r.sequence(r.scaleTo(.5,.5,0,s.interpolateLinear),r.scaleTo(1,1,e,s.overshoot))},fadeIn:function(e,t){return n.ifDefined.assertIsNumber(e),n.ifDefined.assertIsFunction(t),n.isNumber(e)||(e=200),n.isFunction(t)||(t=s.interpolateLinear),r.sequence(r.fadeTo(0,0),r.fadeTo(1,e,t))},fadeInBlink:function(e,t,i,a){return n.ifDefined.assertIsInstanceOf(i,o),n.ifDefined.assertIsNonEmptyString(a),r.sequence(r.fadeTo(0,0),r.wait(t),r.callback(function(){i&&a&&i.play(a)}),r.fadeTo(1,.7*e,s.startBounce),r.fadeTo(1,.3*e,s.bounceLoop))}};return a}),define("events/GainedGoldEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event")),r=e("thor/core/Validation");i.exports=n.generateEventClass("GainedGoldEvent",1206164804,{amount:r.assertIsNumber})}),define("events/GainedPartsEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event")),r=e("thor/core/Validation");i.exports=n.generateEventClass("GainedPartsEvent",1781534230,{amount:r.assertIsNumber})}),define("events/GainedTokensEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event")),r=e("thor/core/Validation");i.exports=n.generateEventClass("GainedTokensEvent",2338875749,{amount:r.assertIsNumber})}),define("events/PauseCurrencyUpdatesEvent",["require","exports","module","thor/core/Class","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));i.exports=n.generateEventClass("PauseCurrencyUpdatesEvent",1562300683,{})}),define("events/UnpauseCurrencyUpdatesEvent",["require","exports","module","thor/core/Class","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));i.exports=n.generateEventClass("UnpauseCurrencyUpdatesEvent",1423121758,{})}),define("ui/CurrencyView",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/ui/Widget","thor/ui/TextWidget","thor/ui/WorldWidget","thor/ui/Margin","thor/ui/CanvasPanel","thor/ui/Anchor","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/graphics/animation/EasingFunctions","thor/ui/Geometry","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","ManagerRepository","thor/event/EventManager","thor/resources/ResourceManager","events/GainedGoldEvent","events/GainedPartsEvent","events/GainedTokensEvent","events/PauseCurrencyUpdatesEvent","events/UnpauseCurrencyUpdatesEvent","player/CurrencyTypeEnum"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=e("thor/ui/Widget"),a=(e("thor/ui/TextWidget"),e("thor/ui/WorldWidget")),_=e("thor/ui/Margin"),l=e("thor/ui/CanvasPanel"),h=e("thor/ui/Anchor"),u=e("thor/graphics/animation/actions/Actions"),c=e("thor/graphics/animation/Transform"),d=e("thor/graphics/animation/EasingFunctions"),g=e("thor/ui/Geometry"),p=e("thor/audio/SoundSprite"),m=e("thor/audio/SoundSpriteResourceLoader"),f=e("ManagerRepository"),v=(e("thor/event/EventManager"),e("thor/resources/ResourceManager"),e("events/GainedGoldEvent")),y=e("events/GainedPartsEvent"),E=e("events/GainedTokensEvent"),S=e("events/PauseCurrencyUpdatesEvent"),T=e("events/UnpauseCurrencyUpdatesEvent"),C=e("player/CurrencyTypeEnum"),I={};I[C.GOLD]="count_total_credits",I[C.TOKENS]="count_total_tokens",I[C.PARTS]="count_total_tokens";var w={};w[C.GOLD]="coin spin",w[C.TOKENS]="coin spin2",w[C.PARTS]="coin spin4";var b={};b[C.GOLD]=v,b[C.PARTS]=y,b[C.TOKENS]=E;var M={channel:"UI_SFX"};i.exports=n.create({initialize:function(e,t){this.__playerManager=f.getPlayerManager(),this.__eventManager=f.getEventManager(),this.__createWorld=e,this.__currency=t,this.__symbol=C.getSymbol(this.__currency),this.__updateEvent=b[this.__currency],this.__animation=w[this.__currency],this.__amount=this.__playerManager.getPlayerCurrency(this.__currency),this.__actual=this.__amount,this.__isListening=!1,this.__isAttached=!1,this.__skeletonFactory=f.getSkeletonFactory(),this.__skeletonFactory.load("currency"),this.__handleCurrencyUpdateEvent=this.__handleCurrencyUpdateEvent.bind(this),this.__boundCurrencyPausedEvent=this.__handleCurrencyPauseEvent.bind(this),this.__boundCurrencyUnpausedEvent=this.__handleCurrencyUnpauseEvent.bind(this),this.__numSpawnedWidgets=0,this.__spawnedWidgets={},this.__animations=[];var i=f.getResourceManager();this.__sounds=i.getOrDefault(m.RESOURCE_TYPE,"game_sounds",p.EMPTY_SOUND_SPRITE)},getCurrencyType:function(){return this.__currency},gain:function(e,t,i){if(!this.__isAttached)return r.warn("tried to gain currency",this.__currency,"when not attached"),Promise.resolve(!1);var n=this,o=this.__amount,a=this.__amount+e;this.setAmount(a);var _=new g(0,0,1,1);this.__label.getGeometry(_);var l=_.getX()+_.getWidth()/2,h=_.getY()+_.getHeight()/2;s.isNumber(t)||(t=l),s.isNumber(i)||(i=h);for(var c=l-t,d=h-i,p=[],m=Math.max(1,Math.min(e,5)),f=0;f<m;++f){var v=this.__animateIcon(t,i,c,d,100*f);p.push(v)}var y=new Promise(function(e,t){n.__labelTransform.setAction(u.sequence(u.wait(600),u.tweenCallback(o,a,400,function(e){n.__label.setText(n.__symbol+(~~e).toLocaleString())}),u.callback(function(){e(!0)})))});return p.push(y),Promise.all(p)},setAmount:function(e,t){s.ifDefined.assertIsBoolean(t),t=t||!1,this.__amount=e,(this.__isListening||t)&&this.__label.setText(this.__symbol+(~~this.__amount).toLocaleString())},getAmount:function(){return this.__amount},__animateIcon:function(e,t,i,n,r){var s=this;return new Promise(function(o,g){s.__container.addSlot(function(g){var p=new h(.5,.5,.5,.5);g.setOffset(new _(0,0,1,1)),g.setAnchor(p);var m=new l;g.setWidget(m),m.addSlot(function(_){var l=new a,p=s.__createWorld();s.__skeletonFactory.create("currency",p).getComponent("SkeletonComponent").playAnimation(s.__animation,!0,!1),_.setAnchor(new h(0,0,1,1)),l.setWorld(p),l.setName("world_widget"),_.setWidget(l),s.__container.invalidate();var f=new c;f.setAction(u.sequence(u.fadeTo(0,0),u.wait(r),u.fadeTo(1,0),u.moveTo(e,t,0),u.callback(function(){s.__sounds.play("currency_fly",M)}),u.parallel(u.moveBy(i,0,600,d.easeIn),u.moveBy(0,n,600,d.fastEaseIn)),u.callback(function(){s.__container.removeSlot(g),p.destroy(),o(!0)}))),m.setTransform(f),s.__animations.push(f)})})})},attach:function(e){if(s.ifDefined.assertIsInstanceOf(e,o),this.__isAttached&&this.detach(),e){this.__container=e;var t=I[this.__currency];this.__label=e.findSingleWidgetWithName(t),this.__labelTransform=new c,this.__label.setTransform(this.__labelTransform),this.__isAttached=!0,this.__eventManager.registerEventHandler(S.EVENT_TYPE,this.__boundCurrencyPausedEvent),this.__eventManager.registerEventHandler(T.EVENT_TYPE,this.__boundCurrencyUnpausedEvent),this.setAmount(this.__amount,!0)}},detach:function(){this.__isAttached&&(this.__container=null,this.__label=null,this.__labelTransform=null,this.__eventManager.unregisterEventHandler(this.__updateEvent.EVENT_TYPE,this.__handleCurrencyUpdateEvent),this.__eventManager.unregisterEventHandler(S.EVENT_TYPE,this.__boundCurrencyPausedEvent),this.__eventManager.unregisterEventHandler(T.EVENT_TYPE,this.__boundCurrencyUnpausedEvent),this.__isAttached=!1)},pause:function(){this.__isListening=!1,this.__eventManager.unregisterEventHandler(this.__updateEvent.EVENT_TYPE,this.__handleCurrencyUpdateEvent)},resume:function(){this.__isAttached&&(this.__isListening=!0,this.updateLabel(),this.__eventManager.registerEventHandler(this.__updateEvent.EVENT_TYPE,this.__handleCurrencyUpdateEvent))},updateLabel:function(){this.setAmount(this.__playerManager.getPlayerCurrency(this.__currency))},isAttached:function(){return this.__isAttached},__handleCurrencyUpdateEvent:function(e){if(this.__isListening&&this.__isAttached){var t=e.getAmount();this.setAmount(t)}},__handleCurrencyPauseEvent:function(){this.pause()},__handleCurrencyUnpauseEvent:function(){this.resume()},update:function(e){this.__labelTransform&&this.__labelTransform.update(e);for(var t=this.__animations.length-1;t>=0;--t){this.__animations[t].update(e)&&this.__animations.splice(t,1)}}})}),define("events/GainedXPEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event")),r=e("thor/core/Validation");i.exports=n.generateEventClass("GainedXPEvent",1861005085,{xpGained:r.assertIsNumber,xp:r.assertIsNumber,levelsGained:r.assertIsNumber,level:r.assertIsNumber,levelGains:r.assertIsArray})}),define("ui/views/LevelXPView",["require","exports","module","thor/core/Class","thor/core/Logger","thor/ui/Widget","thor/core/Validation","thor/ui/Widget","thor/math/MathHelper","thor/ui/Geometry","thor/graphics/animation/actions/Actions","thor/ui/Anchor","thor/ui/Margin","thor/ui/WorldWidget","thor/ui/CanvasPanel","thor/graphics/animation/EasingFunctions","ManagerRepository","events/GainedXPEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/ui/Widget"),e("thor/core/Validation")),s=(e("thor/ui/Widget").VISIBILITY,e("thor/math/MathHelper")),o=e("thor/ui/Geometry"),a=e("thor/graphics/animation/actions/Actions"),_=e("thor/ui/Anchor"),l=e("thor/ui/Margin"),h=e("thor/ui/WorldWidget"),u=e("thor/ui/CanvasPanel"),c=e("thor/graphics/animation/EasingFunctions"),d=e("ManagerRepository"),g=e("events/GainedXPEvent");i.exports=n.create({initialize:function(e){this.__playerManager=d.getPlayerManager(),this.__eventManager=d.getEventManager(),this.__createWorld=e,this.__skeletonFactory=d.getSkeletonFactory(),this.__boundXPEventHandler=this.__onGainedXP.bind(this),this.__isListening=!1,this.__levelLabel=null,this.__progressLabel=null,this.__progressBar=null,this.__container=null,this.__xp=this.__playerManager.getPlayerXP(),this.__level=this.__playerManager.getPlayerLevel()},isAttached:function(){return this.__levelLabel&&this.__progressBar&&this.__progressLabel},__onGainedXP:function(e){if(this.__isListening&&this.isAttached()){var t=e.getLevel(),i=e.getXp();this.setLevelXP(t,i)}},setLevelXP:function(e,t,i){if(r.ifDefined.assertIsBoolean(i),i=i||!1,i&&(this.__level=e,this.__xp=t),this.isAttached()){this.__levelLabel.setText(e.toLocaleString());var n=this.__playerManager.getXPInLevel(e),o=s.clamp(0,1,t/n);this.__playerManager.isMaxLevel(e)?(this.__progressLabel.setText("MAX LEVEL"),o=1):this.__progressLabel.setText(t.toLocaleString()+"/"+n.toLocaleString()),this.__progressBar.setProgress(o)}},update:function(e){},gain:function(e,t,i,n){if(!this.isAttached())return Promise.resolve();var s=new o(0,0,1,1);this.__levelLabel.getGeometry(s);var _=s.getX()+s.getWidth()/2,l=s.getY()+s.getHeight()/2;r.isNumber(i)||(i=_),r.isNumber(n)||(n=l);for(var h=_-i,u=l-n,c=[],d=Math.max(1,Math.min(t,5)),g=0;g<d;++g){var p=this.__animateIcon(i,n,h,u,100*g);c.push(p)}var m,f=this,v=this.__xp,y=this.__playerManager.getXPInLevel(this.__level),E=this.__playerManager.isMaxLevel(this.__level);e>0?(m=this.__playerManager.getXPInLevel(this.__level),this.__level):(m=this.__xp+t,this.__level);var S=new Promise(function(e,t){f.__progressLabel.runAction(a.sequence(a.wait(600),a.tweenCallback(v,m,400,function(e){f.__progressBar.setProgress(e/y),E?f.__progressLabel.setText(""):f.__progressLabel.setText(~~e+"/"+y)}),a.callback(function(){e(!0)})))});return c.push(S),Promise.all(c)},__animateIcon:function(e,t,i,n,r){var s=this;return new Promise(function(o,d){s.__container.addSlot(function(d){var g=new _(.5,.5,.5,.5);d.setOffset(new l(0,0,1,1)),d.setAnchor(g);var p=new u;d.setWidget(p),p.addSlot(function(l){var u=new h,g=s.__createWorld();s.__skeletonFactory.create("currency",g).getComponent("SkeletonComponent").playAnimation("coin spin3",!0,!1),l.setAnchor(new _(0,0,1,1)),u.setWorld(g),u.setName("world_widget"),l.setWidget(u),s.__container.invalidate(),p.runAction(a.sequence(a.fadeTo(0,0),a.wait(r),a.fadeTo(1,0),a.moveTo(e,t,0),a.parallel(a.moveBy(i,0,600,c.easeIn),a.moveBy(0,n,600,c.fastEaseIn)),a.callback(function(){s.__container.removeSlot(d),g.destroy(),o(!0)}))),p.getTransform().alpha=0})})})},pause:function(){this.__eventManager.unregisterEventHandler(g.EVENT_TYPE,this.__boundXPEventHandler),this.__isListening=!1},resume:function(){this.__eventManager.registerEventHandler(g.EVENT_TYPE,this.__boundXPEventHandler),this.__isListening=!0,this.__updateLevelXP()},__updateLevelXP:function(){var e=this.__playerManager.getPlayerXP(),t=this.__playerManager.getPlayerLevel();this.setLevelXP(t,e,!0)},getLevel:function(){return this.__level},getXP:function(){return this.__xp},attach:function(e){this.__container=e,this.__progressBar=e.findSingleWidgetWithName("progress_level"),this.__progressLabel=e.findSingleWidgetWithName("label_progress"),this.__levelLabel=e.findSingleWidgetWithName("label_level"),this.resume()},detach:function(){this.__container=null,this.__progressBar=null,this.__progressLabel=null,this.__levelLabel=null,this.pause()}})}),define("ui/WalletView",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/TextWidget","thor/ui/Widget","ManagerRepository","thor/event/EventManager","thor/resources/ResourceManager","player/CurrencyTypeEnum","./CurrencyView","ui/views/LevelXPView","events/GainedXPEvent","events/GainedGoldEvent","events/GainedPartsEvent","events/GainedTokensEvent","events/PauseCurrencyUpdatesEvent","events/UnpauseCurrencyUpdatesEvent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=(e("thor/ui/TextWidget"),e("thor/ui/Widget").VISIBILITY),o=e("ManagerRepository"),a=e("thor/event/EventManager"),_=(e("thor/resources/ResourceManager"),e("player/CurrencyTypeEnum")),l=e("./CurrencyView"),h=e("ui/views/LevelXPView"),u=(e("events/GainedXPEvent"),e("events/GainedGoldEvent")),c=(e("events/GainedPartsEvent"),e("events/GainedTokensEvent"),e("events/PauseCurrencyUpdatesEvent")),d=e("events/UnpauseCurrencyUpdatesEvent"),g=_.getValues(),p={};p[_.GOLD]="credits",p[_.TOKENS]="tokens",p[_.PARTS]="parts";var m=n.create({initialize:function(e){var t=this;this.__playerManager=o.getPlayerManager(),this.__eventManager=o.getEventManager(),this.__createWorld=e,this.__arrViews=[],this.__viewByCurrencyType={},g.map(function(e){var i=new l(t.__createWorld,e);t.__arrViews.push(i),t.__viewByCurrencyType[e]=i}),this.__levelXpView=new h(this.__createWorld),this.__arrViews.push(this.__levelXpView),this.__canUpdate=!0,this.__container=null,this.__currencyWidgets={}},debugGainGold:function(){var e=this.__eventManager.getNewEvent(u);e.setAmount(this.__playerManager.getPlayerGold()+100),this.__eventManager.queueEvent(e)},getContainer:function(){return this.__container},attach:function(e){this.__container&&this.detach(),e.setVisibility(s.VISIBLE),this.__container=e;for(var t=0,i=g.length;t<i;++t){var n=g[t],r=this.__viewByCurrencyType[n],o=p[n];if(o){var a=e.findWidgetsWithName(o);0===a.length?r.detach():r.attach(a[0])}}var _=e.findWidgetsWithName("player_level");0!==_.length&&this.__levelXpView.attach(_[0])},detach:function(){for(var e=0,t=this.__arrViews.length;e<t;++e)this.__arrViews[e].detach();this.__levelXpView.isAttached()&&this.__levelXpView.detach(),this.__container.setVisibility(s.HIDDEN),this.__container=null},gain:function(e,t,i,n){return this.__viewByCurrencyType[e].gain(t,i,n)},gainXp:function(e,t,i,n){return this.__levelXpView.isAttached()?this.__levelXpView.gain(e,t,i,n):Promise.resolve()},setCurrency:function(e,t,i){r.ifDefined.assertIsBoolean(i),i=i||!1,this.__viewByCurrencyType[e].setAmount(t,i)},getCurrency:function(e){return this.__viewByCurrencyType[e].getAmount()},setLevelXP:function(e,t,i){r.ifDefined.assertIsBoolean(i),i=i||!1,this.__levelXpView.isAttached()&&this.__levelXpView.setLevelXP(e,t,i)},getLevel:function(){return this.__levelXpView.getLevel()},getXP:function(){return this.__levelXpView.getXP()},pause:function(){for(var e=0,t=this.__arrViews.length;e<t;++e)this.__arrViews[e].pause();this.__levelXpView.pause()},resume:function(){for(var e=0,t=this.__arrViews.length;e<t;++e)this.__arrViews[e].resume();this.__levelXpView.resume()},update:function(e){for(var t=0,i=this.__arrViews.length;t<i;++t)this.__arrViews[t].update(e)}});i.exports=m,i.exports.pauseCurrencyUpdates=function(){r.ifDefined.assertIsInstanceOf(e,a);var e=o.getEventManager(),t=e.getNewEvent(c);e.queueEvent(t)},i.exports.unpauseCurrencyUpdates=function(){r.ifDefined.assertIsInstanceOf(e,a);var e=o.getEventManager(),t=e.getNewEvent(d);e.queueEvent(t)}}),define("cards/CardRarityEnum",["require","exports","module","thor/core/Enum","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Enum"),r=(e("thor/core/Validation"),n.create("CardRarityEnum",{COMMON:1,RARE:2,EPIC:3})),s={};s[r.COMMON]=519569407,s[r.RARE]=4287245311,s[r.EPIC]=3811049471;var o={};return o[r.COMMON]="normal",o[r.RARE]="rare",o[r.EPIC]="epic",r.getColor=function(e){return s[e]},r.getSFX=function(e){return o[e]},r}),define("cards/CardParameters",["require","exports","module","thor/core/Class","thor/core/Validation","thor/util/ModelUtils","Constants","cards/CardRarityEnum","cards/CardEffectEnum"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/util/ModelUtils"),o=(e("Constants"),e("cards/CardRarityEnum")),a=(e("cards/CardEffectEnum"),{rarities:{},nextCardId:1,cardTypes:{},cardLevels:{}});a.rarities[o.COMMON]=[],a.rarities[o.RARE]=[],a.rarities[o.EPIC]=[];var _=n.create({initialize:function(){},validate:function(){for(var e in this.rarities)for(var t=this.rarities[e],i=0;i<t.length;++i){t[i]}var n;for(n in this.cardTypes){var s=this.cardTypes[n];r.ifDefined.assertIsString(s.description),r.ifDefined.assertIsString(s.imageName)}for(n in this.cardLevels)for(var o=this.cardLevels[n],i=0;i<o.length;++i){o[i]}},getCardIdsByRarity:function(e){var t=[];for(var i in this.cardTypes){this.cardTypes[i].rarity===e&&t.push(+i)}return t}});return _.fromExisting=function(e){var t=new _;return s.fromExistingWithDefaults(t,e,a,0,2),t.validate(),t},_}),define("cards/CardInstance",["require","exports","module","thor/core/Class","thor/core/Validation","cards/CardParameters"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("cards/CardParameters"),n.create({initialize:function(e,t,i,n,r){n||(r=-1),this.id=e,this.level=t,this.newFlag=i,this.equipped=n,this.equippedSlotIndex=r},getDescription:function(e){return r.getDescription(this.id,this.level,e)}}));return r.getDescription=function(e,t,i){var n=i.cardTypes[e],r=i.cardLevels[e][t],s=n.description||"";return s=s.replace(/{X}/g,""+r.effectValue)},r.fromWire=function(e){return new r(e.id,e.level||0,e.newFlag||!1,e.equipped||!1,e.equippedSlotIndex)},r.toWire=function(e){return{id:e.id,level:e.level,newFlag:e.newFlag,equipped:e.equipped,equippedSlotIndex:e.equippedSlotIndex}},r}),define("ui/views/LargeCardView",["require","exports","module","thor/core/Class","thor/core/Logger","thor/config/Config","thor/core/Validation","thor/resources/ResourceManager","thor/ui/Slot","thor/ui/Anchor","thor/ui/Widget","thor/graphics/animation/actions/Actions","thor/ui/Geometry","thor/graphics/animation/Transform","thor/ui/Widget","thor/ui/ImageWidget","thor/audio/SoundSprite","thor/ui/resources/WidgetResource","thor/graphics/animation/EasingFunctions","thor/graphics/resources/TextureRegionResource","thor/audio/SoundSpriteResourceLoader","cards/CardInstance","cards/CardRarityEnum","cards/CardParameters","player/Player","ui/CommonActions","Constants"],function(e,t,i){var n,r=e("thor/core/Class"),s=(e("thor/core/Logger").getLogger(i),e("thor/config/Config"),e("thor/core/Validation")),o=(e("thor/resources/ResourceManager"),e("thor/ui/Slot"),e("thor/ui/Anchor")),a=(e("thor/ui/Widget"),e("thor/graphics/animation/actions/Actions")),_=(e("thor/ui/Geometry"),e("thor/graphics/animation/Transform")),l=e("thor/ui/Widget").VISIBILITY,h=(e("thor/ui/ImageWidget"),e("thor/audio/SoundSprite")),u=e("thor/ui/resources/WidgetResource"),c=e("thor/graphics/animation/EasingFunctions"),d=e("thor/graphics/resources/TextureRegionResource"),g=e("thor/audio/SoundSpriteResourceLoader"),p=(e("cards/CardInstance"),e("cards/CardRarityEnum")),m=(e("cards/CardParameters"),e("player/Player"),e("ui/CommonActions")),f=e("Constants"),v=1/0,y=i.exports=r.create({initialize:function(e,t){this._widget=e,this._resourceManager=t,this.__sounds=t.getOrDefault(g.RESOURCE_TYPE,"game_sounds",h.EMPTY_SOUND_SPRITE),this.__expandAndShrinkTransform=null,this.__flipCardBackTransform=null,this.__flipCardFrontTransform=null,this.__flipSecondaryCardFrontTransform=null,this.__cardFlyOutTransform=null,this.__animations=[],this.__currentCardBack=null,this.__isSkipping=!1,this.__glow=this._widget.findSingleWidgetWithName("glow_full_card"),this.__glow.setVisibility(l.HIDDEN),this.__glowFrame=this._widget.findSingleWidgetWithName("glow_frame"),this.__glowFrame.setVisibility(l.HIDDEN),this.__cardContents=this._widget.findSingleWidgetWithName("gift_card"),this.__giftCardBack=this.__cardContents.findWidgetsWithName("frame")[0];var i=this.__cardContents.findSingleWidgetWithName("coins");i.setVisibility(l.HIDDEN);var n=i.findSingleWidgetWithName("icon"),r=i.findSingleWidgetWithName("credits"),s=i.findSingleWidgetWithName("count_total_credits"),o=this.__cardContents.findSingleWidgetWithName("parts");o.setVisibility(l.HIDDEN);var a=o.findSingleWidgetWithName("icon"),_=o.findSingleWidgetWithName("credits"),u=o.findSingleWidgetWithName("count_total_credits"),c=this.__cardContents.findSingleWidgetWithName("tokens");c.setVisibility(l.HIDDEN);var d=c.findSingleWidgetWithName("icon"),p=c.findSingleWidgetWithName("credits"),m=c.findSingleWidgetWithName("count_total_credits"),v=this.__cardContents.findSingleWidgetWithName("slot unlock");v.setVisibility(l.HIDDEN);var y=v.findSingleWidgetWithName("icon"),E=v.findSingleWidgetWithName("label"),S=this.__cardContents.findSingleWidgetWithName("coin multiplier");S.setVisibility(l.HIDDEN);var T=S.findSingleWidgetWithName("icon"),C=S.findSingleWidgetWithName("info"),I=C.findSingleWidgetWithName("multiplier_label");I.setText("x"+f.GOLD_MULTIPLIER+" COINS"),C.findSingleWidgetWithName("runs_label").setText("NEXT "+f.GOLD_MULTIPLIER+" RUNS"),this.__cardContents.findSingleWidgetWithName("powerUp_gun").setVisibility(l.HIDDEN),this.__cardContents.findSingleWidgetWithName("powerUp_missile").setVisibility(l.HIDDEN),this.__cardContents.findSingleWidgetWithName("powerUp_companion").setVisibility(l.HIDDEN);var w=this._widget.findSingleWidgetWithName("upgrade_card");w.setVisibility(l.HIDDEN);var b=w.findWidgetsWithName("frame")[0];this.__upgradeCardBack=b;var M=w.findSingleWidgetWithName("upgrade_icon");w.findSingleWidgetWithName("card_locked").setVisibility(l.HIDDEN);var x=w.findSingleWidgetWithName("card_level");this.__widgetsByRewardType={gold:{container:i,icon:n,labelContainer:r,label:s},parts:{container:o,icon:a,labelContainer:_,label:u},tokens:{container:c,icon:d,labelContainer:p,label:m},slotUnlock:{container:v,icon:y,label:E},goldMultipliers:{container:S,icon:T,labelContainer:C,label:I},cards:{container:w,icon:M,cardLevel:x,frame:b}},this.__currentComponents=null},show:function(e,t,i){var n=this._widget.findSingleWidgetWithName("glow_full_card");n.setVisibility(l.HIDDEN);var r=this._widget.findSingleWidgetWithName("glow_frame");r.setVisibility(l.HIDDEN),this.__glow=n,this.__glowFrame=r,this._widget.findSingleWidgetWithName("gift_card").setVisibility(l.HIDDEN);var s=this._widget.findSingleWidgetWithName("upgrade_card");s.setVisibility(l.VISIBLE);var o=i.cardTypes[e];this.__setIcon(s.findSingleWidgetWithName("upgrade_icon"),o.imageName),s.findWidgetsWithName("frame")[0].setTintColor(p.getColor(o.rarity));var a=s.findSingleWidgetWithName("card_level"),_=s.findSingleWidgetWithName("card_locked");t>=0?(a.setText("LEVEL "+(t+1)),_.setVisibility(l.HIDDEN)):(a.setVisibility(l.HIDDEN),_.setVisibility(l.VISIBLE)),this._widget.invalidate()},__setIcon:function(e,t){if(this._resourceManager.has(d.RESOURCE_TYPE,t)){
var i=this._resourceManager.get(d.RESOURCE_TYPE,t);e.setTextureRegion(i),e.invalidate()}},flyOutCard:function(){var e=this;return new Promise(function(t,i){var n=new _,r=a.sequence(a.parallel(a.scaleTo(2.4,2.4,200,c.interpolateCubic),a.fadeTo(0,200,c.interpolateCubic),a.callback(function(){t(),e.__cardFlyOutTransform=null})));n.setAction(r),e.__cardFlyOutTransform=n,e._widget.setTransform(n,!0)})},scaleOut:function(e){if(s.ifDefined.assertIsBoolean(e),e=e||!1){if(this.__currentCardBack){var t=new _;t.alpha=0,this.__currentCardBack.setTransform(t,!0)}if(this.__currentComponents&&this.__currentComponents.container){var t=new _;t.alpha=0,this.__currentComponents.container.setTransform(t,!0)}}else{var i=this;if(this.__currentCardBack){var t=new _,n=a.sequence(m.createScaleOut(),a.callback(function(){i.__cardBackScaleOutTransform=null}));t.setAction(n),this.__currentCardBack.setTransform(t,!0),this.__cardBackScaleOutTransform=t,this.__currentCardBack=null}if(this.__currentComponents&&this.__currentComponents.container){var t=new _,n=a.sequence(m.createScaleOut(),a.callback(function(){i.__containerScaleOutTransform=null}));t.setAction(n),this.__currentComponents.container.setTransform(t,!0),this.__containerScaleOutTransform=t,this.__currentComponents=null}}},flipParts:function(e,t){var i=this.__widgetsByRewardType.parts;return this.__flipCurrency(e,t,i,!0)},flipGold:function(e,t){var i=this.__widgetsByRewardType.gold;return this.__flipCurrency(e,t,i,!0)},flipTokens:function(e,t){var i=this.__widgetsByRewardType.tokens;return this.__flipCurrency(e,t,i,!0)},flipGoldMultipliers:function(e){var t=this.__widgetsByRewardType.goldMultipliers;return this.__flipCurrency(0,e,t,!1)},__flipCurrency:function(e,t,i,n){this.__cardContents.setVisibility(l.VISIBLE);var r=this._widget.getTransform();r&&r.reset(),this.__currentComponents=i;var s=i.icon,o=i.container,a=i.labelContainer,h=i.label;this.__currentCardBack=this.__giftCardBack;var u=s;u.setVisibility(l.HIDDEN),a.setVisibility(l.HIDDEN),h.setVisibility(l.VISIBLE),n&&h.setText("+"+e).invalidate(),o.setVisibility(l.VISIBLE),this.__currentCardBack.setVisibility(l.VISIBLE),h.setTransform(new _),a.setTransform(new _),o.setTransform(new _);var c=this.__flipCardBack(this.__currentCardBack,t+300),d=this.__flipCardFront(u,t+300+200),g=this.__expandAndShrink(a,t+300+200+450);return Promise.all([c,d,g])},flipSlotUnlock:function(e){this.__cardContents.setVisibility(l.VISIBLE);var t=this._widget.getTransform();t&&t.reset();var i=this.__widgetsByRewardType.slotUnlock;this.__currentComponents=i;var n=i.icon,r=i.container,s=i.label;this.__currentCardBack=this.__giftCardBack;var o=n;o.setVisibility(l.HIDDEN),s.setVisibility(l.HIDDEN),r.setVisibility(l.VISIBLE),this.__currentCardBack.setVisibility(l.VISIBLE),s.setTransform(new _),r.setTransform(new _);var a=this.__flipCardBack(this.__currentCardBack,e+300),h=this.__flipCardFront(o,e+300+200),u=this.__expandAndShrink(s,e+300+200+450);return Promise.all([a,h,u])},flipCard:function(e,t,i,n){this.__cardContents.setVisibility(l.HIDDEN);var r=this._widget.getTransform();r&&r.reset();var s=this.__widgetsByRewardType.cards;this.__currentComponents=s;var o=s.frame,a=s.icon,h=s.cardLevel,u=s.container;this.__currentCardBack=this.__upgradeCardBack;var c=(e.id,e.level),d=p.getColor(t.rarity);o.setTintColor(d),this.__setIcon(a,t.imageName),h.setText("LEVEL "+(c+1)),a.setVisibility(l.HIDDEN),h.setVisibility(l.HIDDEN),u.setVisibility(l.VISIBLE),this.__currentCardBack.setVisibility(l.VISIBLE),u.setTransform(new _),h.setTransform(new _),a.setTransform(new _);var g=this.__flipCardBack(this.__currentCardBack,n+300),m=this.__flipCardFront(a,n+300+200,!1),f=this.__flipCardFront(h,n+300+200,!0);return Promise.all([g,m,f])},__expandAndShrink:function(e,t){var i=this;return new Promise(function(n,r){var s=a.sequence(a.callback(function(){e.setVisibility(l.VISIBLE)}),a.fadeTo(0,0),a.wait(t),a.fadeTo(1,0),a.scaleTo(1.3,1.3,200,c.interpolateCubic),a.scaleTo(1,1,200,c.interpolateCubic),a.callback(function(){i.__expandAndShrinkTransform=null,n()})),o=new _;o.setAction(s),e.setTransform(o,!0),i.__expandAndShrinkTransform=o})},__flipCardBack:function(e,t){var i=this;return new Promise(function(n,r){var s=a.sequence(a.scaleTo(-1,1,0),a.wait(t),a.scaleTo(0,1,200,c.interpolateCubic),a.scaleTo(1.3,1.3,200,c.interpolateCubic),a.scaleTo(1,1,200,c.interpolateCubic),a.callback(function(){i.__flipCardBackTransform=null,n()})),o=new _;o.setAction(s),e.setTransform(o,!0),i.__flipCardBackTransform=o})},__flipCardFront:function(e,t,i){s.ifDefined.assertIsBoolean(i),i=i||!1;var n=this;return new Promise(function(r,s){var o=a.sequence(a.callback(function(){e.setVisibility(l.VISIBLE)}),a.fadeTo(0,0),a.scaleTo(0,1,0),a.wait(t),a.callback(function(){n.__isSkipping||n.__sounds.play("card_flip")}),a.fadeTo(1,0),a.scaleTo(1.3,1.3,200,c.interpolateCubic),a.scaleTo(1,1,200,c.interpolateCubic),a.callback(function(){i?n.__flipSecondaryCardFrontTransform=null:n.__flipCardFrontTransform=null,r()})),h=new _;h.setAction(o),e.setTransform(h,!0),i?n.__flipSecondaryCardFrontTransform=h:n.__flipCardFrontTransform=h})},finishAnimations:function(){this.__isSkipping=!0,this.update(v),this.__isSkipping=!1},getGlow:function(){return this.__glow},getGlowFrame:function(){return this.__glowFrame},getWidget:function(){return this._widget},getPartsSourceLocation:function(e){this.__widgetsByRewardType.parts.label.getGeometry(e)},getGoldSourceLocation:function(e){this.__widgetsByRewardType.gold.label.getGeometry(e)},getTokensSourceLocation:function(e){this.__widgetsByRewardType.tokens.label.getGeometry(e)},update:function(e){this.__expandAndShrinkTransform&&this.__expandAndShrinkTransform.update(e),this.__flipCardBackTransform&&this.__flipCardBackTransform.update(e),this.__flipCardFrontTransform&&this.__flipCardFrontTransform.update(e),this.__flipSecondaryCardFrontTransform&&this.__flipSecondaryCardFrontTransform.update(e),this.__containerScaleOutTransform&&this.__containerScaleOutTransform.update(e),this.__cardBackScaleOutTransform&&this.__cardBackScaleOutTransform.update(e),this.__cardFlyOutTransform&&this.__cardFlyOutTransform.update(e)}});i.exports.addToContainer=function(e,t){return new Promise(function(i,n){e.addSlot(function(e){i(y.create(e,t))})})},i.exports.create=function(e,t,i){s.ifDefined.assertIsBoolean(i),i=i||!1,n||(n=t.get(u.RESOURCE_TYPE,"element_card_full"));var r=n.construct();return i||e.setAnchor&&e.setAnchor(new o(0,0,1,1)),e.setWidget(r),new y(r,t)}}),define("ui/views/OpenGiftView",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/core/Enum","thor/ui/Margin","thor/ui/Anchor","thor/ui/Widget","thor/ui/Geometry","thor/ui/Widget","thor/ui/ImageWidget","thor/ui/resources/WidgetResource","thor/graphics/resources/TextureRegionResource","thor/graphics/animation/EasingFunctions","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/resources/ResourceManager","thor/event/EventManager","player/PlayerManager","thor/entity/EntityManager","ManagerRepository","thor/entity/EntityDestroyedEvent","thor/audio/SoundManager","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","thor/graphics/resources/TextureRegionResource","thor/graphics/resources/ParticleSystemResource","thor/entity/ParticleSystemComponent","Constants","player/Player","player/CurrencyTypeEnum","thor/entity/Entity","ui/CommonActions","ui/WalletView","ui/views/LargeCardView","cards/CardInstance","cards/CardRarityEnum","cards/CardParameters","thor/util/TimeoutContext"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=e("thor/core/Enum"),a=(e("thor/ui/Margin"),e("thor/ui/Anchor"),e("thor/ui/Widget"),e("thor/ui/Geometry")),_=e("thor/ui/Widget").VISIBILITY,l=(e("thor/ui/ImageWidget"),e("thor/ui/resources/WidgetResource")),h=e("thor/graphics/resources/TextureRegionResource"),u=e("thor/graphics/animation/EasingFunctions"),c=e("thor/graphics/animation/actions/Actions"),d=e("thor/graphics/animation/Transform"),g=(e("thor/resources/ResourceManager"),e("thor/event/EventManager"),e("player/PlayerManager"),e("thor/entity/EntityManager"),e("ManagerRepository")),p=e("thor/entity/EntityDestroyedEvent"),m=e("thor/audio/SoundManager"),f=e("thor/audio/SoundSprite"),v=e("thor/audio/SoundSpriteResourceLoader"),h=e("thor/graphics/resources/TextureRegionResource"),y=e("thor/graphics/resources/ParticleSystemResource"),E=(e("thor/entity/ParticleSystemComponent"),e("Constants")),S=(e("player/Player"),e("player/CurrencyTypeEnum")),T=(e("thor/entity/Entity"),e("ui/CommonActions")),C=(e("ui/WalletView"),e("ui/views/LargeCardView")),I=(e("cards/CardInstance"),e("cards/CardRarityEnum")),w=(e("cards/CardParameters"),e("thor/util/TimeoutContext")),b=new a(0,0,1,1),M={};M[I.RARE]="particles/vfx_card_rare",M[I.EPIC]="particles/vfx_card_epic";var x=o.create("GiftTypeEnum",{NORMAL:1,GOLD:2,RAID:3});i.exports=n.create({initialize:function(e,t){this.__playerManager=g.getPlayerManager(),this.__eventManager=g.getEventManager(),this.__resourceManager=g.getResourceManager(),this.__entityManager=g.getEntityManager(),this.__cardParameters=this.__playerManager.getCardParameters(),this.__sounds=this.__resourceManager.getOrDefault(v.RESOURCE_TYPE,"game_sounds",f.EMPTY_SOUND_SPRITE),this.__walletView=t,this.__giftType=!1,this.__animations=[];var i=this.__resourceManager.get(l.RESOURCE_TYPE,"screen_gift_box");this.__widget=i.construct(),this.__widget.setVisibility(_.HIDDEN),this.__widget.invalidate(),this.__normalWorldWidget=this.__widget.findSingleWidgetWithName("animation"),this.__world=e(),this.__normalWorldWidget.setWorld(this.__world),this.__goldWorldWidget=this.__widget.findSingleWidgetWithName("animationGold"),this.__goldWorld=e(),this.__goldWorldWidget.setWorld(this.__goldWorld),this.__raidWorldWidget=this.__widget.findSingleWidgetWithName("animationRaid"),this.__raidWorld=e(),this.__raidWorldWidget.setWorld(this.__raidWorld);var n=g.getSkeletonFactory();this.__normalGiftBox=n.create("giftbox",this.__world,{attachParent:this.__world.getScene().getRootComponent(),sortOrder:2}),this.__goldGiftBox=n.create("giftbox_gold",this.__goldWorld,{attachParent:this.__goldWorld.getScene().getRootComponent(),sortOrder:2}),this.__raidGiftBox=n.create("giftbox_raid",this.__raidWorld,{attachParent:this.__raidWorld.getScene().getRootComponent(),sortOrder:2}),this.__button=this.__widget.findSingleWidgetWithName("SimpleButtonWidget").setClickHandler(this.__clicked.bind(this)),this.__dialogSection=this.__widget.findSingleWidgetWithName("dialogue");var r=this.__dialogSection.getSlotAtIndex(3);this.__cardView=C.create(r,this.__resourceManager,!0),this.__topTray=this.__widget.findSingleWidgetWithName("top_tray"),this.__cardLabelsContainer=this.__widget.findSingleWidgetWithName("cardLabel");var s=this.__cardLabelsContainer.findSingleWidgetWithName("textCardName"),o=this.__cardLabelsContainer.findSingleWidgetWithName("textNew"),a=this.__cardLabelsContainer.findSingleWidgetWithName("textCardDescription"),h=this.__cardLabelsContainer.findSingleWidgetWithName("glow");s.setVisibility(_.HIDDEN),a.setVisibility(_.HIDDEN),o.setVisibility(_.HIDDEN),h.setVisibility(_.HIDDEN),this.__cardNameLabel=s,this.__cardDescriptionLabel=a,this.__cardNewLabel=o,this.__cardNewGlow=h,this.__arrCounterImages=[];for(var u=this.__widget.findSingleWidgetWithName("box_count"),c=this.__widget.findSingleWidgetWithName("box_countGold"),d=this.__widget.findSingleWidgetWithName("box_countRaid"),p=0;p<=5;p++){var m=u.findSingleWidgetWithName(""+p);m.setVisibility(_.HIDDEN);var y=c.findSingleWidgetWithName(""+p);y.setVisibility(_.HIDDEN);var E=d.findSingleWidgetWithName(""+p);E.setVisibility(_.HIDDEN);var S={};S[x.NORMAL]=m,S[x.GOLD]=y,S[x.RAID]=E,this.__arrCounterImages.push(S)}this.__timeoutContext=new w,this.__particleSystemsByCardRarity={},this.__particleSystemsByCardRarity[I.RARE]=this.__createParticleSystemTemplate(M[I.RARE],"vfx_sparkle002"),this.__particleSystemsByCardRarity[I.EPIC]=this.__createParticleSystemTemplate(M[I.EPIC],"vfx_sparkle002")},__createParticleSystemTemplate:function(e,t){var i=this.__entityManager.createEntity(),n=this.__entityManager.addComponent(i,"SceneComponent",!1);n.setScale(3,3),i.setRootComponent(n);var r=this.__entityManager.addComponent(i,"ParticleSystemComponent",!1),s=this.__resourceManager.get(y.RESOURCE_TYPE,e),o=this.__resourceManager.get(h.RESOURCE_TYPE,t);return r.setName("OpenGift"+e),r.setParticleSystem(s),r.setTextureRegion(o),r.attachTo(n),i},show:function(e,t){if(s.ifDefined.assertIsInEnum(t,x),t=t||x.NORMAL,r.debug("Showing gift contents: ",e,", gift type: ",t),this.__walletView.attach(this.__topTray),this.__cardLabelsContainer.runAction(T.createDialogBlinkIn()),this.__dialogSection.runAction(T.createDialogBlinkIn()),this.__cardNameLabel.setVisibility(_.HIDDEN),this.__cardDescriptionLabel.setVisibility(_.HIDDEN),this.__cardNewLabel.setVisibility(_.HIDDEN),this.__cardNewGlow.setVisibility(_.HIDDEN),this.__animations.length=0,this.__widget.setVisibility(_.HIDDEN),this.__widget.invalidate(),r.debug("Stuff hidden"),this.__cardRevealed=!1,this.__isClosing=!1,this.__isOpened=!1,this.__hidingCurrentCard=!1,this.__skipped=!1,this.__arrRewardContents=[],this.__arrRewardTypes=[],e.parts&&(this.__arrRewardTypes.push("PARTS"),this.__arrRewardContents.push(e.parts),r.debug("Parts added to reward types")),e.gold&&(this.__arrRewardTypes.push("GOLD"),this.__arrRewardContents.push(e.gold),r.debug("Coins added to reward types")),e.tokens&&(this.__arrRewardTypes.push("TOKENS"),this.__arrRewardContents.push(e.tokens),r.debug("Gacha tokens added to reward types")),e.slotUnlock&&(r.debug("Processing card slot unlock"),this.__arrRewardTypes.push("slotUnlock"),this.__arrRewardContents.push(e.slotUnlock),r.debug("Card slot unlock added to reward types")),e.goldMultipliers&&(r.debug("Processing gold multipliers"),this.__arrRewardTypes.push("goldMultipliers"),this.__arrRewardContents.push(e.goldMultipliers),r.debug("Gold multipliers added to reward types")),e.cards){r.debug("Processing cards");for(var i=e.cards,n=0,o=i.length;n<o;n++)this.__arrRewardTypes.push("cards"),this.__arrRewardContents.push(i[n]);r.debug("Cards added to reward types")}this.__currentRewardIdx=0,this.__widget.setVisibility(_.VISIBLE);for(var a=0;a<this.__arrCounterImages.length;a++)for(var l=this.__arrCounterImages[a],h=x.getValues(),u=0,c=h.length;u<c;++u){var d=h[u];l[d].setVisibility(_.HIDDEN)}var g=this;this.__giftType=t,t===x.GOLD?(r.debug("Showing stuff for gold gift"),this.__normalWorldWidget.setVisibility(_.HIDDEN),this.__goldWorldWidget.setVisibility(_.VISIBLE),this.__raidWorldWidget.setVisibility(_.HIDDEN),this.__giftBox=this.__goldGiftBox):t===x.RAID?(r.debug("Showing stuff for raid gift"),this.__normalWorldWidget.setVisibility(_.HIDDEN),this.__goldWorldWidget.setVisibility(_.HIDDEN),this.__raidWorldWidget.setVisibility(_.VISIBLE),this.__giftBox=this.__raidGiftBox):(r.debug("Showing stuff for daily gift"),this.__normalWorldWidget.setVisibility(_.VISIBLE),this.__goldWorldWidget.setVisibility(_.HIDDEN),this.__raidWorldWidget.setVisibility(_.HIDDEN),this.__giftBox=this.__normalGiftBox),r.debug("Setting up skeleton component for card flipping");var p=this.__giftBox.getComponent("SkeletonComponent");return p.setDefaultAnimation("Idle Open Front"),p.setTranslation(0,40),p.playAnimation("Open"),p.queueAnimation("Idle Open Front"),p.setAnimationEndedCallback(function(){g.__isOpened=!0}),this.__sounds.play("gacha_zoom2"),r.debug("Starting to show current reward"),this.__showCurrentReward(),new Promise(function(e){g.__resolve&&g.__resolve(),g.__resolve=e})},hide:function(){this.__widget.setVisibility(_.HIDDEN),this.__walletView.detach(),this.__normalWorldWidget.setVisibility(_.HIDDEN),this.__goldWorldWidget.setVisibility(_.HIDDEN),this.__giftBox.getComponent("SkeletonComponent").setEnabled(!0),this.__cardRevealed=!1,this.__isClosing=!1,this.__hidingCurrentCard=!1,this.__skipped=!1,this.__animations.length=0,this.__currentRewardComponents=null,this.__resolve&&(this.__resolve(),this.__resolve=null)},__showCurrentReward:function(){this.__animations.length=0,this.__hidingCurrentCard=!1,this.__cardRevealed=!1,this.__isClosing=!1,this.__skipped=!1,r.debug("Abra Cadabra!"),this.__showCards()},__showCards:function(){var e=this.__arrRewardTypes[this.__currentRewardIdx];if(r.debug("Attempting to show reward type: ",e),!s.isDefined(e))return r.warn("Undefined reward type"),this.hide();var t=this.__arrRewardContents[this.__currentRewardIdx];if(!s.isDefined(t))return r.warn("Reward type "+e+" is not in the gift box, aborting"),this.hide();this.__cardNameLabel.setVisibility(_.HIDDEN),this.__cardDescriptionLabel.setVisibility(_.HIDDEN),this.__cardNewLabel.setVisibility(_.HIDDEN),this.__cardNewGlow.setVisibility(_.HIDDEN);var i,n=0===this.__currentRewardIdx?1400:0,o=E.REWARD_TYPE_NAMES[e],a=E.REWARD_TYPE_DESCRIPTIONS[e];if(s.isNonEmptyString(o)&&s.isNonEmptyString(a)&&this.__showNameAndDescription(o,a,n+300+200),"PARTS"===e)i=this.__cardView.flipParts(t,n);else if("GOLD"===e)i=this.__cardView.flipGold(t,n);else if("TOKENS"===e)i=this.__cardView.flipTokens(t,n);else if("goldMultipliers"===e)i=this.__cardView.flipGoldMultipliers(n);else if("slotUnlock"===e)i=this.__cardView.flipSlotUnlock(n);else{if("cards"!==e)throw new Error("Unknown reward type: "+e);var l=this.__cardParameters.cardTypes[t.id],h=!this.__playerManager.getCardAlreadyEarned(t.id);h&&this.__playerManager.addCardIdToEarnedCards(t.id),i=this.__cardView.flipCard(t,l,h,n),this.__setupCardEffects(l,h,n)}r.debug("Creating open promise");var u=this;i.then(function(){r.debug("Open promise done, show other stuff");var i=u.__arrRewardTypes.length-u.__currentRewardIdx-1;r.debug("Cards left: "+i);for(var n=(u.__giftType,x.GOLD,0);n<u.__arrCounterImages.length;n++)for(var s=u.__arrCounterImages[n],o=x.getValues(),a=0,l=o.length;a<l;++a){var h=o[a],c=u.__giftType===h;n===i&&c?s[u.__giftType].setVisibility(_.VISIBLE):s[u.__giftType].setVisibility(_.HIDDEN)}if("GOLD"===e||"PARTS"===e||"TOKENS"===e){"PARTS"===e?u.__cardView.getPartsSourceLocation(b):"GOLD"===e?u.__cardView.getGoldSourceLocation(b):u.__cardView.getTokensSourceLocation(b),r.debug("Showing currency type reward");var d=b.getX(),g=b.getY(),p=S[e];u.__walletView.gain(p,t,d,g)}u.__setCardRevealed()}),this.__cardView.getWidget().invalidate()},__setupCardEffects:function(e,t,i){var n=e.rarity,r=I.getSFX(n),s=this.__skipped?0:i+300+200+450;this.__sounds.play(r,{startTime:m.getTime()+s/1e3});var o=e.name,a=e.genericDescription,_=this;this.__createCallback(function(){_.__skipped||_.__showParticles(n)},i+300+200),this.__showNameAndDescription(o,a,i+300+200),t&&(this.__fadeIn(this.__cardNewGlow,i+300+200+250,500),this.__fadeInBlink(this.__cardNewLabel,300,i+300+200+500))},__showParticles:function(e){var t=this.__particleSystemsByCardRarity[e];if(t){this.__particleAnimation=this.__world.spawnEntity(t,{attachParent:this.__world.getScene().getRootComponent(),sortOrder:1});this.__particleAnimation.getComponent("ParticleSystemComponent").setSpawnPoint(0,-150)}},__clearParticles:function(){if(this.__particleAnimation){var e=this.__eventManager.getNewEvent(p);e.setEntityId(this.__particleAnimation.getId()),e.setDestroyedByPlayer(!1),this.__eventManager.triggerEvent(e),this.__particleAnimation=null}},__animateCurrentRewardOut:function(){this.__timeoutContext.clearTimeouts(),this.__hidingCurrentCard=!0,this.__sounds.play("card_fly_out"),this.__cardView.scaleOut(this.__skipped),this.__clearParticles(),this.__currentRewardComponents&&this.__currentRewardComponents.newLabel&&this.__scaleOutWidget(this.__currentRewardComponents.newLabel),this.__currentRewardComponents&&this.__currentRewardComponents.newGlow&&this.__scaleOutWidget(this.__currentRewardComponents.newGlow),this.__currentRewardIdx++,this.__createCallback(this.__showCurrentReward.bind(this),300)},__clicked:function(){if(!this.__isClosing){if(!this.__isOpened){var e=this.__giftBox.getComponent("SkeletonComponent");return e.playAnimation("Idle Open Front"),e.setEnabled(!1),void(this.__isOpened=!0)}this.__cardRevealed?this.__currentRewardIdx<this.__arrRewardTypes.length-1?this.__animateCurrentRewardOut():this.__dismissCard():this.__hidingCurrentCard||(this.__animations.length=0,this.__skipped=!0,this.__cardView.finishAnimations(),this.__setCardRevealed())}},__fadeInBlink:function(e,t,i){var n=new d,r=c.sequence(c.fadeTo(0,0),c.wait(i),c.callback(function(){e.setVisibility(_.VISIBLE)}),c.fadeTo(1,.7*t,u.startBounce),c.fadeTo(1,.3*t,u.bounceLoop));n.setAction(r),this.__animations.push(n),e.setTransform(n,!0)},__fadeIn:function(e,t,i){var n=new d,r=c.sequence(c.fadeTo(0,0),c.wait(i),c.callback(function(){e.setVisibility(_.VISIBLE)}),c.fadeTo(1,t,u.easeOut));n.setAction(r),this.__animations.push(n),e.setTransform(n,!0)},__dismissCard:function(){this.__isClosing||this.__skipped||(this.__isClosing=!0,this.__hidingCurrentCard=!1,this.__cardRevealed=!1,this.__skipped=!1,this.__sounds.play("card_fly_out"),this.__cardView.flyOutCard())},__createCallback:function(e,t){var i=new d,n=c.sequence(c.wait(t),c.callback(e));i.setAction(n),this.__animations.push(i)},__scaleOutWidget:function(e){var t,i=new d;t=this.__skipped?c.parallel(c.fadeTo(0,0)):c.sequence(c.parallel(c.scaleTo(2.4,2.4,200,u.interpolateCubic),c.fadeTo(0,200,u.interpolateCubic))),i.setAction(t),this.__animations.push(i),e.setTransform(i,!0)},__setCardRevealed:function(){r.debug("Setting card revealed"),this.__cardRevealed=!0;var e=this;this.__timeoutContext.setTimeout(function(){e.__skipped=!1,e.__animateCurrentRewardOut()},1e3)},__showNameAndDescription:function(e,t,i){var n=this;this.__cardNameLabel.setText(e),this.__cardDescriptionLabel.setText(t),this.__cardNameLabel.runAction(c.parallel(T.fadeInBlink(300,i),c.sequence(c.wait(i),c.callback(function(){n.__cardNameLabel.setVisibility(_.VISIBLE)})))),this.__cardDescriptionLabel.runAction(c.parallel(T.fadeInBlink(300,i+150),c.sequence(c.wait(i+150),c.callback(function(){n.__cardDescriptionLabel.setVisibility(_.VISIBLE)}))))},getWidget:function(){return this.__widget},update:function(e){if(this.__widget.getVisibility()===_.VISIBLE){this.__walletView.update(e),this.__cardView.update(e);for(var t=0,i=this.__animations.length;t<i;++t){this.__animations[t]&&this.__animations[t].update(e)}}},destroy:function(){for(var e in this.__particleSystemsByCardRarity){var t=this.__particleSystemsByCardRarity[e],i=this.__eventManager.getNewEvent(p);i.setEntityId(t.getId()),i.setDestroyedByPlayer(!1),this.__eventManager.triggerEvent(i)}this.__particleSystemsByCardRarity={}}}),i.exports.GiftTypeEnum=x}),define("events/GiftAvailableEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation","ui/views/OpenGiftView"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));e("thor/core/Validation"),e("ui/views/OpenGiftView").GiftTypeEnum;i.exports=n.generateEventClass("GiftAvailableEvent",1206164806,{giftType:function(e){}})}),define("raid/RaidManager",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","Constants","thor/config/Config","thor/util/Network","thor/util/JSONLoader","thor/util/StringUtil","thor/util/ModelUtils","ManagerRepository","thor/event/EventManager","thor/resources/ResourceManager","StorageManager","thor/analytics/Seidr","player/CurrencyTypeEnum","GameStats","./Raid","./RaidSpec","./RaidState","./RaidUpdatedEvent","./RewardInfo","ui/views/OpenGiftView","events/GiftAvailableEvent","SystemType","mission/MissionType"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=(e("Constants"),e("thor/config/Config")),a=e("thor/util/Network"),_=e("thor/util/JSONLoader"),l=e("thor/util/StringUtil"),h=e("thor/util/ModelUtils"),u=e("ManagerRepository"),c=(e("thor/event/EventManager"),e("thor/resources/ResourceManager"),e("StorageManager"),e("thor/analytics/Seidr")),d=e("player/CurrencyTypeEnum"),g=(e("GameStats"),e("./Raid")),p=e("./RaidSpec"),m=e("./RaidState"),f=e("./RaidUpdatedEvent"),v=e("./RewardInfo"),y=e("ui/views/OpenGiftView").GiftTypeEnum,E=e("events/GiftAvailableEvent"),S=e("SystemType"),T=e("mission/MissionType"),C=o.REST_SERVER_URL+"/raid",I=o.REST_SERVER_URL+"/raidReward?contextId={contextId}&playerId={playerId}&generations={generations}&cb={cb}",w=o.REST_SERVER_URL+"/raidReward",b=o.REST_SERVER_URL+"/raid/debug",M="raidParticipation";i.exports=n.create({initialize:function(e,t){this.__eventManager=e,this.__storageManager=t,this.__participation={},this.__raid=null,this.__handleRefreshRaid=this.__refreshRaid.bind(this),this.__handleRefresh=this.__refresh.bind(this),this.__specByType={},this.__leaderboard=[],this.__rewards=[],this.__pendingRewardInfo=v.DEFAULT_REWARD_INFO,this.__tier=0,this.__requirement=1},load:function(e){var t=this;return e.loader(_.RESOURCE_TYPE).load("data/raids","data/raids.json").then(function(e){var i=e.specs;for(var n in i){var r=i[n];t.__specByType[n]=new p(r)}t.__rewards=e.rewards})},getState:function(){return this.isPending()?m.PENDING:this.isComplete()?m.COMPLETED:m.ACTIVE},getRaid:function(){return this.__raid},isPending:function(){return!this.__raid||0===this.__raid.created||this.isExpired()},isExpired:function(){return this.__raid&&0!==this.__raid.end&&Date.now()>this.__raid.end},isComplete:function(){return this.__tier>this.getSpec().getMaxTier()},isRedeemable:function(){return this.isComplete()||this.isExpired()},getProgression:function(){var e=this.__raid?this.__raid.progress:0;return this.getSpec().getProgression(e)},getParticipationRewards:function(){for(var e=this,t=u.getPlayerManager(),i=t.getContextId(),n=t.getFacebookId(),s=this.__participation[i]||{},o=Object.keys(s),_=[],h=0,c=o.length;h<c;++h){var g=+o[h];(g<this.__raid.generation||g===this.__raid.generation&&this.isRedeemable())&&_.push(g)}var p=JSON.stringify(_),m=l.interpolate(I,{contextId:i,generations:p,playerId:n,cb:Date.now()});return a.getJSON(m).then(function(t){var i={gold:0,parts:0,tokens:0};for(var n in t){var s=t[n],o=e.__specByType[s.type];if(o){var a=o.getTier(s.progress),l=e.getRewards(a);if(l){i[d.nameFromValue(l.type).toLowerCase()]+=l.amount}}else r.warn("Unknown raid type",s.type)}e.__pendingRewardInfo=new v(i,_);e.__pendingRewardInfo;if(!e.__pendingRewardInfo.hasRewards()&&e.__pendingRewardInfo.isRedeemable())return e.redeem();if(e.__pendingRewardInfo.hasRewards()&&e.__pendingRewardInfo.isRedeemable()){var h=e.__eventManager.getNewEvent(E);return h.setGiftType(y.RAID),e.__eventManager.queueEvent(h),e.__pendingRewardInfo}return e.__pendingRewardInfo})},getTier:function(){return this.__tier},getRequirement:function(){return this.__requirement},getSpecs:function(){var e={};for(var t in this.__specByType)e[t]=this.__specByType[t].clone();return e},getRewards:function(e){return this.__rewards[e]},getPendingReward:function(){return this.__pendingRewardInfo},getSpec:function(){var e=this.__raid?this.__raid.type:-1,t=this.__specByType[e];return t?t:(r.warn("No raid spec for type",+e),p.NULL_INSTANCE)},getType:function(){return this.__raid.type},getLeaderboard:function(){return this.__leaderboard},redeem:function(){if(!this.__pendingRewardInfo)return Promise.resolve(null);var e=this,t={};for(var i in this.__participation){var n=this.__participation[i],o={};h.fromExistingWithDefaults(o,n,n),t[i]=o}for(var a=u.getPlayerManager(),i=a.getContextId(),_=a.getFacebookId(),n=t[i],l=0,c=this.__pendingRewardInfo.generations.length;l<c;++l){delete n[this.__pendingRewardInfo.generations[l]]}s.isNonEmptyObject(t[i])||delete t[i],r.debug("Redeeming",this.__pendingRewardInfo),r.debug("Participation",this.__participation,"-->",t);var d={};d[M]=t;var g=JSON.stringify(e.__pendingRewardInfo.generations);this.__pendingRewardInfo.rewards.parts;return a.addReward(this.__pendingRewardInfo.rewards,d).then(function(){return e.__post(w,{generations:g,contextId:i,playerId:_}),e.__participation=t,e.getParticipationRewards()})},shouldFetchRewards:function(){var e=u.getPlayerManager(),t=e.getContextId(),i=this.__participation[t]||{},n=Object.keys(i).map(function(e){return+e});if(0===n.length)return!1;var r=n.reduce(Math.max,-1);return r<this.__raid.generation||r===this.__raid.generation&&this.isComplete()},handleAuth:function(e){var t=e[M];this.__participation=t},refresh:function(){var e=u.getPlayerManager(),t=e.getContextId(),i=e.getFacebookId();return a.getJSON(C+"?contextId="+t+"&playerId="+i+"&cb="+Date.now()).then(this.__handleRefresh)},__refreshRaid:function(e){this.__raid=g.fromWire(e);var t=this.__specByType[this.__raid.type],i=this.__eventManager.getNewEvent(f);this.__eventManager.queueEvent(i),this.__tier=t.getTier(this.__raid.progress)+1,this.__requirement=t.getRequirement(this.__tier)},__refresh:function(e){return this.__refreshRaid(e.raid),this.__leaderboard=e.leaders,this.getParticipationRewards().then(function(){return e})},contribute:function(e){if(!u.getFUEManager().areRaidsEnabled())return Promise.resolve({raid:g.DEFAULT_RAID,leaders:[]});if(this.isComplete())return Promise.resolve({raid:this.__raid,leaders:this.__leaderboard,contribution:0});var t=this,i=this.getGeneration(),n=u.getPlayerManager(),s=n.getPlayer(),o=this.getContribution(e),a=(this.getTier(),n.getContextId());r.debug("Contributing",o,"to raid",a,i);var _=n.getFacebookId(),l=[this.__post(C,{contextId:a,playerId:_,generation:i,progress:o,shipId:s.equippedShipId,skinId:s.equippedSkinId,avatarUrl:n.getFacebookProfilePhotoUrl(),name:n.getName()})];if(!this.__participation[a]||!this.__participation[a][i]){var h=u.getStorageManager();if(this.__participation[a]||(this.__participation[a]={}),!this.__participation[a][i]){this.__participation[a][i]=!0;var d={};d[M]=this.__participation,l.push(h.setDataAsync(d))}}return Promise.all(l).then(function(e){var i=e[0],n=!t.isComplete();t.__refresh(i);var r=t.getProgression(),s=t.getSpec(),l=s.getMaxTier(),h=T.nameFromValue(t.__raid.type);if(r.progress===o&&c.event("Raid Start",{contextId:a,playerId:_,generation:t.__raid.generation,type:h}),n&&t.isComplete()){var u=r.progress-o;t.getSpec().getProgression(u).tier<l&&c.event("Raid Complete",{contextId:a,playerId:_,generation:t.__raid.generation,type:h})}return c.event("Raid Progression",{contextId:a,playerId:_,generation:t.__raid.generation,type:h,contribution:o,tier:r.tier+1,progress:r.progress,relativeProgress:r.relativeProgress,relativeRequirement:r.relativeRequirement}),{raid:i.raid,leaderboard:i.leaders,contribution:o}})},__trackParticipation:function(){var e=(u.getPlayerManager(),playerManger.getContextId()),t=this.__participation[e];return t||(t={},this.__participation[e]=t),t[this.__raid.generation]=!0,this.__storageManager.setDataAsync(M,this.__participation)},getContribution:function(e){var t=this.__raid.type;switch(t){case T.KILL_BRUISER:return e.kills.bruiser||0;case T.KILL_DESTROYER:return e.kills.destroyer||0;case T.KILL_FRIGATE:return e.kills.frigate||0;case T.KILL_BOSS:return e.kills.boss;case T.KILL_ENEMY:return e.totalKills;case T.COLLECT_GOLD:return e.goldDropsCollected;case T.COLLECT_POINTS:return e.scoreDropsCollected;case T.COLLECT_FUEL:return e.fuel;case T.GUN_UPGRADES:return e.upgradesByType[S.GUN];case T.MISSILE_UPGRADES:return e.upgradesByType[S.MISSILE];case T.COMPANION_UPGRADES:return e.upgradesByType[S.COMPANION];default:return r.error("Unknown mission type:",t),0}},getGeneration:function(){return this.__raid?this.__raid.generation:0},setRewards:function(e){this.__rewards=e},setSpecs:function(e){this.__specByType=e},debugGetLeaderboard:function(){return o.ENABLE_DEBUG_OVERLAY?this.__post(b+"/leaderboard",{contextId:u.getPlayerManager().getContextId(),count:5}):Promise.resolve([])},debugEnd:function(e){return o.ENABLE_DEBUG_OVERLAY?this.__post(b+"/end",{contextId:u.getPlayerManager().getContextId(),remaining:e}).then(this.__handleRefreshRaid):Promise.resolve([])},debugSetType:function(e){if(!o.ENABLE_DEBUG_OVERLAY)return Promise.resolve([])
;var t=this;return this.__post(b+"/type",{contextId:u.getPlayerManager().getContextId(),type:e}).then(function(e){return t.__raid=g.fromWire(e),t.__raid})},debugContribute:function(e,t,i,n){if(!o.ENABLE_DEBUG_OVERLAY)return Promise.resolve([]);var r=this,s=u.getPlayerManager();s.getPlayer();this.__post(C,{contextId:s.getContextId(),playerId:e,name:e,avatarUrl:"https://placekitten.com/g/120/120",generation:this.__raid.generation,progress:t,shipId:i,skinId:n}).then(this.__handleRefresh).then(function(t){return e===s.getFacebookId()?r.debugParticipate(r.__raid.generation):t})},debugParticipate:function(){if(!o.ENABLE_DEBUG_OVERLAY)return Promise.resolve(this.__pendingRewardInfo);var e=this;Array.prototype.forEach.call(arguments,function(t){e.__participation[0]||(e.__participation[0]={}),e.__participation[0][t]=!0}),u.getStorageManager().setDataAsync({raidParticipation:this.__participation}).then(e.getParticipationRewards.bind(e))},__post:function(e,t){var i=Object.keys(t).map(function(e){return e+"={"+e+"}"}).join("&"),n=l.interpolate(i,t);return a.request("POST",e,{contentType:"application/x-www-form-urlencoded",responseType:"json",body:n}).then(function(e){return e.response})}}),i.exports.STORAGE_KEY=M,i.exports.UNLOCK_LEVEL=5}),define("FUEManager",["require","exports","module","thor/core/Class","thor/core/Logger","thor/config/Config","thor/core/Validation","thor/util/JSONLoader","thor/resources/ResourceManager","thor/platforms/Google","thor/analytics/Seidr","gameplay/Level","ManagerRepository","mission/MissionSet","events/GameStartingEvent","raid/RaidManager"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=(e("thor/config/Config"),e("thor/core/Validation")),o=e("thor/util/JSONLoader"),a=(e("thor/resources/ResourceManager"),e("thor/platforms/Google")),_=e("thor/analytics/Seidr"),l=(e("gameplay/Level"),e("ManagerRepository")),h=e("mission/MissionSet"),u=e("events/GameStartingEvent"),c=e("raid/RaidManager"),d=["none","Completed collect fuel mission","Killed miniboss","Opened first gacha box","Equipped and upgraded first card","First run after upgrading first card","Opened first daily gift","Started first post-FUE run","Ended first post-FUE run"];i.exports=n.create({initialize:function(e){this.__leveledUpCard=!1,this.__equippedCard=!1,this.__resourceManager=e,this.__levelNameByCheckpoint={},this.__tooltipsByCheckpoint={},this.__showInitialEndGameFlow=!1,this.__isLaserEnabled=!1,this.__wasInEquipSequence=!1,l.getEventManager().registerEventHandler(u.EVENT_TYPE,this.__handleGameStartingEvent.bind(this))},load:function(){var e=this;return this.__resourceManager.loader(o.RESOURCE_TYPE).load("data/fue","data/fue.json").then(function(t){return r.debug("Loaded FUE data: ",t),e.__levelNameByCheckpoint=t.levelsByCheckpoint,e.__tooltipsByCheckpoint=t.tooltipsByCheckpoint,e.__verifyCurrentFUEState()})},__verifyCurrentFUEState:function(){var e=l.getPlayerManager(),t=e.getFueCheckpoint();switch(t){case 4:var i=e.getOwnedCards(),n=e.getPlayerTokens();if(i.length<=0)return e.addTokens(0===n?1:0).then(function(){return e.setFueCheckpoint(t-1)});break;case 3:var i=e.getOwnedCards(),n=e.getPlayerTokens();if(i.length>=1)return e.setFueCheckpoint(t+1);if(n<=0)return e.addTokens(1)}return Promise.resolve(!0)},shouldShowPlayDialog:function(){return!l.getPlayerManager().canSkipFue()&&5===l.getPlayerManager().getFueCheckpoint()},startRun:function(){var e=l.getPlayerManager();if(this.shouldShowPlayDialog()||7===e.getFueCheckpoint()){var t=e.getFueCheckpoint();e.setFueCheckpoint(t+1)}this.__updatePerRunSettings()},endRun:function(){var e=l.getPlayerManager();if(8===e.getFueCheckpoint()){var t=e.getFueCheckpoint();e.setFueCheckpoint(t+1)}this.__updatePerRunSettings()},__updatePerRunSettings:function(){this.__isLaserEnabled=this.__computeIsLaserEnabled()},isFUEComplete:function(){return!!l.getPlayerManager().canSkipFue()||l.getPlayerManager().getFueCheckpoint()>=7},getCurrentLevelName:function(){if(l.getPlayerManager().canSkipFue())return"levels/GalatronVS Quicksilver/level";var e=l.getPlayerManager().getFueCheckpoint();return this.__levelNameByCheckpoint[""+e]||"levels/GalatronVS Quicksilver/level"},getTooltips:function(){if(!l.getPlayerManager().canSkipFue()){var e=l.getPlayerManager().getFueCheckpoint();return this.__tooltipsByCheckpoint[""+e]}},areReplaysEnabled:function(){return!!l.getPlayerManager().canSkipFue()||l.getPlayerManager().getFueCheckpoint()>=6},isAchievementTrackingEnabled:function(){return!!l.getPlayerManager().canSkipFue()||l.getPlayerManager().getFueCheckpoint()>=5},isMissionResetEnabled:function(e){return s.ifDefined.assertIsObject(e),!!l.getPlayerManager().canSkipFue()||(e||(e=l.getMissionManager().getMissionSet()),e.getLifetimeCompletedMissions()>=h.MISSIONS_PER_SET)},showShortenedMissionProgress:function(){return!l.getPlayerManager().canSkipFue()&&l.getPlayerManager().getFueCheckpoint()<5},isCardScrappingEnabled:function(){return!!l.getPlayerManager().canSkipFue()||l.getPlayerManager().getFueCheckpoint()>=6},completedMission:function(){var e=l.getPlayerManager(),t=e.getFueCheckpoint();1===t&&(e.setFueCheckpoint(t+1),this.__showInitialEndGameFlow=!0)},hasOpenedFUEGacha:function(){return!l.getPlayerManager().canSkipFue()&&3===l.getPlayerManager().getFueCheckpoint()},isDailyGiftCheckpoint:function(){return!l.getPlayerManager().canSkipFue()&&6===l.getPlayerManager().getFueCheckpoint()},hasOpenedFUEDailyGift:function(){return!l.getPlayerManager().canSkipFue()&&!!this.isDailyGiftCheckpoint()},shouldExplainMissions:function(){return!l.getPlayerManager().canSkipFue()&&6===l.getPlayerManager().getFueCheckpoint()},isContinueEnabled:function(){return!!l.getPlayerManager().canSkipFue()||l.getPlayerManager().getFueCheckpoint()>=5},shouldShowInitialEndGameFlow:function(){return!l.getPlayerManager().canSkipFue()&&(2===l.getPlayerManager().getFueCheckpoint()&&this.__showInitialEndGameFlow)},shouldShowFakeFacebookPlayButton:function(){return!l.getPlayerManager().canSkipFue()&&l.getPlayerManager().getFueCheckpoint()<3},showMissionIntro:function(){return!!l.getPlayerManager().canSkipFue()||l.getPlayerManager().getFueCheckpoint()>=4},killedMiniboss:function(){var e=l.getPlayerManager(),t=e.getFueCheckpoint();2===t&&e.setFueCheckpoint(t+1)},__computeIsLaserEnabled:function(){return!!l.getPlayerManager().canSkipFue()||l.getPlayerManager().getFueCheckpoint()>=3},isLaserEnabled:function(){return this.__isLaserEnabled},isInEquipSequence:function(){return!l.getPlayerManager().canSkipFue()&&4===l.getPlayerManager().getFueCheckpoint()},tryFinishEquipSequence:function(){if(this.isInEquipSequence()){var e=l.getPlayerManager(),t=e.getFueCheckpoint(),i=this;return e.setFueCheckpoint(t+1).then(function(){i.setWasInEquipSequence(!0)})}return Promise.resolve()},setWasInEquipSequence:function(e){this.__wasInEquipSequence=e},wasInEquipSequence:function(){return this.__wasInEquipSequence},isSlowRunIntro:function(){return!l.getPlayerManager().canSkipFue()&&l.getPlayerManager().getFueCheckpoint()<4},__handleGameStartingEvent:function(e){this.__showInitialEndGameFlow=!1},isFingerAnimationEnabled:function(){return!l.getPlayerManager().canSkipFue()&&l.getPlayerManager().getFueCheckpoint()<2},areRaidsEnabled:function(){var e=l.getPlayerManager();if(e.canSkipFue())return!0;var t=e.getFueCheckpoint();return e.getPlayerLevel()>=c.UNLOCK_LEVEL&&t>=6},isSlowerMotionEnabled:function(){return!!l.getPlayerManager().canSkipFue()||l.getPlayerManager().getFueCheckpoint()<3},hasLeveledUpCard:function(){return this.__leveledUpCard},hasEquippedCard:function(){return this.__equippedCard},setLeveledUpCard:function(e){this.__leveledUpCard=e},setEquippedCard:function(e){this.__equippedCard=e},shouldShowLootDialog:function(){if(l.getPlayerManager().canSkipFue())return!1;var e=l.getPlayerManager().getFueCheckpoint(),t=l.getPlayerManager().getPlayerTokens();return 3===e&&t>=1},trackCheckpointComplete:function(e){var t=l.getPlayerManager();if(!t.canSkipFue()){t.getFueCheckpoint()===e&&(a.trackEvent("gqs","Tutorial Step Event",{contextId:t.getContextId(),step:e}),_.event("Tutorial Step Event",{contextId:t.getContextId(),step:e,description:d[e]}))}}}),i.exports.MAX_FUE_CHECKPOINT=7}),define("TestManager",["require","exports","module","thor/core/Class","thor/core/Logger","thor/config/Config","thor/entity/Entity","thor/core/Validation","thor/util/JSONLoader","thor/resources/ResourceManager"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=(e("thor/config/Config"),e("thor/entity/Entity"),e("thor/core/Validation"),e("thor/util/JSONLoader"));e("thor/resources/ResourceManager");i.exports=n.create({initialize:function(e){this.__resourceManager=e,this.__testDataByName={}},load:function(){var e=this;return this.__resourceManager.loader(s.RESOURCE_TYPE).load("data/tests","data/tests.json").then(function(t){return e.__testDataByName=e.__convertTestsData(t),r.debug("Loaded tests: ",e.__testDataByName),t})},__convertTestsData:function(e){for(var t={},i=e.tests,n=0,r=i.length;n<r;n++){var s=i[n];t[s.name]=s}return t},getAllTestData:function(){return this.__testDataByName},getTestData:function(e){return this.__testDataByName[e]},getValueForTestGroup:function(e,t){for(var i=e.cohorts,n=0,r=i.length;n<r;n++){var s=i[n];if(s.groups.indexOf(t)!==-1)return s.value}},getCohortData:function(e,t){if(t<0||t>=12)throw new Error("Invalid test group Number: "+t);var i=this.__testDataByName[e];if(!i)return r.warn("Tried to get cohort data for a test that doesn't exist: ",e),null;for(var n=i.cohorts,s=0,o=n.length;s<o;s++){var a=n[s];if(a.groups.indexOf(t)!==-1)return a}return r.warn("Test `"+e+"` does not have an entry for test group `"+t+"`"),null},getTestNames:function(){return Object.keys(this.__testDataByName)}}),i.exports.NUM_TEST_GROUPS=12}),define("player/Player",["require","exports","module","thor/core/Class","thor/core/Validation","thor/util/StringUtil","ManagerRepository","FUEManager","TestManager","player/CurrencyTypeEnum"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/util/StringUtil"),o=(e("ManagerRepository"),e("FUEManager")),a=e("TestManager"),_=e("player/CurrencyTypeEnum"),l=n.create({initialize:function(e,t,i,n,r,s,o,a,l,h,u,c,d,g){this.playerId=e,this.level=t,this.xp=i,this.currencies={},this.currencies[_.GOLD]=n,this.currencies[_.PARTS]=r,this.currencies[_.TOKENS]=s,this.equippedSkinId=o,this.equippedShipId=a,this.goldMultipliers=l,this.finishedGameCount=h,this.testingGroup=u,this.fueCheckpoint=c,this.skipFue=d,this.giveGift=g}});l.calculateTestGroup=function(e){var t=s.fnv1aHash(e);return t<0&&(t=-t),t%a.NUM_TEST_GROUPS},l.fromWire=function(e){var t=e.playerId||"0",i=e.level||1,n=e.xp||0,s=e.gold||_.DEFAULT_CURRENCY_AMOUNTS[_.GOLD],a=e.parts||_.DEFAULT_CURRENCY_AMOUNTS[_.PARTS],h=e.tokens||_.DEFAULT_CURRENCY_AMOUNTS[_.TOKENS],u=e.equippedSkinId||1,c=e.equippedShipId||1,d=e.goldMultipliers||0,g=e.finishedGameCount||0,p=r.isNumber(e.testingGroup)?e.testingGroup:l.calculateTestGroup(t),m=e.fueCheckpoint||o.MAX_FUE_CHECKPOINT,f=!r.isBoolean(e.skipFue)||e.skipFue;return new l(t,i,n,s,a,h,u,c,d,g,p,m,f,r.isBoolean(e.giveGift)?e.giveGift:f)},l.toWire=function(e){return{playerId:e.playerId,level:e.level,xp:e.xp,gold:e.currencies[_.GOLD],parts:e.currencies[_.PARTS],tokens:e.currencies[_.TOKENS],equippedSkinId:e.equippedSkinId,equippedShipId:e.equippedShipId,goldMultipliers:e.goldMultipliers,finishedGameCount:e.finishedGameCount,testingGroup:e.testingGroup,fueCheckpoint:e.fueCheckpoint,skipFue:e.skipFue,giveGift:e.giveGift}},l.createDefaultPlayer=function(e){return new l(e,1,0,_.DEFAULT_CURRENCY_AMOUNTS[_.GOLD],_.DEFAULT_CURRENCY_AMOUNTS[_.PARTS],_.DEFAULT_CURRENCY_AMOUNTS[_.TOKENS],1,1,0,0,l.calculateTestGroup(e),1,!1,!1)},l.DEFAULT_SHIP_ID=1,l.DEFAULT_SKIN_ID=1,l.DEFAULT_LEVEL=1,l.DEFAULT_XP=0,l.DEFAULT_NUM_UPGRADE_SLOTS=1,l.DEFAULT_GOLD_MULTIPLIERS=0,l.MAX_UPGRADE_SLOTS=4,l.DEFAULT_NUM_CARD_SLOTS=1,l.MAX_CARD_SLOTS=4,l.MAX_GOLD_MULTIPLIERS=5,l.DEFAULT_FINISHED_GAME_COUNT=0,l.DEFAULT_FUE_CHECKPOINT=1,l.DEFAULT_SKIP_FUE=!1,i.exports=l}),define("player/PlayerLevelRewardEnum",["require","exports","module","thor/core/Enum","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Enum"),r=(e("thor/core/Validation"),n.create("PlayerLevelRewardEnum",{UPGRADE_SLOT:1,COIN_MULTIPLIER:2,CARD_SLOT:3,PARTS:4,CARD:5,TOKENS:6,GUN_POWERUP:7,MISSILE_POWERUP:8,COMPANION_POWERUP:9}));i.exports=r;var s={};s[r.UPGRADE_SLOT]=!1,s[r.COIN_MULTIPLIER]=!0,s[r.CARD_SLOT]=!1,s[r.PARTS]=!0,s[r.CARD]=!0,s[r.TOKENS]=!0,s[r.GUN_POWERUP]=!1,s[r.MISSILE_POWERUP]=!1,s[r.COMPANION_POWERUP]=!1,i.exports.HAS_VALUE=s;var o={};o[r.UPGRADE_SLOT]=!0,o[r.COIN_MULTIPLIER]=!0,o[r.CARD_SLOT]=!0,o[r.PARTS]=!0,o[r.CARD]=!1,o[r.TOKENS]=!0,o[r.GUN_POWERUP]=!0,o[r.MISSILE_POWERUP]=!0,o[r.COMPANION_POWERUP]=!0,i.exports.EDITABLE=o,i.exports.isPowerUp=function(e){var t=r[e];return t===r.GUN_POWERUP||t===r.MISSILE_POWERUP||t===r.COMPANION_POWERUP}}),define("events/PlayerUpdatedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","player/Player"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));e("player/Player");i.exports=n.generateEventClass("PlayerUpdatedEvent",1206164802,{player:function(e){}},!0)}),define("events/FirstGiftAvailableEvent",["require","exports","module","thor/core/Class","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));i.exports=n.generateEventClass("FirstGiftAvailableEvent",2406455511,{},!0)}),define("events/GainedGoldMultipliersEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event")),r=e("thor/core/Validation");i.exports=n.generateEventClass("GainedGoldMultipliersEvent",4022957538,{amount:r.assertIsNumber})}),define("player/PlayerManager",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/debug/FPSTracker","thor/math/MathHelper","thor/util/JSONLoader","thor/util/LocalStorage","thor/event/EventManager","thor/resources/ResourceManager","thor/platforms/Google","thor/analytics/Seidr","cards/CardEffectEnum","SystemType","thor/config/Config","player/Player","FUEManager","Constants","gameplay/Tournament","cards/CardInstance","cards/CardParameters","player/PlayerLevelRewardEnum","StorageManager","ManagerRepository","GameStats","events/GainedXPEvent","events/GainedGoldEvent","events/GainedPartsEvent","events/GainedTokensEvent","events/PlayerUpdatedEvent","events/FirstGiftAvailableEvent","events/GainedGoldMultipliersEvent","thor/graphics/resources/TextureRegionResource","thor/graphics/imagecache/ImageCache","thor/webgl/WebGLRenderingSession","player/CurrencyTypeEnum"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Device"),s=e("thor/core/Logger").getLogger(i),o=e("thor/core/Validation"),a=(e("thor/debug/FPSTracker").FPSStats,e("thor/math/MathHelper"),e("thor/util/JSONLoader")),_=e("thor/util/LocalStorage"),l=(e("thor/event/EventManager"),e("thor/resources/ResourceManager"),e("thor/platforms/Google")),h=e("thor/analytics/Seidr"),u=(e("cards/CardEffectEnum"),e("SystemType")),c=(e("thor/config/Config"),e("player/Player")),d=e("FUEManager"),g=e("Constants"),p=(e("gameplay/Tournament"),e("cards/CardInstance")),m=(e("cards/CardParameters"),e("player/PlayerLevelRewardEnum")),f=(e("StorageManager"),e("ManagerRepository")),v=(e("GameStats"),e("events/GainedXPEvent")),y=e("events/GainedGoldEvent"),E=e("events/GainedPartsEvent"),S=e("events/GainedTokensEvent"),T=e("events/PlayerUpdatedEvent"),C=e("events/FirstGiftAvailableEvent"),I=e("events/GainedGoldMultipliersEvent"),w=e("thor/graphics/resources/TextureRegionResource"),b=e("thor/graphics/imagecache/ImageCache"),M=(e("thor/webgl/WebGLRenderingSession"),e("player/CurrencyTypeEnum")),x=u.GUN|u.MISSILE|u.COMPANION;i.exports=n.create({initialize:function(e,t,i,n){this.__resourceManager=e,this.__eventManager=t,this.__storageManager=i,this.__shipSkinManager=null,this.__giftManager=null,this.__player=null,this.__cardParameters=null,this.__playerShips=[],this.__playerLevelXP=[],this.__rewardsByPlayerLevel={},this.__currentLevelBonuses={numCardSlots:c.DEFAULT_NUM_CARD_SLOTS,numUpgradeSlots:c.DEFAULT_NUM_UPGRADE_SLOTS,lockedUpgrades:x},this.__ownedCards=[],this.__earnedCards=[],this.__equippedCards=[null,null,null,null],this.__imageCache=new b(n)},load:function(){var e=this;return this.__resourceManager.loader(a.RESOURCE_TYPE).load("data/player_data","data/player_data.json").then(function(t){return s.debug("Loaded player data: ",t),e.__playerLevelXP=t.levels,e.__rewardsByPlayerLevel=e.__convertRewardsArrayToObject(t.rewards),t})},getPlayerShips:function(){return this.__playerShips},getPlayer:function(){return this.__player},shouldGiveGift:function(){return this.__player.giveGift},giveGift:function(){var e=this,t=c.toWire(this.__player);return t.tokens+=3,t.giveGift=!1,this.__storageManager.setDataAsync({player:t}).then(function(){return e._setPlayer(c.fromWire(t)),e._updateTokens(t.tokens),!0})},getPlayerCurrency:function(e){return this.__player.currencies[e]},getPlayerGold:function(){return this.getPlayerCurrency(M.GOLD)},getPlayerParts:function(){return this.getPlayerCurrency(M.PARTS)},getPlayerTokens:function(){return this.getPlayerCurrency(M.TOKENS)},getPlayerCardSlots:function(){return this.__currentLevelBonuses.numCardSlots},getLockedUpgrades:function(){return this.__currentLevelBonuses.lockedUpgrades},adjustPlayerParts:function(e){var t=this,i=c.toWire(this.__player);return i.parts+=e,this.__storageManager.setDataAsync({player:i}).then(function(){t._updateParts(i.parts)})},_setCards:function(e){this.__ownedCards=e,this.__equippedCards=[null,null,null,null];for(var t=0;t<this.__ownedCards.length;++t){var i=this.__ownedCards[t];i.equipped&&(this.__equippedCards[i.equippedSlotIndex]=i,i.newFlag=!1)}var n=this.__eventManager.getNewEvent(T);n.setPlayer(this.__player),this.__eventManager.queueEvent(n)},_setEarnedCards:function(e){this.__earnedCards=e},_setPlayer:function(e){this._update(e)},getPlayerLevel:function(){return this.__player.level},getPlayerXP:function(){return this.__player.xp},getTestingGroup:function(){return this.__player.testingGroup},getFueCheckpoint:function(){return this.canSkipFue()?d.MAX_FUE_CHECKPOINT:this.__player.fueCheckpoint},canSkipFue:function(){return this.__player.skipFue},setTestingGroup:function(e){var t=this,i=c.toWire(this.__player);return i.testingGroup=e,this.__storageManager.setDataAsync({player:i}).then(function(){return t._setPlayer(c.fromWire(i)),i})},getTestStatus:function(e){var t=this.getTestingGroup();return f.getTestManager().getValueForTestGroup(e,t)},getAllPlayerLevels:function(){return this.__playerLevelXP},setAllPlayerLevels:function(e){this.__playerLevelXP=e},needsToDoFirstRun:function(){return this.__player.skipFue&&0===this.__player.finishedGameCount&&this.__player.xp<=0&&this.__player.currencies[M.GOLD]<=M.DEFAULT_CURRENCY_AMOUNTS[M.GOLD]},__convertRewardsObjectToArray:function(e){var t=[];for(var i in e)for(var n=e[i],r=+i,s=0,a=n.length;s<a;s++){var _=n[s],l={type:m.nameFromValue(_.type),level:r};o.isDefined(_.value)&&(l.value=_.value),t.push(l)}return t},__convertRewardsArrayToObject:function(e){for(var t={},i=0,n=e.length;i<n;i++){var r=e[i],s=r.level,a=t[s];o.isArray(a)||(a=[],t[s]=a),a.push({type:m[r.type.toUpperCase()],value:r.value})}return t},getAllPlayerRewards:function(){return this.__convertRewardsObjectToArray(this.__rewardsByPlayerLevel)},setAllPlayerRewards:function(e){this.__rewardsByPlayerLevel=this.__convertRewardsArrayToObject(e)},isMaxLevel:function(e){return o.ifDefined.assertIsNumber(e),o.isDefined(e)||(e=this.__player.level),e>this.__playerLevelXP.length},getXPInLevel:function(e){if(o.ifDefined.assertIsNumber(e),o.isDefined(e)||(e=this.__player.level),e>this.__playerLevelXP.length)return 1/0;var e=Math.max(1,e);return this.__playerLevelXP[e-1]},getLevelRewards:function(e){o.ifDefined.assertIsNumber(e),o.isDefined(e)||(e=this.__player.level);var t=this.__rewardsByPlayerLevel[e];t=t?t.slice(0):[];var i=this.__cardParameters.cardTypes;for(var n in i){e===i[n].minPlayerLevel&&t.push({type:m.CARD,value:+n})}return t},addXP:function(e){var t=this,i=c.toWire(this.__player),n=i.level;if(this.isMaxLevel(n))return Promise.resolve([]);var r=this.getXPInLevel(n);i.xp+=e;for(var s=0,o=0,a=this.__currentLevelBonuses.numCardSlots,_=this.__currentLevelBonuses.numUpgradeSlots,d=this.__currentLevelBonuses.lockedUpgrades;i.xp>=r;){for(var g=this.getLevelRewards(i.level+1),p=0,f=g.length;p<f;p++){var y=g[p];y.type===m.PARTS?s+=y.value:y.type===m.TOKENS?o+=y.value:y.type===m.UPGRADE_SLOT?_=Math.min(numUpgradesSlots+1,c.MAX_UPGRADE_SLOTS):y.type===m.CARD_SLOT?a=Math.min(a+1,c.MAX_CARD_SLOTS):y.type===m.COIN_MULTIPLIER?i.goldMultipliers=c.MAX_GOLD_MULTIPLIERS:y.type===m.GUN_POWERUP?d&=~u.GUN:y.type===m.MISSILE_POWERUP?d&=~u.MISSILE:y.type===m.COMPANION_POWERUP&&(d&=~u.COMPANION)}i.xp-=r,i.level++,r=this.getXPInLevel(i.level),this.isMaxLevel(i.level)&&(i.xp=0),l.trackEvent("gqs","Level Change",{playerLevel:i.level,playerXP:i.xp,gold:i.gold,xpGained:e}),h.event("Level Change",{contextId:this.getContextId(),playerLevel:i.level,playerXP:i.xp,gold:i.gold,xpGained:e})}i.parts+=s,i.tokens+=o;var E=i.level;return this.__storageManager.setDataAsync({player:i}).then(function(){t._setPlayer(c.fromWire(i)),t.__currentLevelBonuses.numCardSlots=a,t.__currentLevelBonuses.numUpgradeSlots=_,t.__currentLevelBonuses.lockedUpgrades=d;for(var r=[],l=n;l<E;l++)r.push({level:l+1,rewards:t.getLevelRewards(l+1)});var h=t.__eventManager.getNewEvent(v);return h.setXp(i.xp),h.setXpGained(e),h.setLevel(i.level),h.setLevelsGained(E-n),h.setLevelGains(r),t.__eventManager.queueEvent(h),s>0&&t._updateParts(i.parts),o>0&&t._updateTokens(i.tokens),r})},serializePlayerLevels:function(){var e=this.__playerLevelXP,t=this.__convertRewardsObjectToArray(this.__rewardsByPlayerLevel);return JSON.stringify({levels:e,rewards:t},null,2)},_update:function(e){this.__player=e;var t=this.__eventManager.getNewEvent(T);t.setPlayer(this.__player),this.__eventManager.queueEvent(t)},_updateParts:function(e){var t=this.__eventManager.getNewEvent(E);t.setAmount(e),this.__eventManager.queueEvent(t),this.__player.currencies[M.PARTS]=e,this._update(this.__player)},_updateGold:function(e){var t=this.__eventManager.getNewEvent(y);t.setAmount(e),this.__eventManager.queueEvent(t),this.__player.currencies[M.GOLD]=e,this._update(this.__player)},_updateGoldMultipliers:function(e){var t=this.__eventManager.getNewEvent(I);t.setAmount(e),this.__eventManager.queueEvent(t),this.__player.goldMultipliers=e,this._update(this.__player)},_updateTokens:function(e){var t=this.__eventManager.getNewEvent(S);t.setAmount(e),this.__eventManager.queueEvent(t),this.__player.currencies[M.TOKENS]=e,this._update(this.__player)},_updateLevelBonuses:function(){for(var e=this.getPlayerLevel(),t=c.DEFAULT_NUM_CARD_SLOTS,i=c.DEFAULT_NUM_UPGRADE_SLOTS,n=x,r=1;r<=e;++r)for(var s=this.getLevelRewards(r),o=0,a=s.length;o<a;++o){var _=s[o];switch(_.type){case m.UPGRADE_SLOT:i=Math.min(i+1,c.MAX_UPGRADE_SLOTS);break;case m.CARD_SLOT:t=Math.min(t+1,c.MAX_CARD_SLOTS);break;case m.GUN_POWERUP:n&=~u.GUN;break;case m.MISSILE_POWERUP:n&=~u.MISSILE;break;case m.COMPANION_POWERUP:n&=~u.COMPANION}}this.__currentLevelBonuses.numCardSlots=t,this.__currentLevelBonuses.numUpgradeSlots=i,this.__currentLevelBonuses.lockedUpgrades=n},setShipSkinManager:function(e){this.__shipSkinManager=e},setGiftManager:function(e){this.__giftManager=e},setAchievementManager:function(e){this.__achievementManager=e},setMissionManager:function(e){this.__missionManager=e},getFacebookId:function(){if(window.isFacebook())return FBInstant.player.getID();var e=_.getItem("BVG_ID");return e||(e="bvg-"+~~(1e9*Math.random()),_.setItem("BVG_ID",e)),e},getName:function(){return window.isFacebook()?FBInstant.player.getName():this.getFacebookId()},getFacebookProfilePhotoUrl:function(){return window.isFacebook()?FBInstant.player.getPhoto():"https://placekitten.com/120/120"},getPlayerProfileImage:function(){return this.__getImage(this.getFacebookProfilePhotoUrl())},getProfileImage:function(e){return this.__getImage(e)},getDefaultProfileImage:function(){return this.__getImage()},__getImage:function(e){if(!o.isNonEmptyString(e)){var t=this.__resourceManager.get(w.RESOURCE_TYPE,"dummyprofile");return Promise.resolve(t)}var i=this;return this.__imageCache.getCachedImage(e,{maxWidth:140,maxHeight:140}).then(function(e){return Promise.resolve(e)}).catch(function(e){s.error("Failed to load player profile image: "+e);var t=i.__resourceManager.get(w.RESOURCE_TYPE,"dummyprofile");return Promise.resolve(t)})},getContextId:function(){return FBInstant.context.getID()||"0"},authenticate:function(){var e,t=this,i=!1,n=["player","ships","gift","achievements","ownedCards","earnedCards","mission_set","raidParticipation"];return this.__storageManager.getDataAsync(n).then(function(n){var r={},s=n.player;if(!o.isObject(s)){i=!0;var a=c.createDefaultPlayer(t.getFacebookId()),_=c.toWire(a);r.player=_,n.player=_}var l=n.ships;if(!o.isArray(l)){var h=t.__shipSkinManager.getDefaultShipsAndSkins();r.ships=h,n.ships=h}var u=n.gift;if(!o.isObject(u)&&(n.player.finishedGameCount>0||n.player.xp>0||n.player.gold>0)){var d=t.__giftManager.getDefaultGift();r.gift=d,n.gift=d}var g=n.achievements;if(!o.isObject(g)){var p={};r.achievements=p,n.achievements=p}var m=n.ownedCards;if(!o.isArray(m)){var f=[];r.ownedCards=f,n.ownedCards=f}var v=n.earnedCards;if(!o.isArray(v)){var y=[];r.earnedCards=y,n.earnedCards=y}var E=n.raidParticipation;if(!o.isObject(E)){var S={};r.raidParticipation=S,n.raidParticipation=S}return e=n,o.isNonEmptyObject(r)?t.__storageManager.setDataAsync(r):n}).then(function(){t.__playerShips=e.ships;var n=c.fromWire(e.player);t._setPlayer(n),l.trackEvent("gqs","Session Start",{playerLevel:t.getPlayerLevel(),playerXP:t.getPlayerXP(),gold:t.getPlayerGold(),isFirstSession:i?1:0,testingGroup:t.getTestingGroup()}),h.event("Session Start",{contextId:t.getContextId(),playerLevel:t.getPlayerLevel(),playerXP:t.getPlayerXP(),gold:t.getPlayerGold(),isFirstSession:i?1:0,testingGroup:t.getTestingGroup(),version:window.VERSION,userAgent:navigator.userAgent});var r=e.ownedCards.map(p.fromWire);t._setCards(r);var s=e.earnedCards;return t._setEarnedCards(s),e})},getContextType:function(){return window.isFacebook()?FBInstant.context.getType():"openweb"},trackSessionInitialized:function(){l.trackEvent("gqs","Session Initialized",{}),h.event("Session Initialized",{contextId:this.getContextId(),testingGroup:this.getTestingGroup(),contextType:this.getContextType(),version:window.VERSION,userAgent:navigator.userAgent})},finalizePlayerLogin:function(){this._updateLevelBonuses()},startGame:function(){return Promise.resolve({gameStarted:!0,token:"game-token"+~~(1e4*Math.random())})},addAndSetGiftContents:function(e,t,i,n){o.ifDefined.assertIsBoolean(n);var r=this,s=c.toWire(this.__player);return s.gold+=e,s.goldMultipliers=Math.min(s.goldMultipliers+t,c.MAX_GOLD_MULTIPLIERS),n&&s.fueCheckpoint++,this.__storageManager.setDataAsync({player:s,gift:i}).then(function(){return r._updateGold(s.gold),r._updateGoldMultipliers(s.goldMultipliers),r.__player.fueCheckpoint=s.fueCheckpoint,l.trackEvent("gqs","Daily Shipment Collected",{playerLevel:r.getPlayerLevel(),playerXP:r.getPlayerXP(),gold:s.gold,goldGained:e}),h.event("Daily Shipment Collected",{contextId:r.getContextId(),playerLevel:r.getPlayerLevel(),playerXP:r.getPlayerXP(),gold:s.gold,goldGained:e}),!0})},addReward:function(e,t){o.ifDefined.assertIsNonEmptyObject(t);var i=this;if(t||(t={}),e.gold|e.parts|e.tokens){var n=c.toWire(this.__player);n.gold+=e.gold,n.parts+=e.parts,n.tokens+=e.tokens,t.player=n}return this.__storageManager.setDataAsync(t).then(function(t){return e.gold&&i._updateGold(n.gold),e.parts&&i._updateParts(n.parts),e.tokens&&i._updateTokens(n.tokens),t})},addGold:function(e){var t=this,i=c.toWire(this.__player);return i.gold+=e,this.__storageManager.setDataAsync({player:i}).then(function(){return t._updateGold(i.gold),!0})},addTokens:function(e){var t=this,i=c.toWire(this.__player);return i.tokens+=e,this.__storageManager.setDataAsync({player:i}).then(function(){return t._updateTokens(i.tokens),!0})},spendGold:function(e,t){o.ifDefined.assertIsNonEmptyString(t);var i=this;if(this.__player.currencies[M.GOLD]<e)return Promise.resolve(!1);var n=c.toWire(this.__player);return n.gold-=e,this.__storageManager.setDataAsync({player:n}).then(function(){return l.trackEvent("gqs","Coin Purchase",{playerLevel:i.getPlayerLevel(),playerXP:i.getPlayerXP(),gold:i.getPlayerGold(),cost:e,item:g.TRACKING_ITEM_IDS.unknown}),h.event("Coin Purchase",{contextId:i.getContextId(),playerLevel:i.getPlayerLevel(),playerXP:i.getPlayerXP(),gold:i.getPlayerGold(),cost:e},t||"unknown","generic"),i._updateGold(n.gold),!0})},continueGame:function(e){var t=this,i=c.toWire(this.__player);return i.gold<e?Promise.resolve(!1):(i.gold-=e,this.__storageManager.setDataAsync({player:i}).then(function(){return l.trackEvent("gqs","Coin Purchase",{playerLevel:t.getPlayerLevel(),playerXP:t.getPlayerXP(),gold:t.getPlayerGold(),cost:e,item:g.TRACKING_ITEM_IDS.continue}),h.event("Coin Purchase",{contextId:t.getContextId(),playerLevel:t.getPlayerLevel(),playerXP:t.getPlayerXP(),gold:t.getPlayerGold(),cost:e},""+i.finishedGameCount,"continue"),t._updateGold(i.gold),!0}))},__getShipsAndSkinsForWire:function(){for(var e=[],t=0,i=this.__playerShips.length;t<i;t++){for(var n=this.__playerShips[t],r=[],s=0,o=n.skinIds.length;s<o;s++)r.push(n.skinIds[s]);var a={shipId:n.shipId,skinIds:r};e.push(a)}return e},purchaseSkin:function(e,t,i){var n=this,r=this.__shipSkinManager.getSkinCost(e,t),o=c.toWire(this.__player);if(o.gold<r)return s.warn("Not Enough Gold"),Promise.reject("Not Enough Gold");o.gold-=r;for(var a=this.__getShipsAndSkinsForWire(),_=0,u=a.length;_<u;_++){var d=a[_];if(d.shipId===e){d.skinIds.push(t),d.skinIds.sort(function(e,t){return e-t});break}}return i&&(o.equippedShipId=e,o.equippedSkinId=t),this.__storageManager.setDataAsync({player:o,ships:a}).then(function(){return l.trackEvent("gqs","Coin Purchase",{playerLevel:n.getPlayerLevel(),playerXP:n.getPlayerXP(),gold:n.getPlayerGold(),cost:r,item:g.TRACKING_ITEM_IDS.skin,skinId:t}),h.event("Coin Purchase",{contextId:n.getContextId(),playerLevel:n.getPlayerLevel(),playerXP:n.getPlayerXP(),gold:n.getPlayerGold(),cost:r},""+t,"skin"),n._setPlayer(c.fromWire(o)),n.__playerShips=a,n._updateGold(o.gold),!0})},purchaseGacha:function(e){o.ifDefined.assertIsBoolean(e),r.debugFeatures[r.DEBUG_FEATURES.DEBUG_OVERLAY]||(e=!1);var t=this,i=c.toWire(this.__player);if(!e){if(i.tokens<1)return s.warn("Not enough tokens"),Promise.reject("Not enough tokens");i.tokens--}var n=!1,a=i.fueCheckpoint;f.getFUEManager().hasOpenedFUEGacha()&&(a++,i.checkpoint=a,n=!0);var _=f.getGachaManager(),l=_.openGacha(),h=_.getCurrentPlayerGacha();i.parts+=l.parts;var u=this.__addToOwnedCards(l.cards);return this.__storageManager.setDataAsync({player:i,currentGachaBag:h.toWire(),ownedCards:u}).then(function(){return t._setPlayer(c.fromWire(i)),t._updateTokens(i.tokens),t.__player.fueCheckpoint=a,t._setCards(u.map(p.fromWire)),n})},__addToOwnedCards:function(e){for(var t=this.__ownedCards.map(p.toWire),i=0;i<e.length;++i)t.push(p.toWire(e[i]));var n=this;return t.sort(function(e,t){var i=n.__cardParameters.cardTypes[e.id],r=n.__cardParameters.cardTypes[t.id];return i.rarity===r.rarity?i.name===r.name?t.level-e.level:i.name.localeCompare(r.name):r.rarity-i.rarity}),t},equipShipSkin:function(e,t){var i=c.toWire(this.__player);i.equippedShipId=e,i.equippedSkinId=t;var n=this;return this.__storageManager.setDataAsync({player:i}).then(function(){return l.trackEvent("gqs","Ship Customized",{playerLevel:n.getPlayerLevel(),playerXP:n.getPlayerXP(),gold:n.getPlayerGold(),
skinId:i.equippedSkinId}),h.event("Ship Customized",{contextId:n.getContextId(),playerLevel:n.getPlayerLevel(),playerXP:n.getPlayerXP(),gold:n.getPlayerGold(),skinId:i.equippedSkinId}),n._setPlayer(c.fromWire(i)),!0})},clearAchievementSeenFlags:function(){var e=this.__achievementManager.getAchievementsForWire(),t=this;return this.__storageManager.setDataAsync({achievements:e}).then(function(){return t.__achievementManager.update(e),!0})},hasNewAchievement:function(){return this.__achievementManager.hasUpdatedAchievement()},endGame:function(e,t,i,n,r,s,o,a,_){var u=this,d=this.__player.goldMultipliers>0,p=s;if(d&&(p*=g.GOLD_MULTIPLIER),this.needsToDoFirstRun()){var m=this.__eventManager.getNewEvent(C);this.__eventManager.queueEvent(m)}var v,y,E;if(f.getFUEManager().isAchievementTrackingEnabled()){var S={playerId:this.__player.id,goldGained:p,distancePoints:e,killPoints:t,kills:i,bossKills:n,spawns:r,stats:o},T=this.__missionManager.getMissionSet().isComplete();y=this.__achievementManager.computeAchievementUpdates(S),v=this.__achievementManager.getAchievementsForWireWithUpdates(y),E=this.__achievementManager.getGoldForAchievementUpdates(y)}else y={},v=this.__achievementManager.getAchievementsForWire(),E=0;for(var I=0,w=0,b=this.__missionManager.getMissionSet().redeem(),M=0,x=b.length;M<x;++M){var R=b[M],P=this.__missionManager.getReward(R.level);w+=P.xp,I+=P.gold,l.trackEvent("gqs","Mission Complete",{playerLevel:this.getPlayerLevel(),playerXP:this.getPlayerXP(),gold:this.getPlayerGold(),missionType:R.type}),h.event("Mission Complete",{contextId:this.getContextId(),playerLevel:this.getPlayerLevel(),playerXP:this.getPlayerXP(),gold:this.getPlayerGold(),missionType:R.type})}var A=c.toWire(this.__player);T&&b.length>0&&(A.tokens+=1),d&&A.goldMultipliers--;var N=this.getPlayerLevel(),D=p+E+I;A.gold+=D,A.finishedGameCount++;var L={player:A,achievements:v};return this.__missionManager.getMissionSet().appendToWire(L),this.__storageManager.setDataAsync(L).then(function(e){return u._setPlayer(c.fromWire(A)),w>0?u.addXP(w).then(function(e){return e.length>0&&(A=c.toWire(u.__player)),e}):e}).then(function(){var r={contextId:u.getContextId(),playerLevel:u.getPlayerLevel(),playerXP:u.getPlayerXP(),gold:A.gold,parts:A.parts,kills:i,bossesKilled:n,minibossKills:o.kills.miniboss,score:t,bruisersKilled:o.kills.bruiser,frigatesKilled:o.kills.frigate,destroyersKilled:o.kills.destroyer,gunshipsKilled:o.kills.gunship,telepoposKilled:o.kills.telepopo,sneakkunsKilled:o.kills.sneakkun,coinsCollected:s,coinsSpawned:o.goldSpawned,maxKillStreak:o.maxKillStreak,upgradeCombos:o.upgradeCombos,goldGained:D,xpGained:w,upgradesCollected:o.upgrades,distance:e,fuelCollected:o.fuel,fuelSpawned:o.fuelSpawned,lasersUsed:o.laser,skinUsed:A.equippedSkinId,numContinues:o.numContinues,meanFps:a.mean,minFps:a.min,maxFps:a.max,stdDevFps:a.standardDeviation,runLength:~~_};return h.event("Gameplay Run Ended",r),l.trackEvent("gqs","Gameplay Run Ended",r),u._updateGold(A.gold),u._updateGoldMultipliers(A.goldMultipliers),u._updateTokens(A.tokens),{levelUp:N<u.getPlayerLevel(),player:u.__player,achievements:y,completedMissions:b}})},setCardParameters:function(e){this.__cardParameters=e},getCardParameters:function(){return this.__cardParameters},getOwnedCards:function(){return this.__ownedCards},getEquippedCards:function(){return this.__equippedCards},hasCardEffect:function(e){for(var t=0;t<this.__equippedCards.length;++t){var i=this.__equippedCards[t];if(i){if(this.__cardParameters.cardTypes[i.id].effect===e)return!0}}return!1},hasNewCard:function(){for(var e=0,t=this.__ownedCards.length;e<t;e++){if(this.__ownedCards[e].newFlag)return!0}return!1},getCardEffect:function(e,t){for(var i=0;i<this.__equippedCards.length;++i){var n=this.__equippedCards[i];if(n){if(t.cardTypes[n.id].effect===e){return t.cardLevels[n.id][n.level].effectValue}}}return 0},levelUpCard:function(e,t){var i=this.__ownedCards.indexOf(e);if(i===-1)return s.warn("Can't level a card you don't own"),Promise.resolve(null);var n=t.cardTypes[e.id],r=t.rarities[n.rarity][e.level];if(!t.cardLevels[e.id][e.level+1])return s.warn("No more levels to upgrade to"),Promise.resolve(null);if(this.getPlayerParts()<r.requiredParts||this.getPlayerGold()<r.requiredCoins)return s.warn("Insufficient currency to upgrade"),Promise.resolve(null);var o=c.toWire(this.__player);o.parts-=r.requiredParts,o.gold-=r.requiredCoins;var a=r.levelUpXp;f.getFUEManager().isInEquipSequence()&&(o.fueCheckpoint++,f.getFUEManager().setWasInEquipSequence(!0)),e.level++;var _=this.__ownedCards.map(p.toWire),u=this;return this.__storageManager.setDataAsync({player:o,ownedCards:_}).then(function(){l.trackEvent("gqs","Card Upgraded",{playerLevel:u.getPlayerLevel(),playerXP:u.getPlayerXP(),gold:u.getPlayerGold(),cardId1:e.id,xpGained:a}),h.event("Card Upgraded",{contextId:u.getContextId(),playerLevel:u.getPlayerLevel(),playerXP:u.getPlayerXP(),gold:u.getPlayerGold(),card:n.name,cardLevel:e.level,xpGained:a}),u._setPlayer(c.fromWire(o)),u._setCards(_.map(p.fromWire));var t=u.getPlayerGold(),r=u.__eventManager.getNewEvent(y);r.setAmount(t),u.__eventManager.queueEvent(r);var s=u.getPlayerParts(),d=u.__eventManager.getNewEvent(E);return d.setAmount(s),u.__eventManager.queueEvent(d),[u.__ownedCards[i],a]})},scrapCard:function(e,t){var i=this.__ownedCards.indexOf(e);if(i===-1)return s.warn("Can't scrap a card you don't own"),Promise.resolve(0);var n=t.cardTypes[e.id],r=t.rarities[n.rarity][e.level],o=r.partValue;this.__ownedCards.splice(i,1);var a=c.toWire(this.__player);a.parts+=o;var _=this.__ownedCards.map(p.toWire),u=this;return this.__storageManager.setDataAsync({player:a,ownedCards:_}).then(function(){return l.trackEvent("gqs","Card Disenchanted",{playerLevel:u.getPlayerLevel(),playerXP:u.getPlayerXP(),gold:u.getPlayerGold(),cardId1:e.id,partsGained:o}),h.event("Card Disenchanted",{contextId:u.getContextId(),playerLevel:u.getPlayerLevel(),playerXP:u.getPlayerXP(),gold:u.getPlayerGold(),card:n.name,cardLevel:e.level,partsGained:o}),u._setPlayer(c.fromWire(a)),0!==o&&u._updateParts(a.parts),u._setCards(_.map(p.fromWire)),o})},addCards:function(e,t){var i=this.__addToOwnedCards(e),n=this;return this.__storageManager.setDataAsync({ownedCards:i}).then(function(){n._setCards(i.map(p.fromWire))})},getCardAlreadyEarned:function(e){return this.__earnedCards.indexOf(e)!==-1},addCardIdToEarnedCards:function(e){var t=this.__earnedCards;t.push(e);var i=this;return this.__storageManager.setDataAsync({earnedCards:t}).then(function(){i._setEarnedCards(t)})},markAllCardsSeen:function(){var e=this.__ownedCards.map(p.toWire);e.forEach(function(e){e.newFlag=!1});var t=this;return this.__storageManager.setDataAsync({ownedCards:e}).then(function(){t._setCards(e.map(p.fromWire))})},deleteCard:function(e){var t=this.__ownedCards.map(p.toWire);t.splice(e,1);var i=this;return this.__storageManager.setDataAsync({ownedCards:t}).then(function(){i._setCards(t.map(p.fromWire))})},unequipCard:function(e){var t=this.__equippedCards[e];if(!t)return Promise.resolve();t.equipped=!1,t.equippedSlotIndex=-1,this.__equippedCards[e]=null;var i=this.__ownedCards.map(p.toWire),n=this;return this.__storageManager.setDataAsync({ownedCards:i}).then(function(){l.trackEvent("gqs","Card Disabled",{playerLevel:n.getPlayerLevel(),playerXP:n.getPlayerXP(),gold:n.getPlayerGold(),cardId1:t.id});var e=n.__cardParameters.cardTypes[t.id];h.event("Card Disabled",{contextId:n.getContextId(),playerLevel:n.getPlayerLevel(),playerXP:n.getPlayerXP(),gold:n.getPlayerGold(),card:e.name,cardLevel:t.level}),n._setCards(i.map(p.fromWire))})},equipCard:function(e,t){if(this.__ownedCards.indexOf(e)===-1)return s.warn("Tried to equip an unowned card"),Promise.resolve();var i=this.__equippedCards[t];if(i){l.trackEvent("gqs","Card Disabled",{playerLevel:this.getPlayerLevel(),playerXP:this.getPlayerXP(),gold:this.getPlayerGold(),cardId1:i.id});var n=this.__cardParameters.cardTypes[i.id];h.event("Card Disabled",{contextId:this.getContextId(),playerLevel:this.getPlayerLevel(),playerXP:this.getPlayerXP(),gold:this.getPlayerGold(),card:n.name,cardLevel:i.level}),i.equipped=!1,i.equippedSlotIndex=-1}this.__equippedCards[t]=e,e.equipped=!0,e.equippedSlotIndex=t;var r=this.__ownedCards.map(p.toWire),o=this;return this.__storageManager.setDataAsync({ownedCards:r}).then(function(){l.trackEvent("gqs","Card Equipped",{playerLevel:o.getPlayerLevel(),playerXP:o.getPlayerXP(),gold:o.getPlayerGold(),cardId1:e.id});var t=o.__cardParameters.cardTypes[e.id];return h.event("Card Equipped",{contextId:o.getContextId(),playerLevel:o.getPlayerLevel(),playerXP:o.getPlayerXP(),gold:o.getPlayerGold(),card:t.name,cardLevel:e.level}),o._setCards(r.map(p.fromWire)),o.__ownedCards})},getUnlockedCardTypes:function(e,t){o.ifDefined.assertIsNumber(t),o.isDefined(t)||(t=this.__player.level);var i=[],n=e.cardTypes;for(var r in n){t>=n[r].minPlayerLevel&&i.push(r)}return i},resetShipPurchases:function(){var e=this.__shipSkinManager.getDefaultShipsAndSkins(),t=c.toWire(this.__player);return t.equippedShipId=c.DEFAULT_SHIP_ID,t.equippedSkinId=c.DEFAULT_SKIN_ID,this.__storageManager.setDataAsync({player:t,ships:e})},resetPlayer:function(){var e=c.createDefaultPlayer(this.getFacebookId());return this.__storageManager.setDataAsync({player:e})},resetAchievements:function(){var e={};return this.__storageManager.setDataAsync({achievements:e})},resetGifts:function(){var e=this.__giftManager.getDefaultGift();return this.__storageManager.setDataAsync({gift:e})},resetCards:function(){var e=this,t=[],i=[];return this.__storageManager.setDataAsync({ownedCards:t,earnedCards:i}).then(function(){e._setCards(t),e._setEarnedCards(i)})},resetMissions:function(){return this.__storageManager.setDataAsync({mission_set:{}})},resetGachaBag:function(){return this.__storageManager.setDataAsync({currentGachaBag:null})},resetAllData:function(){var e=c.createDefaultPlayer(this.getFacebookId()),t=this.__shipSkinManager.getDefaultShipsAndSkins(),i=this.__giftManager.getDefaultGift(),n={},r=[],s=[],o={};return this.__storageManager.setDataAsync({gift:i,ships:t,player:e,achievements:n,ownedCards:r,earnedCards:s,mission_set:o,currentGachaBag:null})},setFueCheckpoint:function(e){f.getFUEManager().trackCheckpointComplete(e-1);var t=c.toWire(this.__player);t.fueCheckpoint=e;var i=this;return this.__storageManager.setDataAsync({player:t}).then(function(){i.__player.fueCheckpoint=e})},toggleCanSkipFue:function(){var e=c.toWire(this.__player),t=!e.skipFue;e.skipFue=t;var i=this;return this.__storageManager.setDataAsync({player:e}).then(function(){i.__player.skipFue=t})},enableRebalanceGift:function(){var e=c.toWire(this.__player);e.giveGift=void 0;var t=this;return this.__storageManager.setDataAsync({player:e}).then(function(){return t._setPlayer(c.fromWire(e)),!0})}})}),define("achievements/AchievementTypeEnum",["require","exports","module","thor/core/Enum","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Enum"),r=(e("thor/core/Validation"),n.create("AchievementTypeEnum",{BOSS_KILLS:0,BRUISER_KILLS:1,FRIGATE_KILLS:2,SCORE:3,KILL_STREAK:4,UPGRADE_COMBOS:5}));i.exports=r;var s={};s[r.BOSS_KILLS]=function(e,t){return e.bossKills+t},s[r.BRUISER_KILLS]=function(e,t){return e.stats.kills.bruiser+t},s[r.FRIGATE_KILLS]=function(e,t){return e.stats.kills.frigate+t},s[r.SCORE]=function(e,t){return e.killPoints},s[r.KILL_STREAK]=function(e,t){return e.stats.maxKillStreak},s[r.UPGRADE_COMBOS]=function(e,t){return e.stats.upgradeCombos},i.exports.VALUE_FUNCTIONS=s}),define("AchievementManager",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","Constants","thor/config/Config","thor/platforms/Google","thor/analytics/Seidr","thor/resources/ResourceManager","thor/util/JSONLoader","achievements/AchievementTypeEnum","ManagerRepository"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=(e("thor/core/Validation"),e("Constants"),e("thor/config/Config"),e("thor/platforms/Google")),o=e("thor/analytics/Seidr"),a=(e("thor/resources/ResourceManager"),e("thor/util/JSONLoader")),_=e("achievements/AchievementTypeEnum"),l=e("ManagerRepository");i.exports=n.create({initialize:function(e){this.__resourceManager=e,this.__playerAchievementsById={},this.__arrAchievementData=[]},load:function(){var e=this;return this.__resourceManager.loader(a.RESOURCE_TYPE).load("data/achievements","data/achievements.json").then(function(t){return r.debug("Loaded achievements data: ",t),e.__arrAchievementData=t.achievements,t})},handleAuth:function(e){if(!e.error)return this.__playerAchievementsById=e.achievements,e},__createAchievementUpdate:function(e,t,i){var n=e.tiers,r=(n.length,this.__getProgressTierIdx(e,t)),s=this.__getProgressTierIdx(e,i),o=s-r;i>=n[s].requirement&&s===n.length-1&&++o;for(var a=(n[r].requirement,{id:e.id,progress:i,unlockDescription:"",numUnlockedTiers:o,gold:0}),_=0,l=r;l<=s;++l){var h=n[l];t<h.requirement&&i>=h.requirement&&(_+=h.gold)}if(_>0){var u=e.tiers[r];a.unlockDescription=u.unlockDescription,a.gold=_,a.updated=!0}return a},computeAchievementUpdates:function(e){for(var t={},i=0,n=this.__arrAchievementData.length;i<n;i++){var r=this.__arrAchievementData[i],s=r.id,o=r.type,a=_[o];this.__playerAchievementsById[s]||(this.__playerAchievementsById[s]={progress:0});var l=this.__playerAchievementsById[s].progress,h=_.VALUE_FUNCTIONS[a](e,l);if(h>l){var u=this.__createAchievementUpdate(r,l,h);t[s]=u}}return t},update:function(e){var t=[];for(var i in e){var n=e[i];this.__playerAchievementsById[i];if(n.gold){t.push(n);var r=l.getPlayerManager();s.trackEvent("gqs","Award Completed",{playerLevel:r.getPlayerLevel(),playerXP:r.getPlayerXP(),gold:r.getPlayerGold(),goldGained:n.gold}),o.event("Award Completed",{contextId:r.getContextId(),playerLevel:r.getPlayerLevel(),playerXP:r.getPlayerXP(),gold:r.getPlayerGold(),goldGained:n.gold})}this.__playerAchievementsById[i].progress=n.progress,this.__playerAchievementsById[i].updated=n.updated}return t},__getProgressTierIdx:function(e,t){for(var i,n=e.tiers,r=n.length,i=0;i<r;i++){if(t<n[i].requirement)break}return Math.min(i,r-1)},__getAchievementDisplay:function(e){var t,i=this.__playerAchievementsById[e.id];t=i?i.progress:0;var n=this.__getProgressTierIdx(e,t),r=e.tiers[n];return{id:e.id,type:e.type,name:e.name,tier:n+1,description:r.description,requirement:r.requirement,progress:t}},getAchievementForDisplay:function(e){for(var t=0,i=this.__arrAchievementData.length;t<i;t++){var n=this.__arrAchievementData[t];if(n.id===e)return this.__getAchievementDisplay(n)}throw r.error("Tried to get achievement "+e+" for display, but none was found."),new Error("Could not find achievement "+e+" for display.")},getAchievementsForDisplay:function(){for(var e={},t=0,i=this.__arrAchievementData.length;t<i;t++){var n=this.__arrAchievementData[t];e[n.id]=this.__getAchievementDisplay(n)}return e},getAchievementsForWire:function(){var e={};for(var t in this.__playerAchievementsById){var i=this.__playerAchievementsById[t];e[t]={progress:i.progress}}return e},getAchievementsForWireWithUpdates:function(e){var t={};for(var i in this.__playerAchievementsById){var n=this.__playerAchievementsById[i];t[i]={progress:n.progress}}for(var i in e){var r=e[i];t[i]={progress:r.progress},r.updated&&(t[i].updated=!0)}return t},hasUpdatedAchievement:function(){for(var e in this.__playerAchievementsById){if(this.__playerAchievementsById[e].updated)return!0}return!1},getGoldForAchievementUpdates:function(e){var t=0;for(var i in e){t+=e[i].gold}return t}})}),define("LaserManager",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","./Constants","thor/event/EventManager","EntityFactory","thor/entity/World","thor/entity/Entity","thor/entity/EntityDestroyedEvent","events/DisableProjectilesEvent","thor/audio/SoundSprite"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("./Constants")),s=(e("thor/event/EventManager"),e("EntityFactory"),e("thor/entity/World"),e("thor/entity/Entity"),e("thor/entity/EntityDestroyedEvent")),o=(e("events/DisableProjectilesEvent"),e("thor/audio/SoundSprite"),{attachParent:null});i.exports=n.create({initialize:function(e,t,i){this.__world=e,this.__entityFactory=t,this.__eventManager=i,this.__laserBeam=null,this.__sounds=null,this.__tintColor=4294967295},isActive:function(){return this.__laserBeam},getLaserBeam:function(){return this.__laserBeam},getLaserInfo:function(){return{name:"laser_gun",energyCost:10,damage:7,duration:2.5}},activateLaserBeam:function(e,t){if(this.__laserBeam){var i=this.__laserBeam.getComponent("LaserBeamComponent");return void i.resetDuration(t)}var n=this.__entityFactory.createEntity("LaserBeam",this.__world,o);if(n){var s=n.getRootComponent();s.setSortOrder(r.HIT_Z_INDEX),s.attachTo(e.getRootComponent());var i=n.getComponent("LaserBeamComponent");i.setLaserData(7,t),i.setTintColor(this.__tintColor),this.__laserBeam=n}},deactivateLaserBeam:function(){if(this.__laserBeam){var e=this.__eventManager.getNewEvent(s);e.setEntityId(this.__laserBeam.getId()),this.__eventManager.triggerEvent(e),this.__laserBeam=null}},clearEntities:function(){this.__laserBeam=null},init:function(e){this.__sounds=e},changeTintColor:function(e){this.__tintColor=e?4293132543:4294967295,this.__laserBeam&&this.__laserBeam.setTintColor(this.__tintColor)}})}),define("StaticShockManager",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","./Constants","ManagerRepository","thor/event/EventManager","EntityFactory","thor/entity/World","thor/entity/Entity","events/ShockEntityEvent","thor/entity/EntityDestroyedEvent","thor/audio/SoundSprite","thor/util/TimeoutContext"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("./Constants")),s=e("ManagerRepository"),o=(e("thor/event/EventManager"),e("EntityFactory"),e("thor/entity/World"),e("thor/entity/Entity"),e("events/ShockEntityEvent")),a=(e("thor/entity/EntityDestroyedEvent"),e("thor/audio/SoundSprite"),e("thor/util/TimeoutContext"));i.exports=n.create({initialize:function(e,t){this.__world=e,this.__eventManager=t,this.__skeletonFactory=s.getSkeletonFactory(),this.__sounds=null,this.__timeoutContext=new a,this.__shock=null,this.__shockDuration=0,this.__shockDelay=0,this.__charges=0,this.__isShocking=!1},init:function(e){this.__sounds=e,this.__shock=this.__skeletonFactory.create("static_shock",this.__world,{sortOrder:r.EXPLOSION_Z_INDEX})},setTiming:function(e,t){this.__shockDuration=e,this.__shockDelay=t},activateShock:function(e,t){if(!this.__isShocking){this.__isShocking=!0,this.__useCharge();var i=this.__shock.getComponent("SkeletonComponent");i.attachTo(e.getRootComponent()),i.setTranslation(0,-100),i.playAnimation("Initial Charge",!1,!0),i.setAnimationEndedCallback(this.__shockEnemy.bind(this,t))}},__shockEnemy:function(e){this.__sounds.play("static_hit");var t=this.__shock.getComponent("SkeletonComponent");t.attachTo(e.getRootComponent()),t.setTranslation(0,0),t.playAnimation("Enemy Damaged",!0),this.__timeoutContext.setTimeout(this.__endShock.bind(this,e),this.__shockDuration)},__endShock:function(e){var t=this.__eventManager.getNewEvent(o);t.setEntityId(e.getId()),this.__eventManager.triggerEvent(t);var i=this.__shock.getComponent("SkeletonComponent");i.playAnimation("Enemy Defeated",!1,!0),i.setAnimationEndedCallback(this.__delayShock.bind(this))},__delayShock:function(){var e=this;this.__timeoutContext.setTimeout(function(){e.__isShocking=!1},this.__shockDelay)},addCharge:function(){this.__charges!==r.MAX_STATIC_CHARGES&&this.__charges++},__useCharge:function(){this.__charges>0&&this.__charges--},getCharges:function(){return this.__charges}})}),define("ShipSkinManager",["require","exports","module","thor/core/Class","thor/core/Logger","thor/config/Config","thor/entity/Entity","thor/core/Validation","thor/util/JSONLoader","thor/resources/ResourceManager","thor/graphics/resources/TextureRegionResource","player/Player","player/PlayerManager"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=(e("thor/config/Config"),e("thor/entity/Entity"),e("thor/core/Validation")),o=e("thor/util/JSONLoader"),a=(e("thor/resources/ResourceManager"),e("thor/graphics/resources/TextureRegionResource")),_=e("player/Player");e("player/PlayerManager");i.exports=n.create({initialize:function(e,t){this.__resourceManager=e,this.__playerManager=t,this.__shipDataByShipId={}},load:function(){var e=this;return this.__resourceManager.loader(o.RESOURCE_TYPE).load("data/ships","data/ships.json").then(function(t){return e.__shipDataByShipId=e.__convertShipsData(t),r.debug("Loaded ships: ",e.__shipDataByShipId),t})},__convertShipsData:function(e){for(var t={},i=Object.keys(e),n=0,r=i.length;n<r;n++){var s=i[n],o=e[s],a={shipId:s,name:o.name},_=Object.keys(o.textures);a.arrTextureIds=_,a.textures={},a.skins={};for(var l=0,h=_.length;l<h;l++){for(var u=_[l],c=o.textures[u],d=Object.keys(c.skins).map(function(e){return parseInt(e)}),g={name:c.name,arrSkinIds:d},p=0,m=d.length;p<m;p++){var f=d[p],v=c.skins[f];a.skins[f]={sticker:u,bodyTint:parseInt(v.bodyTint,16),tracersTint:parseInt(v.tracersTint,16),colorName:v.colorName,cost:v.cost}}a.textures[u]=g}t[s]=a}return t},getAllShipsData:function(){return this.__shipDataByShipId},getSkinCost:function(e,t){return this.__findSkin(e,t).cost},getPrimarySkinColor:function(e,t){var i=this.__findSkin(e,t);return i?i.bodyTint:(r.warn("Skin ID "+t+" for ship ID "+e+" was not found."),4294967295)},isSkinOwned:function(e,t){for(var i,n=this.__playerManager.getPlayerShips(),r=0,o=n.length;r<o;r++){var a=n[r];if(a.shipId===e){i=a;break}}if(!s.isObject(i))return!1;for(var _=0,l=i.skinIds.length;_<l;_++)if(i.skinIds[_]===t)return!0;return!1},isTextureOwned:function(e,t){for(var i,n=this.__playerManager.getPlayerShips(),r=0,o=n.length;r<o;r++){var a=n[r];if(a.shipId===e){i=a;break}}if(!s.isObject(i))return!1;var _=this.__shipDataByShipId[e];if(!s.isObject(_))return!1;var l=_.textures[t];if(!s.isObject(l))return!1;for(var h=i.skinIds,u=l.arrSkinIds,c=h.length,d=u.length,g=0;g<c;g++)for(var p=h[g],m=0;m<d;m++){var t=u[m];if(p===t)return!0}return!1},getFirstOwnedSkinForTexture:function(e,t){for(var i,n=this.__playerManager.getPlayerShips(),r=0,s=n.length;r<s;r++){var o=n[r];if(o.shipId===e){i=o;break}}for(var a=this.__shipDataByShipId[e],_=a.textures[t],l=i.skinIds,h=_.arrSkinIds,u=l.length,c=h.length,d=0;d<u;d++)for(var g=l[d],p=0;p<c;p++){var t=h[p];if(g===t)return g}},__findSkin:function(e,t){var i=this.__findShip(e);return i?this.__findSkinInShip(i,t):null},__findSkinInShip:function(e,t){return e.skins[t]},__findShip:function(e){return this.__shipDataByShipId[e]},setEquippedSkin:function(e){var t=this.__playerManager.getPlayer(),i=t.equippedShipId,n=t.equippedSkinId;this.setShipSkin(e,i,n)},setShipSkin:function(e,t,i){var n=this.__findSkin(t,i);e.getComponentByName("body_layer").setTintColor(n.bodyTint),e.getComponentByName("tracers_layer").setTintColor(n.tracersTint);var r=e.getComponentByName("sticker_layer"),s=this.__resourceManager.get(a.RESOURCE_TYPE,n.sticker);r.setTextureRegion(s)},getDefaultShipsAndSkins:function(){return[{shipId:_.DEFAULT_SHIP_ID,skinIds:[_.DEFAULT_SKIN_ID]}]}})});define("mission/MissionPool",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","Constants","./DifficultyType","./MissionType","./TrackingType","./Mission"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("Constants"),e("./DifficultyType")),s=e("./MissionType"),o=e("./TrackingType"),a=e("./Mission"),_=n.create({initialize:function(e,t){this.__level=e,this.__missions=missions},getMissions:function(){return this.__missions}});_.deserialize=function(e,t){for(var i={},n=r.getValues(),l=0,h=n.length;l<h;++l)i[n[l]]=[];i[r.CHALLENGE]=[],i[r.NORMAL]=[];for(var u in t){var c=r[u],d=t[u];for(var g in d){var p=s[g],m=d[g];for(var f in m){var v=o[f],y=m[f];i[c].push(new a(e,c,p,v,y))}}}return new _(e,i)},i.exports=_}),define("mission/MissionManager",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","Constants","thor/event/EventManager","thor/resources/ResourceManager","thor/util/JSONLoader","StorageManager","player/PlayerManager","thor/event/EventManager","./MissionType","./TrackingType","./DifficultyType","./Mission","./MissionInstance","./MissionPool","mission/MissionSet","SystemType","events/SystemUpgradeComboEvent","events/GameStartingEvent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=(e("Constants"),e("thor/event/EventManager"),e("thor/resources/ResourceManager"),e("thor/util/JSONLoader")),a=(e("StorageManager"),e("player/PlayerManager"),e("thor/event/EventManager"),e("./MissionType"),e("./TrackingType"),e("./DifficultyType"),e("./Mission")),_=e("./MissionInstance"),l=(e("./MissionPool"),e("mission/MissionSet")),h=(e("SystemType"),e("events/SystemUpgradeComboEvent"),e("events/GameStartingEvent"));i.exports=n.create({initialize:function(e,t,i){this.__playerManager=e,e.setMissionManager(this),this.__storageManager=t,this.__eventManager=i,i.registerEventHandler(h.EVENT_TYPE,this.__handleGameStartingEvent.bind(this)),this.__missionSet=null,this.__rewards=[],this.__missions=[]},trackKill:function(e){this.__missionSet.trackKill(e)},trackCollectGold:function(){this.__missionSet.trackCollectGold()},trackCollectPoints:function(){this.__missionSet.trackCollectPoints()},trackCollectFuel:function(){this.__missionSet.trackCollectFuel()},trackBossKill:function(){this.__missionSet.trackBossKill()},trackMinibossKill:function(){this.__missionSet.trackMinibossKill()},trackSystemUpgrade:function(e){this.__missionSet.trackSystemUpgrade(e)},handlePlayerDamaged:function(){this.__missionSet.handlePlayerDamaged()},__handleGameStartingEvent:function(){this.__missionSet.resetEphemeralMissions()},getMission:function(e,t,i,n){var o=this.__missions[e-1];if(!o)return r.warn("Could not find missions in level "+e),null;var _=o[t];if(!_)return r.warn("Could not find missions of {level, difficulty} {"+e+", "+t+"}"),null;var l=_[i];if(!l)return r.warn("Could not find missions of {level, difficulty, type} {"+e+", "+t+", "+i+"}"),null;var h=l[n];return s.isNumber(h)?new a(e,t,i,n,h):(r.warn("Could not find mission {level, difficulty, type, tracking} {"+e+", "+t+", "+i+", "+n+"}"),null)},getPool:function(e,t){var i=[],n=this.__missions[e-1][t];for(var r in n){var s=+r,o=n[r];for(var a in o){var _=+a;i.push([e,t,s,_])}}return i},getMissions:function(){return this.__missions},getCurrentMissions:function(){return this.__missionSet.getMissions()},getMissionSet:function(){return this.__missionSet},getRewards:function(){return this.__rewards},getReward:function(e){return this.__rewards[e-1]},load:function(e){var t=this;return Promise.all([e.loader(o.RESOURCE_TYPE).load("data/missions","data/missions.json"),e.loader(o.RESOURCE_TYPE).load("data/mission_rewards","data/mission_rewards.json")]).then(function(e){t.setMissions(e[0]),t.setRewards(e[1])})},__getMissions:function(e){for(var t=[],i=0,n=e.length;i<n;++i){var s=e[i];4!==s.length&&r.error("Invalid mission key",s);var o=this.apply(this,s);t.push(o)}return t},setMissions:function(e){this.__missions=e},setRewards:function(e){for(var t=0,i=e.length;t<i;t++){e[t]}this.__rewards=e},handleAuth:function(e){var t=this,i=e[l.STORAGE_KEY];return l.fromWire(i).then(function(e){t.__missionSet=e}).catch(function(e){r.error(e)})},dumpMissions:function(){if(!this.__missions)return void console.debug("=== No missions have been loaded ===");console.debug("=== Loaded Missions ===");for(var e in this.__missions){var t=this.__missions[e];for(var i in t){var n=t[i];for(var r in n){var s=n[r];for(var o in s){var l=s[o],h=new a(+e,+i,+r,+o,+l),u=new _(h,0,!1);console.debug("\t"+u.getDescription(!1)+": "+u.toString())}}}}}}),i.exports.MISSION_REWARDS_PATH="data/mission_rewards.json",i.exports.MISSIONS_PATH="data/missions.json"}),define("gameplay/EnemyTypeEnum",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum");i.exports=n.create("EnemyTypeEnum",{BRUISER:1,FRIGATE:2,DESTROYER:3,GUNSHIP:4,BOSS:5,MINIBOSS:6,SPLODEY:7,SNEAKKUN:8,BLADEHEAD:9,BATTLECRUISER:10,TELEPOPO:11})}),define("gameplay/GameParameters",["require","exports","module","thor/core/Class","thor/core/Validation","thor/util/ModelUtils","Constants"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/util/ModelUtils")),s=e("Constants"),o={baseVelocity:s.SCROLL_VELOCITY,velocityIncrement:s.SCROLL_ACCELERATION,maxVelocity:s.MAX_SCROLL_VELOCITY,unitsToMeters:s.UNITS_TO_METERS,health:s.MAX_PLAYER_HEALTH,damage:s.DEFAULT_PLAYER_BULLET_DAMAGE,hitRadius:s.PLAYER_COLLISION_RADIUS,pickupRadius:s.PLAYER_PICKUP_COLLISION_RADIUS,mapScrollMultiplier:1,topScrollMultiplier:.2,midScrollMultiplier:.17,bottomScrollMultiplier:.1,parallaxDeadZonePercentage:20,parallaxMapBufferPercentage:100,pointsPerMeter:50,waveDropChance:.1,reviveSafetyTime:3e3,maxComboMultiplier:100,maxComboDisplay:999,comboMultiplierIncrement:.1,comboIncrementStepAmount:10,valueToCoins:50,pointsPerMedal:150,loopDifficultyIncrease:10,maxHealthIncreases:2,pointsPerEnergy:1,pointsToCharge:1,systemUpgradeComboPoints:500,currencyAcceleration:2e4,currencyMaxVelocityY:9e3,currencyMinInitialVelocityY:-650,currencyMaxInitialVelocityY:-300,maxGameSpeed:2,shockDelay:300,shockDuration:800,shockRange:1e3},a=n.create({initialize:function(){},validate:function(){}});i.exports=a,i.exports.fromExisting=function(e){var t=new a;return r.fromExistingWithDefaults(t,e,o,0,2),t.validate(),t}}),define("gameplay/states/LoadingState",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i));e("thor/core/Validation");i.exports=n.create({initialize:function(){},onEnter:function(){r.debug("Loading")}})}),define("events/PlayerStateEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","thor/entity/Entity"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));e("thor/entity/Entity");i.exports=n.generateEventClass("PlayerState",1067302361,{playerEntity:function(e){}})}),define("gameplay/states/IdleState",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/util/FSM","thor/util/StringUtil","GameLogic","Constants","events/PlayerStateEvent","events/GameStartingEvent","events/TransitionUIStateEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i)),s=(e("thor/core/Validation"),e("thor/util/FSM").State),o=e("thor/util/StringUtil"),a=(e("GameLogic"),e("Constants")),_=e("events/PlayerStateEvent"),l=e("events/GameStartingEvent"),h=e("events/TransitionUIStateEvent");i.exports=n.create(s,{initialize:function(e){this.__gameLogic=e},onEnter:function(){r.debug("Idle");var e=this.__gameLogic;e.__slowMotion=!1,e.__backgroundLayer.setScrollVelocity(a.BG_SCROLL_VELOCITY*e.__gameParameters.mapScrollMultiplier),e.__backgroundLayer.clearMaps(),e.queueBackground(),e.__bottomLayer.setScrollVelocity(e.__gameParameters.baseVelocity*e.__gameParameters.bottomScrollMultiplier*e.__gameParameters.mapScrollMultiplier),e.__topLayer.setScrollVelocity(e.__gameParameters.baseVelocity*e.__gameParameters.topScrollMultiplier*e.__gameParameters.mapScrollMultiplier),e.__bulletManager.expireAllBullets(),e._gold=0,e.__deathCount=0,e.__isGrazing=!1,e.__grazingEntityId=null,e.__grazingCollided=!1,e.__comboCount=0,e.__comboMultiplier=e.DEFAULT_COMBO_START,e.__sctQueue.length=0,e.__replayPositions=[];for(var t=0;t<e.__layers.length;++t)e.__layers[t].clearMaps();e.__entityFactory.clearEntities(),
e.__shipY=e.__gameBounds.height*a.SPAWN_HEIGHT_PERCENTAGE,e.__ship=e.__createPlayerShip(),e.__ship.getRootComponent().setTintColor(4294967040),e.__shipResources=e.__ship.getComponent("ResourceComponent"),e.__shipEntityId=e.__ship.getId(),e.findShipOverlayComponents(),e.__bossDeathAnimation=null;var i=e.__eventManager.getNewEvent(_);if(i.setPlayerEntity(e.__ship),e.__eventManager.queueEvent(i),r.debug("Player is entity: "+e.__shipEntityId),e.setSeed(~~(Date.now()/1e3)),e.__gameTimer=0,e.__bossesKilled=0,e.__kills=0,e.__maxKillStreak=0,e.__points=0,e.__killPoints=0,e.__energyPoints=0,e.__chargePoints=0,e.__distance=0,e.__playerDeathDistance=0,e.__gameSpeedMultiplier=1,e.__isLoaded=!0,"autoTest"===o.getUrlParams().mode){var n=e.__eventManager.getNewEvent(h);n.setState("Gameplay"),e.__eventManager.queueEvent(n);var s=e.__eventManager.getNewEvent(l);s.setIsFUE(!1),e.__eventManager.queueEvent(s)}}})}),define("gameplay/systems/UpgradableSystem",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger","thor/entity/Entity","thor/audio/SoundSprite","SystemType","player/PlayerManager"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/core/Logger").getLogger(i));e("thor/entity/Entity"),e("thor/audio/SoundSprite"),e("SystemType"),e("player/PlayerManager");i.exports=n.create({initialize:function(e,t,i){this._entity=t,this._level=0,this._maxLevel=1,this._type=e,this._sounds=null,this._playerManager=i},setSoundSprite:function(e){this._sounds=e},getType:function(){return this._type},getMaxLevel:function(){return this._maxLevel},upgrade:function(){if(this._level>=this._maxLevel)return this._sounds.play("upgrade"+this._maxLevel),1;r.log("Upgrading from level "+this._level+" to level "+(this._level+1));var e=this._level;return this._level=Math.min(this._level+1,this._maxLevel),e!==this._level&&this._apply(),this._sounds.play("upgrade"+this._level),this._level-e},applyComboBonus:function(){return r.log("bursting system",this.initialize.name),!(this._level>this._maxLevel)&&(this._sounds&&this._sounds.play("full_upgrade_fanfare"),this._level++,this._applyComboBonus(),!0)},_applyComboBonus:function(){},_apply:function(){},reset:function(){this._level=0,this._apply()},getSystemStatus:function(){return{level:this._level}},setSystemStatus:function(e){this._level=e.level,this._apply(),this._level>=this._maxLevel&&this._applyComboBonus()}})}),define("gameplay/systems/UpgradableActionSystem",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger","SystemType","./UpgradableSystem","bulletml/BulletMLResource"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/core/Logger").getLogger(i),o=e("SystemType"),a=e("./UpgradableSystem"),_=e("bulletml/BulletMLResource");i.exports=n.create(a,{initialize:function(e,t,i,n,s,o){r.ifDefined.assertIsNonEmptyString(o),a.prototype.initialize.call(this,e,t,n),this._entityManager=i,this._arrActionNames=s,this._arrActions=null,this._maybeDefaultActionName=o,this._defaultAction=null,this._maxLevel=s.length-1},load:function(e){var t=this,i=this._maybeDefaultActionName?[].concat(this._maybeDefaultActionName,this._arrActionNames):this._arrActionNames;return Promise.all(i.map(function(t){return e.loader(_.RESOURCE_TYPE).load(t,t+".xml")})).then(function(e){return t._arrActions=e,t._maybeDefaultActionName&&(t._defaultAction=t._arrActions.splice(0,1)[0]),e})},_applyComboBonus:function(){this._apply()},_apply:function(){var e;if(0===this._level){if(!this._defaultAction)return;e=this._defaultAction}else e=this._arrActions[this._level-1];if(!e)return void s.error("Could not find action for level "+this._level);if(this._entity.isActive()){var t=o.nameFromValue(this._type),i=this._entity.getComponentByName(t);i||(i=this._entityManager.addComponent(this._entity,"ActionComponent",!1),i.setName(t)),i.setAction(e.getAction())}}})}),define("gameplay/systems/GunSystem",["require","exports","module","thor/core/Class","thor/core/Logger","SystemType","./UpgradableActionSystem"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("SystemType")),s=e("./UpgradableActionSystem");i.exports=n.create(s,{initialize:function(e,t,i){s.prototype.initialize.call(this,r.GUN,e,t,i,["bullets/systems/gun/level_1","bullets/systems/gun/level_2","bullets/systems/gun/level_3","bullets/systems/gun/level_4","bullets/systems/gun/level_5"],"bullets/systems/gun/level_0")}})}),define("gameplay/systems/MissileSystem",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger","bulletml/BulletMLResource","SystemType","./UpgradableActionSystem"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/core/Logger").getLogger(i)),s=e("bulletml/BulletMLResource"),o=e("SystemType"),a=e("./UpgradableActionSystem");i.exports=n.create(a,{initialize:function(e,t,i){a.prototype.initialize.call(this,o.MISSILE,e,t,i,["bullets/systems/missile/level_1","bullets/systems/missile/level_2","bullets/systems/missile/level_3","bullets/systems/missile/level_4","bullets/systems/missile/level_5"])},getClusterAction:function(){return this.__clusterAction},_applyComboBonus:function(){var e=this._entity.getComponentByName("MissileSystemBurst");e?r.error("Missile system burst already applied to entity"):(e=this._entityManager.addComponent(this._entity,"ActionComponent",!1),e.setName("MissileSystemBurst"));var t=this._arrActions[this._level-1];e.setAction(t.getAction())},load:function(e){var t=this;return a.prototype.load.call(this,e).then(function(i){return e.loader(s.RESOURCE_TYPE).load("bullets/systems/missile/level_5_cluster","bullets/systems/missile/level_5_cluster.xml").then(function(e){return t.__clusterAction=e,Promise.resolve(i.concat(e))})})},setSystemStatus:function(e){this._level=e.level,this._level>=this._maxLevel?(this._applyComboBonus(),this.__applyNonClusterMissilesMaxed()):this._apply()},__applyNonClusterMissilesMaxed:function(){if(!(this._level<this._maxLevel)){var e=this._arrActions[this._level-2];if(!e)return void r.error("Could not find action for level "+this._level);if(this._entity.isActive()){var t=o.nameFromValue(this._type),i=this._entity.getComponentByName(t);i||(i=this._entityManager.addComponent(this._entity,"ActionComponent",!1),i.setName(t)),i.setAction(e.getAction())}}}})}),define("gameplay/systems/CompanionSystem",["require","exports","module","thor/core/Class","thor/entity/World","thor/core/Logger","thor/entity/Entity","thor/core/Validation","thor/event/EventManager","thor/entity/EntityManager","thor/entity/EntityDestroyedEvent","SystemType","./UpgradableActionSystem","EntityFactory","player/PlayerManager","ManagerRepository"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/entity/World"),e("thor/core/Logger").getLogger(i),e("thor/entity/Entity"),e("thor/core/Validation"),e("thor/event/EventManager"),e("thor/entity/EntityManager"),e("thor/entity/EntityDestroyedEvent")),s=e("SystemType"),o=e("./UpgradableActionSystem"),a=(e("EntityFactory"),e("player/PlayerManager"),e("ManagerRepository")),_=[[0,0],[1,0],[1,1],[2,1],[2,2],[3,3]];i.exports=n.create(o,{initialize:function(e,t,i,n,r,_){o.prototype.initialize.call(this,s.COMPANION,e,t,_,["bullets/systems/companion/level_1","bullets/systems/companion/level_2","bullets/systems/companion/level_3","bullets/systems/companion/level_4","bullets/systems/companion/level_5"]),this.__eventManager=n,this._entityFactory=i,this._world=r,this.__leftCompanion=null,this.__rightCompanion=null,this.__skeletonFactory=a.getSkeletonFactory(),this.__leftUpgradeAnimation=null,this.__rightUpgradeAnimation=null},_apply:function(){if(o.prototype._apply.call(this),this._level>=1&&!this.__leftCompanion){var e=this._entityFactory.createEntity("YCompanion",this._world,{attachParent:this._entity.getRootComponent()});this.__leftCompanion=e;var t=[0,0];e.getRootComponent().getTranslation(t),t[0]=-t[0],e.getRootComponent().setTranslation(t[0],t[1])}if(this._level>=2&&!this.__rightCompanion){var e=this._entityFactory.createEntity("YCompanion",this._world,{attachParent:this._entity.getRootComponent()});this.__rightCompanion=e}this.__updateCompanionLayers()},__updateCompanionLayers:function(){if(this.__leftCompanion)for(var e=0;e<3;e++){var t="char_body_lvl"+(e+1),i=this.__leftCompanion.getComponentByName(t);i.setAlphaTint(0)}if(this.__rightCompanion)for(var e=0;e<3;e++){var t="char_body_lvl"+(e+1),i=this.__rightCompanion.getComponentByName(t);i.setAlphaTint(0)}if(0!==this._level){var n=_[this._level],r=n[0],s=n[1];if(this.__leftCompanion&&r>0){var t="char_body_lvl"+r,i=this.__leftCompanion.getComponentByName(t);i.setAlphaTint(255)}if(this.__rightCompanion&&s>0){var t="char_body_lvl"+s,i=this.__rightCompanion.getComponentByName(t);i.setAlphaTint(255)}}},__destroyCompanion:function(e){var t=e.getComponent("SceneComponent");t&&t.removeFromParent();var i=this.__eventManager.getNewEvent(r);i.setEntityId(e.getId()),this.__eventManager.queueEvent(i)},reset:function(){if(this.__leftUpgradeAnimation){this.__leftUpgradeAnimation.getRootComponent().removeFromParent();var e=this.__eventManager.getNewEvent(r);e.setEntityId(this.__leftUpgradeAnimation.getId()),this.__eventManager.queueEvent(e),this.__leftUpgradeAnimation=null}if(this.__rightUpgradeAnimation){this.__rightUpgradeAnimation.getRootComponent().removeFromParent();var e=this.__eventManager.getNewEvent(r);e.setEntityId(this.__rightUpgradeAnimation.getId()),this.__eventManager.queueEvent(e),this.__rightUpgradeAnimation=null}this.__leftCompanion&&(this.__destroyCompanion(this.__leftCompanion),this.__leftCompanion=null),this.__rightCompanion&&(this.__destroyCompanion(this.__rightCompanion),this.__rightCompanion=null),o.prototype.reset.call(this)},updateCompanionUpgradeAnimations:function(){var e=_[this._level],t="Drone attack "+e[0],i="Drone attack "+e[1];if(this.__leftCompanion&&!this.__leftUpgradeAnimation){var n=this.__createAnimationEntity(this.__leftCompanion.getRootComponent(),t);this.__leftUpgradeAnimation=n}else if(this.__leftUpgradeAnimation){var r=this.__leftUpgradeAnimation.getComponent("SkeletonComponent");r.playAnimation(t,!0,!1)}if(this.__rightCompanion&&!this.__rightUpgradeAnimation){var n=this.__createAnimationEntity(this.__rightCompanion.getRootComponent(),i);this.__rightUpgradeAnimation=n}else if(this.__rightUpgradeAnimation){var r=this.__rightUpgradeAnimation.getComponent("SkeletonComponent");r.playAnimation(i,!0,!1)}},__createAnimationEntity:function(e,t){var i=this.__skeletonFactory.create("card_abilities",this._world,{sortOrder:-1,attachParent:e});return i.getRootComponent().setScale(1,1),i.getRootComponent().setTranslation(2,0),i.getComponent("SkeletonComponent").playAnimation(t,!0,!1),i}})}),define("gameplay/systems/ShipSystems",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Logger","thor/audio/SoundSprite","SystemType","./GunSystem","./MissileSystem","./CompanionSystem","events/SystemUpgradeComboEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/core/Logger").getLogger(i)),s=(e("thor/audio/SoundSprite"),e("SystemType")),o=e("./GunSystem"),a=e("./MissileSystem"),_=e("./CompanionSystem"),l=e("events/SystemUpgradeComboEvent");i.exports=n.create({initialize:function(e,t,i,n,r,l){this.__eventManager=e,this.__systems={},this.__lastSystem=null,this.__comboLength=0,this.__systems[s.MISSILE]=new a(t,i,l),this.__systems[s.GUN]=new o(t,i,l),this.__systems[s.COMPANION]=new _(t,i,n,e,r,l),this.__sounds=null},load:function(e){var t=[];for(var i in this.__systems){var n=this.__systems[i];t.push(n.load(e))}return Promise.all(t)},reset:function(){for(var e in this.__systems){this.__systems[e].reset()}},getSystemsStatus:function(){var e={combo:this.__comboLength,lastSystem:this.__lastSystem};for(var t in this.__systems)e[t]=this.__systems[t].getSystemStatus();return e},setSystemsStatus:function(e){this.__comboLength=e.combo,this.__lastSystem=e.lastSystem;for(var t in e){var i=this.__systems[t];i&&i.setSystemStatus(e[t])}},setSoundSprite:function(e){this.__sounds=e;for(var t in this.__systems){this.__systems[t].setSoundSprite(this.__sounds)}},upgrade:function(e){var t=this.__systems[e];if(0===t.upgrade())return void r.debug("Could not upgrade further.");e===this.__lastSystem?this.__comboLength++:(this.__lastSystem=e,this.__comboLength=1),this.__comboLength>=t.getMaxLevel()&&(t.applyComboBonus(),this.__comboLength=0,this.__lastSystem=null);var i=this.__eventManager.getNewEvent(l);i.setSystemType(e),i.setComboLength(this.__comboLength),this.__eventManager.queueEvent(i),r.log("got upgrade",s.getFields()[e-1],"combo",this.__comboLength)},debugUpgradeToMax:function(){for(var e in this.__systems){var t=this.__systems[e];t.setSystemStatus({level:t.getMaxLevel()+1})}},get:function(e){return this.__systems[e]}})}),define("gameplay/states/PrepareState",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/audio/SoundManager","thor/util/FSM","Constants","thor/util/StringUtil","thor/platforms/Google","thor/analytics/Seidr","thor/audio/SoundSprite","GameLogic","gameplay/systems/ShipSystems","gameplay/Level","bulletml/BulletMLResource","thor/audio/SoundSpriteResourceLoader","ResourceTypes","thor/graphics/resources/TextureRegionResource","thor/graphics/resources/ParticleSystemResource","thor/entity/ParticleSystemComponent","GameStats","SystemType","events/HideMenuUIEvent","events/ShowMenuUIEvent","events/ComboUpdateEvent","events/GameStartedEvent","events/ScoreChangedEvent","events/PlayerEnergyEvent","events/PlayerHealthEvent","../../cards/CardEffectEnum","ManagerRepository"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Device"),s=e("thor/core/Logger").getLogger(i),o=(e("thor/core/Validation"),e("thor/audio/SoundManager")),a=e("thor/util/FSM").State,_=e("Constants"),l=e("thor/util/StringUtil"),h=e("thor/platforms/Google"),u=e("thor/analytics/Seidr"),c=e("thor/audio/SoundSprite"),d=(e("GameLogic"),e("gameplay/systems/ShipSystems")),g=e("gameplay/Level"),p=e("bulletml/BulletMLResource"),m=e("thor/audio/SoundSpriteResourceLoader"),f=e("ResourceTypes"),v=e("thor/graphics/resources/TextureRegionResource"),y=e("thor/graphics/resources/ParticleSystemResource"),E=(e("thor/entity/ParticleSystemComponent"),e("GameStats"),e("SystemType")),S=e("events/HideMenuUIEvent"),T=(e("events/ShowMenuUIEvent"),e("events/ComboUpdateEvent")),C=e("events/GameStartedEvent"),I=e("events/ScoreChangedEvent"),w=e("events/PlayerEnergyEvent"),b=e("events/PlayerHealthEvent"),M=e("../../cards/CardEffectEnum"),x=e("ManagerRepository");i.exports=n.create(a,{initialize:function(e){this.__gameLogic=e,this.__isContinue=!1,this.__playerManager=x.getPlayerManager(),this.__entityFactory=x.getEntityFactory(),this.__entityManager=x.getEntityManager(),this.__resourceManager=x.getResourceManager(),this.__fueManager=x.getFUEManager()},onEnter:function(e){e=e||{},s.debug("Prepare");var t=this,i=this.__gameLogic;if(this.__isContinue=!!e.isContinue,!this.__isContinue){for(var n=0;n<i.__layers.length;++n)i.__layers[n].clearMaps(),i.__layers[n].queueNewMap(_.LEVEL_START_BUFFER);i.resetStats(),i.__replayPositions=[],h.trackEvent("gqs","Gameplay Run Started",{playerLevel:i.__playerManager.getPlayerLevel(),playerXP:i.__playerManager.getPlayerXP(),gold:i.__playerManager.getPlayerGold()}),u.event("Gameplay Run Started",{contextId:i.__playerManager.getContextId(),playerLevel:i.__playerManager.getPlayerLevel(),playerXP:i.__playerManager.getPlayerXP(),gold:i.__playerManager.getPlayerGold()})}i.__comboCount=0,i.__comboPoints=0;var r=i.__eventManager.getNewEvent(T);r.setCount(i.__comboCount),r.setMultiplier(1),r.setBonus(i.__comboPoints),i.__eventManager.queueEvent(r);var o=i.__playerManager.startGame();i.__shipSystems=new d(i.__eventManager,i.__ship,i.__entityManager,i.__entityFactory,i.__world,i.__playerManager),this.__applyCardVfx();var a=!!i.__playerManager.getCardEffect(M.ACTIVE_ABILITY_INCREASE_SECONDS,i.__cardParameters);i.setLaserUpgradeEquipped(a);var l=x.getPlayerManager().getLockedUpgrades();i.__unlockedSystems=E.getFields().filter(function(e){return 0==(E[e]&l)}),Promise.all([o,i.__shipSystems.load(i.__resourceManager)]).then(function(e){var n=t.__fueManager.getCurrentLevelName();s.log("Playing level: ",n),i.__levelSequencer.setLevel(i.__resourceManager.get(g.RESOURCE_TYPE,n)),i.__bossDeathAction=i.__resourceManager.get(p.RESOURCE_TYPE,"bullets/spawners/boss_death"),i.__sounds||(i.__sounds=i.__resourceManager.getOrDefault(m.RESOURCE_TYPE,"game_sounds",c.EMPTY_SOUND_SPRITE)),i.__actionGlobals.setSoundSprite(i.__sounds),i.__shipSystems.setSoundSprite(i.__sounds),i.__bulletManager.setSoundSprite(i.__sounds);var r=i.getPlayerBulletDamageBonus();i.__bulletManager.resetBulletData(r>0);var o=i.__entityFactory.getEntityTemplates();for(var a in o){var _=o[a],l=_.getComponent("SoundOnEventComponent");l&&l.setSoundSprite(i.__sounds);var h=_.getComponent("SoundLoopComponent");h&&h.setSoundSprite(i.__sounds)}i.__ship.getComponent("SoundOnEventComponent").setSoundSprite(i.__sounds),i.__shipSkinManager.setEquippedSkin(i.__ship);var u=i.__eventManager.getNewEvent(C);u.setIsFUE(i.__isFUE),u.setSeed(i.__seed),u.setWasContinue(t.__isContinue),i.__eventManager.queueEvent(u);var d=i.__eventManager.getNewEvent(b);d.setOldHealth(0);var f=i.getPlayerMaxHealth();d.setNewHealth(f),d.setMaxHealth(f),i.__eventManager.queueEvent(d),i.__shipSystems.reset(),i.__shipSystems.setSystemsStatus(i.__storedUpgrades),i.createPlayerDamageVisualEffect(),i.handleCompanionUpgradeEffects(),i.__staticShockDamage=i.__playerManager.getCardEffect(M.STATIC_SHOCK,i.__cardParameters)}).catch(function(e){throw new Error(e)})},__applyCardVfx:function(){var e=this.__playerManager.hasCardEffect(M.MISSILE_DAMAGE_INCREASE_PERCENT);this.__applyMissileDamageVfx(e)},__applyMissileDamageVfx:function(e){var t=this.__entityFactory.getEntityTemplate("SimpleMissile");if(e){var i=this.__resourceManager.get(y.RESOURCE_TYPE,"particles/vfx_missile_trail"),n=this.__resourceManager.get(v.RESOURCE_TYPE,"particleSmoke_32"),r=this.__entityManager.addComponent(t,"ParticleSystemComponent",!1);r.setName("MissileDamageVFX"),r.setParticleSystem(i),r.setTextureRegion(n),r.attachTo(t.getRootComponent())}else{var s=t.getComponent("ParticleSystemComponent");s&&this.__entityManager.removeComponent(t,s)}},onExit:function(){var e=this.__gameLogic;e.__shipResources.setResource(f.HEALTH,e.getPlayerMaxHealth()),e.setActiveAllGameplayEntities(!0),e.__fpsTracker.beginTracking(),e.__ship.getRootComponent().setTintColor(4294967295),e.__backgroundLayer.setScrollVelocity(_.BG_SCROLL_VELOCITY),e.__bottomLayer.setScrollVelocity(e.__gameParameters.baseVelocity*e.__gameParameters.bottomScrollMultiplier*e.__gameParameters.mapScrollMultiplier),e.__midLayer.setScrollVelocity(e.__gameParameters.baseVelocity*e.__gameParameters.midScrollMultiplier*e.__gameParameters.mapScrollMultiplier),e.__topLayer.setScrollVelocity(e.__gameParameters.baseVelocity*e.__gameParameters.topScrollMultiplier*e.__gameParameters.mapScrollMultiplier);this.__gameLogic.getPlayerShip().getComponent("RecordPositionComponent");if(!this.__isContinue){var t=e.__eventManager.getNewEvent(I);t.setScore(0),t.setTotalScore(0),e.__eventManager.queueEvent(t),r.isMobileDevice&&(e.__initialShipAdvance=!0,e.__initialShipAdvanceTimerMS=0);var i=x.getReplayManager(),n=i.getReplays(),s=n.length,a=i.getNumRequested();e.lastRunRatioReplaysLoaded=i.getRatioLoaded();for(var c=0;c<s;++c){var d=n[c];d.positions.length>0&&e._createGhost(d)}h.trackEvent("gqs","Replays Loaded",{numLoaded:s,numRequested:a}),u.event("Replays Loaded",{contextId:e.__playerManager.getContextId(),numLoaded:s,numRequested:a})}e.__lastInputX=null,e.__lastInputY=null;var g=e.__eventManager.getNewEvent(w);g.setOldEnergy(0),g.setNewEnergy(0),e.__eventManager.queueEvent(g),"autoTest"===l.getUrlParams().mode&&(e.__slowMotion=!1,e.setSlowMotionEnabled(!1));var p=e.__eventManager.getNewEvent(S);e.__eventManager.queueEvent(p),e.__isPlayingGame=!0,o.setChannelGain("SFX",1,0),this.__isContinue&&e.__sounds.play("revive")}})}),define("gameplay/states/PlayingState",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/audio/SoundManager","thor/util/FSM","Constants","GameLogic"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=(e("thor/core/Validation"),e("thor/audio/SoundManager"),e("thor/util/FSM").State);e("Constants"),e("GameLogic");i.exports=n.create(s,{initialize:function(e){this.__gameLogic=e},onEnter:function(){r.debug("Playing"),this.__gameLogic.__boss=null;for(var e=this.__gameLogic.getGhosts(),t=0,i=e.length;t<i;++t){e[t].getComponent("ReplayPositionComponent").setPaused(!1)}this.__gameLogic.__ship.getComponent("RecordPositionComponent").startRecording(this.__gameLogic.__replayPositions)},onExit:function(){for(var e=this.__gameLogic.getGhosts(),t=0,i=e.length;t<i;++t){e[t].getComponent("ReplayPositionComponent").setPaused(!0)}}})}),define("gameplay/states/BossState",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/util/FSM"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i)),s=(e("thor/core/Validation"),e("thor/util/FSM").State);i.exports=n.create(s,{initialize:function(e){this.__gameLogic=e},onEnter:function(){r.debug("Boss Spawned"),this.__gameLogic.getPlayerShip().getComponent("RecordPositionComponent").pauseRecording()}})}),define("gameplay/ScoreTypeEnum",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum"),r=n.create("ScoreType",{KILL:1,WAVE:2,GRAZE:3,BOSS_TIME_BONUS:4,MEDAL:5});i.exports=r}),define("events/BossClearedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("BossClearedEvent",539051247,{entityId:n.assertIsNumber})}),define("gameplay/states/BossKilledState",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/audio/SoundManager","thor/util/FSM","GameLogic","Constants","./../ScoreTypeEnum","ResourceTypes","bulletml/BulletMLResource","events/BossClearedEvent","ManagerRepository"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i)),s=(e("thor/core/Validation"),e("thor/audio/SoundManager"),e("thor/util/FSM").State),o=(e("GameLogic"),e("Constants")),a=e("./../ScoreTypeEnum"),_=e("ResourceTypes"),l=(e("bulletml/BulletMLResource"),e("events/BossClearedEvent")),h=e("ManagerRepository");i.exports=n.create(s,{initialize:function(e){this.__gameLogic=e,this.__missionManager=h.getMissionManager()},onEnter:function(){r.debug("Boss Killed");var e=this.__gameLogic;e.__levelSequencer.stop(),e.__bossesKilled++,this.__missionManager.trackBossKill(),e.__stats.trackBossKill();var t=e.__waveIdByEntityId[e.__boss.getId()],i=e.__activeWavesById[t],n=e.__gameTimer-i.timeSpawned;if(n<o.BOSS_MAX_KILL_TIME){var s=~~(o.BOSS_MAX_KILL_TIME-n),h=s*o.BOSS_BONUS_SCORE_PER_SECOND;e.__addToScore(h,a.BOSS_TIME_BONUS)}e.__bulletManager.expireBulletsWithMask(o.COLLISION_CATEGORY_ENEMY_BULLET),e.__entityFactory.clearEntitiesWithType("PodBossPod");var u=e.__boss.getComponent("ResourceComponent");u.deleteResource(_.DAMAGE),u.deleteResource(_.HEALTH);var c=e.__eventManager.getNewEvent(l);c.setEntityId(e.__boss.getId()),e.__eventManager.queueEvent(c),e.__spawnBossDeathAnimation()}})}),define("events/GameOverEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation","gameplay/Tournament"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));e("thor/core/Validation"),e("gameplay/Tournament");i.exports=n.generateEventClass("GameOverEvent",4221609060,{})}),define("gameplay/states/GameOverState",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/audio/SoundManager","thor/util/FSM","GameLogic","events/GameOverEvent","events/ChangeMusicEvent","thor/entity/EntityDestroyedEvent","ManagerRepository","ui/MusicTypeEnum"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i)),s=(e("thor/core/Validation"),e("thor/audio/SoundManager"),e("thor/util/FSM").State),o=(e("GameLogic"),e("events/GameOverEvent")),a=e("events/ChangeMusicEvent"),_=e("thor/entity/EntityDestroyedEvent"),l=e("ManagerRepository"),h=e("ui/MusicTypeEnum");i.exports=n.create(s,{initialize:function(e){this.__gameLogic=e},onEnter:function(){r.debug("GameOver");var e=this.__gameLogic;e.__fpsStats=e.__fpsTracker.endTracking();var t=e.__eventManager.getNewEvent(o);if(e.__eventManager.queueEvent(t),e.__isPlayingGame=!1,e.__laserManager.deactivateLaserBeam(),e.__bossWarningEntity&&e.__bossWarningEntity.isActive()){var i=e.__eventManager.getNewEvent(_);i.setEntityId(e.__bossWarningEntity.getId()),e.__eventManager.queueEvent(i)}if(e.__bossDeathAnimation&&e.__bossDeathAnimation.isActive()){var n=e.__eventManager.getNewEvent(_);n.setEntityId(e.__bossDeathAnimation.getId()),e.__eventManager.queueEvent(n),e.__bossDeathAnimation=null}e.__handleComboBreak(),l.getFUEManager().endRun();var s=e.__eventManager.getNewEvent(a);s.setMusicType(h.INTRO),e.__eventManager.queueEvent(s)}})}),define("events/GameEndSequenceEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event")),r=e("thor/core/Validation");i.exports=n.generateEventClass("GameEndSequenceEvent",3990084375,{showContinue:r.isBoolean,goldCollected:r.isNumber,score:r.isNumber})}),define("gameplay/states/ContinueState",["require","exports","module","thor/core/Class","thor/util/FSM","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/util/StringUtil","GameLogic","Constants","events/GameEndSequenceEvent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/util/FSM").State,s=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i)),o=(e("thor/core/Validation"),e("thor/util/StringUtil")),a=(e("GameLogic"),e("Constants")),_=e("events/GameEndSequenceEvent");i.exports=n.create(r,{initialize:function(e){this.__gameLogic=e},onEnter:function(){s.debug("Continue"),this.__gameLogic.pauseBackgrounds(),this.__gameLogic.setActiveAllGameplayEntities(!1);var e=this.__gameLogic.__playerManager.getPlayerGold(),t=this.__gameLogic._gold,i=e+t,n=this.__gameLogic.__eventManager.getNewEvent(_),r=i>=a.COST_TO_CONTINUE,l=!this.__gameLogic.__hasUsedContinue&&r;"autoTest"===o.getUrlParams().mode&&(l=!1),n.setShowContinue(l),n.setGoldCollected(t),n.setScore(this.__gameLogic.__points),this.__gameLogic.__eventManager.queueEvent(n)}})}),define("gameplay/states/DyingState",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/audio/SoundManager","thor/util/FSM","GameLogic","thor/entity/EntityDestroyedEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i)),s=(e("thor/core/Validation"),e("thor/audio/SoundManager"),e("thor/util/FSM").State);e("GameLogic"),e("thor/entity/EntityDestroyedEvent");i.exports=n.create(s,{initialize:function(e){this.__gameLogic=e},onEnter:function(){r.debug("Dying");var e=this.__gameLogic;e.__isPlayingGame=!1,e.__laserManager.deactivateLaserBeam(),e.__handleComboBreak()}})}),define("gameplay/states/RevivingState",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/util/FSM","GameLogic","Constants","events/PlayerStateEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Device"),e("thor/core/Logger").getLogger(i)),s=e("thor/core/Validation"),o=e("thor/util/FSM").State,a=(e("GameLogic"),e("Constants")),_=e("events/PlayerStateEvent");i.exports=n.create(o,{initialize:function(e){this.__gameLogic=e},onEnter:function(){r.debug("Reviving");var e=this.__gameLogic;if(e.__isShipDead=!1,e.__slowMotion=!1,e.__backgroundLayer.setScrollVelocity(a.BG_SCROLL_VELOCITY*e.__gameParameters.mapScrollMultiplier),e.__shipY=e.__gameBounds.height*a.SPAWN_HEIGHT_PERCENTAGE,e.__ship=e.__createPlayerShip(),e.__shipResources=e.__ship.getComponent("ResourceComponent"),e.__shipEntityId=e.__ship.getId(),e.findShipOverlayComponents(),s.isObject(e.__bossDeathAnimation)&&e.__bossDeathAnimation.isActive()){var t=e.__eventManager.getNewEvent(EntityDestroyedEvent);t.setEntityId(e.__bossDeathAnimation.getId()),t.setDestroyedByPlayer(!1),e.__eventManager.queueEvent(t),e.__bossDeathAnimation=null}e.__ship.getComponent("TemporaryInvincibilityComponent").startInvincibility();var i=e.__eventManager.getNewEvent(_);i.setPlayerEntity(e.__ship),e.__eventManager.queueEvent(i),r.debug("Player is entity: "+e.__shipEntityId),e.__fsm.transitionTo("prepare",{isContinue:!0})}})}),define("events/IntroStartEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));i.exports=n.generateEventClass("IntroStartEvent",547578,{})}),define("events/IntroEndEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));i.exports=n.generateEventClass("IntroEndEvent",547580,{})}),define("gameplay/states/DelayState",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/util/FSM","ManagerRepository","events/IntroStartEvent","events/IntroEndEvent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Device"),s=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/util/FSM").State),o=(e("ManagerRepository"),e("events/IntroStartEvent")),a=e("events/IntroEndEvent");i.exports=n.create(s,{initialize:function(e){this.__gameLogic=e},onEnter:function(){r.forceResize(),this.__gameLogic.__eventManager.registerEventHandler(a.EVENT_TYPE,this.__transitionOut.bind(this));var e=this.__gameLogic.__eventManager.getNewEvent(o);this.__gameLogic.__eventManager.queueEvent(e)},onExit:function(){this.__gameLogic.__eventManager.unregisterEventHandler(a.EVENT_TYPE,this.__transitionOut.bind(this)),this.__gameLogic.__levelSequencer.play()},__transitionOut:function(){this.__gameLogic.__fsm.transitionTo("playing")}})}),define("thor/graphics/animation/skeleton/attachment/EntityAttachment",["require","exports","module","thor/core/Class","thor/core/Validation","./Attachment","./AttachmentType","thor/entity/Entity"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("./Attachment")),s=e("./AttachmentType");e("thor/entity/Entity");i.exports=n.create(r,{initialize:function(e){r.prototype.initialize.call(this,e,s.ENTITY),this.rootComponent=null},setEntity:function(e){this.rootComponent=e.getRootComponent()}})}),
define("GameLogic",["require","exports","module","thor/util/FSM","thor/core/Base","thor/core/Class","thor/core/Device","thor/entity/Entity","thor/core/Logger","thor/core/Validation","thor/util/LocalStorage","thor/debug/PerformanceOverlay","thor/resources/ResourceManager","thor/debug/FPSTracker","thor/math/MatrixOrderings","thor/util/Timer","thor/platforms/Google","thor/analytics/Seidr","thor/audio/SoundSprite","thor/util/TimeoutContext","thor/config/Config","events/WaveSpawnedEvent","events/ReplayEndedEvent","thor/event/EventManager","events/CollisionEvent","events/HideMenuUIEvent","events/ShowMenuUIEvent","events/GameResetEvent","events/GameContinueEvent","events/GameStartedEvent","events/GameStartingEvent","events/SpawnEntityEvent","events/InputStartedEvent","events/InputEndedEvent","events/InputMovedEvent","events/ComboUpdateEvent","events/PlayerHealthEvent","events/PlayerEnergyEvent","events/PlayerDebrisEvent","events/ExplodeEntityEvent","events/ShockEntityEvent","events/ExplodePlayerEvent","events/GoldChangedEvent","events/ScoreChangedEvent","events/HidePlayerShipEvent","thor/entity/EntityDestroyedEvent","events/SpawnBulletMLEntityEvent","events/BossEntityCreatedEvent","events/BossTimerUpdateEvent","events/BossSpawnedEvent","events/MinibossSpawnedEvent","events/BossKilledEvent","events/BossPinataEvent","events/BossCompleteEvent","events/MinibossSpawnedEvent","events/BulletMLEvent","events/ActivateLaserEvent","events/DeactivateLaserEvent","events/DisableProjectilesEvent","events/SystemUpgradeComboEvent","events/LevelSectionChangedEvent","events/CompleteGameEndingEvent","events/PlayerDoneExplodingEvent","events/ReturnToFacebookEvent","events/SpawnUpgradeEvent","gameplay/LevelSequencer","gameplay/LevelGroupTypeEnum","gameplay/LevelSectionTypeEnum","thor/math/MersenneTwister","thor/entity/World","thor/entity/EntityManager","thor/util/StringUtil","thor/util/JSONLoader","thor/graphics/resources/TextureRegionResource","thor/graphics/resources/AnimatedSpriteResource","bulletml/ActionGlobals","bulletml/BulletMLResource","bulletml/BulletDefinition","Constants","GameStats","MapManager","BulletManager","EntityFactory","ResourceTypes","events/GameBoundsEvent","UpgradeTypeEnum","TiledBackground","CollisionManager","ManagerRepository","player/PlayerManager","AchievementManager","LaserManager","StaticShockManager","ShipSkinManager","mission/MissionManager","./gameplay/Tournament","./gameplay/EnemyTypeEnum","./gameplay/GameParameters","./cards/CardParameters","./cards/CardEffectEnum","./gameplay/WeightedSelector","./gameplay/states/LoadingState","./gameplay/states/IdleState","./gameplay/states/PrepareState","./gameplay/states/PlayingState","./gameplay/states/BossState","./gameplay/states/BossKilledState","./gameplay/states/GameOverState","./gameplay/states/ContinueState","./gameplay/states/DyingState","./gameplay/states/RevivingState","./gameplay/states/DelayState","thor/audio/SoundSpriteResourceLoader","thor/audio/SoundManager","thor/graphics/animation/Tween","thor/graphics/animation/TweenGroup","thor/math/ColorUtil","./gameplay/ScoreTypeEnum","SystemType","gameplay/systems/ShipSystems","components/ActionComponent","thor/graphics/animation/skeleton/Skin","thor/graphics/animation/skeleton/attachment/RegionAttachment","thor/graphics/animation/skeleton/attachment/EntityAttachment"],function(e,t,i){var n=e("thor/util/FSM"),r=(e("thor/core/Base"),e("thor/core/Class")),s=e("thor/core/Device"),o=(e("thor/entity/Entity"),e("thor/core/Logger").getLogger(i)),a=e("thor/core/Validation"),_=e("thor/util/LocalStorage"),l=e("thor/debug/PerformanceOverlay"),h=(e("thor/resources/ResourceManager"),e("thor/debug/FPSTracker")),u=(e("thor/math/MatrixOrderings"),e("thor/util/Timer")),c=e("thor/platforms/Google"),d=e("thor/analytics/Seidr"),g=e("thor/audio/SoundSprite"),p=e("thor/util/TimeoutContext"),m=(e("thor/config/Config"),e("events/WaveSpawnedEvent")),f=e("events/ReplayEndedEvent"),v=(e("thor/event/EventManager"),e("events/CollisionEvent")),y=e("events/HideMenuUIEvent"),E=e("events/ShowMenuUIEvent"),S=e("events/GameResetEvent"),T=e("events/GameContinueEvent"),C=e("events/GameStartedEvent"),I=e("events/GameStartingEvent"),w=e("events/SpawnEntityEvent"),b=e("events/InputStartedEvent"),M=e("events/InputEndedEvent"),x=e("events/InputMovedEvent"),R=e("events/ComboUpdateEvent"),P=e("events/PlayerHealthEvent"),A=e("events/PlayerEnergyEvent"),N=(e("events/PlayerDebrisEvent"),e("events/ExplodeEntityEvent")),D=e("events/ShockEntityEvent"),L=e("events/ExplodePlayerEvent"),O=e("events/GoldChangedEvent"),V=e("events/ScoreChangedEvent"),B=(e("events/HidePlayerShipEvent"),e("thor/entity/EntityDestroyedEvent")),k=e("events/SpawnBulletMLEntityEvent"),W=e("events/BossEntityCreatedEvent"),F=e("events/BossTimerUpdateEvent"),U=e("events/BossSpawnedEvent"),G=e("events/MinibossSpawnedEvent"),H=e("events/BossKilledEvent"),q=e("events/BossPinataEvent"),Y=e("events/BossCompleteEvent"),G=e("events/MinibossSpawnedEvent"),z=e("events/BulletMLEvent"),X=e("events/ActivateLaserEvent"),K=e("events/DeactivateLaserEvent"),j=e("events/DisableProjectilesEvent"),Q=e("events/SystemUpgradeComboEvent"),Z=e("events/LevelSectionChangedEvent"),J=e("events/CompleteGameEndingEvent"),$=e("events/PlayerDoneExplodingEvent"),ee=e("events/ReturnToFacebookEvent"),te=e("events/SpawnUpgradeEvent"),ie=e("gameplay/LevelSequencer"),ne=e("gameplay/LevelGroupTypeEnum"),re=e("gameplay/LevelSectionTypeEnum"),se=e("thor/math/MersenneTwister"),oe=(e("thor/entity/World"),e("thor/entity/EntityManager"),e("thor/util/StringUtil")),ae=e("thor/util/JSONLoader"),_e=e("thor/graphics/resources/TextureRegionResource"),le=e("thor/graphics/resources/AnimatedSpriteResource"),he=(e("bulletml/ActionGlobals"),e("bulletml/BulletMLResource")),ue=e("bulletml/BulletDefinition"),ce=e("Constants"),de=e("GameStats"),ge=e("MapManager"),pe=(e("BulletManager"),e("EntityFactory"),e("ResourceTypes")),me=e("events/GameBoundsEvent"),fe=e("UpgradeTypeEnum"),ve=e("TiledBackground"),ye=(e("CollisionManager"),e("ManagerRepository")),Ee=(e("player/PlayerManager"),e("AchievementManager"),e("LaserManager"),e("StaticShockManager"),e("ShipSkinManager"),e("mission/MissionManager"),e("./gameplay/Tournament"),e("./gameplay/EnemyTypeEnum"),e("./gameplay/GameParameters")),Se=e("./cards/CardParameters"),Te=e("./cards/CardEffectEnum"),Ce=(e("./gameplay/WeightedSelector"),e("./gameplay/states/LoadingState")),Ie=e("./gameplay/states/IdleState"),we=e("./gameplay/states/PrepareState"),be=e("./gameplay/states/PlayingState"),Me=e("./gameplay/states/BossState"),xe=e("./gameplay/states/BossKilledState"),Re=e("./gameplay/states/GameOverState"),Pe=e("./gameplay/states/ContinueState"),Ae=e("./gameplay/states/DyingState"),Ne=e("./gameplay/states/RevivingState"),De=e("./gameplay/states/DelayState"),Le=e("thor/audio/SoundSpriteResourceLoader"),Oe=e("thor/audio/SoundManager"),Ve=e("thor/graphics/animation/Tween"),Be=e("thor/graphics/animation/TweenGroup"),ke=e("thor/math/ColorUtil"),We=e("./gameplay/ScoreTypeEnum"),Fe=e("SystemType"),Ue=(e("gameplay/systems/ShipSystems"),e("components/ActionComponent"),e("thor/graphics/animation/skeleton/Skin")),Ge=(e("thor/graphics/animation/skeleton/attachment/RegionAttachment"),e("thor/graphics/animation/skeleton/attachment/EntityAttachment")),He={};He[fe.FUEL_PICKUP]="FuelPickup",He[fe.SYSTEM_UPGRADE]="SystemUpgrade";var qe={};qe[fe.FUEL_PICKUP]="FUEL",qe[fe.SYSTEM_UPGRADE]="SYSTEM UPGRADE";var Ye={};Ye[fe.FUEL_PICKUP]=216852991,Ye[fe.SYSTEM_UPGRADE]=4294967295;var ze={};ze[Fe.GUN]="GUN POWER UP",ze[Fe.MISSILE]="MISSILE POWER UP",ze[Fe.COMPANION]="COMPANION POWER UP";var Xe={};Xe[Fe.GUN]=4293661183,Xe[Fe.MISSILE]=3511222271,Xe[Fe.COMPANION]=4170456319;var Ke={},je=[0,0],Qe=[0,0],Ze=[0,0],Je=[0,0],$e={attachParent:null},et={attachParent:null},tt=["GOOD!","GREAT!"],it=["SUPER!","AMAZING!","FANTASTIC!","INCREDIBLE!"],nt=[],rt=[],st={1:4294967295,2:2382324223,3:4294457599,4:4288807167,5:4280558847,6:193069055,7:3058222591,8:1010646527},ot={LOCAL:"local"},at={MAP_MANAGER:0,LEVEL_SEQUENCER:1},_t=Object.keys(at).length,lt={SimpleMissile:ce.MISSILES_Z_INDEX,ClusterMissile:ce.MISSILES_Z_INDEX,ClusterMissileMini:ce.MISSILES_Z_INDEX,MiniBoss:ce.MINIBOSS_Z_INDEX},ht=[3,1,4,4,4,2];i.exports=r.create({initialize:function(e,t,i,r,o,a,c,d,g,y,E,R,P,O){this.gameMode=ot.LOCAL,this.__world=e,this.__stats=null;var V=this.__world.getScene().getRootComponent(),W=t.getEntityManager();this.__entityManager=W,this.__entityFactory=t,this.__replayManager=ye.getReplayManager(),this.__raidManager=ye.getRaidManager(),this.__gameplayScene=W.createEntity();var F=W.addComponent(this.__gameplayScene,"SceneComponent",!1);this.__gameplayScene.setRootComponent(F),F.attachTo(V),F.register(e),F.beginPlay(),W.activateEntity(this.__gameplayScene),$e.attachParent=F,this.__uiScene=W.createEntity();var ne=W.addComponent(this.__uiScene,"SceneComponent",!1);this.__uiScene.setRootComponent(ne),ne.attachTo(V),ne.register(e),ne.beginPlay(),W.activateEntity(this.__uiScene),et.attachParent=ne,this.__eventManager=i,this.__bulletManager=r,this.__collisionManager=o,this.__playerManager=a,this.__achievementManager=R,this.__missionManager=P,this.__laserManager=c,this.__staticShockManager=O,this.__shipSkinManager=E,this.__gameMersenneTwister=d,this.__lootMersenneTwister=new se(this.__gameMersenneTwister.int()),this.__actionGlobals=g,this.__gameParameters=Ee.fromExisting({}),this.__cardParameters=Se.fromExisting({}),this.__subRNGS=[];for(var re=0;re<_t;++re)this.__subRNGS.push(new se(this.__gameMersenneTwister.int()));this.__levelSequencer=new ie(this.__eventManager,y,this,this.__subRNGS[at.LEVEL_SEQUENCER]),this.__mapManager=new ge(this.__subRNGS[at.MAP_MANAGER],e),this.__slowMotionMultiplier=1,this.__playerInvincible=!1,this.__fpsTracker=new h,this.__backgroundLayer={},this.__planetLayer={},this.__asteroidLayer={},this.__bottomLayer={},this.__midLayer={},this.__topLayer={},this.__layers=[],this.__slowMotion=!0,this.__disableSlowMotion=!1,this.__fastMotion=!1,this.__gameTimer=0,this.__bossesKilled=0,this.__kills=0,this.__maxKillStreak=0,this.__points=0,this.__killPoints=0,this.__comboPoints=0,this.__energyPoints=0,this.__chargePoints=0,this.__playerDeathDistance=0,this.__ship=null,this.__shipResources=null,this.__shipEntityId=null,this.__deathCount=0,this.__shipY=0,this.__enemyProjectilesEnabled=!0,this.__enemyProjectilesDisabledTimer=0,this.__playerProjectilesEnabled=!0,this.__playerProjectilesDisabledTimer=0,this.__fireInterval=+_.getItem(ce.DEBUG_FIRING_INTERVAL)||ce.DEFAULT_FIRING_INTERVAL,this.__missileDamage=+_.getItem(ce.DEBUG_MISSILE_DAMAGE)||null,this.__spawnedEntityCount=0,this.__spawnedEntitiesByType={},this.__spawnedEntityTypesById={},this.__entitiesOnScreen={},this.__sidekickEntities=[],this.__playerActionComponentInfos=[],this.__entityVelocity=0,this.__activeWavesById={},this.__waveIdByEntityId={},this.__currentWaveId=0,this.__distance=0,this.__sctQueue=[],this.__sctQueueTimer=0,this.__lastInputX=null,this.__lastInputY=null,this.__comboCount=0,this.__comboMultiplier=1,this.__isPlayingGame=!1,this.__isGrazing=!1,this.__grazingEntityId=null,this.__grazingCollided=!1,this.__fuel=this.__gameParameters.maxFuel,this.__hitSoundCooldown=0,this.__fuelTimer=new u(1e3),this.__activeInstructionsShown=!1,this.__isFUE=!1,this.__isShipDead=!1,this._gold=0,this.__shipSystems=null,this.__storedUpgrades={},this.__logHealth=!1,this.__hasUsedContinue=!1,this.__initialShipAdvance=!1,this.__initialShipAdvanceTimerMS=0,this.__wasInBoss=!1,this.__isLoaded=!1,this.__gamePaused=!1,this.__gameSpeedMultiplier=1,this.__staticShockDamage=0,this.__ghosts=[],this.__shipDamageTweenGroup=null,this.__shipIdleComponent=null,this.__shipOverlayComponent=null,this.__cockpitOverlayComponent=null,this.__replayPositions=[],this.lastRunRatioReplaysLoaded=0,this.__bossDeathAnimation=null,i.registerEventHandler(Z.EVENT_TYPE,this.__levelSectionChangedEvent.bind(this)),i.registerEventHandler(m.EVENT_TYPE,this.__waveSpawnedEventHandler.bind(this)),i.registerEventHandler(k.EVENT_TYPE,this.__spawnBulletMLEntityEventHandler.bind(this)),i.registerEventHandler(C.EVENT_TYPE,this.__gameStartedEventHandler.bind(this)),i.registerEventHandler(I.EVENT_TYPE,this.__gameStartingEventHandler.bind(this)),i.registerEventHandler(S.EVENT_TYPE,this.__gameResetEventHandler.bind(this)),i.registerEventHandler(T.EVENT_TYPE,this.__gameContinueEventHandler.bind(this)),i.registerEventHandler(b.EVENT_TYPE,this.__inputStartedEventHandler.bind(this)),i.registerEventHandler(x.EVENT_TYPE,this.__inputMovedEventHandler.bind(this)),i.registerEventHandler(M.EVENT_TYPE,this.__inputEndedEventHandler.bind(this)),i.registerEventHandler(me.EVENT_TYPE,this.__gameBoundsEventHandler.bind(this)),i.registerEventHandler(w.EVENT_TYPE,this.__spawnEntityEventHandler.bind(this)),i.registerEventHandler(v.EVENT_TYPE,this.__collisionEventHandler.bind(this)),i.registerEventHandler(B.EVENT_TYPE,this.__entityDestroyedEventHandler.bind(this)),i.registerEventHandler(N.EVENT_TYPE,this.__explodeEntityEventHandler.bind(this)),i.registerEventHandler(D.EVENT_TYPE,this.__shockEntityEventHandler.bind(this)),i.registerEventHandler(L.EVENT_TYPE,this.__explodePlayerEventHandler.bind(this)),i.registerEventHandler(z.EVENT_TYPE,this.__bulletMLEventHandler.bind(this)),i.registerEventHandler(X.EVENT_TYPE,this.__activateLaserEventHandler.bind(this)),i.registerEventHandler(K.EVENT_TYPE,this.__deactivateLaserEventHandler.bind(this)),i.registerEventHandler(j.EVENT_TYPE,this.__disableProjectilesEventHandler.bind(this)),i.registerEventHandler(Q.EVENT_TYPE,this.__handleSystemUpgradeComboEvent.bind(this)),i.registerEventHandler(q.EVENT_TYPE,this.__handleBossPinataEvent.bind(this)),i.registerEventHandler(U.EVENT_TYPE,this.__handleBossSpawnedEvent.bind(this)),i.registerEventHandler(G.EVENT_TYPE,this.__handleMinibossSpawnedEvent.bind(this)),i.registerEventHandler(H.EVENT_TYPE,this.__handleBossKilledEvent.bind(this)),i.registerEventHandler(Y.EVENT_TYPE,this.__handleBossCompleteEvent.bind(this)),i.registerEventHandler(G.EVENT_TYPE,this.__handleMinibossSpawnedEvent.bind(this)),i.registerEventHandler(J.EVENT_TYPE,this.__handleCompleteGameEndingEvent.bind(this)),i.registerEventHandler($.EVENT_TYPE,this.__handlePlayerDoneExplodingEvent.bind(this)),i.registerEventHandler(f.EVENT_TYPE,this.__replayEndedEventHandler.bind(this)),i.registerEventHandler(te.EVENT_TYPE,this.__spawnUpgradeEventHandler.bind(this)),"autoTest"===oe.getUrlParams().mode?(i.registerEventHandler(A.EVENT_TYPE,this.__handleAutoTestEnergyEvent.bind(this)),i.registerEventHandler(ee.EVENT_TYPE,this.__handleAutoTestReturnToFacebookEvent.bind(this)),this.__isAutoTest=!0,this.__testingPhase=0,this.__testingPart=0,this.__bossCount=0,this.__minibossCount=0):this.__isAutoTest=!1,this.__gameBounds={width:0,height:0,canvasWidth:0,scaleFactor:1,invScaleFactor:1};this.__fsm=new n("Game Logic"),this.__fsm.addState("loading",new Ce),this.__fsm.addState("idle",new Ie(this)),this.__fsm.addState("prepare",new we(this)),this.__fsm.addState("delay",new De(this)),this.__fsm.addState("playing",new be(this)),this.__fsm.addState("boss",new Me(this)),this.__fsm.addState("boss killed",new xe(this)),this.__fsm.addState("dying",new Ae(this)),this.__fsm.addState("game over",new Re(this)),this.__fsm.addState("continue",new Pe(this)),this.__fsm.addState("reviving",new Ne(this)),this.__fsm.addTransition("loading","idle"),this.__fsm.addTransition("idle","prepare"),this.__fsm.addTransition("prepare","playing"),this.__fsm.addTransition("prepare","delay"),this.__fsm.addTransition("prepare","boss"),this.__fsm.addTransition("prepare","boss killed"),this.__fsm.addTransition("delay","playing"),this.__fsm.addTransition("delay","game over"),this.__fsm.addTransition("playing","boss"),this.__fsm.addTransition("boss","boss killed"),this.__fsm.addTransition("boss","continue"),this.__fsm.addTransition("boss killed","playing"),this.__fsm.addTransition("playing","dying"),this.__fsm.addTransition("dying","continue"),this.__fsm.addTransition("boss","dying"),this.__fsm.addTransition("boss killed","dying"),this.__fsm.addTransition("continue","game over"),this.__fsm.addTransition("continue","reviving"),this.__fsm.addTransition("reviving","prepare"),this.__fsm.addTransition("playing","game over"),this.__fsm.addTransition("boss","game over"),this.__fsm.addTransition("game over","idle"),this.__fsm.setStartState("loading"),this.__fsm.reset(),s.debugFeatures[s.DEBUG_FEATURES.DEBUG_OVERLAY]&&(this.__bulletsEnabled=!0,this.__missilesEnabled=!0,this.__infiniteEnergyEnabled=!1),this.__boundGetEntityVelocity=this.getEntityVelocity.bind(this);var ae=l.getInstance();this.update=ae.addInstrumentedTask("GameLogic Update",this.update.bind(this),1e3,2,5),this.__timeoutContext=new p},isPlaying:function(){return this.__isPlayingGame},isLoaded:function(){return this.__isLoaded},getLevelSequencer:function(){return this.__levelSequencer},setSpawnerEnabled:function(e){e?this.__levelSequencer.resume():this.__levelSequencer.stop()},getScore:function(){return this.__points},getSpawnerEnabled:function(){return this.__levelSequencer.isRunning()},getActionGlobals:function(){return this.__actionGlobals},getEntityVelocity:function(){return this.__entityVelocity},getGameplayScene:function(){return this.__gameplayScene},setSeed:function(e){o.debug("Seed set to: "+e),this.__seed=e,this.__gameMersenneTwister.seed(e),this.__lootMersenneTwister.seed(this.__gameMersenneTwister.int());for(var t=0;t<this.__subRNGS.length;++t)this.__subRNGS[t].seed(this.__gameMersenneTwister.int())},getSeed:function(){return this.__seed},getCurrentState:function(){return this.__fsm.getCurrentState()},resetGame:function(){"game over"!==this.__fsm.getCurrentState()&&(this.__fsm.transitionTo("game over"),this.__storedUpgrades={});var e=this.__eventManager.getNewEvent(S);this.__eventManager.queueEvent(e)},sendGameResult:function(){var e=this.__playerDeathDistance||this.getDistance(),t=e*this.__gameParameters.pointsPerMeter;this.__playerManager.getPlayer();return Promise.all([this.__playerManager.endGame(t,this.__points,this.__kills,this.__bossesKilled,this.__spawnedEntityCount,this._gold,this.__stats,this.__fpsStats,this.__gameTimer),this.__replayManager.saveToServer(this.__points,this.__replayPositions),this.__raidManager.contribute(this.__stats)]).then(function(e){return{result:e[0],raid:e[2]}})},createDummyShip:function(e){return this.__entityFactory.createEntity(ce.DUMMY_SHIP_ENTITY_NAME,this.__world,{attachParent:e.getRootComponent()})},__createPlayerShip:function(){var e=this.__entityFactory.createEntity(ce.SHIP_ENTITY_NAME,this.__world,{sortOrder:ce.PLAYER_Z_INDEX,attachParent:this.__gameplayScene.getRootComponent()});return e.getRootComponent().setTranslation(this.__gameBounds.width*ce.SPAWN_WIDTH_PERCENTAGE,this.__shipY),this.__shipSkinManager.setEquippedSkin(e),e.getComponent("MoveTowardsComponent").stop(),e},_createGhost:function(e){if(0===e.positions.length)return void o.warn("Cannot create a ghost with no replay positions.");var t=this.__entityFactory.createEntity("Ship07Ghost",this.__world,{sortOrder:ce.GHOST_Z_INDEX,attachParent:this.__gameplayScene.getRootComponent()});t.getRootComponent().setAlphaTint(ce.GHOST_ALPHA),t.getComponent("ReplayPositionComponent").setReplay(e),this.__shipSkinManager.setShipSkin(t,e.shipId,e.skinId),this.__ghosts.push(t)},findShipOverlayComponents:function(){if(!this.__ship)return this.__shipIdleComponent=null,this.__shipOverlayComponent=null,void(this.__cockpitOverlayComponent=null);this.__shipIdleComponent=this.__ship.getComponentByName("cockpit_shine"),this.__shipOverlayComponent=this.__ship.getComponentByName("body_overlay"),this.__cockpitOverlayComponent=this.__ship.getComponentByName("cockpit_overlay"),this.__shipIdleComponent&&(this.__shipIdleComponent.stop(),this.__shipIdleComponent.restart()),this.__shipOverlayComponent&&this.__shipOverlayComponent.setTintColor(4294967040),this.__cockpitOverlayComponent&&this.__cockpitOverlayComponent.setTintColor(4294967040)},createPlayerDamageVisualEffect:function(){if(this.__ship){if(this.__playerManager.getCardEffect(Te.ALL_DAMAGE_INCREASE_PERCENT,this.__cardParameters)<=0)return this.removePlayerDamageVisualEffect();var e=this.__skeletonFactory.create("card_abilities",this.__world,{sortOrder:ce.UPGRADE_Z_INDEX-1,attachParent:this.__ship.getRootComponent()});e.getComponent("SkeletonComponent").playAnimation("All Damage Increased",!0,!1),this.__playerAllDamageAnimationEntity=e}},removePlayerDamageVisualEffect:function(){if(this.__playerAllDamageAnimationEntity){var e=this.__eventManager.getNewEvent(B);e.setEntityId(this.__playerAllDamageAnimationEntity.getId()),e.setDestroyedByPlayer(!1),this.__eventManager.queueEvent(e),this.__playerAllDamageAnimationEntity=null}},__gameStartingEventHandler:function(e){if("idle"!==this.__fsm.getCurrentState())throw new Error("Tried to transition to prepare but was not in idle state.");this.__isFUE=e.getIsFUE(),this.__fsm.transitionTo("prepare")},__gameStartedEventHandler:function(e){if("prepare"!==this.__fsm.getCurrentState())throw new Error("Tried to transition to playing but was not in prepare state.");if(this.__wasInBoss&&this.__boss){var t=this.__boss.getComponent("ResourceComponent");if(t){var i=t.getResource(pe.HEALTH);if(null===i||0===i)return void this.__fsm.transitionTo("boss killed")}this.__fsm.transitionTo("boss")}else e.getWasContinue()?(this.__levelSequencer.resume(),this.__nextLevelOnContinue&&(this.__levelSequencer.nextSection(),this.__nextLevelOnContinue=!1),this.__fsm.transitionTo("playing")):this.__fsm.transitionTo("delay")},__gameResetEventHandler:function(){if("game over"===this.__fsm.getCurrentState()){if(this.__ghosts)for(var e=0;e<this.__ghosts.length;++e){var t=this.__ghosts[e],i=t.getId();if(a.isNumber(i)){var n=this.__eventManager.getNewEvent(B);n.setEntityId(t.getId()),this.__eventManager.queueEvent(n)}}this.__ghosts=[],this.__gamePaused=!1,this.__hasUsedContinue=!1,this.__initialShipAdvance=!1,this.__destroyAllGameplayEntities(),this.__isShipDead=!1,this.__wasInBoss=!1,this.__spawnedEntityCount=0,this.__deathCount=0,this.__gameSpeedMultiplier=1,this.__slowMotionMultiplier=1,this.__spawnedEntitiesByType={},this.__spawnedEntityTypesById={},this.__entitiesOnScreen={},this.__destroyedEntitiesByType={},this.__fsm.transitionTo("idle"),this.__levelSequencer.reset(),this.unpauseBackgrounds();var r=this.__eventManager.getNewEvent(A);r.setOldEnergy(0),r.setNewEnergy(0),this.__eventManager.queueEvent(r),this.__isAutoTest&&(this.setSlowMotionEnabled(!1),this.__testingPhase>0&&(this.setPlayerInvincible(!0),this.__bossCount=0,this.__minibossCount=0))}},noContinueHandler:function(){this.__storedUpgrades={};var e=this.__eventManager.getNewEvent(J);this.__eventManager.queueEvent(e),this.__fsm.transitionTo("game over")},continueHandler:function(){var e=this,t=ce.COST_TO_CONTINUE,i=this.__playerManager.getPlayerGold();return i<ce.COST_TO_CONTINUE&&(this.__loseGold(ce.COST_TO_CONTINUE-i),t=i),this.__playerManager.continueGame(t).then(function(t){if(!t)return!1;c.trackEvent("gqs","Continue Used",{playerLevel:e.__playerManager.getPlayerLevel(),playerXP:e.__playerManager.getPlayerXP(),gold:e.__playerManager.getPlayerGold()}),d.event("Continue Used",{contextId:e.__playerManager.getContextId(),playerLevel:e.__playerManager.getPlayerLevel(),playerXP:e.__playerManager.getPlayerXP(),gold:e.__playerManager.getPlayerGold()}),e.__storedUpgrades=e.__shipSystems.getSystemsStatus(),e.__shipSystems.reset(),e.__stats.trackContinue(),e.__hasUsedContinue=!0;var i=e.__eventManager.getNewEvent(T);return e.__eventManager.queueEvent(i),!0})},die:function(){var e=this.__shipResources.getResource(pe.HEALTH);this._changePlayerHealth(-e)},getShipPosition:function(){var e=this.__ship.getRootComponent();return e.getTranslation(je),je[0]=(je[0]-this.__gameBounds.width/2)*e._worldToLocalTransform[0],je[1]=(je[1]-this.__gameBounds.height/2)*e._worldToLocalTransform[3],je},__gameContinueEventHandler:function(){if("continue"!==this.__fsm.getCurrentState())return void o.warn("Tried to continue a game, but wasn't in continue state.");this.__fsm.transitionTo("reviving")},__disableProjectilesEventHandler:function(e){this.__bulletManager.setEnemyBulletsEnabled(!1),this.__enemyProjectilesEnabled=!1,this.__enemyProjectilesDisabledTimer=e.getTimer()},__deactivateLaserEventHandler:function(e){this.__laserManager.deactivateLaserBeam()},__activateLaserEventHandler:function(e){if(!this.__gamePaused){var t=this.__laserManager.getLaserInfo(),i=this.__playerManager.getCardEffect(Te.ACTIVE_ABILITY_INCREASE_SECONDS,this.__cardParameters);if(t.duration+=i,!this.__laserManager.isActive()){if(!this.__infiniteEnergyEnabled){var n=t.energyCost,r=this.__ship.getComponent("ResourceComponent");if(!this.__ship.isActive())return;var s=r.getResource(pe.ENERGY),o=s-n;if(o<0)return;r.setResource(pe.ENERGY,o);var a=this.__eventManager.getNewEvent(A);a.setOldEnergy(s),a.setNewEnergy(o),this.__eventManager.queueEvent(a)}this.__laserManager.activateLaserBeam(this.__ship,t.duration)}}},__gameBoundsEventHandler:function(e){var t=e.getWidth(),i=e.getCanvasWidth(),n=e.getHeight();this.__gameBounds.width=t,this.__gameBounds.height=n,this.__gameBounds.canvasWidth=i;var r=i/t;this.__gameplayScene.getRootComponent().setScale(r,r),this.__gameBounds.scaleFactor=r,this.__gameBounds.invScaleFactor=1/r;var s=n*(1-r);this.__gameBounds.height=n+s,"idle"===this.__fsm.getCurrentState()&&this.__ship&&(this.__ship.getRootComponent().setTranslation(this.__gameBounds.width*ce.SPAWN_WIDTH_PERCENTAGE,this.__shipY),this.__ship.getComponent("MoveTowardsComponent").stop())},__entityDestroyedEventHandler:function(e){var t=e.getEntityId();delete this.__waveIdByEntityId[t];for(var i in this.__activeWavesById){var n=this.__activeWavesById[i];if(n.entitiesById[t]){n.activeEntities--,delete n.entitiesById[t];var r=e.getDestroyedByPlayer();if(r||n.type===ne.HAZARD||this.__handleComboBreak(),n.isComplete()){if(!r&&n.type===ne.BOSS){var s=this.__shipResources.getResource(pe.HEALTH);this._changePlayerHealth(-s)}if(r||!this.__isPlayingGame||n.type!==ne.BOSS&&n.type!==ne.MINIBOSS||this.__sounds.play("ship_flyby"),n.type===ne.MINIBOSS&&r){this.__missionManager.trackMinibossKill();ye.getFUEManager().killedMiniboss()}delete this.__activeWavesById[i]}}}delete this.__spawnedEntityTypesById[t],delete this.__entitiesOnScreen[t],t===this.__shipEntityId&&(this.__playerDeathDistance=this.getDistance(),this.__deathCount++,this.__wasInBoss="boss"===this.__fsm.getCurrentState()||"boss killed"===this.__fsm.getCurrentState(),"game over"!==this.__fsm.getCurrentState()&&this.__fsm.transitionTo("dying"),this.__slowMotion=!1)},__damageEntity:function(e,t,i){if(e&&t){var n=!1,r=(e.getId(),e.getComponent("SoundOnEventComponent"),t.getResource(pe.HEALTH));return r=t.modifyResource(pe.HEALTH,-i),0===r&&(n=!0,this.__handleEntityDestroyed(e,t)),n}},__collideEntities:function(e,t,i,n){e.getRootComponent().getTranslation(Qe);var r=e.getComponent("SoundOnEventComponent"),s=(t.getComponent("SoundOnEventComponent"),e.getComponent("BlinkComponent")),o=n.getResource(pe.DAMAGE),a=i.getResource(pe.HEALTH),_=i.getResource(pe.INVULNERABILITY),l=e.getId();t.getId();e.getId()===this.__shipEntityId&&o>0&&(this.__grazingCollided=!0);var h=!1;if(r&&o>0&&this.__hitSoundCooldown<=0&&(r.playSound("hit"),this.__hitSoundCooldown=30),null!==o&&null!==a){if(null!==_&&0!==_&&(o=0),l===this.__shipEntityId){o*=1-this.__playerManager.getCardEffect(Te.DAMAGE_REDUCTION_PERCENT,this.__cardParameters)/100,!this.__playerInvincible&&o>0&&(this._changePlayerHealth(-1*o),r&&0!==a&&r.playSound("lost_health"))}else o=this.__applyDamageBonus(o,t),a=i.modifyResource(pe.HEALTH,-o);0!==o&&s&&(l===this.__shipEntityId?s.startBlinking(200):s.startBlinking(100)),0===a&&(h=!0,this.__handleEntityDestroyed(e,i))}var u=e.getComponent("BulletComponent");if(u){if(this.__bulletManager.expireBulletIndex(u.getBulletIndex()),"cluster_missile"==u.getBulletType()){var c=this.__eventManager.getNewEvent(z);c.setBulletEventType("triggerSpawnCluster"),c.setBulletData(u.getBulletData().clone()),this.__eventManager.queueEvent(c)}return this.__showSmallExplosion(Qe[0],Qe[1]),!1}var d=t.getComponent("CollisionComponent")||t.getComponent("RectCollisionComponent");return d&&d.getCategory()&ce.COLLISION_CATEGORY_ENEMY_EMP&&l===this.__shipEntityId&&this.__startPlayerBulletsDisabledTimer(),h},__handleEntityDestroyed:function(e,t){var i=e.getId(),n=e.getComponent("SoundOnEventComponent");if(e.getRootComponent().getTranslation(Qe),i===this.__shipEntityId&&(n&&n.playSound("death"),this.__handlePlayerAboutToDie()),t.getResource(pe.EXPLODE_ON_DEATH)&&i!==this.__shipEntityId){var r=this.__eventManager.getNewEvent(N);r.setX(Qe[0]),r.setY(Qe[1]),r.setEntityId(i);var s=t.getResource(pe.EXPLOSION_SCALE);a.isNumber(s)?r.setScale(s):r.setScale(1),this.__eventManager.queueEvent(r)}"boss"!==this.__fsm.getCurrentState()&&(this.__handleEntityDrops(e,t,Qe),n&&n.playSound("death"));var o=t.getResource(pe.UPGRADE);o&&this.__handleUpgrade(o,e);var _=t.getResource(pe.GOLD_PICKUP);_&&(this.__gainGold(_),this.__spawnMagnetCardAnimation(),this.__missionManager.trackCollectGold(),this.__stats.trackCollectGold())},__applyDamageBonus:function(e,t){var i,n=t.getComponent("CollisionComponent");if(n||(n=t.getComponent("RectCollisionComponent")),!n)return e;i=n.getCategory();var r=i&ce.COLLISION_CATEGORY_PLAYER_FIRED_BULLET,s=i&ce.COLLISION_CATEGORY_COMPANION_BULLET,o=i&ce.COLLISION_CATEGORY_PLAYER_MISSILE;if(!r&&!s&&!o)return e;var a=100;return a+=this.__playerManager.getCardEffect(Te.ALL_DAMAGE_INCREASE_PERCENT,this.__cardParameters),r&&(a+=this.getPlayerBulletDamageBonus()),s&&(a+=this.__playerManager.getCardEffect(Te.COMPANION_DAMAGE_INCREASE_PERCENT,this.__cardParameters)),o&&(a+=this.__playerManager.getCardEffect(Te.MISSILE_DAMAGE_INCREASE_PERCENT,this.__cardParameters)),e*a/100},__handleEntityDrops:function(e,t,i){var n=e.getId(),r=t.getResource(pe.GOLD);r&&this.__spawnGold(r,i[0],i[1]);var s=t.getResource(pe.UPGRADE_TYPE);s&&this.__spawnUpgrade(i[0],i[1],s);var o=t.getResource(pe.SCORE);if(o){this.__addToScore(o,We.KILL,i[0],i[1]),this.__incrementComboCounter();var a,_=this.__levelSequencer.getLevel();a=_?_.fuel.dropComboInterval:1e3,this.__comboCount%a==0&&this.__spawnFuelPickup(i[0],i[1]);var l=this.__spawnedEntityTypesById[n];l&&(this.__stats.trackKill(l),this.__missionManager.trackKill(l))}},__collisionEventHandler:function(e){var t=this.__entityManager.getEntity(e.getEntityIdA()),i=this.__entityManager.getEntity(e.getEntityIdB());if(t&&i){var n=t.getComponent("ResourceComponent"),r=i.getComponent("ResourceComponent");if(n&&r){var s=this.__collideEntities(t,i,n,r),o=this.__collideEntities(i,t,r,n);s&&this.__destroyCollidedEntity(t),o&&this.__destroyCollidedEntity(i)}}},__destroyCollidedEntity:function(e){var t=this.__waveIdByEntityId[e.getId()],i=this.__activeWavesById[t];if(t&&i.type===ne.BOSS){var n=this.__eventManager.getNewEvent(H);this.__eventManager.queueEvent(n);return void e.getComponent("ResourceComponent").deleteResource(pe.HEALTH)}t&&i.type===ne.MINIBOSS&&this.__stats.trackMinibossKill();var r=e.getComponent("ActionComponent");r&&this.__handleBulletMLDeathEvents(e,r);var s=this.__eventManager.getNewEvent(B);s.setEntityId(e.getId()),s.setDestroyedByPlayer(!0),this.__eventManager.triggerEvent(s)},__handleBulletMLDeathEvents:function(e,t){t.fireEvent("death");var i=e.getComponent("BulletMLComponent");if(!i)return void o.warn("Bullet ML Entity ",e," has no Bullet ML Component");for(var n=i.getChildIds(),r=0,s=n.length;r<s;r++){var a=n[r],_=this.__entityManager.getEntity(a);if(_){var l=_.getComponent("ActionComponent");l&&l.fireEvent("parentKilled")}}var h=i.getParentId(),u=this.__entityManager.getEntity(h);if(!u)return void o.warn("Got parent id of bulletML entity that wasn't an entity.");var c=u.getComponent("ActionComponent");if(!c)return void o.warn("Got parent entity of bulletML entity that has no action component.");c.fireEvent("childKilled");var d=u.getComponent("BulletMLComponent")
;if(!d)return void o.warn("Got parent entity of bulletML entity that has no BulletML component.");d.removeChildId(e.getId());var n=d.getChildIds(),s=n.length;if(0===s)c.fireEvent("allChildrenKilled");else for(var g=0;g<s;g++){var p=n[g],m=this.__entityManager.getEntity(p);if(!m)return void o.warn("Got sibling id of bulletML entity that wasn't an entity.");var f=m.getComponent("ActionComponent");if(!f)return void o.warn("Got sibling entity of bulletML entity that has no action component.");f.fireEvent("siblingKilled")}},getPlayerMaxHealth:function(){var e=1+this.__playerManager.getCardEffect(Te.FUEL_CAPACITY_INCREASE_PERCENT,this.__cardParameters)/100;return this.__gameParameters.health*e},getPlayerBulletDamageBonus:function(){return this.__playerManager.getCardEffect(Te.BULLET_DAMAGE_INCREASE_PERCENT,this.__cardParameters)},_changePlayerHealth:function(e,t){if(a.ifDefined.assertIsBoolean(t),!this.__playerInvincible&&this.__ship.isActive()){if(!this.__shipResources.getResource(pe.INVULNERABILITY)){!t&&e<0&&this.__missionManager.handlePlayerDamaged();var i=this.getPlayerMaxHealth(),n=this.__shipResources.getResource(pe.HEALTH);e=Math.min(e,i-n);var r=this.__shipResources.modifyResource(pe.HEALTH,e),s=this.__eventManager.getNewEvent(P);if(s.setOldHealth(n),s.setNewHealth(r),s.setMaxHealth(i),s.setWasHit(!t),this.__eventManager.queueEvent(s),r<=0&&!this.__isShipDead){this.__shipDamageTweenGroup&&(this.__shipDamageTweenGroup.reset(),this.__shipDamageTweenGroup=null),this.__shipIdleComponent&&this.__shipIdleComponent.stop(),this.__shipOverlayComponent&&this.__shipOverlayComponent.setTintColor(4294967040),this.__cockpitOverlayComponent&&this.__cockpitOverlayComponent.setTintColor(4294967040),this.__shipIdleComponent=null,this.__shipOverlayComponent=null,this.__cockpitOverlayComponent=null,this.removePlayerDamageVisualEffect();var o=this.__eventManager.getNewEvent(L);this.__ship.getRootComponent().getTranslation(Je),o.setX(Je[0]),o.setY(Je[1]),o.setEntityId(this.__ship.getId()),this.__eventManager.queueEvent(o);var _=this.__eventManager.getNewEvent(B);_.setEntityId(this.__ship.getId()),_.setDestroyedByPlayer(!0),this.__eventManager.queueEvent(_);var l=this.__ship.getComponent("RecordPositionComponent");this.__replayPositions=l.getPositions(),this.__handleComboBreak(),this.__isShipDead=!0}else r>0&&e<0&&!t&&this.__showPlayerDamageAnimation()}}},__handleUpgrade:function(e,t){var i=null;switch(e){case fe.FUEL_PICKUP:this.__stats.trackFuel();var n=t.getComponent("ResourceComponent").getResource(pe.FUEL),r=this.__playerManager.getCardEffect(Te.FUEL_CAPSULE_INCREASE_PERCENT,this.__cardParameters);this._changePlayerHealth(n*(1+r/100),!0),this.__missionManager.trackCollectFuel();break;case fe.SYSTEM_UPGRADE:i=t.getComponent("SystemUpgradeComponent").getSystem();var s=Fe[i];this.__missionManager.trackSystemUpgrade(s),this.__stats.trackSystemUpgrade(s),this.__shipSystems.upgrade(s),s===Fe.COMPANION&&this.handleCompanionUpgradeEffects();break;default:return void o.error("Unknown upgrade type: "+e)}var a=this.__entityFactory.createEntity("PickupText",this.__world,{sortOrder:ce.SCT_Z_INDEX,attachParent:this.__uiScene.getRootComponent()});if(a){this.__ship.getRootComponent().getTranslation(je),a.getRootComponent().setTranslation(je[0],je[1]);var _=a.getComponent("TextComponent"),l=a.getComponent("SCTComponent");i?(_.setText(ze[Fe[i]]),l.setTintColor(Xe[Fe[i]])):(_.setText(qe[e]),l.setTintColor(Ye[e])),_.setCentered(!0),l.startSCT(je[0],je[1]),this.__voiceSounds&&Ke[e]&&this.__voiceSounds.play(Ke[e],{volume:1.4})}},handleCompanionUpgradeEffects:function(){this.__playerManager.getCardEffect(Te.COMPANION_DAMAGE_INCREASE_PERCENT,this.__cardParameters)>0&&this.__shipSystems.get(Fe.COMPANION).updateCompanionUpgradeAnimations()},__handleSystemUpgradeComboEvent:function(e){if(0===e.getComboLength()){this.__stats.trackUpgradeCombo(),this.__points+=this.__gameParameters.systemUpgradeComboPoints;var t=this.__eventManager.getNewEvent(V);t.setScore(this.__points),t.setTotalScore(this.__points),this.__eventManager.triggerEvent(t);var i=this.__entityFactory.createEntity("PickupText",this.__world,{sortOrder:ce.SCT_Z_INDEX,attachParent:this.__uiScene.getRootComponent()});if(i){var n=this.__gameBounds.canvasWidth/2,r=this.__gameBounds.height/2-.1*this.__gameBounds.height;i.getRootComponent().setTranslation(n,r);var s=i.getComponent("TextComponent");s.setText("COMBO COMPLETE!"),s.setCentered(!0);var o=i.getComponent("SCTComponent");o.setTintColor(4294967295),o.setInDistance(-300),o.setMidDistance(-100),o.setOutDistance(-300),o.setScale(1.4),this.__sctQueue.push(o),this.__sctQueue.push(n),this.__sctQueue.push(r)}}},__showSmallExplosion:function(e,t){this.__emitEntityAtScenePosition("SmallExplosion",e,t,ce.HIT_Z_INDEX)},__explodePlayerEventHandler:function(e){this.__spawnPlayerDeathAnimation(e.getX(),e.getY())},__explodeEntityEventHandler:function(e){var t=e.getScale(),i=this.__emitEntityAtScenePosition("EntityExplosion",e.getX(),e.getY(),ce.EXPLOSION_Z_INDEX),n=i.getRootComponent();n.setScale(t,t),n.setRotation(2*Math.random()*Math.PI)},__shockEntityEventHandler:function(e){if(!e.getEntityId())return void o.debug("Entity died before shock was applied.");var t=this.__entityManager.getEntity(e.getEntityId()),i=t.getComponent("ResourceComponent");this.__damageEntity(t,i,this.__staticShockDamage)&&this.__destroyCollidedEntity(t)},destroyEntity:function(e){var t=this.__eventManager.getNewEvent(B);t.setEntityId(e),t.setDestroyedByPlayer(!1),this.__eventManager.triggerEvent(t)},__bulletMLEventHandler:function(e){"triggerExplosion"==e.getBulletEventType()?(this.__explodeEventBullet(e),this.__spawnClusterMiniMissiles(e)):"triggerExplosionMini"==e.getBulletEventType()?this.__explodeEventBullet(e):"triggerSpawnCluster"==e.getBulletEventType()&&this.__spawnClusterMiniMissiles(e)},__spawnClusterMiniMissiles:function(e){var t=this.__shipSystems.get(Fe.MISSILE).getClusterAction();if(t){var i=this.__eventManager.getNewEvent(k),n=new ue("Spawner",ue.BulletType.ENTITY);n.setAction(t.getAction());var r=e.getBulletData(),s=r.x,o=r.y;i.setX(s),i.setY(o),i.setVx(0),i.setVy(0),i.setAngularVelocity(0),i.setBulletDefinition(n),i.setWaveId(0),this.__eventManager.queueEvent(i)}},__explodeEventBullet:function(e){var t=e.getBulletData(),i=t.x,n=t.y;this.__emitEntityAtScenePosition("SmallExplosion",i,n,ce.EXPLOSION_Z_INDEX);var r=e.getBulletData().id,s=this.__entityManager.getEntity(r);if(s){var o=s.getComponent("BulletComponent");if(o)this.__bulletManager.expireBulletIndex(o.getBulletIndex());else{var a=this.__eventManager.getNewEvent(B);a.setEntityId(r),this.__eventManager.triggerEvent(a)}}},__gainGold:function(e){if(!(e<=0)){this._gold+=e;var t=this.__eventManager.getNewEvent(O);t.setGold(this._gold),this.__eventManager.queueEvent(t)}},__loseGold:function(e){if(!(e<=0)){this._gold-=Math.min(this._gold,e);var t=this.__eventManager.getNewEvent(O);t.setGold(this._gold),this.__eventManager.queueEvent(t)}},__addToScore:function(e,t,i,n){if(this.__isPlayingGame){switch(t){case We.KILL:this.__kills+=1,this.__killPoints+=e;case We.MEDAL:var r=this.__entityFactory.createEntity("PickupText",this.__world,{sortOrder:ce.SCT_Z_INDEX,attachParent:this.__uiScene.getRootComponent()});if(r){r.getRootComponent().setTranslation(i,n);var s=r.getComponent("TextComponent");s.setText("+"+e),s.setCentered(!0);var o=r.getComponent("SCTComponent");o.setScale(.75),o.setTintColor(4294967295),o.setInDistance(0),o.setMidDistance(-75),o.setOutDistance(-30),o.startSCT(i,n)}this.__points+=e;break;case We.WAVE:break;case We.BOSS_TIME_BONUS:this.__points+=e;break;case We.GRAZE:}var a=this.__eventManager.getNewEvent(V);a.setScore(this.__points),a.setTotalScore(this.__points),this.__eventManager.queueEvent(a),ye.getFUEManager().isLaserEnabled()&&this.__addToEnergy(),this.__addToCharge()}},getPoints:function(){return this.__points},getCurrentEnergy:function(){return this.__ship&&this.__ship.isActive()?this.__ship.getComponent("ResourceComponent").getResource(pe.ENERGY)||0:0},__addToEnergy:function(){var e=this.__ship.getComponent("ResourceComponent"),t=e.getResource(pe.ENERGY),i=this.__eventManager.getNewEvent(A);if(t<ce.MAXIMUM_ENERGY){var n=Math.floor((this.__killPoints-this.__energyPoints)/this.__gameParameters.pointsPerEnergy),r=t+n;r>=ce.MAXIMUM_ENERGY&&(r=ce.MAXIMUM_ENERGY),e.setResource(pe.ENERGY,r),i.setOldEnergy(t),i.setNewEnergy(r),this.__energyPoints+=n*this.__gameParameters.pointsPerEnergy}else i.setOldEnergy(ce.MAXIMUM_ENERGY),i.setNewEnergy(ce.MAXIMUM_ENERGY);this.__eventManager.queueEvent(i)},__addToCharge:function(){this.__killPoints-this.__chargePoints>=this.__gameParameters.pointsToCharge&&(this.__staticShockManager.addCharge(),this.__chargePoints+=this.__gameParameters.pointsToCharge)},__spawnUpgradeEventHandler:function(e){var t=e.getX(),i=e.getY(),n=e.getUpgradeType();if(n===fe.SYSTEM_UPGRADE)this.__spawnUpgrade(t,i,fe.SYSTEM_UPGRADE);else{if(n!==fe.FUEL_PICKUP)throw new Error("Unsupported upgrade type: "+n);this.__spawnFuelPickup(t,i)}},__spawnFuelPickup:function(e,t){var i,n=this.__levelSequencer.getLevel();i=n?n.fuel.dropComboTier:1;var r,s=Math.ceil(this.__comboCount/i);r=n?s*n.fuel.perComboTier:1*s,this.__stats.trackFuelSpawned();var o=this.__spawnUpgrade(e,t,fe.FUEL_PICKUP);if(o&&o.getComponent("ResourceComponent").setResource(pe.FUEL,r),this.__playerManager.getCardEffect(Te.FUEL_CAPSULE_INCREASE_PERCENT,this.__cardParameters)>0){var a=o.getComponent("AnimatedSpriteComponent"),_=this.__resourceManager.get(le.RESOURCE_TYPE,"upgrades/fuel_upgrade_pickup");a.setAnimatedSprite(_)}},__spawnUpgrade:function(e,t,i){if(a.ifDefined.assertIsNumber(i),this.__isPlayingGame&&this.__ship.isActive()){var n=this.__unlockedSystems.length;if(i===fe.SYSTEM_UPGRADE&&0===n)return void o.warn("Tried spawning an upgrade when none were unlocked");var r=He[i],s=this.__entityFactory.createEntity(r,this.__world,{sortOrder:ce.UPGRADE_Z_INDEX,attachParent:this.__gameplayScene.getRootComponent()});if(!s)return void o.warn("Failed to spawn upgrade entity");if(i===fe.SYSTEM_UPGRADE){var _=s.getComponent("SystemUpgradeComponent"),l=~~(this.__lootMersenneTwister.random()*n);_.setStartingSystem(Fe[this.__unlockedSystems[l]]),_.setLockedUpgrades(ye.getPlayerManager().getLockedUpgrades());var h=s.getComponent("DriftComponent"),u=this.__gameBounds.width*ce.UPGRADE_ZONE_UPPER_BOUND,c=this.__gameBounds.width*ce.UPGRADE_ZONE_LOWER_BOUND,d=this.__gameBounds.width*ce.UPGRADE_ZONE_LEFT_BOUND,g=this.__gameBounds.width*ce.UPGRADE_ZONE_RIGHT_BOUND;if(e<d||e>g||t<u||t>c){var p=d+this.__lootMersenneTwister.random()*(g-d),m=u+this.__lootMersenneTwister.random()*(c-u);h.setInitialDrift(p-e,m-t),h.setStartDriftingLeft(p-e>0)}else h.setStartDriftingLeft(e>.5*this.__gameBounds.width)}var f=e+this.__lootMersenneTwister.random()*ce.UPGRADE_SPREAD-.5*ce.UPGRADE_SPREAD,v=t+this.__lootMersenneTwister.random()*ce.UPGRADE_SPREAD-.5*ce.UPGRADE_SPREAD;s.getRootComponent().setTranslation(f,v);var y=s.getComponent("BackgroundMovementComponent");y&&(y.setVelocitySource(this.__boundGetEntityVelocity),y.setBottomEventHeight(this.__gameBounds.height),y.setDestroyOnLeave(!0));var E=s.getComponent("AttractComponent");return E&&E.setTargetEntityId(this.__ship.getId()),s}},__spawnGold:function(e,t,i){if(this.__isPlayingGame){this.__stats.trackGoldSpawned(e);for(var n=0;n<e;++n){var r=this.__spawnSprayMovementPickup("Gold",t,i,ce.CURRENCY_Z_INDEX,this.__gameParameters.currencyAcceleration,this.__gameParameters.currencyMinInitialVelocityY,this.__gameParameters.currencyMaxInitialVelocityY,this.__gameParameters.currencyMaxVelocityY),s=r.getComponent("AttractComponent");if(s&&this.__ship){var o=this.__playerManager.getCardEffect(Te.COLLECTION_RADIUS_INCREASE_PERCENT,this.__cardParameters),a=ce.GOLD_PICKUP_RADIUS*(1+.01*o);s.setAttractionMultiplier(ce.GOLD_ATTRACTION,ce.GOLD_ATTRACTION_STRONG,1/(a*a)),s.setTargetEntityId(this.__ship.getId())}}}},__spawnSprayMovementPickup:function(e,t,i,n,r,s,o,a){var e=this.__entityFactory.createEntity(e,this.__world,{sortOrder:n,attachParent:this.__gameplayScene.getRootComponent()}),_=this.__lootMersenneTwister.random()*ce.CURRENCY_SPREAD_X-ce.CURRENCY_SPREAD_X/2,l=this.__lootMersenneTwister.random()*(o-s)+s;e.getRootComponent().setTranslation(t,i);var h=e.getComponent("SprayMovementComponent");return h.setVelocityX(_),h.setVelocityY(l),h.setXBounds(0,this.__gameBounds.width),h.setAccelerationY(r),h.setMaxVelocityY(a),e.getComponent("PositionDespawnComponent").setBounds(this.__gameBounds),e},getSlowMotionMultiplier:function(e){if(this.__gamePaused)return 0;if(this.__fastMotion)return 4;this.__fsm.getCurrentState();if(!this.__isPlayingGame||this.__disableSlowMotion)return 1;var t;t=ye.getFUEManager().isSlowerMotionEnabled()?.1:.2;var i=1*this.__gameSpeedMultiplier;return this.__slowMotion&&this.__slowMotionMultiplier>t?(this.__slowMotionMultiplier-=e/1e3*1,this.__slowMotionMultiplier=Math.max(t,this.__slowMotionMultiplier)):!this.__slowMotion&&this.__slowMotionMultiplier<i&&(this.__slowMotionMultiplier+=e/1e3*1,this.__slowMotionMultiplier=Math.min(i,this.__slowMotionMultiplier)),this.__slowMotionMultiplier},setSlowMotionEnabled:function(e){this.__disableSlowMotion=!e},toggleFastMotion:function(){this.__fastMotion=!this.__fastMotion},isFastMotionEnabled:function(){return this.__fastMotion},__emitEntityAtScenePosition:function(e,t,i,n){var r=this.__entityFactory.createEntity(e,this.__world,$e);if(r){var s=r.getRootComponent();s.setSortOrder(n),s.setTranslation(t,i)}else o.warn("Failed to emit entity "+e);return r},__waveSpawnedEventHandler:function(e){if(this.__isPlayingGame){var t=e.getWaveInfo(),i=e.getSpawnerResource();this.__currentWaveId++,this.__activeWavesById[this.__currentWaveId]=t,t.setId(this.__currentWaveId),t.setTimeSpawned(this.__gameTimer);var n=this.__eventManager.getNewEvent(k),r=new ue("Spawner",ue.BulletType.ENTITY);r.setAction(i.getAction()),n.setX(this.__gameBounds.width/2),n.setY(0),n.setVx(0),n.setVy(0),n.setAngularVelocity(0),n.setBulletDefinition(r),n.setWaveId(t.id),this.__eventManager.triggerEvent(n)}},__spawnBulletMLEntityEventHandler:function(e){if(this.__isPlayingGame&&!this.__gamePaused){var t=e.getX(),i=e.getY(),n=e.getVx(),r=e.getVy(),s=e.getAngularVelocity(),_=e.getBulletDefinition(),l=_.id,h=_.action,u=e.getWaveId(),c=e.getParentId(),d=_.metadata||{};if((this.__enemyProjectilesEnabled||"EnemyMissile"!==l&&"MinibossMissile"!==l)&&(this.__playerProjectilesEnabled||"SimpleMissile"!==l&&"ClusterMissile"!==l)){var g=this.__entityFactory.createEntity(l,this.__world,$e),p=g.getComponent("SoundOnEventComponent");p&&p.playSound("enter_screen");var m;m=lt[l]?lt[l]:ce.FLYER_Z_INDEX,_.damage&&g.getComponent("ResourceComponent").setResource(pe.DAMAGE,_.damage),g.getRootComponent().setTranslation(t,i),g.getRootComponent().setSortOrder(m);var f=g.getComponent("PositionDespawnComponent");f&&f.setBounds(this.__gameBounds);var v=g.getComponent("BulletMLComponent");if(!v)return void o.warn("Entity spawned via BulletML didn't have a BulletMLComponent");var y=v.getBulletData();if(y.spawnedBy=u,y.x=t,y.y=i,y.vx=n,y.vy=r,y.angularVelocity=s,y.bulletDefinition=_,a.isDefined(c)&&c!==-1){v.setParentId(c);var E=this.__entityManager.getEntity(c);if(!E)return void o.warn("Got parent id of bulletML entity that wasn't an entity.");var S=E.getComponent("BulletMLComponent");if(!S)return void o.warn("Got parent entity of bulletML entity that has no BulletML component.");S.addChildId(y.id)}var T=u>0?this.__activeWavesById[u]:null;if("Spawner"!==l&&T&&T.type!==ne.HAZARD&&!d.hazard){var C=T.spawnedCount,I=T.enemyDrops[C],w=d.healthMultiplier||1,b=Math.min(this.__levelSequencer.getLoopCount(),this.__gameParameters.maxHealthIncreases),M=b*this.__gameParameters.loopDifficultyIncrease,x=(T.baseHealth+M)*w;this.__logHealth&&o.debug("Enemy Health: "+x);var R=d.valueMultiplier||1,P=T.baseValue*R;if(T.addEntity(g,P),this.__waveIdByEntityId[g.getId()]=T.id,T.type===ne.BOSS||T.type===ne.MINIBOSS){var A=this.__eventManager.getNewEvent(W);A.setBossEntity(g),this.__eventManager.queueEvent(A)}T.type===ne.BOSS&&(this.__boss=g);var N=g.getComponent("ResourceComponent");N.setResource(pe.HEALTH,x),N.setResource(pe.SCORE,P);var D=this.__lootMersenneTwister.rnd()<=T.goldChance,L=D?T.goldDropped:0;if(N.setResource(pe.GOLD,L),I){N.setResource(pe.UPGRADE_TYPE,I);var O=g.getComponent("GlowingSpriteComponent");O&&O.setGlowEnabled(!0)}g.getComponentsOfType("SpriteComponent",nt);for(var V=0;V<nt.length;V++){var B=nt[V];B.getName().indexOf("tint")!==-1&&B.setTintColor(d.color||st[1])}this.__spawnedEntitiesByType[l]?this.__spawnedEntitiesByType[l]++:this.__spawnedEntitiesByType[l]=1,this.__spawnedEntityTypesById[g.getId()]=l,this.__entitiesOnScreen[g.getId()]=g.getRootComponent(),this.__spawnedEntityCount++}var k=g.getComponent("ActionComponent");k&&(h&&k.setAction(h),k.setBulletData(y))}}},__spawnEntityEventHandler:function(e){if("playing"==this.__fsm.getCurrentState()||this.__isPlayingGame){var t=e.getEntityType(),i=e.getX(),n=e.getY(),r=this.__entityFactory.createEntity(t,this.__world,$e);if(!r)return void o.error("Failed to create entity of type "+t+", abort!");var s=r.getComponent("BackgroundMovementComponent");s&&s.setVelocitySource(this.__boundGetEntityVelocity),r.getRootComponent().setTranslation(i,n);var a=ce.FLYER_Z_INDEX,_=r.getComponent("SoundOnEventComponent");_&&_.playSound("enter_screen"),r.getRootComponent().setSortOrder(a);var l=e.getSoundSprite(),h=e.getSoundName();l&&h&&l.play(h)}},__handleBossPinataEvent:function(e){var t=e.getEntityId(),i=this.__entityManager.getEntity(t);if(!i)return void o.warn("Attempted to spawn boss drops when boss is missing from current wave");if("boss killed"===this.__fsm.getCurrentState()){var n=i.getComponent("ResourceComponent");i.getRootComponent().getTranslation(Ze);this.__handleEntityDrops(i,n,Ze);this.__sounds.play("boss_defeat_fanfare")}var r=i.getComponent("ActionComponent");r&&this.__handleBulletMLDeathEvents(i,r);var s=this.__eventManager.getNewEvent(B);s.setEntityId(t),s.setDestroyedByPlayer(!0),this.__eventManager.triggerEvent(s)},__handleBossSpawnedEvent:function(e){function t(){4===i.__testingPhase||3===i.__testingPhase||5===i.__testingPhase?setTimeout(function(){i.setPlayerInvincible(!1)},35e3):i.setPlayerInvincible(!1)}this.__fsm.transitionTo("boss");var i=this;this.__isAutoTest&&(this.__bossCount++,o.debug("Boss "+this.__bossCount+" spawned, testing phase "+this.__testingPhase+" part "+this.__testingPart),1===this.__testingPhase?(this.__killPoints+=this.__laserManager.getLaserInfo().energyCost*this.__gameParameters.pointsPerEnergy,this.__addToEnergy()):2===this.__testingPhase||3===this.__testingPhase||4===this.__testingPhase?1===this.__testingPart&&1===this.__bossCount?t():3===this.__testingPart&&2===this.__bossCount&&t():5===this.__testingPhase&&(0===this.__testingPart&&2===this.__bossCount?t():1===this.__testingPart&&3===this.__bossCount&&t()))},__handleMinibossSpawnedEvent:function(e){function t(){4===i.__testingPhase||3===i.__testingPhase?setTimeout(function(){i.setPlayerInvincible(!1)},35e3):i.setPlayerInvincible(!1)}var i=this;this.__isAutoTest&&(this.__minibossCount++,o.debug("Miniboss "+this.__minibossCount+" spawned, testing phase "+(this.__testingPhase+1)+" part "+(this.__testingPart+1)),2!==this.__testingPhase&&3!==this.__testingPhase&&4!==this.__testingPhase||(0===this.__testingPart&&1===this.__minibossCount?t():2===this.__testingPart&&2===this.__minibossCount&&t()))},__spawnMagnetCardAnimation:function(){var e=this;if(0!==this.__playerManager.getCardEffect(Te.COLLECTION_RADIUS_INCREASE_PERCENT,this.__cardParameters)&&!this.__magnetCurrentlyAnimating){this.__magnetCurrentlyAnimating=!0;var t=this.__skeletonFactory.create("card_abilities",this.__world,{sortOrder:ce.UPGRADE_Z_INDEX,attachParent:this.__ship.getRootComponent()}),i=t.getComponent("SkeletonComponent");i.playAnimation("Magnet Field",!1,!0),i.setAnimationEndedCallback(function(){var i=e.__eventManager.getNewEvent(B);i.setEntityId(t.getId()),i.setDestroyedByPlayer(!1),e.__eventManager.queueEvent(i),e.__magnetCurrentlyAnimating=!1})}},__spawnBossDeathAnimation:function(){var e=this,t=this.__boss.getComponent("ActionComponent"),i=this.__resourceManager.get(he.RESOURCE_TYPE,"bullets/spawners/boss_death");t.setAction(i.getAction());var n=[0,0];this.__boss.getRootComponent().getTranslation(n);var r=this.__skeletonFactory.create("boss_death",this.__world,{sortOrder:ce.DEATH_ANIMATION_Z_INDEX});this.__bossDeathAnimation=r,r.getRootComponent().setTranslation(n[0]+21,n[1]+37);var s=r.getComponent("SkeletonComponent");s.playAnimation("Boss Death"),s.setAnimationEndedCallback(function(){var t=e.__eventManager.getNewEvent(B);t.setEntityId(r.getId()),t.setDestroyedByPlayer(!1),e.__eventManager.queueEvent(t),e.__bossDeathAnimation=null})},__spawnGhostDeathAnimation:function(e,t,i){a.ifDefined.assertIsInstanceOf(i,_e);var n=this.__entityFactory.createEntity("GhostDebris",this.__world,{sortOrder:ce.GHOST_Z_INDEX,attachParent:this.__gameplayScene.getRootComponent()}),r=n.getRootComponent();r.setName("anchor root"),r.setTranslation(e,t);var s=this.__skeletonFactory.addToEntity(n,"ghost_death");s.setName("debris").playAnimation("friend death",!1,!1).queueAnimation("friend death idle"),s.register(this.__world),s.beginPlay();var o=this.__skeletonFactory.addToEntity(n,"ghost_death"),_=e>ce.GAME_AREA_WIDTH/2,l=_?-1:1;o.setName("avatar").playAnimation("Facebook Icon appear",!1,!1).queueAnimation("Facebook Icon Idle").setScale(l,1),o.register(this.__world),o.beginPlay();var h=o,u=h.__skeleton,c=u.skeleton;u.setDefaultSkin();var d="sources/facebook_profile",g=u.getSlotInstanceByName(d),p=g.getSlotIndex(),m=c.defaultSkin.getAttachment(p,d),f=u.getAttachment(p,d),v=this.__gameBounds.height-m.y+2*m.height;if(n.getComponent("BackgroundMovementComponent").setBottomEventHeight(v),i){var y=this.__entityManager.createEntity(),r=this.__entityManager.addComponent(y,"RegionAttachmentComponent",!1);r.setSlot(g),r.setAttachment(f),r.attachTo(h),y.setRootComponent(r);var E=this.__entityManager.addComponent(y,"SpriteComponent",!1);E.setTextureRegion(i),E.setWidth(2*m.width),E.setHeight(2*m.height),E.attachTo(r),E.beginPlay();var S=this.__entityManager.addComponent(y,"PositionDespawnComponent",!1);S.setMaxDespawnYPosition(v),S.beginPlay();var T=new Ge(d);T.setEntity(y),this.__entityManager.activateEntity(y),E.register(this.__world),r.register(this.__world),r.beginPlay(),r.update(0);var C=i.name,I=new Ue(C),w={};w[d]=T,I.attachments[g.__slotIndex]=w,c.addSkin(I),h.setSkin(C),g.updateAttachment()}},__spawnPlayerDeathAnimation:function(e,t){var i=this,n=this.__skeletonFactory.create("player_death",this.__world,{sortOrder:ce.PLAYER_EXPLOSION_Z_INDEX,attachParent:this.__gameplayScene.getRootComponent()}),r=n.getComponent("SkeletonComponent");r.playAnimation("player death",!1,!0),n.getRootComponent().setTranslation(e,t),this.__sounds.play("ship_destroy2"),r.setAnimationEndedCallback(function(){var e=i.__eventManager.getNewEvent(B);e.setEntityId(n.getId()),e.setDestroyedByPlayer(!1),i.__eventManager.queueEvent(e);var t=i.__eventManager.getNewEvent($);i.__eventManager.queueEvent(t)})},__handleBossKilledEvent:function(e){if(this.__shipResources&&this.__shipResources.getResource(pe.HEALTH)&&"boss"===this.__fsm.getCurrentState())this.__fsm.transitionTo("boss killed");else if(this.__boss&&this.__boss.isActive()){var t=this.__boss.getComponent("ResourceComponent");t&&t.deleteResource(pe.HEALTH)}},__handleBossCompleteEvent:function(){"boss killed"===this.__fsm.getCurrentState()?(this.__levelSequencer.resume(),this.__levelSequencer.nextSection(),this.__fsm.transitionTo("playing")):this.__wasInBoss&&(this.__wasInBoss=!1,this.__nextLevelOnContinue=!0)},__handlePlayerDoneExplodingEvent:function(){o.debug("PLAYER DEATH COMPLETE");var e=this;this.__timeoutContext.setTimeout(e.__fsm.transitionTo.bind(e.__fsm,"continue"),500)},__handleCompleteGameEndingEvent:function(){this.__completeGameEnding()},__handleAutoTestReturnToFacebookEvent:function(e){var t=ht[this.__testingPhase];this.__testingPart++,this.__testingPart===t&&(this.__testingPhase++,this.__testingPart=0),this.__testingPhase<ht.length?(o.debug("Auto testing game, resetting to start phase "+(this.__testingPhase+1)+", part "+(this.__testingPart+1)),this.resetGame()):window.location=window.location},__handleAutoTestEnergyEvent:function(e){if(1===this.__testingPhase){var t=this.__laserManager.getLaserInfo(),i=t.energyCost;if(!(e.getNewEnergy()<i)){var n=this.__eventManager.getNewEvent(X);n.setCardId(t.name),this.__eventManager.queueEvent(n),this.setPlayerInvincible(!1)}}},__levelSectionChangedEvent:function(e){var t=e.getLevel(),i=e.getIndex(),n=t.sections[i];if(n.type===re.ENEMY_WAVE)if(this.__gameSpeedMultiplier+=n.speedIncrease,t.groups[n.groupId].type===ne.BOSS){var r=this.__eventManager.getNewEvent(U);this.__eventManager.queueEvent(r)}else if(t.groups[n.groupId].type===ne.MINIBOSS){var s=this.__eventManager.getNewEvent(G);this.__eventManager.queueEvent(s)}},pauseBackgrounds:function(){this.__backgroundLayer.setScrollVelocity(0);for(var e=0,t=this.__layers.length;e<t;++e)this.__layers[e].setScrollVelocity(0);this.__entityVelocity=0},unpauseBackgrounds:function(){this.__backgroundLayer.setScrollVelocity(ce.BG_SCROLL_VELOCITY*this.__gameParameters.mapScrollMultiplier),this.__planetLayer.setScrollVelocity(ce.PLANET_SCROLL_VELOCITY*this.__gameParameters.mapScrollMultiplier),this.__asteroidLayer.setScrollVelocity(ce.ASTEROID_SCROLL_VELOCITY*this.__gameParameters.mapScrollMultiplier),this.__bottomLayer.setScrollVelocity(this.__gameParameters.baseVelocity*this.__gameParameters.bottomScrollMultiplier*this.__gameParameters.mapScrollMultiplier),this.__midLayer.setScrollVelocity(this.__gameParameters.baseVelocity*this.__gameParameters.midScrollMultiplier*this.__gameParameters.mapScrollMultiplier),this.__topLayer.setScrollVelocity(this.__gameParameters.baseVelocity*this.__gameParameters.topScrollMultiplier*this.__gameParameters.mapScrollMultiplier),this.__entityVelocity=this.__getCurrentScrollVelocity()},__completeGameEnding:function(){if(Oe.setChannelGain("SFX",0,ce.SFX_GAME_OVER_FADE_DURATION_SECONDS),this.__ship&&this.__ship.isActive()){this.__ship.getComponentsOfType("ActionComponent",rt);for(var e=0,t=rt.length;e<t;++e){rt[e].clearAction()}}},__destroyAllGameplayEntities:function(){var e=this.__entityFactory.getCreatedEntityIds();for(var t in e){var i=this.__eventManager.getNewEvent(B);i.setEntityId(+t),this.__eventManager.triggerEvent(i)}this.__bulletManager.expireAllBullets(),this.__entityFactory.clearEntities(),this.__laserManager.clearEntities(),this.__sidekickEntities=[]},setActiveAllGameplayEntities:function(e){var t=this.__entityFactory.getCreatedEntityIds();for(var i in t)if(i!=this.__shipEntityId){var n=this.__entityManager.getEntity(+i);!e&&n.isActive()?this.__entityManager.deactivateEntity(n):e&&!n.isActive()&&this.__entityManager.activateEntity(n)}var r=this.__bulletManager.getOwningEntity();!e&&r.isActive()?this.__entityManager.deactivateEntity(r):e&&!r.isActive()&&this.__entityManager.activateEntity(r)},__inputStartedEventHandler:function(e){if(this.__isPlayingGame){this.__slowMotion=!1,this.__lastInputX=null,this.__lastInputY=null;var t=this.__eventManager.getNewEvent(y);this.__eventManager.queueEvent(t)}},__inputEndedEventHandler:function(e){if(this.__isPlayingGame){var t=this.__eventManager.getNewEvent(E);this.__eventManager.queueEvent(t),this.__disableSlowMotion||this.__ship.isActive()&&(this.__slowMotion=!0,this.__ship.getComponent("MoveTowardsComponent").stop())}},__inputMovedEventHandler:function(e){if(this.__isPlayingGame&&this.__ship.isActive()){var t=this.__gameBounds.width*e.getXPercent(),i=this.__gameBounds.height*e.getYPercent(),n=this.__ship.getComponent("MoveTowardsComponent");if(s.isMobileDevice){(null===this.__lastInputX||null===this.__lastInputY||e.getResetRelativeLocation())&&(this.__lastInputX=t,this.__lastInputY=i);var r=n.getTarget(),o=t-this.__lastInputX,a=i-this.__lastInputY;r.x+o<0?o=-r.x:r.x+o>this.__gameBounds.width&&(o=this.__gameBounds.width-r.x),r.y+a<0?a=-r.y:r.y+a>this.__gameBounds.height&&(a=this.__gameBounds.height-r.y),n.moveTowardsRelative(o,a)}else n.moveTowards(t,i);this.__lastInputX=t,this.__lastInputY=i}},setGamePaused:function(e){"dying"!==this.__fsm.getCurrentState()&&this.__gamePaused!==e&&(this.__gamePaused=e,"delay"!==this.__fsm.getCurrentState()&&this.setSpawnerEnabled(!this.__gamePaused),this.setActiveAllGameplayEntities(!this.__gamePaused))},init:function(e){this.__resourceManager=e;var t=e.get(ae.RESOURCE_TYPE,"levels/first");this.__entityFactory.init(t,e);var i=this.getDistance.bind(this);this.__mapManager.init(t,e),this.__mapManager.setDistanceFunction(i),this.__playerActionComponentInfos.length=0,this.__laserManager.init(e.getOrDefault(Le.RESOURCE_TYPE,"game_sounds",g.EMPTY_SOUND_SPRITE)),this.__staticShockManager.init(e.getOrDefault(Le.RESOURCE_TYPE,"game_sounds",g.EMPTY_SOUND_SPRITE)),this.__backgroundLayer=new ve("Star",this.__mapManager,this.__eventManager,this.__entityManager,this.__entityFactory,this.__world,this.__gameplayScene,ce.SPACE_MAP,ce.STARFIELD_Z_INDEX,this.__gameBounds),this.__backgroundLayer.setScrollVelocity(ce.BG_SCROLL_VELOCITY*this.__gameParameters.mapScrollMultiplier),this.__planetLayer=new ve("Planet",this.__mapManager,this.__eventManager,this.__entityManager,this.__entityFactory,this.__world,this.__gameplayScene,ce.PLANET_MAP,ce.PLANET_Z_INDEX,this.__gameBounds),this.__planetLayer.setScrollVelocity(ce.PLANET_SCROLL_VELOCITY*this.__gameParameters.mapScrollMultiplier),this.__asteroidLayer=new ve("Asteroid",this.__mapManager,this.__eventManager,this.__entityManager,this.__entityFactory,this.__world,this.__gameplayScene,ce.ASTEROID_MAP,ce.ASTEROID_Z_INDEX,this.__gameBounds),this.__asteroidLayer.setScrollVelocity(ce.ASTEROID_SCROLL_VELOCITY*this.__gameParameters.mapScrollMultiplier),this.__bottomLayer=new ve("Bottom",this.__mapManager,this.__eventManager,this.__entityManager,this.__entityFactory,this.__world,this.__gameplayScene,ce.BOTTOM_MAP,ce.BOTTOM_LAYER_Z_INDEX,this.__gameBounds),this.__bottomLayer.setScrollVelocity(this.__gameParameters.baseVelocity*this.__gameParameters.bottomScrollMultiplier*this.__gameParameters.mapScrollMultiplier),this.__midLayer=new ve("Mid",this.__mapManager,this.__eventManager,this.__entityManager,this.__entityFactory,this.__world,this.__gameplayScene,ce.MID_MAP,ce.MID_LAYER_Z_INDEX,this.__gameBounds),this.__midLayer.setScrollVelocity(this.__gameParameters.baseVelocity*this.__gameParameters.midScrollMultiplier*this.__gameParameters.mapScrollMultiplier),this.__topLayer=new ve("Top",this.__mapManager,this.__eventManager,this.__entityManager,this.__entityFactory,this.__world,this.__gameplayScene,ce.TOP_MAP,ce.TOP_LAYER_Z_INDEX,this.__gameBounds),this.__topLayer.setScrollVelocity(this.__gameParameters.baseVelocity*this.__gameParameters.topScrollMultiplier),this.__gameParameters.mapScrollMultiplier,this.__layers=[this.__planetLayer,this.__asteroidLayer,this.__bottomLayer,this.__midLayer,this.__topLayer],this.__skeletonFactory=ye.getSkeletonFactory();var n=this.__skeletonFactory.load("boss_death"),r=n.getRootComponent();r.setCentered(!0),r.setScale(2,2),n=this.__skeletonFactory.load("player_death"),r=n.getRootComponent(),r.setCentered(!0),r.setScale(2,2),n=this.__skeletonFactory.load("card_abilities"),r=n.getRootComponent(),r.setCentered(!0),r.setScale(2,2),this.__fsm.transitionTo("idle")},getDistance:function(){return~~this.__distance},__getCurrentScrollVelocity:function(){if(a.isNumber(this.__gameParameters.velocityIncrement)){var e=~~(this.__gameParameters.baseVelocity+this.__gameParameters.velocityIncrement*this.__gameTimer);return a.isNumber(this.__gameParameters.maxVelocity)&&this.__gameParameters.maxVelocity>0?Math.min(e,this.__gameParameters.maxVelocity):e}return this.__gameParameters.baseVelocity},update:function(e){if(!this.__gamePaused){if(this.__isPlayingGame&&(this.__hitSoundCooldown-=e,
this.__sctQueueTimer-=e,this.__sctQueueTimer<0&&this.__sctQueue.length>0)){var t=this.__sctQueue.pop(),i=this.__sctQueue.pop();this.__sctQueue.pop().startSCT(i,t),this.__sctQueueTimer=350}if("playing"===this.__fsm.getCurrentState()||"boss"===this.__fsm.getCurrentState()||"delay"===this.__fsm.getCurrentState()){if(this.__initialShipAdvance){var n=e/ce.SHIP_INITIAL_JUMP_DURATION_MS,r=ce.SHIP_INITIAL_JUMP_OFFSET*n;this.__ship.getComponent("MoveTowardsComponent").moveTowardsRelative(0,r),this.__initialShipAdvanceTimerMS+=e,this.__initialShipAdvanceTimerMS>=ce.SHIP_INITIAL_JUMP_DURATION_MS&&(this.__initialShipAdvance=!1)}if(this.__gameTimer+=.001*e,this.__actionGlobals.time=this.__gameTimer,this.__ship.getRootComponent().getTranslation(this.__actionGlobals.aimTarget),this.__enemyProjectilesDisabledTimer>0&&(this.__enemyProjectilesDisabledTimer-=.001*e),this.__playerProjectilesDisabledTimer>0&&(this.__playerProjectilesDisabledTimer-=.001*e),this.__bulletsEnabled&&!this.__enemyProjectilesEnabled&&this.__enemyProjectilesDisabledTimer<=0&&(this.__enemyProjectilesEnabled=!0,this.__bulletManager.setEnemyBulletsEnabled(!0)),this.__bulletsEnabled&&!this.__playerProjectilesEnabled&&this.__playerProjectilesDisabledTimer<=0){this.__playerProjectilesEnabled=!0,this.__bulletManager.setPlayerBulletsEnabled(!0);var s=[];this.__ship.getComponentsOfType("ActionComponent",s);for(var o=0,a=s.length;o<a;++o){s[o].setActive(!0)}}if("boss"!==this.__fsm.getCurrentState()&&"delay"!==this.__fsm.getCurrentState()&&this.__fuelTimer.update(e)){var _,l=this.__playerManager.getCardEffect(Te.FUEL_CONSUMPTION_DECREASE_PERCENT,this.__cardParameters),h=this.__levelSequencer.getLevel();_=h?h.fuel.perSecond:0,this._changePlayerHealth(-_*(1-l/100),!0),this.__fuelTimer.set(1e3)}var u=this.__getCurrentScrollVelocity();this.__distance;this.__distance+=u*e*.001*this.__gameParameters.unitsToMeters;var c=this.__eventManager.getNewEvent(F);c.setTimeRemaining(this.__levelSequencer.timeToNextBoss()/1e3),this.__eventManager.queueEvent(c),u-this.__entityVelocity>=1&&(this.__bottomLayer.setScrollVelocity(u*this.__gameParameters.bottomScrollMultiplier*this.__gameParameters.mapScrollMultiplier),this.__midLayer.setScrollVelocity(u*this.__gameParameters.midScrollMultiplier*this.__gameParameters.mapScrollMultiplier),this.__topLayer.setScrollVelocity(u*this.__gameParameters.topScrollMultiplier*this.__gameParameters.mapScrollMultiplier),this.__entityVelocity=u),this.__levelSequencer.update(e);var r=this.getMapOffset();if(this.__gameplayScene.getRootComponent().setTranslation(r,0),this.__staticShockDamage>0&&this.__staticShockManager.getCharges()>0){var d={id:-1,d:-1},g=Object.keys(this.__entitiesOnScreen),p=[0,0];this.__ship.getRootComponent().getTranslation(p);for(var m=0,f=g.length;m<f;++m){var v=[0,0];this.__entitiesOnScreen[g[m]].getTranslation(v);var y=(v[0]-p[0])*(v[0]-p[0])+(v[1]-p[1])*(v[1]-p[1]);(y<d.d||d.d<0)&&(d.id=g[m],d.d=y)}var E=Math.sqrt(d.d)/2;if(d.d>=0&&E<this.__gameParameters.shockRange){var S=this.__entityManager.getEntity(parseInt(d.id));S&&this.__staticShockManager.activateShock(this.__ship,S)}}}this.__shipDamageTweenGroup&&this.__shipDamageTweenGroup.update(e)}},__handlePlayerAboutToDie:function(){if(this.__ghosts)for(var e=0;e<this.__ghosts.length;++e){var t=this.__ghosts[e],i=t.getComponent("ReplayPositionComponent");i.setPaused(!0)}},__replayEndedEventHandler:function(e){for(var t=0;t<this.__ghosts.length;++t){var i=this.__ghosts[t];if(i.getId()===e.getEntityId()){var n=i.getComponent("ReplayPositionComponent"),r=n.getPlayerProfileRegion();i.getRootComponent().getTranslation(je),this.__spawnGhostDeathAnimation(je[0],je[1],r);var s=this.__eventManager.getNewEvent(B);return s.setEntityId(i.getId()),this.__eventManager.queueEvent(s),void this.__ghosts.splice(t,1)}}},setVoices:function(e){this.__voiceSounds=e},getBulletsEnabled:function(){return this.__bulletsEnabled},toggleBulletsEnabled:function(){var e=[];this.__bulletsEnabled=!this.__bulletsEnabled,this.__ship.getComponentsOfType("ActionComponent",e);for(var t=0,i=e.length;t<i;++t){e[t].setActive(this.__bulletsEnabled)}this.__enemyProjectilesEnabled=this.__bulletsEnabled,this.__bulletManager.setEnemyBulletsEnabled(this.__bulletsEnabled),this.__playerProjectilesEnabled=this.__bulletsEnabled,this.__bulletManager.setPlayerBulletsEnabled(this.__bulletsEnabled)},__startPlayerBulletsDisabledTimer:function(){this.__playerProjectilesEnabled=!1,this.__bulletManager.setPlayerBulletsEnabled(!1),this.__playerProjectilesDisabledTimer=ce.PLAYER_PROJECTILE_DISABLE_TIME_SECONDS;var e=[];this.__ship.getComponentsOfType("ActionComponent",e);for(var t=0,i=e.length;t<i;++t){e[t].setActive(!1)}},setInfiniteEnergyEnabled:function(e){this.__infiniteEnergyEnabled=e},getInfiniteEnergyEnabled:function(){return this.__infiniteEnergyEnabled},getDeathCount:function(){return this.__deathCount},getPlayerInvincible:function(){return this.__playerInvincible},setPlayerInvincible:function(e){this.__playerInvincible=e,o.debug("Setting player invincible to",e)},getGameParameters:function(){return this.__gameParameters},getCardParameters:function(){return this.__cardParameters},getBounds:function(){return this.__gameBounds},getPlayerShip:function(){return this.__ship},getGhosts:function(){return this.__ghosts},getCurrentWaveEntityIds:function(){return Object.keys(this.__waveIdByEntityId).map(function(e){return parseInt(e)})},__incrementComboCounter:function(){this.__comboCount=Math.min(this.__comboCount+1,this.__gameParameters.maxComboDisplay),this.__stats.trackKillStreak(this.__comboCount);var e,t=!1,i=null;if(this.__comboCount<=100?(e=~~(this.__comboCount/50),i=tt[Math.min(tt.length-1,e-1)],t=this.__comboCount%50==0&&e>0):(e=~~((this.__comboCount-100)/100),i=it[Math.min(it.length-1,e-1)],t=this.__comboCount%100==0),t&&i){var n=this.__entityFactory.createEntity("PickupText",this.__world,{sortOrder:ce.SCT_Z_INDEX,attachParent:this.__uiScene.getRootComponent()});if(n){var r=this.__gameBounds.canvasWidth/2,s=this.__gameBounds.height/2-.1*this.__gameBounds.height;n.getRootComponent().setTranslation(r,s);var o=n.getComponent("TextComponent");o.setText(i),o.setCentered(!0);var a=n.getComponent("SCTComponent");a.setTintColor(4294967295),a.setInDistance(-300),a.setMidDistance(-100),a.setOutDistance(-300),a.setScale(1.8),this.__sctQueue.push(a),this.__sctQueue.push(r),this.__sctQueue.push(s)}}var _=this.__eventManager.getNewEvent(R);_.setCount(this.__comboCount),_.setMultiplier(1),_.setBonus(this.__comboPoints),this.__eventManager.queueEvent(_)},__handleComboBreak:function(){var e=0;if(this.__comboCount>10){var t=10*(2+~~(this.__comboCount/100));t=Math.min(t,this.__gameParameters.maxComboMultiplier),e=t*this.__comboCount}this.__comboCount>this.__maxKillStreak&&(this.__maxKillStreak=this.__comboCount),this.__points+=e,this.__comboPoints=0,this.__comboCount=0,this.__comboMultiplier=1;var i=this.__eventManager.getNewEvent(R);i.setCount(this.__comboCount),i.setMultiplier(1),i.setBonus(e),this.__eventManager.queueEvent(i);var n=this.__eventManager.getNewEvent(V);n.setScore(this.__points),n.setTotalScore(this.__points),this.__eventManager.queueEvent(n)},queueBackground:function(){for(var e=Math.max(this.__gameBounds.scaleFactor,this.__gameBounds.invScaleFactor),t=this.__gameBounds.height/2*e,i=this.__backgroundLayer.queueNewMap(0),n=Math.ceil(t/i)+1,r=0;r<n;++r)i=this.__backgroundLayer.queueNewMap(i*r,!0);this.__backgroundLayer.setScrollVelocity(ce.BG_SCROLL_VELOCITY*this.__gameParameters.mapScrollMultiplier)},getMapOffset:function(){var e=this.getShipPosition(),t=Math.max(-1,Math.min(1,2*e[0]/this.__gameBounds.width)),i=Math.abs(t),n=.01*this.__gameParameters.parallaxDeadZonePercentage,r=.01*this.__gameParameters.parallaxMapBufferPercentage;if(i<n)return 0;var s=(i-n)/(1-n);return(t<0?-(s*s):s*s)*r*ce.MAP_BUFFER*.5},setGameParameters:function(e){if(this.__gameParameters=e,this.__staticShockManager.setTiming(this.__gameParameters.shockDuration,this.__gameParameters.shockDelay),this.__ship){if(this.__shipResources){var t=this.__shipResources.getResource(pe.HEALTH)||1;this.__shipResources.setResource(pe.HEALTH,e.health);var i=this.__eventManager.getNewEvent(P);i.setOldHealth(t),i.setNewHealth(e.health),i.setMaxHealth(e.health),this.__eventManager.queueEvent(i)}var n=this.__ship.getComponentByName("collision"),r=this.__ship.getComponentByName("pickup_collision");n&&n.setRadius(e.hitRadius),r&&r.setRadius(e.pickupRadius)}},setCardParameters:function(e){this.__cardParameters=e},resetStats:function(){this.__stats=new de},getStats:function(){return this.__stats},setLaserUpgradeEquipped:function(e){this.__laserManager.changeTintColor(e)},__showPlayerDamageAnimation:function(){if(this.__shipIdleComponent&&this.__shipOverlayComponent&&this.__cockpitOverlayComponent){this.__shipDamageTweenGroup||(this.__shipDamageTweenGroup=new Be),this.__shipDamageTweenGroup.reset();var e=this;this.__shipIdleComponent.stop(),this.__shipOverlayComponent.setTintColor(4294967040),this.__cockpitOverlayComponent.setTintColor(4294967040),this.__shipDamageTweenGroup.addTweenable(new Ve(200,0,250),function(t){e.__shipOverlayComponent&&e.__shipOverlayComponent.setTintColor(ke.createRGBA(255,255,255,t.getValue()))},function(){e.__shipOverlayComponent&&(e.__shipOverlayComponent.setTintColor(ke.createRGBA(255,255,255,200)),e.__shipDamageTweenGroup.addTweenable(new Ve(200,0,250),function(t){e.__shipOverlayComponent&&e.__shipOverlayComponent.setTintColor(ke.createRGBA(255,255,255,t.getValue()))},function(){e.__shipOverlayComponent&&e.__cockpitOverlayComponent&&(e.__shipOverlayComponent.setTintColor(4294967040),e.__cockpitOverlayComponent.setTintColor(ke.createRGBA(255,255,255,200)),e.__shipDamageTweenGroup.addTweenable(new Ve(200,0,250),function(t){e.__cockpitOverlayComponent&&e.__cockpitOverlayComponent.setTintColor(ke.createRGBA(255,255,255,t.getValue()))},function(){e.__cockpitOverlayComponent&&(e.__cockpitOverlayComponent.setTintColor(ke.createRGBA(255,255,255,200)),e.__shipDamageTweenGroup.addTweenable(new Ve(200,0,250),function(t){e.__cockpitOverlayComponent&&e.__cockpitOverlayComponent.setTintColor(ke.createRGBA(255,255,255,t.getValue()))},function(){e.__cockpitOverlayComponent&&e.__shipIdleComponent&&(e.__cockpitOverlayComponent.setTintColor(4294967040),e.__shipIdleComponent.restart())}))}))}))})}}}),i.exports.GAME_MODES=ot}),define("events/GiftUpdatedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("GiftUpdatedEvent",1206164803,{gift:n.assertIsObject},!0)}),define("GiftManager",["require","exports","module","thor/core/Class","thor/core/Logger","thor/config/Config","thor/core/Validation","thor/util/JSONLoader","thor/resources/ResourceManager","./Constants","StorageManager","ManagerRepository","events/GameResetEvent","events/GiftUpdatedEvent","events/FirstGiftAvailableEvent","player/Player"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=(e("thor/config/Config"),e("thor/core/Validation"),e("thor/util/JSONLoader")),o=(e("thor/resources/ResourceManager"),e("./Constants"),e("StorageManager"),e("ManagerRepository")),a=(e("events/GameResetEvent"),e("events/GiftUpdatedEvent")),_=e("events/FirstGiftAvailableEvent"),l=e("player/Player");i.exports=n.create({initialize:function(e,t,i,n){this.__resourceManager=e,this.__eventManager=t,this.__playerManager=i,this.__storageManager=n,this.__gift=null,this.__arrGiftData=[],this.__eventManager.registerEventHandler(_.EVENT_TYPE,this.__firstGiftAvailableHandler.bind(this))},load:function(){var e=this;return this.__resourceManager.loader(s.RESOURCE_TYPE).load("data/gifts","data/gifts.json").then(function(t){return r.debug("Loaded gift data: ",t),e.__arrGiftData=t.gifts,t})},getGift:function(){return this.__gift},__findNextGift:function(e){for(var t,i=e+1,n=0,r=this.__arrGiftData.length;n<r;n++){if((t=this.__arrGiftData[n].id)===i)break}return t},__computeGiftRewards:function(e){var t=this.__getGiftData(e);if(!t)return 0;var i=~~(t.gold.min/10),n=~~(t.gold.max/10);return 10*~~(Math.random()*(n-i)+i)},open:function(){var e=this;if(!this.__gift)return r.warn("Tried to open gift, but no gift present."),Promise.resolve({error:"No Gift"});var t=Date.now();if(this.__gift.availableAt>t)return r.warn("Tried to open gift, but it's too soon."),Promise.resolve({error:"Gift Not Available Yet"});var i=this.__computeGiftRewards(this.__gift.giftId),n=l.MAX_GOLD_MULTIPLIERS,s=this.__findNextGift(this.__gift.giftId),a={giftId:s,lastOpenedEpochMS:t},_=o.getFUEManager().hasOpenedFUEDailyGift();return this.__playerManager.addAndSetGiftContents(i,n,a,_).then(function(){return e._update(a),{gold:i,goldMultipliers:n}})},__getGiftData:function(e){for(var t=0,i=this.__arrGiftData.length;t<i;t++){var n=this.__arrGiftData[t];if(n.id===e)return n}return r.error("Tried to find gift data for gift "+e+" but none could be found."),null},getGiftDelaySeconds:function(e){var t=this.__getGiftData(e);return t?t.delaySeconds:(r.error("Could not find gift data for gift "+e+" so returning a real long buffer."),Date.now()+31536e4)},__computeAvailableAt:function(e,t){var i=this.getGiftDelaySeconds(e);return this.__playerManager.needsToDoFirstRun()?Date.now()+1e3*i:t+1e3*i},handleAuth:function(e){return e.error?e:(e.gift?this._update(e.gift):this.__gift=null,e)},_update:function(e){e.availableAt=this.__computeAvailableAt(e.giftId,e.lastOpenedEpochMS),Object.freeze(e),this.__gift=e;var t=this.__eventManager.getNewEvent(a);t.setGift(e),this.__eventManager.queueEvent(t)},setTimeRemaining:function(e){var t=this,i=this.__gift.giftId,n=this.__getGiftData(i),r=n.delaySeconds-e,s=Date.now()-1e3*r,o={giftId:i,lastOpenedEpochMS:s};return this.__storageManager.setDataAsync({gift:o}).then(function(){return t._update(o),o})},debugResetSequence:function(){var e=this,t=this.getDefaultGift();return this.__storageManager.setDataAsync({gift:t}).then(function(){return e._update(t),t})},getDefaultGift:function(){return{giftId:1,lastOpenedEpochMS:Date.now()}},__firstGiftAvailableHandler:function(){var e=this,t=this.getDefaultGift(),i=t.giftId,n=this.__getGiftData(i),r=2*n.delaySeconds,s=Date.now()-1e3*r,o={giftId:i,lastOpenedEpochMS:s};return this.__storageManager.setDataAsync({gift:o}).then(function(){return e._update(o),o})}})}),define("ui/UIUtil",["require","exports","module","thor/core/Logger","thor/core/Validation","Constants","thor/entity/World","EntityFactory","ShipSkinManager"],function(e,t,i){var n=e("thor/core/Logger").getLogger(i),r=e("thor/core/Validation"),s=e("Constants"),o=(e("thor/entity/World"),e("EntityFactory"),e("ShipSkinManager"),["vfx_thruster","vfx_thruster_no_tint"]);return{createShip:function(e,t,i,a,_,l,h){r.ifDefined.assertIsNumber(l),r.ifDefined.assertIsNumber(h);var u=e.getScene(),c=t.createEntity("Ship07",e,{sortOrder:s.PLAYER_Z_INDEX,attachParent:u.getRootComponent()}),d=c.getRootComponent();d.setTranslation(0,0),d.setScale(a,_);for(var g=0,p=o.length;g<p;++g){var m=o[g],f=c.getComponentByName(m);f?f.setTintColor(s.TINT_INVISIBLE):n.warn("Could not find layer "+m+" to hide")}return r.isNumber(l)&&r.isNumber(h)?i.setShipSkin(c,l,h):i.setEquippedSkin(c),c}}}),define("ui/views/LeaderboardEntryView",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/util/StringUtil","thor/ui/Slot","thor/ui/Alignment","thor/ui/Widget","thor/resources/ResourceManager","thor/ui/resources/WidgetResource","thor/graphics/resources/TextureRegionResource","ui/UIUtil","mission/MissionType","ManagerRepository"],function(e,t,i){var n,r=e("thor/core/Class"),s=e("thor/core/Logger").getLogger(i),o=e("thor/core/Validation"),a=e("thor/util/StringUtil"),_=(e("thor/ui/Slot"),e("thor/ui/Alignment")),l=e("thor/ui/Widget"),h=l.VISIBILITY,u=(e("thor/resources/ResourceManager"),e("thor/ui/resources/WidgetResource")),c=(e("thor/graphics/resources/TextureRegionResource"),e("ui/UIUtil")),d=(e("mission/MissionType"),e("ManagerRepository")),g={1:4293605119,2:4294967295,3:4289069311};i.exports=r.create({initialize:function(e,t){this._widget=e,this.__createWorld=t,this.__world=null,this.__worldWidget=null,this.__shipEntity=null,this.__playerManager=d.getPlayerManager(),this.__resourceManager=d.getResourceManager(),this.__self=this._widget.findSingleWidgetWithName("slot_you"),this.__other=this._widget.findSingleWidgetWithName("slot_player")},show:function(e,t){this.__container=this.__other,this._widget.setVisibility(h.VISIBLE),t?(this.__container=this.__self,this.__self.setVisibility(h.VISIBLE),this.__other.setVisibility(h.HIDDEN)):(this.__self.setVisibility(h.HIDDEN),this.__other.setVisibility(h.VISIBLE)),this.__rank=this.__container.findSingleWidgetWithName("text_placement"),this.__rank.setText(e.rank+"");var i=g[e.rank];o.isDefined(i)||(i=515832575),this.__rank.setTintColor(i);var n=this.__container.findSingleWidgetWithName("frame_placementCap"),r=this.__container.findSingleWidgetWithName("frame_placementDetial");n.setTintColor(i),r.setTintColor(i),this.__name=this.__container.findSingleWidgetWithName("text_playerName"),this.__name.setText(a.trim(e.name,12,"...")),this.__score=this.__container.findSingleWidgetWithName("text_playerScore"),this.__score.setText(e.score.toLocaleString()),this.__worldWidget=this.__container.findSingleWidgetWithName("playerShip_World"),this.__world=this.__createWorld(),this.__worldWidget.setWorld(this.__world);var s=this.__parseExtraData(e.extraData);this.__shipEntity=c.createShip(this.__world,d.getEntityFactory(),d.getShipSkinManager(),.4,.4,s.shipId,s.skinId),this.__profilePhoto=this.__container.findSingleWidgetWithName("icon_profilePic"),this.__setProfilePhoto(e.photo)},__setProfilePhoto:function(e){o.ifDefined.assertIsString(e);var t=this;return o.isNonEmptyString(e)?t.__playerManager.getProfileImage(e).then(function(e){t.__profilePhoto.setTextureRegion(e),t.__container.invalidate()}).catch(function(e){s.warn("Couldn't get player's photo")}):(s.warn("No photo URL provided, set as default"),t.__playerManager.getDefaultProfileImage().then(function(e){t.__profilePhoto.setTextureRegion(e),t.__container.invalidate()}).catch(function(e){s.warn("Couldn't get default photo for player")}))},__parseExtraData:function(e){var t={};try{t=JSON.parse(e)}catch(e){s.warn("Couldn't parse extraData info: ",e),t={}}return o.isDefined(t.shipId)||(t.shipId=1),o.isDefined(t.skinId)||(t.skinId=1),t},hide:function(){this._widget.setVisibility(h.HIDDEN)},destroy:function(){this.__worldWidget=null,this.__shipEntity=null,this.__world.destroy(),this.__world=null}}),i.exports.addToContainer=function(e,t){return new Promise(function(n,r){e.addSlot(function(e){n(i.exports.create(e,t))})})},i.exports.create=function(e,t){n||(n=d.getResourceManager().get(u.RESOURCE_TYPE,"element_rank"));var r=n.construct();return e.setAnchor&&e.setAnchor(new Anchor(0,0,1,1)),e.setHAlign(_.H_ALIGNMENT.CENTER),e.setWidget(r),new i.exports(r,t)}}),define("LeaderboardManager",["require","exports","module","thor/core/Class","thor/core/Logger","thor/config/Config","thor/util/Network","thor/core/Validation","thor/ui/Widget","thor/ui/Widget","thor/resources/ResourceManager","thor/ui/resources/WidgetResource","thor/ui/Anchor","./Constants","player/PlayerManager","ui/views/LeaderboardEntryView","ManagerRepository"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=(e("thor/config/Config"),e("thor/util/Network"),e("thor/core/Validation")),o=e("thor/ui/Widget"),a=(e("thor/ui/Widget").VISIBILITY,e("thor/resources/ResourceManager"),e("thor/ui/resources/WidgetResource"),e("thor/ui/Anchor"),e("./Constants"),e("player/PlayerManager"),e("ui/views/LeaderboardEntryView")),_=e("ManagerRepository"),l=n.create({initialize:function(){var e=s.isDefined(window.FBInstant)?window.FBInstant.getSupportedAPIs():[];this.__hasLeaderboardAPI=!s.isDefined(e)||e.indexOf("getLeaderboardAsync")>=0,this.__hasConnectedEntriesAPI=this.__hasLeaderboardAPI,this.__contextLeaderboardName="";var t=window.FBInstant.context.getID();null!==t&&(this.__contextLeaderboardName="contextual."+t),this.__globalLeaderboardName="all",this.__topPriorityLeaderboard="",this.__hasLeaderboardAPI&&(this.__topPriorityLeaderboard=this.__contextLeaderboardName,""===this.__contextLeaderboardName&&(this.__topPriorityLeaderboard=this.__globalLeaderboardName)),this.__leaderboardEntries=[],this.__playerEntry={id:"",name:"",score:0,rank:0,photo:"",extraData:""},this.__betterPlayerEntry={id:"",name:"",score:0,rank:0,photo:"",extraData:""},this.__createWorld,this.__entries=[]},setCreateWorld:function(e){this.__createWorld=e},setScoreToFBLeaderboard:function(e){if(!this.__hasLeaderboardAPI)return void r.warn("FB leaderboard API is not available, skip score recording");var t=this,i=this.__createExtraData(),n=[];return n.push(t.__setScore(t.__contextLeaderboardName,e,i)),n.push(t.__setScore(t.__globalLeaderboardName,e,i)),Promise.all(n)},__setScore:function(e,t,i){s.ifDefined.assertIsString(i);return s.isNonEmptyString(e)?window.FBInstant.getLeaderboardAsync(e).then(function(e){return e.setScoreAsync(t,i)}).catch(function(t){r.warn("Couldn't set score to leaderboard ",e,t)}):Promise.resolve(!0)},__getPlayerEntryFromFBLeaderboard:function(){if(!this.__hasLeaderboardAPI)return Promise.resolve(!0);var e=this;return this.__playerEntry={},window.FBInstant.getLeaderboardAsync(e.__topPriorityLeaderboard).then(function(t){return s.isNonEmptyString(e.__contextLeaderboardName)||!e.__hasConnectedEntriesAPI?e.__queryPlayerEntry(t):e.__queryPlayerEntryAmongFriends(t)}).catch(function(t){r.warn("Couldn't get leaderboard for player entry: ",e.__topPriorityLeaderboard,t)})},__queryPlayerEntry:function(e){var t=this;return leaderbaord.getPlayerEntryAsync().then(function(e){t.__playerEntry=t.__translateEntry(e)}).catch(function(e){r.warn("Query player entry failed: ",e)})},__queryPlayerEntryAmongFriends:function(e){var t=this;return e.getConnectedPlayerEntriesAsync(30,0).then(function(e){for(var i=!1,n=0,r=e.length;n<r;n++){var s=e[n];if(s.getPlayer().getID()===window.FBInstant.player.getID()){t.__playerEntry=t.__translateEntry(s),i=!0;break}}if(!i)return t.__queryPlayerEntry().then(function(){t.__playerEntry.rank=31})}).catch(function(e){r.warn("Query player entry among friends failed: ",e)})},__getBetterPlayerEntryFromFBLeaderboard:function(){if(!this.__hasLeaderboardAPI)return Promise.resolve(!0);var e=this;if(this.__betterPlayerEntry={},!s.isNonEmptyObject(this.__playerEntry)||this.__playerEntry.rank<1)return Promise.resolve(!1);if(this.__playerEntry.rank<=this.__leaderboardEntries.length+1)return Promise.resolve(!0);var t=this.__playerEntry.rank-2;return window.FBInstant.getLeaderboardAsync(e.__topPriorityLeaderboard).then(function(i){return!s.isNonEmptyString(e.__contextLeaderboardName)&&e.__hasConnectedEntriesAPI?i.getConnectedPlayerEntriesAsync(1,t):i.getEntriesAsync(1,t)}).then(function(i){1===i.length?e.__betterPlayerEntry=e.__translateEntry(i[0]):i.length>1&&(e.__betterPlayerEntry=e.__translateEntry(i[t]))}).catch(function(t){r.warn("Couldn't get better player's rank entry on leaderboard ",e.__topPriorityLeaderboard,t)})},__getLeaderboardEntriesFromFB:function(e){e<=0&&(e=5);var t=this;return this.__leaderboardEntries=[],new Promise(function(i,n){window.FBInstant.getLeaderboardAsync(t.__topPriorityLeaderboard).then(function(i){return!s.isNonEmptyString(t.__contextLeaderboardName)&&t.__hasConnectedEntriesAPI?i.getConnectedPlayerEntriesAsync(e,0):i.getEntriesAsync(e,0)}).then(function(n){var r=n.length;r>e&&n.splice(e,r-e),t.__leaderboardEntries=n.map(function(e){return t.__translateEntry(e)}),i(!0)}).catch(function(e){r.warn("Couldn't get rank entries on leaderboard ",leaderboardName,e),i(!0)})})},generateLeaderboardEntries:function(e,t){if(s.ifDefined.assertIsNumber(t),e<=0&&(e=5),!this.__hasLeaderboardAPI)return this.__getFakeLeaderboard(e,t),Promise.resolve(!0);var i=this;return i.__getPlayerEntryFromFBLeaderboard().then(function(){return i.__getLeaderboardEntriesFromFB(e)}).then(function(){return i.__getBetterPlayerEntryFromFBLeaderboard()}).then(function(){var t=i.__leaderboardEntries.length;if(t===e){var n=i.__playerEntry.rank;n===t+1?(i.__leaderboardEntries.splice(e-2,1),i.__leaderboardEntries.push(i.__playerEntry)):n>t+1&&(i.__leaderboardEntries.splice(e-2,2),i.__leaderboardEntries.push(i.__betterPlayerEntry),i.__leaderboardEntries.push(i.__playerEntry))}else t<=0&&r.warn("Couldn't get any leaderboard entry")}).catch(function(e){r.warn("Couldn't complete leaderboard list generating: ",e)})},__translateEntry:function(e){var t=e.getPlayer();return{rank:e.getRank(),score:e.getScore(),id:t.getID(),name:t.getName(),photo:t.getPhoto(),extraData:e.getExtraData()}},__getFakeLeaderboard:function(e,t){s.ifDefined.assertIsNumber(t);e<=0&&(e=5),s.isNumber(t)||(t=1e4),this.__leaderboardEntries=[];for(var i=!1,n=2e3*(e-1)+0,r=0;r<e;r++)if(t>=n&&!i)this.__playerEntry.name="Suki",this.__playerEntry.rank=r+1,this.__playerEntry.extraData=this.__createExtraData(),this.__playerEntry.score=t,this.__playerEntry.photo="",this.__playerEntry.id="999",i=!0,this.__leaderboardEntries.push(this.__playerEntry);else{var o={};o.rank=r+1,o.extraData=this.__createExtraData(!0),o.score=n,o.name="Player"+r,o.photo="",o.id=r+"",this.__leaderboardEntries.push(o),n-=2e3}},setupLeaderboardListWidget:function(e,t){for(var i=this,n=(this.__playerEntry.rank,this.__leaderboardEntries.length,t.getNumSlots()),r=n-1;r>=0;r--){var s=t.getSlotAtIndex(r);s.setWidget(o.NULL_WIDGET),t.removeSlot(s)}for(var _=0,l=this.__entries.length;_<l;_++)this.__entries[_].destroy();return this.__entries=[],Promise.all(this.__leaderboardEntries.map(function(e){var n=i.__playerEntry.id===e.id;return a.addToContainer(t,i.__createWorld).then(function(t){t.show(e,n),i.__entries.push(t)})}))},__createExtraData:function(e){s.ifDefined.assertIsBoolean(e);var t=_.getPlayerManager().getPlayer(),i={shipId:t.equippedShipId,skinId:t.equippedSkinId};e&&(i.shipId=1,i.skinId=1);var n="";try{n=JSON.stringify(i)}catch(e){r.warn("Couldn't parse extraData info: ",e)}return n}});i.exports=new l,i.exports.LEADERBOARD_LIMIT=5,i.exports.LEADERBOARD_PAGE_LIMIT=10}),define("gacha/Gacha",["require","exports","module","thor/core/Class","thor/core/Validation","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/core/Enum"),o={};o.TypeEnum=s.create("CardTypeEnum",{COMMON:1,RARE:2,EPIC:3});var a=n.create({initialize:function(e){this.id=e,this.level=1,this.numCards=1,this.isRandom=!0,this.specificCards=[],this.cardRarity=o.TypeEnum.COMMON,this.isRefillable=!0},isEqual:function(e){if(this.level!==e.level||this.numCards!==e.numCards||this.isRandom!==e.isRandom||this.specificCards.length!==e.specificCards.length||this.cardRarity!==e.cardRarity||this.isRefillable!==e.isRefillable)return!1;for(var t=0;t<this.specificCards.length;t++)if(this.specificCards[t]!==e.specificCards[t])return!1;return!0}});a.fromWire=function(e){var t=new a(e.id);return t.level=e.level,t.numCards=e.numCards,t.isRandom=e.isRandom,t.cardRarity=e.cardRarity,t.isRefillable=e.isRefillable,e.specificCards.forEach(function(e){t.specificCards.push(e)}),t};var _=n.create({initialize:function(e){this.level=e,this.numCards=0,this.minParts=0,this.maxParts=0,this.items=[]},validate:function(){var e=null;this.level<=0&&(e||(e=[])).push("Gacha level must be at least 1"),this.items.length<=0&&(e||(e=[])).push("Gacha "+this.level+" must have at least 1 item");for(var t=0;t<this.items.length;t++){var i=this.items[t];i.numCards<0&&(e||(e=[])).push("GachaBagItem "+i.id+" does not have a valid numCards value"),i.isRandom&&!r.isDefined(o.TypeEnum.nameFromValue(i.cardRarity))&&(e||(e=[])).push("GachaBagItem "+i.id+" gives random cards but does not have a valid cardRarity"),!i.isRandom&&i.specificCards.length<=0&&(e||(e=[])).push("GachaBagItem "+i.id+"  does not have any specific cards defined");for(var n=0;n<i.specificCards.length;n++){i.specificCards[n]}}return e},isEqual:function(e){if(this.level!==e.level||this.numCards!==e.numCards||this.minParts!==e.minParts||this.maxParts!==e.maxParts||this.items.length!==e.items.length)return!1;var t=[],i=[];e.items.forEach(function(e){var t=a.fromWire(e);i.push(t)});for(var n=0;n<this.items.length;n++)for(var r=a.fromWire(this.items[n]),s=!1,o=0;o<i.length;o++)if(t.indexOf(o)===-1){var _=i[o];if(r.isEqual(_)){s=!0,t.push(o);break}if(!s)return!1}return!0}});i.exports=_,i.exports.fromWire=function(e){var t=new i.exports(e.level);return t.numCards=e.numCards,t.minParts=e.minParts,t.maxParts=e.maxParts,e.items.forEach(function(e){var i={};for(var n in e)i[n]=e[n];i.id!==t.items.length+1&&(i.id=t.items.length+1),t.items.push(i)}),t},i.exports.GachaBagItem=a,i.exports.GachaBagItem.RESOURCE_TYPE="gachaBagItem",i.exports.RESOURCE_TYPE="gacha"}),define("gacha/PlayerGachaBag",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/math/MersenneTwister","cards/CardInstance","cards/CardParameters","gacha/Gacha","GameLogic","player/PlayerManager"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=(e("thor/math/MersenneTwister"),e("cards/CardInstance"));e("cards/CardParameters"),e("gacha/Gacha"),e("GameLogic"),e("player/PlayerManager");i.exports=n.create({initialize:function(e,t,i,n){this.__gachaManager=e,this.__playerManager=t,this.__mersenneTwister=i,this.__gameLogic=n,this.__level=null,this.__currentGacha=null,this.__undrawnCards=[],this.__hasBeenRefilled=!1,this.__lastReward={parts:0}},setGacha:function(e){this.__currentGacha&&e.level===this.__currentGacha.level||(this.__hasBeenRefilled=!1),this.__currentGacha=e,this.__level=e.level,window.CURRENT_GACHA=e},getGacha:function(){return this.__currentGacha},refillUndrawnCards:function(e){this.__undrawnCards.length=0,r.debug("Refilling undrawn gacha bag cards, is refill of current bag? "+e),this.__fillCardBag(this.__currentGacha.items,this.__undrawnCards,e)},__fillCardBag:function(e,t,i){for(var n=this.__gameLogic.getCardParameters(),o=e.length,a=0;a<o;a++){var _=e[a];if(_.isRefillable||!i)if(_.isRandom){var l=n.getCardIdsByRarity(_.cardRarity),h=this.__playerManager.getPlayerLevel();if(l=l.filter(function(e){return h>=n.cardTypes[e].minPlayerLevel}),!s.isArray(l)){r.warn("Got non-array for card rarity "+_.cardRarity+".  Skipping item index "+a,e);continue}if(0===l.length){r.warn("Found 0 card choices at rarity "+_.cardRarity+" and level "+h+".  Skipping item index "+a,e);continue}var u=_.numCards;l.length<u&&r.warn("Requested "+u+" cards from rarity "+_.cardRarity+" but only found "+l.length+" cards available.");for(var c=0;c<u&&l.length>0;++c){var d=~~(this.__mersenneTwister.random()*l.length),g=l[d];l.splice(d,1),t.push({id:g,level:_.level-1})}}else for(var p=_.specificCards,d=0;d<p.length;++p)for(var g=p[d],m=_.numCards,f=0;f<m;f++)t.push({id:g,level:_.level-1})}r.debug("Card bag contents: ",t)},open:function(e,t){r.debug("Opening gacha, current gacha is ",this.__currentGacha);var i=this.__rollParts(this.__currentGacha),n=this.__currentGacha.numCards,s=this.__drawCards(this.__undrawnCards,n);if(0===this.__undrawnCards.length){this.__hasBeenRefilled=!0;var o=this.__currentGacha.level;if(o>=this.__gachaManager.getMaxGachaLevel()||e<=o)this.refillUndrawnCards(!0);else{var a=this.__gachaManager.getGachaByLevel(o+1);this.setGacha(a),this.refillUndrawnCards(!1)}}return this.__lastReward.parts=i,this.__lastReward.cards=s,this.__lastReward},__rollParts:function(e){var t=e.minParts,i=e.maxParts;return t+Math.round(this.__mersenneTwister.random()*(i-t))},__drawCards:function(e,t){for(var i=[];i.length<t&&e.length>0;){var n=~~(this.__mersenneTwister.random()*this.__undrawnCards.length),r=this.__undrawnCards.splice(n,1)[0];i.push(new o(r.id,r.level,!0,!1))}return i},getLevel:function(){return this.__level},getUndrawnCardsLeft:function(){
return this.__undrawnCards.length},toWire:function(){for(var e={level:this.__level,hasBeenRefilled:this.__hasBeenRefilled,undrawnCards:[]},t=0;t<this.__undrawnCards.length;t++)e.undrawnCards.push(this.__undrawnCards[t]);return e}}),i.exports.fromWire=function(e,t,n,r,s,o){var a=new i.exports(e,t,n,r);a.__level=s.level,a.setGacha(o),a.__hasBeenRefilled=s.hasBeenRefilled;for(var _=0;_<s.undrawnCards.length;_++){var l=s.undrawnCards[_];a.__undrawnCards.push(l)}return a}}),define("GachaManager",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/config/Config","thor/util/StringUtil","thor/math/MersenneTwister","Constants","GameLogic","player/PlayerManager","./StorageManager","gacha/Gacha","gacha/PlayerGachaBag"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=e("thor/config/Config"),a=(e("thor/util/StringUtil"),e("thor/math/MersenneTwister"),e("Constants"),e("GameLogic"),e("player/PlayerManager"),e("./StorageManager"),e("gacha/Gacha")),_=e("gacha/PlayerGachaBag"),l=n.create({initialize:function(e,t,i,n){this.__playerManager=e,this.__mersenneTwister=t,this.__storageManager=i,this.__gameLogic=n,this.__currentGachaBag=null,this.__gachaData=null,this.__maxGachaLevel=null,this.__lastReward={}},setGachaData:function(e){this.__gachaData={},r.debug("Setting gacha data: ",e);for(var t=Object.keys(e),i=0,n=0,s=t.length;n<s;n++){var o=t[n],_=e[o],l=a.fromWire(_);this.__gachaData[o]=l,i=Math.max(i,+t[n])}this.__maxGachaLevel=i},injectGacha:function(e){if(!o.ENABLE_DESIGNER_TOOLS)return void r.warn("Attempted to injectGacha without designer tools enabled");s.assertIsNonEmptyObject(e);var t=e.level;this.__gachaData[t]=e,t!==this.__currentGachaBag.getGacha().level||this.__currentGachaBag.getGacha().isEqual(e)||this.resetCurrentPlayerGacha()},resetCurrentPlayerGacha:function(){if(!o.ENABLE_DESIGNER_TOOLS)return r.warn("Attempted to resetCurrentGacha without designer tools enabled"),Promise.resolve();var e=this;return new Promise(function(t,i){var n=e.__currentGachaBag?e.__currentGachaBag.getLevel():1,s=e.__gachaData[n];if(e.__currentGachaBag){r.debug("Setting current gacha bag due to reset: ",s),e.__currentGachaBag.setGacha(s);var o=e.__currentGachaBag.__undrawnCards,a=s.items.map(function(e){return e.id});if(o.length)for(var _=o.length-1;_>=0;_--){var l=o[_];a.indexOf(l.id)<0&&o.splice(_,1)}}return e.__transmitCurrentGachaBag()})},retrieveCurrentPlayerGacha:function(){var e=this;return this.__storageManager.getDataAsync(["currentGachaBag"]).then(function(t){var i=t.currentGachaBag;if(s.isNonEmptyString(i))try{i=JSON.parse(i)}catch(e){r.warn("Failed to load player gacha bag, defaulting to level 1 bag"),i=null}var n;return s.isObject(i)?(n=e.__gachaData[i.level],r.debug("Setting current gacha bag from wire data: ",n),e.__currentGachaBag=_.fromWire(e,e.__playerManager,e.__mersenneTwister,e.__gameLogic,i,n)):(n=e.__gachaData[1],r.debug("Setting current gacha bag on load due to no current gacha bag: ",n),e.__currentGachaBag=new _(e,e.__playerManager,e.__mersenneTwister,e.__gameLogic),e.__currentGachaBag.setGacha(n),e.__currentGachaBag.refillUndrawnCards(!1)),e.__transmitCurrentGachaBag()})},getCurrentPlayerGacha:function(){return this.__currentGachaBag},__transmitCurrentGachaBag:function(){var e=this.__currentGachaBag.toWire();return this.__storageManager.setDataAsync({currentGachaBag:e}).catch(function(e){r.error("Failed to send player gacha bag data to Facebook: {}",e)})},openGacha:function(){return this.__lastReward=this.__currentGachaBag.open(this.__playerManager.getPlayerLevel(),this.__gameLogic.getCardParameters()),this.__lastReward},getLastReward:function(){return this.__lastReward},getGachaByLevel:function(e){return this.__gachaData[e]},getMaxGachaLevel:function(){return this.__maxGachaLevel},getGachaData:function(){return this.__gachaData},getCurrentGachaLevel:function(){return this.__currentGachaBag.getLevel()}});i.exports=l}),define("ui/AudioMuteEnum",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum");i.exports=n.create("AudioMuteEnum",{SOUND:1,MUSIC:2,TOGGLE:3})}),define("events/GiftUnavailableEvent",["require","exports","module","thor/core/Class","thor/event/Event","thor/core/Validation","ui/views/OpenGiftView"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/event/Event"));e("thor/core/Validation"),e("ui/views/OpenGiftView").GiftTypeEnum;i.exports=n.generateEventClass("GiftUnavailableEvent",1206164807,{giftType:function(e){}})}),define("ui/DotJiggleAction",["require","exports","module","thor/core/Class","thor/graphics/animation/actions/Action","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/graphics/animation/actions/Action"),s=e("thor/core/Validation");i.exports=n.create(r,{initialize:function(){this.__xRange=0,this.__yRange=0,this.__accum=0,this.__hasOrientationSupport=s.isDefined(window.DeviceOrientationEvent),this.__orientation=0,r.prototype.initialize.call(this)},reset:function(){r.prototype.reset.call(this),this.__xRange=0,this.__yRange=0,this.__accum=0,this.__orientation=0},jiggle:function(e,t){this.__xRange=e,this.__yRange=t},setOrientation:function(e){this.__orientation=e},isComplete:function(){return!1},update:function(e){var t,i;this.__accum+=3e-4*e,t=Math.sin(8*this.__accum)*(.4*this.__xRange),i=Math.cos(3*this.__accum)*(.4*this.__yRange),this.__hasOrientationSupport&&(t+=2*this.__orientation),this._target.x=t,this._target.y=i}})}),define("ui/views/DotGridView",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","ui/DotJiggleAction","thor/graphics/animation/Transform","thor/ui/Widget"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation")),s=e("ui/DotJiggleAction"),o=e("thor/graphics/animation/Transform");e("thor/ui/Widget");i.exports=n.create({initialize:function(e){this.__action=new s,this.__action.jiggle(10,10),this.__transform=new o,this.__transform.setAction(this.__action),this.__boundOrientationEvent=this.__onOrientationEvent.bind(this),e.setTransform(this.__transform),r.isDefined(window.DeviceOrientationEvent)&&window.addEventListener("deviceorientation",this.__boundOrientationEvent,!0)},update:function(e){this.__transform.update(e)},destroy:function(){r.isDefined(window.DeviceOrientationEvent)&&window.removeEventListener("deviceorientation",this.__boundOrientationEvent,!0)},__onOrientationEvent:function(e){var t=e.gamma||0;this.__action.setOrientation(t)}})}),define("ui/states/UIState",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Panel","thor/ui/Widget","thor/ui/Anchor","thor/util/FSM"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=(e("thor/ui/Panel"),e("thor/ui/Widget")),o=e("thor/ui/Anchor"),a=e("thor/util/FSM").State;i.exports=n.create(a,{initialize:function(e){this.__panel=e,this.__slot=null,this._widget=null},_constructWidget:function(){return s.NULL_WIDGET},_invalidate:function(){this.__panel.invalidate()},onEnter:function(e){r.ifDefined.assertIsBoolean(e),r.isDefined(e)||(e=!0),this._widget=this._constructWidget();var t=this;this.__panel.addSlot(function(e){t.__slot=e,e.setAnchor(new o(0,0,1,1)),e.setWidget(t._widget)}),e&&this.__panel.invalidate()},onExit:function(){this.__slot&&(this.__panel.removeSlot(this.__slot),this.__panel.invalidate(),this.__slot=null),this._widget=null},update:function(e){}})}),define("ui/SlideInDialog",["require","exports","module","thor/core/Class","thor/core/Logger","thor/ui/Widget","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/core/Validation","thor/graphics/animation/EasingFunctions"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/ui/Widget")),s=e("thor/graphics/animation/actions/Actions"),o=e("thor/graphics/animation/Transform"),a=(e("thor/core/Validation"),r.VISIBILITY),_=e("thor/graphics/animation/EasingFunctions");i.exports=n.create({initialize:function(e,t,i){this._widget=e,this._modal=t,this._gameBounds=i,this._isShowing=!1,this._resolvers=[],this._transform=null,this._modalTransform=null,this._action=null,this._modalAction=null,this._widget.setVisibility(a.HIDDEN),this._modal.setVisibility(a.HIDDEN),this._widget.invalidate()},show:function(){var e=this;this._isShowing=!0,this._widget.setVisibility(a.VISIBLE),this._modal.setVisibility(a.VISIBLE);var e=this,t=this._gameBounds.height;return this._transform?this._transform.reset():(this._transform=new o,this._widget.setTransform(this._transform)),this._action=s.sequence(s.fadeTo(0,0),s.moveBy(0,t,0),s.parallel(s.fadeTo(1,350),s.moveBy(0,-t,500,_.easeOut))),this._transform.setAction(this._action),this._modalTransform?this._modalTransform.reset():this._modalTransform=new o,this._modal.setTransform(this._modalTransform),this._modalAction=s.sequence(s.fadeTo(0,0),s.fadeTo(1,350)),this._modalTransform.setAction(this._modalAction),new Promise(function(t,i){e._resolvers.push(t)})},hide:function(){var e=this,t=new Promise(function(t,i){e._resolvers.push(t)});this._isShowing=!1;var i=this._gameBounds.height;return this._transform?this._transform.reset():(this._transform=new o,this._widget.setTransform(this._transform)),this._action=s.sequence(s.parallel(s.sequence(s.wait(150),s.fadeTo(0,350,_.easeIn)),s.moveBy(0,i,500,_.easeIn)),s.callback(function(){e._widget.setVisibility(a.HIDDEN),e._modal.setVisibility(a.HIDDEN);for(var t=0,i=e._resolvers.length;t<i;++t)e._resolvers[t]();e._resolvers.length=0})),this._transform.setAction(this._action),this._modalTransform?this._modalTransform.reset():this._modalTransform=new o,this._modal.setTransform(this._modalTransform),this._modalAction=s.fadeTo(0,350),this._modalTransform.setAction(this._modalAction),t},destroy:function(){this._action=null,this._transform&&this._transform.reset(),this._transform=null,this._modalAction=null,this._modalTransform&&this._modalTransform.reset(),this._modalTransform=null},update:function(e){this._transform&&this._transform.update(e),this._modalTransform&&this._modalTransform.update(e)}})}),define("ui/views/RaidEntryView",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/util/StringUtil","thor/ui/Slot","thor/ui/Widget","thor/resources/ResourceManager","thor/ui/resources/WidgetResource","thor/graphics/resources/TextureRegionResource","ui/UIUtil","mission/MissionType","ManagerRepository"],function(e,t,i){var n,r=e("thor/core/Class"),s=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation")),o=e("thor/util/StringUtil"),a=(e("thor/ui/Slot"),e("thor/ui/Widget")),_=a.VISIBILITY,l=(e("thor/resources/ResourceManager"),e("thor/ui/resources/WidgetResource")),h=e("thor/graphics/resources/TextureRegionResource"),u=e("ui/UIUtil"),c=e("mission/MissionType"),d=e("ManagerRepository"),g=["frame_placementDetial","frame_placementCap","text_placement"],p=[4293605119,4294967295,4289069311];i.exports=r.create({initialize:function(e,t){this._widget=e,this.__createWorld=t,this.__world=null,this.__worldWidget=null,this.__shipEntity=null,this.__playerManager=d.getPlayerManager(),this.__resourceManager=d.getResourceManager(),this.__self=this._widget.findSingleWidgetWithName("slot_you"),this.__other=this._widget.findSingleWidgetWithName("slot_player")},show:function(e,t,i){s.ifDefined.assertIsBoolean(i);var n=e.isPlayer;this._widget.setVisibility(_.VISIBLE),this.__self.setVisibility(n?_.VISIBLE:_.HIDDEN),this.__other.setVisibility(n?_.HIDDEN:_.VISIBLE),this.__container=n?this.__self:this.__other,this.__progress=this.__container.findSingleWidgetWithName("text_playerScore"),this.__progress.setText(""+e.progress),this.__name=this.__container.findSingleWidgetWithName("text_playerName"),n&&(e.name=this.__playerManager.getName()),this.__worldWidget=this.__container.findSingleWidgetWithName("playerShip_World"),this.__world=this.__createWorld(),this.__worldWidget.setWorld(this.__world);var r=this.__playerManager.getPlayer();this.__shipEntity=u.createShip(this.__world,d.getEntityFactory(),d.getShipSkinManager(),.4,.4,n?r.equippedShipId:e.shipId,n?r.equippedSkinId:e.skinId),this.__name.setText(o.trim(e.name,12,"..."));var a=c.getIcon(t),l=this.__resourceManager.get(h.RESOURCE_TYPE,a);this.__icon=this.__container.findSingleWidgetWithName("icon_objective"),this.__icon.setTextureRegion(l),this.__rank=this.__container.findSingleWidgetWithName("text_placement");var p=this.__container.findSingleWidgetWithName("frame_placementDetial"),m="";i?(m+=e.rank,p.setVisibility(_.VISIBLE)):p.setVisibility(_.HIDDEN),this.__rank.setText(m);for(var f=i?this.getPlacementTint(e.rank):515832575,v=0,y=g.length;v<y;++v){var E=g[v];this.__container.findSingleWidgetWithName(E).setTintColor(f)}this.__profilePic=this.__container.findSingleWidgetWithName("icon_profilePic"),e.isPlayer?this.__playerManager.getPlayerProfileImage().then(this.__setProfileImage.bind(this)):s.isNonEmptyString(e.avatarUrl)&&this.__playerManager.getProfileImage(e.avatarUrl).then(this.__setProfileImage.bind(this))},__setProfileImage:function(e){s.ifDefined.assertIsInstanceOf(e,h),e&&(this.__profilePic.setTextureRegion(e),this.__container.invalidate())},hide:function(){this._widget.setVisibility(_.HIDDEN)},destroy:function(){this.__worldWidget=null,this.__shipEntity=null,this.__world.destroy(),this.__world=null},getPlacementTint:function(e){return p[e-1]||515832575}}),i.exports.addToContainer=function(e,t){return new Promise(function(n,r){e.addSlot(function(e){n(i.exports.create(e,t))})})},i.exports.create=function(e,t){n||(n=d.getResourceManager().get(l.RESOURCE_TYPE,"element_playerSlot"));var r=n.construct();return e.setAnchor&&e.setAnchor(new Anchor(0,0,1,1)),e.setWidget(r),new i.exports(r,t)}}),define("ui/views/RaidProgressView",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/graphics/animation/EasingFunctions","thor/ui/Widget","thor/util/StringUtil","thor/util/TimeoutContext","thor/graphics/resources/TextureRegionResource","ManagerRepository","player/CurrencyTypeEnum","mission/MissionType","mission/MissionCategory","raid/RaidState","ui/views/RaidEntryView"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation")),s=(e("thor/graphics/animation/actions/Actions"),e("thor/graphics/animation/Transform"),e("thor/graphics/animation/EasingFunctions"),e("thor/ui/Widget")),o=s.VISIBILITY,a=e("thor/util/StringUtil"),_=(e("thor/util/TimeoutContext"),e("thor/graphics/resources/TextureRegionResource")),l=e("ManagerRepository"),h=(e("player/CurrencyTypeEnum"),e("mission/MissionType")),u=e("mission/MissionCategory");e("raid/RaidState"),e("ui/views/RaidEntryView");i.exports=n.create({initialize:function(e){this._raidManager=l.getRaidManager(),this._resourceManager=l.getResourceManager(),this._widget=e,this._progressBar=this._widget.findSingleWidgetWithName("ProgressBarWidget"),this._progressLabel=this._widget.findSingleWidgetWithName("label_progress"),this._completeLine=this._widget.findSingleWidgetWithName("completeLine"),this._completeLine.invalidate(),this._missionDescriptionLabel=this._widget.findSingleWidgetWithName("label"),this._missionIcon=this._widget.findSingleWidgetWithName("icon"),this._missionCheck=this._widget.findSingleWidgetWithName("check"),this._missionIconByCategory={},this._missionIconByCategory[u.KILL]=this._widget.findSingleWidgetWithName("BG_kills"),this._missionIconByCategory[u.COLLECT]=this._widget.findSingleWidgetWithName("BG_collect"),this._missionIconByCategory[u.SKILL]=this._widget.findSingleWidgetWithName("BG_skill"),this._rewardIcon=this._widget.findSingleWidgetWithName("icon_reward"),this._rewardBacking=this._widget.findSingleWidgetWithName("detialGiftBacking"),this._widget.invalidate()},refresh:function(e,t){r.ifDefined.assertIsNonEmptyObject(e),r.ifDefined.assertIsBoolean(t),e||(e=this._raidManager.getProgression()),r.isBoolean(t)||(t=this._raidManager.isComplete()),this._progress=e.progress;var i=Math.min(e.relativeProgress/e.relativeRequirement,1),n=i>=1;this._progressBar.setProgress(i),this._progressBar.setVisibility(t?o.HIDDEN:o.VISIBLE),this._completeLine.setVisibility(t?o.VISIBLE:o.HIDDEN),this._rewardIcon.setVisibility(t?o.HIDDEN:o.VISIBLE),this._rewardBacking.setVisibility(t?o.HIDDEN:o.VISIBLE),this._progressLabel.setText(n?"Complete":a.interpolate("{remaining} left to go",{remaining:e.relativeRequirement-e.relativeProgress}));for(var s=this._raidManager.getRaid(),l=h.CATEGORY[s.type],c=u.getValues(),d=0,g=c.length;d<g;++d){var p=c[d],m=l===p?o.VISIBLE:o.HIDDEN;this._missionIconByCategory[p].setVisibility(m)}var f,v=h.DESCRIPTION_TEXT[s.type];f=e.relativeRequirement>1?v.plural:v.singular,this._missionDescriptionLabel.setText(a.interpolate(f,{requirement:e.requirement}));var y=h.getIcon(s.type),E=this._resourceManager.get(_.RESOURCE_TYPE,y);this._missionIcon.setTextureRegion(E);var n=this._raidManager.isComplete();this._missionCheck.setVisibility(n?o.VISIBLE:o.HIDDEN),this._widget.invalidate()}}),i.exports.PROGRESS_FORMAT="{remaining} left to go"}),define("ui/RaidDialog",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/graphics/animation/actions/Actions","thor/graphics/animation/EasingFunctions","thor/graphics/animation/Transform","thor/ui/Widget","thor/ui/resources/WidgetResource","thor/resources/ResourceManager","thor/graphics/resources/TextureRegionResource","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","thor/util/StringUtil","thor/util/TimeoutContext","ManagerRepository","player/CurrencyTypeEnum","mission/MissionType","mission/MissionCategory","raid/RaidState","raid/RaidUpdatedEvent","ui/SlideInDialog","ui/views/RaidEntryView","ui/views/RaidProgressView"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/graphics/animation/actions/Actions"),e("thor/graphics/animation/EasingFunctions"),e("thor/graphics/animation/Transform"),e("thor/ui/Widget")),s=r.VISIBILITY,o=(e("thor/ui/resources/WidgetResource"),e("thor/resources/ResourceManager"),e("thor/graphics/resources/TextureRegionResource"),e("thor/audio/SoundSprite")),a=e("thor/audio/SoundSpriteResourceLoader"),_=e("thor/util/StringUtil"),l=e("thor/util/TimeoutContext"),h=e("ManagerRepository"),u=e("player/CurrencyTypeEnum"),c=(e("mission/MissionType"),e("mission/MissionCategory"),e("raid/RaidState")),d=e("raid/RaidUpdatedEvent"),g=e("ui/SlideInDialog"),p=e("ui/views/RaidEntryView"),m=e("ui/views/RaidProgressView"),f={};f[c.PENDING]="Waiting for players...",f[c.ACTIVE]="{count} players participating",f[c.COMPLETED]="{count} players participated";var v=c.getValues(),y={};y[c.PENDING]="timerPending",y[c.ACTIVE]="timer",y[c.COMPLETED]="timerCoolDown",i.exports=n.create(g,{initialize:function(e,t,i,n){g.prototype.initialize.call(this,e,t,i),this.__createWorld=n,this.__raidManager=h.getRaidManager(),this.__eventManager=h.getEventManager(),this.__eventManager.registerEventHandler(d.EVENT_TYPE,this.refresh.bind(this)),this.__resourceManager=h.getResourceManager(),this.__timeoutContext=new l,this.__sounds=this.__resourceManager.getOrDefault(a.RESOURCE_TYPE,"game_sounds",o.EMPTY_SOUND_SPRITE),this.__backButton=this._widget.findSingleWidgetWithName("btn_back").findSingleWidgetWithName("button"),this.__backButton.setClickHandler(this.hide.bind(this)).setSoundSprite(this.__sounds).setClickSound("back"),this.__progressLabel=this._widget.findSingleWidgetWithName("label_progress"),this.__unlockedRewardContainer=this._widget.findSingleWidgetWithName("panel_yourReward"),this.__unlockedRewardLabel=this.__unlockedRewardContainer.findSingleWidgetWithName("text_reward"),this.__nextRewardContainer=this._widget.findSingleWidgetWithName("panel_reward"),this.__nextRewardLabel=this.__nextRewardContainer.findSingleWidgetWithName("text_reward");var r=this._widget.findSingleWidgetWithName("challenge");this.__raidProgressView=new m(r),this.__nextRewardDetail=r.findSingleWidgetWithName("detial1"),this.__progressLabel=r.findSingleWidgetWithName("label_progress"),r.findSingleWidgetWithName("loader").setVisibility(s.HIDDEN),this.__missionDescriptionLabel=r.findSingleWidgetWithName("label"),this.__progressIcon=r.findSingleWidgetWithName("icon_container").findSingleWidgetWithName("icon"),this.__progressRewardIcon=r.findSingleWidgetWithName("icon_reward"),this.__playerCountLabel=this._widget.findSingleWidgetWithName("text_playerCount"),this.__completedContainer=this._widget.findSingleWidgetWithName("timerCoolDown"),this.__completedLabel=this.__completedContainer.findSingleWidgetWithName("text_expiry_timer"),this.__activeContainer=this._widget.findSingleWidgetWithName("timer"),this.__activeLabel=this.__activeContainer.findSingleWidgetWithName("text_expiry_timer"),this.__timerContainer=null,this.__timerLabel=null,this.__entries=[],this.__leaderboardList=this._widget.findSingleWidgetWithName("ListPanel"),this.__showResolve=null,this.__containers={};for(var _ in y){var u=y[_];this.__containers[_]=this._widget.findSingleWidgetWithName(u)}},show:function(){return this._isShowing=!0,this.refresh().then(g.prototype.show.bind(this))},refresh:function(){if(!this._isShowing)return Promise.resolve();var e=this;this.__raidProgressView.refresh();var t=this.__raidManager.isComplete(),i=this.__raidManager.getProgression();this.__unlockedRewardContainer.setVisibility(i.tier>=0?s.VISIBLE:s.HIDDEN),this.__nextRewardContainer.setVisibility(t?s.HIDDEN:s.VISIBLE),this.__nextRewardDetail.setVisibility(t?s.HIDDEN:s.VISIBLE);var n=i.tier,r=this.__raidManager.getRewards(n),o=this.__raidManager.getRewards(n+1);n>=0&&this.__unlockedRewardLabel.setText("+"+r.amount.toLocaleString()+u.getSymbol(r.type)),o&&this.__nextRewardLabel.setText("+"+o.amount.toLocaleString()+u.getSymbol(o.type)),this.__missionDescriptionLabel.setTintColor(t?519754288:519754495),this.__progressIcon.setTintColor(t?4294967120:4294967295),this.__progressRewardIcon.setTintColor(t?4294967120:4294967295),t&&this.__progressLabel.setText("Complete");this.__raidManager.getLeaderboard();return this.__checkRaidState(),this.__updateLeaderboard().then(function(){e._widget.invalidate()})},destroy:function(){g.prototype.destroy.call(this),this.__timeoutContext.clearAll();for(var e=0;e<this.__entries.length;++e)this.__entries[e].destroy();this.__entries.length=0},__checkRaidState:function(){var e=this;this.__timeoutContext.clearAll();for(var t=this.__raidManager.getState(),i=0,n=v.length;i<n;++i){var r=v[i],o=this.__containers[r],a=r===t;if(o.setVisibility(a?s.VISIBLE:s.HIDDEN),a&&r!==c.PENDING){var l=this.__raidManager.getRaid(),h=o.findSingleWidgetWithName("text_expiry_timer"),u=this.__tickTimer.bind(this,l.end,h);u(),this.__timeoutContext.setTimeout(function(){e.__timeoutContext.setInterval(u,1e3)},1e3-Date.now()%1e3)}}var d=f[t],g=_.interpolate(d,{count:this.__raidManager.getRaid().population});this.__playerCountLabel.setText(g).invalidate()},__tickTimer:function(e,t){var i=Date.now(),n=Math.max((e-i)/1e3,0),r=_.getTimeDisplayString(n,"0:00:00","hybridHours");t.setText(r).invalidate(),n<=0&&this.__checkRaidState()},__updateLeaderboard:function(){for(var e=this,t=this.__raidManager.getType(),i=this.__raidManager.getLeaderboard(),n=this.__entries.length-1,r=i.length;n>=r;n--)this.__entries[n].hide();var s=this.__raidManager.getState()===c.PENDING;return Promise.all(i.map(function(i,n){return n>=e.__entries.length?p.addToContainer(e.__leaderboardList,e.__createWorld).then(function(n){n.show(i,t,!s),e.__entries.push(n)}):(e.__entries[n].show(i,t,!s),Promise.resolve(e.__entries[n]))}))}})}),define("ui/views/RaidSummary",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","thor/util/TimeoutContext","thor/ui/Widget","ManagerRepository","thor/util/StringUtil","raid/RaidManager","raid/RaidState","raid/RaidUpdatedEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/audio/SoundSprite")),s=e("thor/audio/SoundSpriteResourceLoader"),o=e("thor/util/TimeoutContext"),a=e("thor/ui/Widget"),_=a.VISIBILITY,l=e("ManagerRepository"),h=e("thor/util/StringUtil"),u=e("raid/RaidManager"),c=e("raid/RaidState"),d=e("raid/RaidUpdatedEvent");i.exports=n.create({initialize:function(e,t){this.__eventManager=l.getEventManager();var i=l.getResourceManager();this.__sounds=i.getOrDefault(s.RESOURCE_TYPE,"game_sounds",r.EMPTY_SOUND_SPRITE),this.__raidManager=l.getRaidManager(),this._widget=e,this.__defaultButton=e.findSingleWidgetWithName("btn_normal"),this.__pendingButton=e.findSingleWidgetWithName("btn_new"),this.__waitingButton=e.findSingleWidgetWithName("btn_waiting"),this.__glow=e.findSingleWidgetWithName("glow"),this.__timerIcon=e.findSingleWidgetWithName("icon_timer"),this.__timerLabel=e.findSingleWidgetWithName("text_timer"),this.__progressLabel=e.findSingleWidgetWithName("text_compValue"),this.__progressDescriptionLabel=e.findSingleWidgetWithName("text_progress"),this.__pendingLabel=e.findSingleWidgetWithName("text_status"),this.__lockedLabel=e.findSingleWidgetWithName("text_locked"),this.__lockedLabel.setText("LEVEL "+u.UNLOCK_LEVEL+" LOCKED"),this.__lockIcon=e.findSingleWidgetWithName("icon_lock"),this.__timeoutContext=new o,this.__playerOpened=!1,this.__isRefreshing=!1;var n=this;this.setClickHandler(function(){n.__playerOpened=!0,l.getFUEManager().areRaidsEnabled()?n.__sounds.play("click"):n.__sounds.play("insufficient_funds"),t(),n.refresh()}),this.__eventManager.registerEventHandler(d.EVENT_TYPE,this.refresh.bind(this)),this.refresh()},getWidget:function(){return this._widget},refresh:function(){var e=this,t=this.__raidManager.getState();if(!l.getFUEManager().areRaidsEnabled())return this.__defaultButton.setVisibility(_.HIDDEN),this.__pendingButton.setVisibility(_.HIDDEN),this.__waitingButton.setVisibility(_.VISIBLE),this.__progressLabel.setVisibility(_.HIDDEN),this.__progressDescriptionLabel.setVisibility(_.HIDDEN),this.__glow.setVisibility(_.HIDDEN),this.__pendingLabel.setVisibility(_.HIDDEN),this.__timerIcon.setVisibility(_.HIDDEN),this.__timerLabel.setVisibility(_.HIDDEN),this.__lockedLabel.setVisibility(_.VISIBLE),void this.__lockIcon.setVisibility(_.VISIBLE);this.__lockedLabel.setVisibility(_.HIDDEN),this.__lockIcon.setVisibility(_.HIDDEN);var i=t===c.PENDING,n=t===c.COMPLETED,r=t===c.ACTIVE?_.VISIBLE:_.HIDDEN,s=i?_.VISIBLE:_.HIDDEN,o=i?_.HIDDEN:_.VISIBLE,a=n?_.VISIBLE:_.HIDDEN;if(this.__defaultButton.setVisibility(t===c.ACTIVE||i&&this.__playerOpened?_.VISIBLE:_.HIDDEN),this.__progressLabel.setVisibility(r),this.__progressDescriptionLabel.setVisibility(r),this.__timerIcon.setVisibility(o),this.__timerLabel.setVisibility(o),this.__pendingButton.setVisibility(i&&!this.__playerOpened?s:_.HIDDEN),this.__waitingButton.setVisibility(a),this.__glow.setVisibility(i&&!this.__playerOpened?s:_.HIDDEN),this.__pendingLabel.setVisibility(t===c.ACTIVE?_.HIDDEN:_.VISIBLE),this.__timeoutContext.clearAll(),!i){var h,u=this.__raidManager.getProgression();h=u.requirement<0?100:u.relativeProgress/u.relativeRequirement*100,this.__progressLabel.setText(~~h+"%");var d=this.__raidManager.getRaid(),g=this.__tickTimer.bind(this,d.end);g(),this.__timeoutContext.setTimeout(function(){e.__timeoutContext.setInterval(g,1e3)},1e3-Date.now()%1e3)}},__tickTimer:function(e){var t=Date.now(),i=Math.max((e-t)/1e3,0),n=h.getTimeDisplayString(i,"0:00:00","hybridHours");this.__timerLabel.setText(n).invalidate();var r=this.__raidManager.getState();if(i<=0&&(r!==c.PENDING||!this.__isRefreshing)){this.__isRefreshing=!0,this.__lastRecheck=t;var s=this;this.__raidManager.refresh().then(function(){s.__playerOpened=!1,s.__isRefreshing=!1,s.refresh()})}},setClickHandler:function(e){this.__defaultButton.setClickHandler(e),this.__pendingButton.setClickHandler(e),this.__waitingButton.setClickHandler(e)},setEnabled:function(e){this.__defaultButton.setEnabled(e),this.__pendingButton.setEnabled(e),this.__waitingButton.setEnabled(e)},destroy:function(){this.__timeoutContext.clearAll()}})}),define("ui/views/MissionProgressView",["require","exports","module","thor/core/Class","thor/core/Logger","thor/ui/Widget","thor/ui/Anchor","thor/graphics/animation/actions/Actions","thor/ui/Geometry","thor/graphics/animation/Transform","thor/core/Validation","thor/ui/Widget","thor/math/MathHelper","thor/ui/resources/WidgetResource","thor/resources/ResourceManager","thor/graphics/animation/EasingFunctions","mission/MissionSet"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/ui/Widget"),e("thor/ui/Anchor")),s=e("thor/graphics/animation/actions/Actions"),o=(e("thor/ui/Geometry"),e("thor/graphics/animation/Transform")),a=e("thor/core/Validation"),_=e("thor/ui/Widget").VISIBILITY,l=(e("thor/math/MathHelper"),e("thor/ui/resources/WidgetResource")),h=(e("thor/resources/ResourceManager"),e("thor/graphics/animation/EasingFunctions"),e("mission/MissionSet")),u=h.MAX_COMPLETED_SETS*h.MISSIONS_PER_SET;i.exports=n.create({initialize:function(e,t){var i=e.get(l.RESOURCE_TYPE,"element_mission_progress");this.__missionProgressWidget=i.construct();var n=this;t.addSlot(function(e){e.setAnchor(new r(0,0,1,1)),e.setWidget(n.__missionProgressWidget),e.setAutoSize(!0)}),this.__notchWidgets=[];for(var s=0;s<h.MAX_COMPLETED_SETS;s++)for(var o=this.__missionProgressWidget.findSingleWidgetWithName("notchGroup"+(s+1)),a=o.getNumSlots(),_=0;_<a;_++){var c=o.getSlotAtIndex(_).getWidget();this.__notchWidgets.push({empty:c.findSingleWidgetWithName("empty"),full:c.findSingleWidgetWithName("full"),glow:c.findSingleWidgetWithName("glowEffect"),widget:c})}if(this.__notchWidgets.length!==u)throw new Error("Number of notch slots does not match the expected "+u+" slots.");this.__rewardWidgets=[];for(var d=0;d<h.MAX_COMPLETED_SETS;d++){var g=this.__missionProgressWidget.findSingleWidgetWithName("reward"+(d+1));this.__rewardWidgets.push({check:g.findSingleWidgetWithName("checkMark"),token:g.findSingleWidgetWithName("tokenBox"),glow:g.findSingleWidgetWithName("glowEffect"),widget:g})}this.__textProgressWidgets=[];for(var d=0;d<h.MAX_COMPLETED_SETS;d++){var p=this.__missionProgressWidget.findSingleWidgetWithName("text_progress"+(d+1));this.__textProgressWidgets.push(p)}this.setNumMissionsComplete(0),this.__numCompleted=0},getNumCompleted:function(){return this.__numCompleted},setNumMissionsComplete:function(e,t){a.ifDefined.assertIsBoolean(t);for(var i=~~(e/h.MISSIONS_PER_SET),n=0;n<u;n++){var r=this.__notchWidgets[n];r.glow.setVisibility(_.HIDDEN),n<e?r.full.setVisibility(_.VISIBLE):r.full.setVisibility(_.HIDDEN)}for(var s=0;s<h.MAX_COMPLETED_SETS;s++){var o=this.__rewardWidgets[s];o.glow.setVisibility(_.HIDDEN);var l=t&&e%h.MISSIONS_PER_SET==0&&s===i-1;s<i&&!l?(o.check.setVisibility(_.VISIBLE),o.token.setVisibility(_.HIDDEN)):(o.check.setVisibility(_.HIDDEN),o.token.setVisibility(_.VISIBLE))}for(var c=0;c<h.MAX_COMPLETED_SETS;++c)c===i?(this.__textProgressWidgets[c].setVisibility(_.VISIBLE),this.__textProgressWidgets[c].setText((e%h.MISSIONS_PER_SET).toString()+"/"+h.MISSIONS_PER_SET.toString())):this.__textProgressWidgets[c].setVisibility(_.HIDDEN);this.__numCompleted=e,this.__missionProgressWidget.invalidate()},addCompletedMission:function(e){var t=this,i=new Promise(function(i,n){var r=t.__notchWidgets[t.__numCompleted],a=r.full;a.setVisibility(_.VISIBLE),t.__fullTransform=new o;var l=s.sequence(s.fadeTo(0,0),s.wait(e),s.fadeTo(1,83),s.callback(function(){i(!0),t.__fullTransform=null}));t.__fullTransform.setAction(l),a.setTransform(t.__fullTransform)}),n=new Promise(function(i,n){var r=t.__notchWidgets[t.__numCompleted],a=r.glow;a.setVisibility(_.VISIBLE),t.__glowTransform=new o;var l=s.sequence(s.fadeTo(0,0),s.wait(e),s.fadeTo(1,83),s.fadeTo(1,67),s.callback(function(){i(!0),
a.setVisibility(_.HIDDEN),t.__glowTransform=null}));t.__glowTransform.setAction(l),a.setTransform(t.__glowTransform)});return Promise.all([i,n]).then(function(){return t.setNumMissionsComplete(t.__numCompleted+1,!0),!0})},getTokenSource:function(e){return this.__rewardWidgets[e].widget},getNotchGeometry:function(e,t){this.__notchWidgets[e].widget.getGeometry(t)},addToken:function(e){var t=this,i=new Promise(function(e,i){var n=~~(t.__numCompleted/h.MISSIONS_PER_SET),r=n-1,a=t.__rewardWidgets[r],l=a.glow;l.setVisibility(_.VISIBLE);var u=new o,c=s.sequence(s.fadeTo(0,0),s.scaleTo(.6,.6,0),s.parallel(s.fadeTo(1,133),s.scaleTo(1.5,1.5,200)),s.parallel(s.fadeTo(0,266),s.scaleTo(.9,.9,266)),s.callback(function(){e(!0),l.setVisibility(_.HIDDEN),t.__tokenGlowTransform=null}));u.setAction(c),l.setTransform(u,!0),t.__tokenGlowTransform=u}),n=new Promise(function(e,i){var n=~~(t.__numCompleted/h.MISSIONS_PER_SET),r=n-1,a=t.__rewardWidgets[r],l=a.check;l.setVisibility(_.VISIBLE);var u=new o,c=s.sequence(s.fadeTo(0,0),s.scaleTo(.5,.5,0),s.parallel(s.fadeTo(1,100),s.scaleTo(1.3,1.3,200)),s.scaleTo(1,1,133),s.callback(function(){e(!0),t.__checkTransform=null}));u.setAction(c),l.setTransform(u,!0),t.__checkTransform=u}),r=new Promise(function(e,i){var n=~~(t.__numCompleted/h.MISSIONS_PER_SET),r=n-1,a=t.__rewardWidgets[r],_=a.token,l=new o,u=s.sequence(s.wait(166),s.fadeTo(0,100),s.callback(function(){e(!0),t.__tokenTransform=null}));l.setAction(u),_.setTransform(l),t.__tokenTransform=l});return Promise.all([i,n,r]).then(function(){t.setNumMissionsComplete(t.__numCompleted,!1)})},update:function(e){this.__fullTransform&&this.__fullTransform.update(e),this.__glowTransform&&this.__glowTransform.update(e),this.__tokenGlowTransform&&this.__tokenGlowTransform.update(e),this.__checkTransform&&this.__checkTransform.update(e),this.__tokenTransform&&this.__tokenTransform.update(e)}})}),define("ui/views/FUEMissionProgressView",["require","exports","module","thor/core/Class","thor/core/Logger","thor/ui/Widget","thor/ui/Anchor","thor/graphics/animation/actions/Actions","thor/ui/Geometry","thor/graphics/animation/Transform","thor/core/Validation","thor/ui/Widget","thor/math/MathHelper","thor/ui/resources/WidgetResource","thor/resources/ResourceManager","thor/graphics/animation/EasingFunctions","mission/MissionSet","ui/views/MissionProgressView"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/ui/Widget"),e("thor/ui/Anchor")),s=(e("thor/graphics/animation/actions/Actions"),e("thor/ui/Geometry"),e("thor/graphics/animation/Transform"),e("thor/core/Validation")),o=e("thor/ui/Widget").VISIBILITY,a=(e("thor/math/MathHelper"),e("thor/ui/resources/WidgetResource")),_=(e("thor/resources/ResourceManager"),e("thor/graphics/animation/EasingFunctions"),e("mission/MissionSet")),l=e("ui/views/MissionProgressView"),h=_.MISSIONS_PER_SET;i.exports=n.create(l,{initialize:function(e,t){var i=e.get(a.RESOURCE_TYPE,"element_mission_progressFUE");this.__missionProgressWidget=i.construct();var n=this;t.addSlot(function(e){e.setAnchor(new r(0,0,1,1)),e.setWidget(n.__missionProgressWidget),e.setAutoSize(!0)}),this.__notchWidgets=[];for(var s=this.__missionProgressWidget.findSingleWidgetWithName("notchGroup1"),o=s.getNumSlots(),_=0;_<o;_++){var l=s.getSlotAtIndex(_).getWidget();this.__notchWidgets.push({empty:l.findSingleWidgetWithName("empty"),full:l.findSingleWidgetWithName("full"),glow:l.findSingleWidgetWithName("glowEffect"),widget:l})}if(this.__notchWidgets.length!==h)throw new Error("Number of notch slots does not match the expected "+h+" slots.");this.__rewardWidgets=[];var u=this.__missionProgressWidget.findSingleWidgetWithName("reward1");this.__rewardWidgets.push({check:u.findSingleWidgetWithName("checkMark"),token:u.findSingleWidgetWithName("tokenBox"),glow:u.findSingleWidgetWithName("glowEffect"),widget:u}),this.__textProgressWidgets=[];var c=this.__missionProgressWidget.findSingleWidgetWithName("text_progress1");this.__textProgressWidgets.push(c),this.setNumMissionsComplete(0),this.__numCompleted=0},setNumMissionsComplete:function(e,t){s.ifDefined.assertIsBoolean(t);for(var i=~~(e/_.MISSIONS_PER_SET),n=0;n<h;n++){var r=this.__notchWidgets[n];r.glow.setVisibility(o.HIDDEN),n<e?r.full.setVisibility(o.VISIBLE):r.full.setVisibility(o.HIDDEN)}var a=this.__rewardWidgets[0];a.glow.setVisibility(o.HIDDEN);var l=t&&e%_.MISSIONS_PER_SET==0&&1===i;0<i&&!l?(a.check.setVisibility(o.VISIBLE),a.token.setVisibility(o.HIDDEN)):(a.check.setVisibility(o.HIDDEN),a.token.setVisibility(o.VISIBLE)),0===i?(this.__textProgressWidgets[0].setVisibility(o.VISIBLE),this.__textProgressWidgets[0].setText((e%_.MISSIONS_PER_SET).toString()+"/"+_.MISSIONS_PER_SET.toString())):this.__textProgressWidgets[0].setVisibility(o.HIDDEN),this.__numCompleted=e,this.__missionProgressWidget.invalidate()}})}),define("ui/views/MissionDescriptionView",["require","exports","module","thor/core/Class","thor/core/Logger","thor/ui/Widget","thor/ui/Anchor","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/core/Validation","thor/ui/Widget","thor/math/MathHelper","thor/math/ColorUtil","thor/ui/resources/WidgetResource","thor/graphics/animation/EasingFunctions","thor/graphics/resources/TextureRegionResource","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","mission/MissionType","mission/MissionCategory","mission/MissionInstance","ManagerRepository"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/ui/Widget"),e("thor/ui/Anchor")),s=e("thor/graphics/animation/actions/Actions"),o=e("thor/graphics/animation/Transform"),a=e("thor/core/Validation"),_=e("thor/ui/Widget").VISIBILITY,l=(e("thor/math/MathHelper"),e("thor/math/ColorUtil"),e("thor/ui/resources/WidgetResource")),h=e("thor/graphics/animation/EasingFunctions"),u=e("thor/graphics/resources/TextureRegionResource"),c=e("thor/audio/SoundSprite"),d=e("thor/audio/SoundSpriteResourceLoader"),g=e("mission/MissionType"),p=e("mission/MissionCategory"),m=(e("mission/MissionInstance"),e("ManagerRepository")),f={};f[p.KILL]="BG_kills",f[p.COLLECT]="BG_collect",f[p.SKILL]="BG_skill";var v={};v[g.KILL_BRUISER]="icon_destroy_x_bruisers",v[g.KILL_DESTROYER]="icon_destroy_x_destroyers",v[g.KILL_FRIGATE]="icon_destroy_x_frigates",v[g.KILL_BOSS]="icon_destroy_x_boss",v[g.KILL_ENEMY]="icon_destroy_x_enemies",v[g.COLLECT_GOLD]="icon_collect_x_coins",v[g.COLLECT_FUEL]="icon_collect_x_fuel",v[g.MISSILE_UPGRADES]="icon_collect_x_missiles",v[g.GUN_UPGRADES]="icon_collect_x_bullets",v[g.COMPANION_UPGRADES]="icon_collect_x_companions",v[g.KILL_MINIBOSS]="icon_destroy_x_midboss";var y={channel:"UI_SFX"};i.exports=n.create({initialize:function(e,t,i,n,s,o,h){var u=this;a.ifDefined.assertIsBoolean(n),a.ifDefined.assertIsBoolean(s),a.ifDefined.assertIsBoolean(o),a.ifDefined.assertIsBoolean(h),this.__delayCompletion=n||!1;var g=m.getResourceManager();this.__sounds=g.getOrDefault(d.RESOURCE_TYPE,"game_sounds",c.EMPTY_SOUND_SPRITE);var p=g.get(l.RESOURCE_TYPE,"element_mission_description");this.__missionDescriptionWidget=p.construct(),this.__container=e,this.__container.addSlot(function(e){e.setAnchor(new r(0,0,1,1)),e.setWidget(u.__missionDescriptionWidget),e.setAutoSize(!0)}),this.__glow=this.__missionDescriptionWidget.findSingleWidgetWithName("glow"),this.__glow.setVisibility(_.HIDDEN),this.__icon=this.__missionDescriptionWidget.findSingleWidgetWithName("icon"),this.__check=this.__missionDescriptionWidget.findSingleWidgetWithName("check"),this.__backgrounds={};for(var v in f)this.__backgrounds[v]=this.__missionDescriptionWidget.findSingleWidgetWithName(f[v]);this.setMissionInstance(t,s,o,h),this.__introTransform=null,this.__screenWidth=i},setMissionInstance:function(e,t,i,n){a.ifDefined.assertIsBoolean(t),a.ifDefined.assertIsBoolean(i),a.ifDefined.assertIsBoolean(n);var r=g.CATEGORY[e.type];for(var s in this.__backgrounds)this.__backgrounds[s].setVisibility(_.HIDDEN);this.__backgrounds[r].setVisibility(_.VISIBLE);var o=m.getResourceManager(),l=v[e.type];if(a.isNonEmptyString(l)&&o.has(u.RESOURCE_TYPE,l)){var h=o.get(u.RESOURCE_TYPE,l);this.__icon.setTextureRegion(h)}var c=e.completed;c&&this.__delayCompletion&&(c=!e.recentlyCompleted),c?(this.__icon.setVisibility(_.HIDDEN),this.__check.setVisibility(_.VISIBLE)):(this.__icon.setVisibility(_.VISIBLE),this.__check.setVisibility(_.HIDDEN));var d=e.getDescription(),p=this.__missionDescriptionWidget.findSingleWidgetWithName("label");p.setText(d),c&&i?p.setTintColor(954662704):p.setTintColor(954662911);var f=this.__missionDescriptionWidget.findSingleWidgetWithName("label_progress"),y=this.__missionDescriptionWidget.findSingleWidgetWithName("ProgressBarWidget"),E=this.__missionDescriptionWidget.findSingleWidgetWithName("completeLine");if(e.completed)E.setVisibility(_.VISIBLE),y.setVisibility(_.HIDDEN),f.setText("COMPLETE");else{E.setVisibility(_.HIDDEN),y.setVisibility(_.VISIBLE);var S=e.getRemaining();if(e.isEphemeral()){var T=0;t?(S=e.getProgress(),n&&(T=e.progress/e.requirement)):i&&(S=e.getBestProgress()),y.setProgress(T)}else y.setProgress(e.progress/e.requirement);f.setText(S)}this.__missionDescriptionWidget.invalidate(),this.__container.invalidate()},slideIn:function(e){var t=this;return new Promise(function(i,n){var r=new o,a=s.sequence(s.moveBy(-t.__screenWidth,0,0),s.wait(e),s.moveBy(t.__screenWidth,0,200,h.easeOut),s.callback(function(){i(!0),t.__introTransform=null}));r.setAction(a),t.__missionDescriptionWidget.invalidate(),t.__container.invalidate(),t.__missionDescriptionWidget.setTransform(r),t.__introTransform=r})},slidePast:function(e){var t=this;return new Promise(function(i,n){var r=new o,a=s.sequence(s.moveBy(t.__screenWidth,0,0),s.moveBy(-t.__screenWidth,0,200,h.easeOut),s.wait(e-400),s.moveBy(-t.__screenWidth,0,200,h.easeOut),s.callback(function(){i(!0),t.__introTransform=null}));r.setAction(a),t.__missionDescriptionWidget.invalidate(),t.__container.invalidate(),t.__missionDescriptionWidget.setTransform(r),t.__introTransform=r})},animateComplete:function(){var e=this,t=new Promise(function(t,i){e.__glow.setVisibility(_.VISIBLE);var n=new o,r=s.sequence(s.scaleTo(.01,.01,0),s.fadeTo(1,0),s.scaleTo(3,3,300),s.parallel(s.scaleTo(1.2,1.2,300),s.fadeTo(0,300)),s.callback(function(){t(!0),e.__glow.setVisibility(_.HIDDEN),e.__glowTransform=null}));n.setAction(r),e.__glow.setTransform(n,!0),e.__glowTransform=n}),i=new Promise(function(t,i){e.__check.setVisibility(_.VISIBLE);var n=new o,r=s.sequence(s.callback(function(){e.__sounds.play("check_mark",y)}),s.fadeTo(0,0),s.wait(266),s.scaleTo(1.65,1.65,0),s.parallel(s.fadeTo(1,200),s.scaleTo(1,1,300,h.easeOut)),s.callback(function(){t(!0),e.__checkTransform=null}));n.setAction(r),e.__check.setTransform(n,!0),e.__checkTransform=n}),n=new Promise(function(t,i){var n=new o,r=s.sequence(s.wait(366),s.fadeTo(0,100),s.callback(function(){t(!0),e.__icon.setVisibility(_.HIDDEN),e.__iconTransform=null}));n.setAction(r),e.__icon.setTransform(n),e.__iconTransform=n});return Promise.all([t,i,n])},update:function(e){this.__introTransform&&this.__introTransform.update(e),this.__glowTransform&&this.__glowTransform.update(e),this.__checkTransform&&this.__checkTransform.update(e),this.__iconTransform&&this.__iconTransform.update(e)}}),i.exports.MISSION_ICON_RESOURCE_NAMES=v}),define("ui/MissionsDialog",["require","exports","module","thor/core/Class","thor/core/Logger","thor/ui/Widget","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/core/Validation","thor/util/StringUtil","thor/audio/SoundSprite","thor/ui/resources/WidgetResource","thor/util/TimeoutContext","thor/graphics/animation/EasingFunctions","thor/resources/ResourceManager","thor/graphics/resources/TextureRegionResource","thor/audio/SoundSpriteResourceLoader","ManagerRepository","mission/MissionSet","mission/MissionType","mission/MissionCategory","mission/MissionInstance","ui/CommonActions","ui/SlideInDialog","ui/views/MissionProgressView","ui/views/FUEMissionProgressView","ui/views/MissionDescriptionView"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/ui/Widget")),s=e("thor/graphics/animation/actions/Actions"),o=e("thor/graphics/animation/Transform"),a=(e("thor/core/Validation"),r.VISIBILITY),_=e("thor/util/StringUtil"),l=e("thor/audio/SoundSprite"),h=(e("thor/ui/resources/WidgetResource"),e("thor/util/TimeoutContext")),u=(e("thor/graphics/animation/EasingFunctions"),e("thor/resources/ResourceManager"),e("thor/graphics/resources/TextureRegionResource"),e("thor/audio/SoundSpriteResourceLoader")),c=e("ManagerRepository"),d=e("mission/MissionSet"),g=(e("mission/MissionType"),e("mission/MissionCategory"),e("mission/MissionInstance"),e("ui/CommonActions")),p=e("ui/SlideInDialog"),m=e("ui/views/MissionProgressView"),f=e("ui/views/FUEMissionProgressView"),v=e("ui/views/MissionDescriptionView");i.exports=n.create(p,{initialize:function(e,t,i){p.prototype.initialize.call(this,e,t,i);var n=c.getResourceManager();this.__timeoutContext=new h,this.__sounds=n.getOrDefault(u.RESOURCE_TYPE,"game_sounds",l.EMPTY_SOUND_SPRITE),this._widget=this._widget.findSingleWidgetWithName("missions_panel"),this._widget.setVisibility(a.HIDDEN);var r=this._widget.findSingleWidgetWithName("ListPanel");this.__missionSlotWidgets=[],this.__missionDescriptionContainers=[],this.__missionDescriptionSwapButtons=[],this.__missionDescriptionViews=[];for(var s=0,o=r.getNumSlots();s<o;s++){var _=r.getSlotAtIndex(s).getWidget();this.__missionSlotWidgets.push(_);var d=_.findSingleWidgetWithName("mission_description");this.__missionDescriptionContainers.push(d);var g=_.findSingleWidgetWithName("btn_swap");g.setClickHandler(this.__swapMission.bind(this,s)).setSoundSprite(this.__sounds),this.__missionDescriptionSwapButtons.push(g)}var v=this._widget.findSingleWidgetWithName("mission_progress");c.getFUEManager().isMissionResetEnabled()?this.__missionProgress=new m(n,v):this.__missionProgress=new f(n,v),this.__missionsTimerLabel=this._widget.findSingleWidgetWithName("expiry_timer"),this.__missionsList=this._widget.findSingleWidgetWithName("mission_list"),this.__missionsMessagingContainer=this._widget.findSingleWidgetWithName("mission_messaging"),this.__missionsDailyMessagingContainer=this.__missionsMessagingContainer.findSingleWidgetWithName("finished_daily"),this.__missionsSetMessagingContainer=this.__missionsMessagingContainer.findSingleWidgetWithName("finished_set"),this.__missionsDailyTimer=this.__missionsDailyMessagingContainer.findSingleWidgetWithName("timer"),this.__missionsSetTimer=this.__missionsSetMessagingContainer.findSingleWidgetWithName("timer"),this.__backButton=this._widget.findSingleWidgetWithName("btn_back").findSingleWidgetWithName("button"),this.__backButton.setClickHandler(this.hide.bind(this)).setSoundSprite(this.__sounds).setClickSound("back"),this.__swapButtonTransform=null,this._widget.invalidate()},__flickerSwapButton:function(e,t){var i=this;return new Promise(function(n,r){var a=i.__missionSlotWidgets[e],_=i.__missionDescriptionViews[e],l=new o,h=s.sequence(s.fadeTo(0,550),s.wait(100),s.callback(function(){_.setMissionInstance(t)}),g.createDialogBlinkIn(),s.callback(function(){n(!0),i.__swapButtonTransform=null}));l.setAction(h),a.setTransform(l),i.__swapButtonTransform=l})},__swapMission:function(e){for(var t=0,i=this.__missionDescriptionSwapButtons.length;t<i;t++){this.__missionDescriptionSwapButtons[t].setEnabled(!1)}var n=c.getMissionManager(),r=n.getMissionSet(),s=this;r.swap(e).then(function(t){return s.__flickerSwapButton(e,t)}).catch(function(){s.__updateMissionExternalComponents()}).then(function(){s.__updateMissionExternalComponents()})},__updateMissionExternalComponents:function(){for(var e=c.getMissionManager(),t=e.getMissionSet(),i=t.getMissions(),n=c.getPlayerManager().getPlayerGold(),r=n>=d.SWAP_COST,s=c.getFUEManager().isMissionResetEnabled(),o=0,_=i.length;o<_;o++){var l=i[o],h=this.__missionDescriptionSwapButtons[o];h.setEnabled(r&&s),h.setVisibility(l.completed?a.HIDDEN:a.VISIBLE)}for(var u=this.__missionDescriptionSwapButtons.length;o<u;o++)this.__missionDescriptionSwapButtons[o].setVisibility(a.HIDDEN)},__showMissions:function(){this.__updateMissionExternalComponents();var e=c.getMissionManager(),t=e.getMissionSet(),i=t.getCompletedSets(),n=t.getCompleted().length;n=t.isComplete()?0:t.getCompleted().length;var r=i*d.MISSIONS_PER_SET+n;this.__missionProgress.setNumMissionsComplete(r);var s=t.getMissions();this.__missionDescriptionViews.length=0;for(var o=0,_=this.__missionDescriptionContainers.length;o<_;o++){for(var l=this.__missionDescriptionContainers[o],h=s[o],u=l.getNumSlots(),g=u-1;g>=0;g--)l.removeSlotAtIndex(g);if(h){l.setVisibility(a.VISIBLE);var p=new v(l,h,this._gameBounds.width,!1,!1,!0);this.__missionDescriptionViews.push(p),l.invalidate()}else l.setVisibility(a.HIDDEN),l.invalidate()}this.__updateMissionExternalComponents();var m=i>=d.MAX_COMPLETED_SETS;if(!m&&c.getFUEManager().isMissionResetEnabled()){this.__missionsTimerLabel.setVisibility(a.VISIBLE);var f=t.computeResetEpochMS();this.__startMissionTick(f)}else this.__missionsTimerLabel.setVisibility(a.HIDDEN);if(t.isComplete()){this.__missionsList.setVisibility(a.HIDDEN),this.__missionsMessagingContainer.setVisibility(a.VISIBLE);var f;m?(this.__missionsSetMessagingContainer.setVisibility(a.HIDDEN),this.__missionsDailyMessagingContainer.setVisibility(a.VISIBLE),f=t.computeResetEpochMS()):(this.__missionsSetMessagingContainer.setVisibility(a.VISIBLE),this.__missionsDailyMessagingContainer.setVisibility(a.HIDDEN),f=t.computeMissionStartEpochMS()),this.__startMissionMessagingTick(f)}else this.__missionsList.setVisibility(a.VISIBLE),this.__missionsMessagingContainer.setVisibility(a.HIDDEN);this._widget.invalidate()},__startMissionMessagingTick:function(e){var t=this;this.__cancelMissionMessagingTick(),this.__missionMessagingTargetTimestamp=e,this.__missionMessagingTick(),this.__timeoutContext.setTimeout(function(){t.__missionMessagingTick(),t.__missionMessagingIntervalId=t.__timeoutContext.setInterval(t.__missionMessagingTick.bind(t),1e3)},1e3-Date.now()%1e3)},__cancelMissionMessagingTick:function(){this.__missionMessagingIntervalId&&(this.__timeoutContext.cancelInterval(this.__missionMessagingIntervalId),this.__missionMessagingIntervalId=null)},__missionMessagingTick:function(){var e=Math.max(0,this.__missionMessagingTargetTimestamp-Date.now()),t=~~(e/1e3),i=_.getTimeDisplayString(t,"00:00:00","hybridHours");this.__missionsDailyTimer.setText(i),this.__missionsSetTimer.setText(i),e<=0&&this.__cancelMissionMessagingTick()},__startMissionTick:function(e){var t=this;this.__cancelMissionTick(),this.__missionTargetTimestamp=e,this.__missionTick(),this.__timeoutContext.setTimeout(function(){t.__missionTick(),t.__missionIntervalId=t.__timeoutContext.setInterval(t.__missionTick.bind(t),1e3)},1e3-Date.now()%1e3)},__cancelMissionTick:function(){this.__missionIntervalId&&(this.__timeoutContext.cancelInterval(this.__missionIntervalId),this.__missionIntervalId=null)},__missionTick:function(){var e=Math.max(0,this.__missionTargetTimestamp-Date.now()),t=~~(e/1e3),i=_.getTimeDisplayString(t,"00:00:00","hybridHours");this.__missionsTimerLabel.setText("NEW DAILY MISSIONS IN "+i),e<=0&&this.__cancelMissionTick()},show:function(){return this.__showMissions(),p.prototype.show.call(this)},hide:function(){return this.__cancelMissionTick(),p.prototype.hide.call(this)},destroy:function(){this.__timeoutContext.clearAll(),p.prototype.destroy.call(this)},update:function(e){p.prototype.update.call(this,e),this.__swapButtonTransform&&this.__swapButtonTransform.update(e)}})}),define("ui/views/MissionSummary",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","thor/util/TimeoutContext","thor/util/StringUtil","thor/ui/Widget","ManagerRepository","mission/MissionSet"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/audio/SoundSprite")),s=e("thor/audio/SoundSpriteResourceLoader"),o=e("thor/util/TimeoutContext"),a=e("thor/util/StringUtil"),_=e("thor/ui/Widget"),l=_.VISIBILITY,h=e("ManagerRepository"),u=e("mission/MissionSet");i.exports=n.create({initialize:function(e,t){this._widget=e,this.__defaultButton=e.findSingleWidgetWithName("btn_normal"),this.__newButton=e.findSingleWidgetWithName("btn_new"),this.__waitingButton=e.findSingleWidgetWithName("btn_waiting"),this.__glow=e.findSingleWidgetWithName("glow"),this.__timerLabel=e.findSingleWidgetWithName("text_timer"),this.__timerIcon=e.findSingleWidgetWithName("icon_timer"),this.__progressLabel=e.findSingleWidgetWithName("text_compValue"),this.__progressDescriptionLabel=e.findSingleWidgetWithName("text_progress"),this.__completeLabel=e.findSingleWidgetWithName("text_status");var i=h.getResourceManager();this.__sounds=i.getOrDefault(s.RESOURCE_TYPE,"game_sounds",r.EMPTY_SOUND_SPRITE),this.__playerOpened=!1,this.__timeoutContext=new o;var n=this;this.setClickHandler(function(){n.__playerOpened=!0,t(),n.refresh()}),this.refresh()},getWidget:function(){return this._widget},__pickNewMissions:function(){var e=h.getMissionManager(),t=e.getMissionSet(),i=h.getPlayerManager(),n=i.getPlayerLevel();return t.advance(n,t.shouldDailyReset())},refresh:function(){var e=this,t=h.getMissionManager(),i=t.getMissionSet(),n=i.isComplete(),r=i.getCompleted().length;this.__progressLabel.setText(r+"/"+u.MISSIONS_PER_SET);var s=!1;if(!i.isComplete()){s=i.getMissions().reduce(function(e,t){return e+t.progress},0)<=0}this.__glow.setVisibility(s&&!this.__playerOpened?l.VISIBLE:l.HIDDEN),n?(this.__defaultButton.setVisibility(l.HIDDEN),this.__newButton.setVisibility(l.HIDDEN),this.__waitingButton.setVisibility(l.VISIBLE)):!s||this.__playerOpened?(this.__defaultButton.setVisibility(l.VISIBLE),this.__newButton.setVisibility(l.HIDDEN),this.__waitingButton.setVisibility(l.HIDDEN)):(this.__defaultButton.setVisibility(l.HIDDEN),this.__newButton.setVisibility(l.VISIBLE),this.__waitingButton.setVisibility(l.HIDDEN));if(i.isComplete()?(this.__completeLabel.setVisibility(l.VISIBLE),this.__progressLabel.setVisibility(l.HIDDEN),this.__progressDescriptionLabel.setVisibility(l.HIDDEN)):(this.__completeLabel.setVisibility(l.HIDDEN),this.__progressLabel.setText(r+"/"+u.MISSIONS_PER_SET),this.__progressLabel.setVisibility(l.VISIBLE),this.__progressDescriptionLabel.setVisibility(l.VISIBLE)),!h.getFUEManager().isMissionResetEnabled())return this.__timerLabel.setVisibility(l.HIDDEN),void this.__timerIcon.setVisibility(l.HIDDEN);this.__timerLabel.setVisibility(l.VISIBLE),this.__timerIcon.setVisibility(l.VISIBLE);var o;if(i.isComplete()){if((o=i.computeMissionStartEpochMS())<=Date.now())return void this.__pickNewMissions().then(this.refresh.bind(this))}else o=i.computeResetEpochMS();this.__timeoutContext.clearAll();var a=this.__tickTimer.bind(this,o);a(),this.__timeoutContext.setTimeout(function(){e.__timeoutContext.setInterval(a,1e3)},1e3-Date.now()%1e3)},__tickTimer:function(e){var t=Date.now(),i=Math.max((e-t)/1e3,0),n=a.getTimeDisplayString(i,"0:00:00","hybridHours");this.__timerLabel.setText(n).invalidate(),i<=0&&this.refresh()},setClickHandler:function(e){this.__defaultButton.setClickHandler(e).setSoundSprite(this.__sounds),this.__newButton.setClickHandler(e).setSoundSprite(this.__sounds),this.__waitingButton.setClickHandler(e).setSoundSprite(this.__sounds)},setEnabled:function(e){this.__defaultButton.setEnabled(e),this.__newButton.setEnabled(e)},destroy:function(){this.__timeoutContext.clearAll()}})}),define("ui/GalatronDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Dialog","thor/audio/SoundSprite","thor/resources/ResourceManager","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/ui/Dialog")),s=e("thor/audio/SoundSprite"),s=(e("thor/resources/ResourceManager"),e("thor/audio/SoundSprite")),o=e("thor/audio/SoundSpriteResourceLoader");i.exports=n.create(r,{initialize:function(e,t){r.prototype.initialize.call(this,e,t),this.__sounds=e.getOrDefault(o.RESOURCE_TYPE,"game_sounds",s.EMPTY_SOUND_SPRITE),this.setCloseSoundId(this.__sounds,"back")},show:function(e){r.prototype.show.call(this,e),this.__sounds.play("popup")}})}),define("ui/LevelUpDialog",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/ui/Margin","thor/ui/Anchor","thor/ui/Widget","thor/ui/Geometry","thor/ui/Widget","thor/ui/ImageWidget","thor/ui/resources/WidgetResource","thor/graphics/resources/TextureRegionResource","thor/graphics/animation/EasingFunctions","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/resources/ResourceManager","thor/entity/EntityManager","thor/event/EventManager","ManagerRepository","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","thor/entity/EntityDestroyedEvent","Constants","player/PlayerManager","player/PlayerLevelRewardEnum","player/CurrencyTypeEnum","ui/CommonActions","ui/GalatronDialog","ui/WalletView","thor/util/TimeoutContext","thor/graphics/resources/TextureRegionResource","thor/graphics/resources/ParticleSystemResource","thor/entity/ParticleSystemComponent"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=(e("thor/ui/Margin"),e("thor/ui/Anchor"),e("thor/ui/Widget"),e("thor/ui/Geometry")),a=e("thor/ui/Widget").VISIBILITY,_=(e("thor/ui/ImageWidget"),e("thor/ui/resources/WidgetResource")),l=e("thor/graphics/resources/TextureRegionResource"),h=e("thor/graphics/animation/EasingFunctions"),u=e("thor/graphics/animation/actions/Actions"),c=e("thor/graphics/animation/Transform"),d=(e("thor/resources/ResourceManager"),e("thor/entity/EntityManager"),e("thor/event/EventManager"),e("ManagerRepository")),g=e("thor/audio/SoundSprite"),p=e("thor/audio/SoundSpriteResourceLoader"),m=e("thor/entity/EntityDestroyedEvent"),f=e("Constants"),v=(e("player/PlayerManager"),e("player/PlayerLevelRewardEnum")),y=e("player/CurrencyTypeEnum"),E=e("ui/CommonActions"),S=e("ui/GalatronDialog"),T=(e("ui/WalletView"),e("thor/util/TimeoutContext")),l=e("thor/graphics/resources/TextureRegionResource"),C=e("thor/graphics/resources/ParticleSystemResource"),I=(e("thor/entity/ParticleSystemComponent"),new o(0,0,1,1)),w=new o(0,0,1,1),b=[0,80],M={channel:"UI_SFX"};i.exports=n.create(S,{initialize:function(e,t,i,n,r,s){S.prototype.initialize.call(this,t,"screen_level_up"),this.__playerManager=e,this.__resourceManager=t,this.__entityManager=i,this.__eventManager=n,this.__sounds=t.getOrDefault(p.RESOURCE_TYPE,"game_sounds",g.EMPTY_SOUND_SPRITE),this.__animations=[],this.__button=this._widget.findSingleWidgetWithName("SimpleButtonWidget").setClickHandler(this.__clicked.bind(this)),this.__walletView=s;var o=this._widget.findSingleWidgetWithName("dialogue").getSlotAtIndex(1),h=this.__resourceManager.get(_.RESOURCE_TYPE,"element_card_full");this.__card=h.construct(),this.__card.setVisibility(a.HIDDEN),o.setWidget(this.__card),this.__card.findSingleWidgetWithName("glow_full_card").setVisibility(a.HIDDEN),this.__card.findSingleWidgetWithName("glow_frame").setVisibility(a.HIDDEN),this.__cardContents=this.__card.findSingleWidgetWithName("gift_card"),this.__card.findSingleWidgetWithName("upgrade_card").setVisibility(a.HIDDEN),this.__cardBack=this.__cardContents.findWidgetsWithName("frame")[0],this.__rewardNameLabel=this._widget.findSingleWidgetWithName("text_cardName"),this.__rewardDescriptionLabel=this._widget.findSingleWidgetWithName("text_cardDescription"),this.__rewardNameLabel.setVisibility(a.HIDDEN),this.__rewardDescriptionLabel.setVisibility(a.HIDDEN);var u=this.__cardContents.findSingleWidgetWithName("coins");u.setVisibility(a.HIDDEN);var c=u.findSingleWidgetWithName("icon"),m=u.findSingleWidgetWithName("credits"),f=u.findSingleWidgetWithName("count_total_credits"),v=this.__cardContents.findSingleWidgetWithName("parts");v.setVisibility(a.HIDDEN);var y=v.findSingleWidgetWithName("icon"),E=v.findSingleWidgetWithName("credits"),I=v.findSingleWidgetWithName("count_total_credits"),w=this.__cardContents.findSingleWidgetWithName("tokens");w.setVisibility(a.HIDDEN);var b=w.findSingleWidgetWithName("icon"),M=w.findSingleWidgetWithName("credits"),x=w.findSingleWidgetWithName("count_total_credits"),R=this.__cardContents.findSingleWidgetWithName("slot unlock"),u=this.__cardContents.findSingleWidgetWithName("coins");R.setVisibility(a.HIDDEN);var P=R.findSingleWidgetWithName("icon"),A=R.findSingleWidgetWithName("label"),N=this.__cardContents.findSingleWidgetWithName("coin multiplier");N.setVisibility(a.HIDDEN);var D=N.findSingleWidgetWithName("icon"),L=N.findSingleWidgetWithName("multiplier_label"),O=this.__cardContents.findSingleWidgetWithName("powerUp_gun");O.setVisibility(a.HIDDEN);var V=O.findSingleWidgetWithName("icon"),B=O.findSingleWidgetWithName("text_info"),k=this.__cardContents.findSingleWidgetWithName("powerUp_missile");k.setVisibility(a.HIDDEN);var W=k.findSingleWidgetWithName("icon"),F=k.findSingleWidgetWithName("text_info"),U=this.__cardContents.findSingleWidgetWithName("powerUp_companion");U.setVisibility(a.HIDDEN);var G=U.findSingleWidgetWithName("icon"),H=U.findSingleWidgetWithName("text_info");this.__componentsByRewardType={COINS:{container:u,icon:c,labelContainer:m,label:f},PARTS:{container:v,icon:y,labelContainer:E,label:I},TOKENS:{container:w,icon:b,labelContainer:M,label:x},CARD_SLOT:{container:R,icon:P,label:A},COIN_MULTIPLIER:{container:N,icon:D,label:L},GUN_POWERUP:{container:O,icon:V,labelContainer:B},MISSILE_POWERUP:{container:k,icon:W,labelContainer:F},COMPANION_POWERUP:{container:U,icon:G,labelContainer:H}},this.__topTray=this._widget.findSingleWidgetWithName("top_tray"),this.__topTray.setVisibility(a.HIDDEN),this.__walletView.attach(this.__topTray),this.__walletView.pause(),this.__levelLabel=this._widget.findSingleWidgetWithName("level"),this.__levelLabel.setText(""+(this.__playerManager.getPlayer().level-1)),this.__levelUpLabel=this._widget.findSingleWidgetWithName("label1"),this.__levelUpLabel.setVisibility(a.HIDDEN),this.__levelUpFlash=this._widget.findWidgetsWithName("word_glow")[0],this.__levelUpFlash.setVisibility(a.HIDDEN),this.__rewardsLabel=this._widget.findSingleWidgetWithName("label2"),this.__rewardsLabel.setVisibility(a.HIDDEN),this.__rewardsFlash=this._widget.findSingleWidgetWithName("word_glow2"),this.__rewardsFlash.setVisibility(a.HIDDEN),this.__levelUpWorld=this._widget.findSingleWidgetWithName("level_up_animation");var q=r();this.__levelUpWorld.setWorld(q),this.__cardUnlockWorld=this._widget.findSingleWidgetWithName("slot_animation");var Y=r();this.__cardUnlockWorld.setWorld(Y),this.__skeletonFactory=d.getSkeletonFactory(),this.__sparkleTemplate=this.__entityManager.createEntity();var z=this.__entityManager.addComponent(this.__sparkleTemplate,"SceneComponent",!1);z.setScale(2,2),this.__sparkleTemplate.setRootComponent(z);var X=this.__entityManager.addComponent(this.__sparkleTemplate,"ParticleSystemComponent",!1),K=this.__resourceManager.get(C.RESOURCE_TYPE,"particles/vfx_ambient_particles"),j=this.__resourceManager.get(l.RESOURCE_TYPE,"point");X.setName("LevelUpParticles"),X.setParticleSystem(K),X.setTextureRegion(j),X.attachTo(z),this.__particleAnimation=null,this.__hexAnimation=null,this.__rewardAnimation=null,this.__cardUnlock=null,this.__timeoutContext=new T},show:function(e,t,i,n){S.prototype.show.call(this,e),this.__walletView.setCurrency(y.TOKENS,i,!0),this.__walletView.setCurrency(y.GOLD,n,!0),this.__walletView.pause();var s={};0===t.length&&r.warn("No rewards passed to LevelUpDialog",t),this.__rewardNameLabel.setVisibility(a.HIDDEN),this.__rewardDescriptionLabel.setVisibility(a.HIDDEN);for(var o=0,_=t.length;o<_;o++){var l=t[o]
;l.type===v.COIN_MULTIPLIER?s.COIN_MULTIPLIER=(s.COIN_MULTIPLIER||0)+l.value:l.type===v.CARD_SLOT?s.CARD_SLOT=1:l.type===v.PARTS?s.PARTS=(s.PARTS||0)+l.value:l.type===v.TOKENS?s.TOKENS=(s.TOKENS||0)+l.value:l.type===v.GUN_POWERUP?s.GUN_POWERUP=1:l.type===v.MISSILE_POWERUP?s.MISSILE_POWERUP=1:l.type===v.COMPANION_POWERUP?s.COMPANION_POWERUP=1:r.debug("Unknown reward type in LevelUpDialog",l)}this.__rewardContents=s,this.__arrRewardTypes=Object.keys(s),this.__currentRewardIdx=0,this.__showingLevelIntro=!0,this.__animations.length=0,this._widget.setVisibility(a.VISIBLE),this._widget.invalidate();var h=this,u=this.__levelUpWorld.__world;this.__particleAnimation=u.spawnEntity(this.__sparkleTemplate,{attachParent:u.getScene().getRootComponent(),sortOrder:1}),this.__hexAnimation=this.__skeletonFactory.create("level_up",u,{attachParent:u.getScene().getRootComponent(),sortOrder:2});var c=h.__hexAnimation.getComponent("SkeletonComponent");this.__createCallback(function(){h.__sounds.play("player_level_up",M),c.setDefaultAnimation("player level up idle"),c.playAnimation("player level up start",!1),c.setAnimationEndedCallback(function(){c.playAnimation("player level up idle",!0)})},1e3),this.__fadeOut(this.__levelLabel,250,1e3),this.__createCallback(function(){h.__levelLabel.setText(""+h.__playerManager.getPlayer().level),h.__fadeInBlink(h.__levelLabel,250,0)},1500),this.__fadeInAndOut(this.__levelUpFlash,250,2e3),this.__fadeInNoBlink(this.__levelUpLabel,250,2250),this.__fadeInNoBlink(this.__topTray,250,3e3),this.__fadeInAndOut(this.__rewardsFlash,250,3e3),this.__fadeInNoBlink(this.__rewardsLabel,250,3250),this.__createCallback(this.__showRewards.bind(this),3500)},close:function(){this.__animations.length=0,this.__rewardNameLabel.setVisibility(a.HIDDEN),this.__rewardDescriptionLabel.setVisibility(a.HIDDEN);var e=this;this._widget.runAction(u.sequence(E.createDialogBlinkOut(),u.callback(function(){S.prototype.close.call(e),e.__walletView.detach(),e.destroy()})))},__showRewards:function(){this.__animations.length=0,this.__cardRevealed=!1,this.__isClosing=!1,this.__hidingCurrentCard=!1,this.__skipped=!1,this.__showingLevelIntro=!1,this.__fadeInBlink(this.__card,300,250),this.__currentRewardIdx=0,this.__showCurrentReward()},__showCurrentReward:function(){this.__hidingCurrentCard=!1,this.__cardRevealed=!1;var e=this.__arrRewardTypes[this.__currentRewardIdx],t=this.__rewardContents[e],i=this.__componentsByRewardType[e],n=v.isPowerUp(e);if(!s.isDefined(t))return r.warn("Reward type "+e+" is not in the gift box, aborting"),this.close();if(!s.isObject(i))return r.warn("No components exist for reward type "+e+", aborting"),this.close();this.__rewardNameLabel.setVisibility(a.HIDDEN),this.__rewardDescriptionLabel.setVisibility(a.HIDDEN),this.__currentRewardComponents=i;var o=i.container,_=i.icon,l=i.labelContainer,h=i.label;_.setVisibility(a.HIDDEN),l&&l.setVisibility(a.HIDDEN),h&&h.setVisibility(a.HIDDEN),"COINS"===e?h.setText(f.COINS_SYMBOL+t).invalidate():h&&"COIN_MULTIPLIER"!==e&&"CARD_SLOT"!==e&&h.setText(""+t).invalidate();var u=f.REWARD_TYPE_NAMES[e],c=f.REWARD_TYPE_DESCRIPTIONS[e],d=0===this.__currentRewardIdx?250:0,g=this.__skipped?0:d+300+200+950;this.__cardBack.setVisibility(a.VISIBLE),this.__skipped?(this.__skip(this.__cardBack),this.__skip(_),this.__setCardRevealed(),s.isNonEmptyString(u)&&s.isNonEmptyString(c)&&(this.__rewardNameLabel.setText(u),this.__rewardDescriptionLabel.setText(c),this.__skip(this.__rewardNameLabel),this.__skip(this.__rewardDescriptionLabel))):(this.__flipCardBack(this.__cardBack,d+300),this.__flipCardFront(_,d+300+200),s.isNonEmptyString(u)&&s.isNonEmptyString(c)&&this.__showNameAndDescription(u,c,d+300+200)),l?(n?this.__flipWidget(l,d+300+200):this.__expandAndShrink(l,g),h&&h.setVisibility(a.VISIBLE)):h&&(n?this.__flipWidget(h,d+300+200):this.__expandAndShrink(h,g)),"COINS"===e?this.__addCurrency(y.GOLD,t,h,g):"PARTS"===e?this.__addCurrency(y.PARTS,t,h,g):"TOKENS"===e?this.__addCurrency(y.TOKENS,t,h,g):n&&(this.__flipLockIcon(o,d+300+200),this.__scaleUpUpgradeIcon(o,d+300+200)),o.setVisibility(a.VISIBLE),this._widget.invalidate(),this.__timeoutContext.setTimeout(this.__nextCard.bind(this),f.ANIMATION_TRIGGER_DELAY_MS+300+200+950)},__addCurrency:function(e,t,i,n){function r(){i.getGeometry(w);var n=w.getX(),r=w.getY();s.__walletView.gain(e,t,n,r)}var s=this,o=u.sequence(u.wait(n),u.callback(r)),a=new c;a.setAction(o),i.setTransform(a),this.__animations.push(a)},__animateCurrentRewardOut:function(){this.__hidingCurrentCard=!0,this.__sounds.play("card_fly_out",M),this.__scaleOutWidget(this.__cardBack),this.__currentRewardComponents&&this.__currentRewardComponents.container&&this.__scaleOutWidget(this.__currentRewardComponents.container),this.__currentRewardIdx++,this.__createCallback(this.__showCurrentReward.bind(this),300)},__clicked:function(){if(!this.__isClosing)if(this.__showingLevelIntro){this.__showingLevelIntro=!1,this.__animations.length=0;var e=this.__hexAnimation.getComponent("SkeletonComponent");e.clearAnimationEndedCallback(),e.playAnimation("player level up idle"),this.__levelLabel.setText(""+this.__playerManager.getPlayer().level),this.__skip(this.__levelLabel),this.__levelLabel.setVisibility(a.VISIBLE),this.__rewardsLabel.setVisibility(a.VISIBLE),this.__skip(this.__rewardsLabel),this.__rewardsFlash.setVisibility(a.HIDDEN),this.__levelUpLabel.setVisibility(a.VISIBLE),this.__skip(this.__levelUpLabel),this.__levelUpFlash.setVisibility(a.HIDDEN),this.__showRewards()}else this.__cardRevealed&&!this.__hidingCurrentCard&&(this.__animations.length=0,this.__skipped=!0,this.__nextCard())},__nextCard:function(){if(this.__timeoutContext.clearTimeouts(),this.__currentRewardIdx<this.__arrRewardTypes.length-1?this.__animateCurrentRewardOut():(this.__skipped=!1,this.__dismissCard()),this.__cardUnlock){var e=this.__eventManager.getNewEvent(m);e.setEntityId(this.__cardUnlock.getId()),e.setDestroyedByPlayer(!1),this.__eventManager.triggerEvent(e),this.__cardUnlock=null}},__skip:function(e){var t=u.sequence(u.fadeTo(1,0),u.callback(function(){e.setVisibility(a.VISIBLE)}),u.scaleTo(1,1,0)),i=new c;i.setAction(t),e.setTransform(i,!0),this.__animations.push(i)},__expandAndShrink:function(e,t){var i=u.sequence(u.callback(function(){e.setVisibility(a.VISIBLE)}),u.fadeTo(0,0),u.wait(t),u.fadeTo(1,0),u.scaleTo(1.3,1.3,200,h.interpolateCubic),u.scaleTo(1,1,200,h.interpolateCubic)),n=new c;n.setAction(i),e.setTransform(n,!0),this.__animations.push(n)},__flipCardBack:function(e,t){var i=u.sequence(u.scaleTo(-1,1,0),u.wait(t),u.scaleTo(0,1,200,h.interpolateCubic),u.scaleTo(1.3,1.3,200,h.interpolateCubic),u.scaleTo(1,1,200,h.interpolateCubic),u.callback(this.__setCardRevealed.bind(this))),n=new c;n.setAction(i),e.setTransform(n,!0),this.__animations.push(n)},__flipCardFront:function(e,t){var i=this,n=u.sequence(u.callback(function(){e.setVisibility(a.VISIBLE)}),u.fadeTo(0,0),u.scaleTo(0,1,0),u.wait(t),u.callback(function(){i.__sounds.play("card_flip")}),u.fadeTo(1,0),u.scaleTo(1.3,1.3,200,h.interpolateCubic),u.scaleTo(1,1,200,h.interpolateCubic)),r=new c;r.setAction(n),e.setTransform(r,!0),this.__animations.push(r)},__fadeInBlink:function(e,t,i){var n=new c,r=u.sequence(u.fadeTo(0,0),u.wait(i),u.callback(function(){e.setVisibility(a.VISIBLE)}),u.fadeTo(1,.7*t,h.startBounce),u.fadeTo(1,.3*t,h.bounceLoop));n.setAction(r),this.__animations.push(n),e.setTransform(n,!0)},__fadeInAndOut:function(e,t,i){var n=new c,r=u.sequence(u.fadeTo(0,0),u.wait(i),u.callback(function(){e.setVisibility(a.VISIBLE)}),u.fadeTo(1,.5*t,h.easeInOut),u.fadeTo(0,.5*t,h.easeInOut));n.setAction(r),this.__animations.push(n),e.setTransform(n,!0)},__fadeInNoBlink:function(e,t,i){var n=new c,r=u.sequence(u.fadeTo(0,0),u.wait(i),u.callback(function(){e.setVisibility(a.VISIBLE)}),u.fadeTo(1,t,h.easeInOut));n.setAction(r),this.__animations.push(n),e.setTransform(n,!0)},__fadeOut:function(e,t,i){var n=new c,r=u.sequence(u.fadeTo(1,0),u.callback(function(){e.setVisibility(a.VISIBLE)}),u.wait(i),u.fadeTo(0,t,h.easeInOut));n.setAction(r),this.__animations.push(n),e.setTransform(n,!0)},__dismissCard:function(){if(!this.__isClosing&&!this.__skipped){this.__isClosing=!0,this.__skipped=!0,this.__cardRevealed=!1;var e=new c;this.__card.getGeometry(I);var t=I.getX()+I.getWidth()/2,i=I.getY()+I.getHeight()/2,n=t-e.x,r=i-e.y;e.x+=n,e.y+=r,e.tx-=n,e.ty-=r,this.__sounds.play("card_fly_out",M);var s=u.sequence(u.parallel(u.scaleTo(2.4,2.4,200,h.interpolateCubic),u.fadeTo(0,200,h.interpolateCubic)),u.callback(this.close.bind(this)));e.setAction(s),this.__animations.push(e),this.__card.setTransform(e,!0)}},__createCallback:function(e,t){var i=new c,n=u.sequence(u.wait(t),u.callback(e));i.setAction(n),this.__animations.push(i)},__scaleOutWidget:function(e){var t=new c,i=u.sequence(u.parallel(u.scaleTo(2.4,2.4,200,h.interpolateCubic),u.fadeTo(0,200,h.interpolateCubic)));t.setAction(i),this.__animations.push(t),e.setTransform(t,!0)},__setCardRevealed:function(){if(this.__cardRevealed=!0,this.__skipped=!1,"CARD_SLOT"===this.__arrRewardTypes[this.__currentRewardIdx]){var e=this.__cardUnlockWorld.__world;this.__cardUnlock=this.__skeletonFactory.create("card_unlock",e,{attachParent:e.getScene().getRootComponent()});var t=this.__cardUnlock.getComponent("SkeletonComponent");switch(t.setTranslation(b[0],b[1]),this.__playerManager.getPlayerCardSlots()){case 2:t.setDefaultAnimation("Unlock Card Idle 2"),t.playAnimation("Unlock Card Slot");break;case 3:t.setDefaultAnimation("Unlock Card Idle 3"),t.playAnimation("Unlock Card Slot2");break;case 4:t.setDefaultAnimation("Unlock Card Idle 4"),t.playAnimation("Unlock Card Slot3")}}},__flipLockIcon:function(e,t){var i=e.findSingleWidgetWithName("icon_lock");i.setVisibility(a.HIDDEN);var n=new c,r=u.sequence(u.fadeTo(0,0),u.scaleTo(0,1,0),u.wait(t),u.callback(function(){i.setVisibility(a.VISIBLE)}),u.fadeTo(1,0),u.scaleTo(1,1,200,h.interpolateCubic),u.wait(200),u.parallel(u.sequence(u.scaleTo(1.2,1,200/3,h.easeOut),u.scaleTo(0,0,400/3,h.interpolateCubic)),u.fadeTo(0,200,h.interpolateCubic)));n.setAction(r),this.__animations.push(n),i.setTransform(n,!0)},__scaleUpUpgradeIcon:function(e,t){var i=e.findSingleWidgetWithName("icon");i.setVisibility(a.HIDDEN);var n=e.findSingleWidgetWithName("glow");n.setVisibility(a.HIDDEN);var r=this,s=new c,o=u.sequence(u.fadeTo(0,0),u.scaleTo(0,.75,0),u.wait(t),u.callback(function(){i.setVisibility(a.VISIBLE)}),u.fadeTo(.6,0),u.scaleTo(.75,.75,200,h.interpolateCubic),u.wait(200),u.callback(function(){r.__sounds.play("unlock")}),u.parallel(u.fadeTo(1,200,h.interpolateCubic),u.scaleTo(1,1,200,h.interpolateCubic))),_=new c,l=u.sequence(u.fadeTo(0,0),u.scaleTo(0,0,0),u.wait(t+400),u.callback(function(){n.setVisibility(a.VISIBLE)}),u.parallel(u.fadeTo(1,200,h.interpolateCubic),u.scaleTo(1,1,200,h.interpolateCubic)));s.setAction(o),this.__animations.push(s),i.setTransform(s,!0),_.setAction(l),this.__animations.push(_),n.setTransform(_,!0)},__flipWidget:function(e,t){var i=new c,n=u.sequence(u.fadeTo(0,0),u.scaleTo(0,1,0),u.wait(t),u.callback(function(){e.setVisibility(a.VISIBLE)}),u.fadeTo(1,0),u.scaleTo(1.3,1.3,200,h.interpolateCubic),u.scaleTo(1,1,200,h.interpolateCubic));i.setAction(n),e.setTransform(i,!0),this.__animations.push(i)},__showNameAndDescription:function(e,t,i){var n=this;this.__rewardNameLabel.setText(e),this.__rewardDescriptionLabel.setText(t),this.__rewardNameLabel.runAction(u.parallel(E.fadeInBlink(300,i),u.sequence(u.wait(i),u.callback(function(){n.__rewardNameLabel.setVisibility(a.VISIBLE)})))),this.__rewardDescriptionLabel.runAction(u.parallel(E.fadeInBlink(300,i+150),u.sequence(u.wait(i+150),u.callback(function(){n.__rewardDescriptionLabel.setVisibility(a.VISIBLE)}))))},update:function(e){if(this._widget.getVisibility()===a.VISIBLE){this.__walletView.update(e);for(var t=0,i=this.__animations.length;t<i;++t){this.__animations[t]&&this.__animations[t].update(e)}}},destroy:function(){var e=this.__eventManager.getNewEvent(m);e.setEntityId(this.__sparkleTemplate.getId()),e.setDestroyedByPlayer(!1),this.__eventManager.triggerEvent(e),delete this.__sparkleTemplate,e=this.__eventManager.getNewEvent(m),e.setEntityId(this.__particleAnimation.getId()),e.setDestroyedByPlayer(!1),this.__eventManager.triggerEvent(e),delete this.__particleAnimation,e=this.__eventManager.getNewEvent(m),e.setEntityId(this.__hexAnimation.getId()),e.setDestroyedByPlayer(!1),this.__eventManager.triggerEvent(e),delete this.__hexAnimation,this.__levelUpWorld.__world.destroy(),this.__levelUpWorld.clearWorld(),delete this.__levelUpWorld,this.__cardUnlockWorld.__world.destroy(),this.__cardUnlockWorld.clearWorld(),delete this.__cardUnlockWorld,delete this.__button,delete this.__card,delete this.__cardBack,delete this.__cardContents,delete this.__componentsByRewardType,delete this.__levelLabel,delete this.__levelUpLabel,delete this.__levelUpFlash,delete this.__rewardsLabel,delete this.__rewardsFlash}})}),define("ui/PopupDialogEnum",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum");i.exports=n.create("PopupDialogEnum",{NO_LEFT:1,NO_RIGHT:2,OK:3})}),define("ui/views/PopupDialog",["require","exports","module","thor/core/Class","thor/core/Validation","ManagerRepository","thor/ui/Widget","thor/ui/Widget","ui/GalatronDialog","ui/PopupDialogEnum"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("ManagerRepository"),o=(e("thor/ui/Widget"),e("thor/ui/Widget").VISIBILITY),a=e("ui/GalatronDialog"),_=e("ui/PopupDialogEnum"),l=n.create(a,{initialize:function(e,t,i,n,l,h,u,c){r.ifDefined.assertIsFunction(c),a.prototype.initialize.call(this,s.getResourceManager(),"popup_confirmationDialog"),this._widget.findSingleWidgetWithName("blackVeil").setVisibility(o.HIDDEN);var d=this._widget.findSingleWidgetWithName("btn_yesLeft"),g=this._widget.findSingleWidgetWithName("btn_yesRight"),p=this._widget.findSingleWidgetWithName("btn_noLeft"),m=this._widget.findSingleWidgetWithName("btn_noRight"),f=this._widget.findSingleWidgetWithName("btn_okCenter");e!==_.NO_LEFT&&(g.setVisibility(o.HIDDEN),p.setVisibility(o.HIDDEN)),e!==_.NO_RIGHT&&(d.setVisibility(o.HIDDEN),m.setVisibility(o.HIDDEN)),e!==_.OK&&f.setVisibility(o.HIDDEN);var v=this;if(e===_.NO_LEFT)g.setClickHandler(function(){g.enabled=!1,a.prototype.close.call(v),u()}),g.findWidgetsWithName("label").forEach(function(e){e.setText(n)}),p.setClickHandler(function(){p.enabled=!1,a.prototype.close.call(v),c()}),p.findWidgetsWithName("label").forEach(function(e){e.setText(l)});else if(e===_.NO_RIGHT)d.setClickHandler(function(){d.enabled=!1,a.prototype.close.call(v),u()}),d.findWidgetsWithName("label").forEach(function(e){e.setText(n)}),m.setClickHandler(function(){m.enabled=!1,a.prototype.close.call(v),c()}),m.findWidgetsWithName("label").forEach(function(e){e.setText(l)});else{if(e!==_.OK)throw new Error("Tried creating popup dialog with bad configuration: "+e);f.setClickHandler(function(){f.enabled=!1,a.prototype.close.call(v),u()}),f.findWidgetsWithName("label").forEach(function(e){e.setText(h)})}this._widget.findSingleWidgetWithName("heading").setText(t),this._widget.findSingleWidgetWithName("body").setText(i)}});i.exports=l,i.exports.showMessage=function(e,t,i){return r.ifDefined.assertIsNonEmptyString(i),new Promise(function(n,r){new l(_.OK,e,t,"","",i||"Okay",function(){n(!0)}).show(s.getDialogManager())})},i.exports.showConfirmation=function(e,t,i,n){return r.ifDefined.assertIsNonEmptyString(i),r.ifDefined.assertIsNonEmptyString(n),new Promise(function(r,o){new l(_.NO_RIGHT,e,t,i||"Okay",n||"Cancel","",function(){r(!0)},function(){r(!1)}).show(s.getDialogManager())})}}),define("ui/FUEDialogBase",["require","exports","module","thor/ui/Slot","thor/core/Class","thor/ui/Anchor","thor/ui/Widget","thor/core/Validation","thor/ui/Widget","thor/audio/SoundSprite","thor/ui/resources/WidgetResource","thor/audio/SoundSpriteResourceLoader","ManagerRepository","ui/CommonActions"],function(e,t,i){var n=(e("thor/ui/Slot"),e("thor/core/Class")),r=e("thor/ui/Anchor"),s=e("thor/ui/Widget"),o=(e("thor/core/Validation"),e("thor/ui/Widget").VISIBILITY,e("thor/audio/SoundSprite")),a=e("thor/ui/resources/WidgetResource"),_=e("thor/audio/SoundSpriteResourceLoader"),l=e("ManagerRepository"),h=e("ui/CommonActions"),u=n.create({initialize:function(e){var t=l.getResourceManager();this.__dialogResource=t.get(a.RESOURCE_TYPE,e),this._widget=this.__dialogResource.construct(),this.__sounds=t.getOrDefault(_.RESOURCE_TYPE,"game_sounds",o.EMPTY_SOUND_SPRITE),this.__resolvers=[],this.__isShowing=!1},getWidget:function(){return this._widget},show:function(){return this._widget.invalidate(),this.__isShowing=!0,this._widget.runAction(h.createDialogBlinkIn()),this.__sounds.play("popup"),Promise.resolve()},close:function(){return this.__isShowing=!1,this.__resolvers.forEach(function(e){e(!0)}),this.__resolvers.length=0,Promise.resolve(!0)},isShowing:function(){return this.__isShowing},waitForClosed:function(){var e=this;return new Promise(function(t,i){e.__resolvers.push(t)})}});i.exports=u,i.exports.showDialog=function(e,t){return t.setAnchor(new r(0,0,1,1)),t.setWidget(e.getWidget()),e.show(),e.waitForClosed().then(function(){t.setWidget(s.NULL_WIDGET)})}}),define("ui/StandardFUEDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Widget","ManagerRepository","ui/FUEDialogBase"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/ui/Widget").VISIBILITY,o=e("ManagerRepository"),a=e("ui/FUEDialogBase"),_=n.create(a,{initialize:function(e,t){r.ifDefined.assertIsNonEmptyString(t);o.getResourceManager();a.prototype.initialize.call(this,"popup_FUEDialogue_standard"),this._closableByModalClick=!0;var i=this._widget.findSingleWidgetWithName("text_paragraph1"),n=this._widget.findSingleWidgetWithName("text_paragraph2"),_=this._widget.findSingleWidgetWithName("text_paragraph");t?(i.setVisibility(s.VISIBLE),n.setVisibility(s.VISIBLE),_.setVisibility(s.HIDDEN),i.setText(e),n.setText(t)):(i.setVisibility(s.HIDDEN),n.setVisibility(s.HIDDEN),_.setVisibility(s.VISIBLE),_.setText(e))}});i.exports=_}),define("ui/DescriptionFUEDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Widget","thor/graphics/resources/TextureRegionResource","ManagerRepository","ui/FUEDialogBase"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=e("thor/ui/Widget").VISIBILITY,o=e("thor/graphics/resources/TextureRegionResource"),a=e("ManagerRepository"),_=e("ui/FUEDialogBase"),l=n.create(_,{initialize:function(){var e,t,i=(arguments.length,arguments[0]);3===arguments.length?(e=arguments[1],t=arguments[2]):2===arguments.length&&(t=arguments[1]),r.ifDefined.assertIsNonEmptyString(e);var n=a.getResourceManager();_.prototype.initialize.call(this,"popup_FUEDialogue_description"),this._closableByModalClick=!0;var l=this._widget.findSingleWidgetWithName("text_paragraph1"),h=this._widget.findSingleWidgetWithName("text_paragraph2"),u=this._widget.findSingleWidgetWithName("text_paragraph");e?(l.setVisibility(s.VISIBLE),h.setVisibility(s.VISIBLE),u.setVisibility(s.HIDDEN),l.setText(i),h.setText(e)):(l.setVisibility(s.HIDDEN),h.setVisibility(s.HIDDEN),u.setVisibility(s.VISIBLE),u.setText(i));var c=this._widget.findSingleWidgetWithName("icon");if(n.has(o.RESOURCE_TYPE,t)){var d=n.get(o.RESOURCE_TYPE,t);c.setTextureRegion(d)}}});i.exports=l}),define("ui/LootIntroDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Widget","ManagerRepository","ui/DescriptionFUEDialog"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/ui/Widget").VISIBILITY,e("ManagerRepository"),e("ui/DescriptionFUEDialog")),s=n.create(r,{initialize:function(){r.prototype.initialize.call(this,"Loot Chests contain powerful upgrades to your ship. Let's open one right now.","currency_token")}});i.exports=s}),define("ui/HomeInfoEnum",["require","exports","module","thor/core/Enum"],function(e,t,i){var n=e("thor/core/Enum");i.exports=n.create("HomeInfoEnum",{SCAVENGE:1,CUSTOMIZE:2,ACHIEVEMENTS:4,MISSIONS:8,DAILY_GIFT:16,WALLET:32,RAID:64,LEADERBOARD:128})}),define("events/GiftOpenedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","ui/views/OpenGiftView"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));e("ui/views/OpenGiftView").GiftTypeEnum;i.exports=n.generateEventClass("GiftOpenedEvent",1206164805,{giftType:function(e){}})}),define("events/GiftOpenEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event","ui/views/OpenGiftView"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation"),e("thor/event/Event"));e("ui/views/OpenGiftView").GiftTypeEnum;i.exports=n.generateEventClass("GiftOpenEvent",1206164821,{giftType:function(e){}})}),define("ui/views/GiftBoxButton",["require","exports","module","thor/core/Enum","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/util/FSM","thor/ui/Widget","thor/ui/Widget","thor/ui/resources/WidgetResource","thor/graphics/resources/TextureRegionResource","thor/graphics/animation/Transform","thor/graphics/animation/EasingFunctions","thor/graphics/animation/actions/Actions","thor/entity/EntityDestroyedEvent","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","ui/WalletView","./OpenGiftView","ManagerRepository","ui/views/OpenGiftView","events/GiftOpenEvent","events/GiftOpenedEvent"],function(e,t,i){var n=e("thor/core/Enum"),r=e("thor/core/Class"),s=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("thor/util/FSM")),o=(e("thor/ui/Widget"),e("thor/ui/Widget").VISIBILITY),a=(e("thor/ui/resources/WidgetResource"),e("thor/graphics/resources/TextureRegionResource"),e("thor/graphics/animation/Transform")),_=e("thor/graphics/animation/EasingFunctions"),l=e("thor/graphics/animation/actions/Actions"),h=e("thor/entity/EntityDestroyedEvent"),u=e("thor/audio/SoundSprite"),c=e("thor/audio/SoundSpriteResourceLoader"),d=e("ui/WalletView"),g=(e("./OpenGiftView"),e("ManagerRepository")),p=e("ui/views/OpenGiftView").GiftTypeEnum,m=e("events/GiftOpenEvent"),f=e("events/GiftOpenedEvent"),v=n.create({UNAVAILABLE:0,AVAILABLE:1}),y={};y[p.NORMAL]="giftbox",y[p.GOLD]="giftbox_gold",y[p.RAID]="giftbox_raid",i.exports=r.create({initialize:function(e,t,i,n){this._type=i,this._openGiftView=t,this._widget=e,this._world=n(),this._button=e.findSingleWidgetWithName("button"),this._button.setClickHandler(this.redeem.bind(this)),this._label=e.findSingleWidgetWithName("btn_label"),this._anchor=e.findSingleWidgetWithName("animation"),this._anchor.setWorld(this._world);var r=g.getResourceManager();this._sounds=r.getOrDefault(c.RESOURCE_TYPE,"game_sounds",u.EMPTY_SOUND_SPRITE),this._fsm=new s(e.getName()),this._fsm.addState("init"),this._fsm.addState("unavailable",{onEnter:this._onUnavailable.bind(this)}),this._fsm.addState("available",{onEnter:this._onAvailable.bind(this)}),this._fsm.addTransition("init","available"),this._fsm.addTransition("init","unavailable"),this._fsm.addTransition("available","unavailable"),this._fsm.addTransition("unavailable","available"),this._fsm.setStartState("init"),this._fsm.start(),this._animations=[],this._widget.setVisibility(o.HIDDEN),this._eventManager=g.getEventManager(),this._isRedeeming=!1,this.__redeemingPromise=null},setState:function(e){e===v.AVAILABLE?this.available():this.unavailable()},available:function(){"available"!==this._fsm.getCurrentState()&&this._fsm.transitionTo("available")},unavailable:function(){"unavailable"!==this._fsm.getCurrentState()&&this._fsm.transitionTo("unavailable")},redeem:function(){var e=this;if("available"!==this._fsm.getCurrentState())return Promise.reject(null);if(this._isRedeeming)return this.__redeemingPromise;this._isRedeeming=!0,this._label.setVisibility(o.HIDDEN),d.pauseCurrencyUpdates();var t=this._eventManager.getNewEvent(m);t.setGiftType(this._type),this._eventManager.triggerEvent(t),this._button.setVisibility(o.HIDDEN),this._label.setVisibility(o.HIDDEN),this._sounds.play("gacha_zoom"),this._skeleton.playAnimation("Zoom In",!1,!0),this.__redeemingPromise=this._redeem().then(function(t){return e._skeleton?new Promise(function(i,n){e._skeleton.setAnimationEndedCallback(function(){i(t)})}):Promise.resolve(t)}).then(function(t){return e._openGiftView.show(t,e._type).then(function(){var t=e._eventManager.getNewEvent(f);t.setGiftType(e._type),e._eventManager.triggerEvent(t),e.unavailable()})}).catch(function(){d.unpauseCurrencyUpdates()}).then(function(){e._isRedeeming=!1,e.__redeemingPromise=null})},_redeem:function(){return Promise.reject("not implemented")},_onAvailable:function(){this._flyIn(),this._button.setVisibility(o.VISIBLE),this._label.setVisibility(o.VISIBLE);var e=g.getSkeletonFactory();if(!this._spineEntity||!this._spineEntity.getId()){var t=y[this._type];this._spineEntity=e.create(t,this._world,{attachParent:this._world.getScene().getRootComponent()})}var i=this._skeleton=this._spineEntity.getComponent("SkeletonComponent");i.setTranslation(0,40),i.setDefaultAnimation("Idle Closed"),i.playAnimation("Idle Closed",!0),this._widget.setVisibility(o.VISIBLE),this._sounds.play("shipment_circle")},_onUnavailable:function(){this._widget.setVisibility(o.HIDDEN)},_flyIn:function(){var e=new a,t=l.sequence(l.scaleTo(9,9,0),l.fadeTo(0,0),l.parallel(l.scaleTo(1,1,600,_.interpolateCubic),l.loop(l.rotateBy(2*Math.PI,1e4,_.interpolateCubic)),l.fadeTo(1,800,_.interpolateCubic)));e.setAction(t),this._button.setTransform(e,!0),this._animations.push(e)},destroy:function(){if(this._spineEntity&&this._spineEntity.getId()){var e=g.getEventManager(),t=e.getNewEvent(h),i=this._spineEntity.getId();t.setEntityId(i),e.queueEvent(t)}this._world&&this._world.destroy()},update:function(e){for(var t=this._animations.length-1;t>=0;--t)this._animations[t].update(e)&&this._animations.splice(t,1),this._animations[t].update(e)}}),i.exports.State=v}),define("ui/views/DailyGiftBoxButton",["require","exports","module","thor/core/Class","thor/core/Logger","ui/views/OpenGiftView","./GiftBoxButton","ManagerRepository"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("ui/views/OpenGiftView").GiftTypeEnum),s=e("./GiftBoxButton"),o=e("ManagerRepository");i.exports=n.create(s,{initialize:function(e,t,i){s.prototype.initialize.call(this,e,t,r.NORMAL,i)},_redeem:function(){return o.getGiftManager().open()}})}),define("ui/views/RaidGiftBoxButton",["require","exports","module","thor/core/Class","thor/core/Logger","ui/views/OpenGiftView","./GiftBoxButton","ManagerRepository"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("ui/views/OpenGiftView").GiftTypeEnum),s=e("./GiftBoxButton"),o=e("ManagerRepository");i.exports=n.create(s,{initialize:function(e,t,i){s.prototype.initialize.call(this,e,t,r.RAID,i)},_redeem:function(){var e=o.getRaidManager(),t=e.getPendingReward();return e.redeem().then(function(){return t.rewards})}})}),define("ui/states/HomeState",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/util/FSM","thor/util/Alert","thor/util/TimeoutContext","thor/util/StringUtil","thor/math/ColorUtil","thor/platforms/Google","thor/analytics/Seidr","thor/audio/SoundManager","thor/audio/SoundSprite","ui/AudioMuteEnum","events/AudioMuteChangedEvent","thor/audio/SoundSpriteResourceLoader","thor/resources/ResourceManager","thor/ui/Margin","thor/ui/Anchor","thor/ui/Widget","thor/ui/Geometry","thor/ui/Widget","thor/ui/ImageWidget","thor/ui/resources/WidgetResource","thor/math/MathHelper","thor/graphics/animation/EasingFunctions","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/graphics/resources/TextureRegionResource","events/LevelUpEvent","events/GainedXPEvent","events/GameBoundsEvent","events/GameStartingEvent","events/TransitionUIStateEvent","GameLogic","GiftManager","thor/ui/DialogManager","player/PlayerManager","ui/views/OpenGiftView","events/GiftAvailableEvent","events/GiftUnavailableEvent","events/GiftUpdatedEvent","ShipSkinManager","ui/views/DotGridView","./UIState","thor/event/EventManager","Constants","thor/audio/SoundManager","events/AudioMuteChangedEvent","ui/AudioMuteEnum","thor/ui/InputEvent","mission/MissionSet","ui/WalletView","ui/CommonActions","ManagerRepository","mission/TrackingType","ui/RaidDialog","ui/views/RaidSummary","ui/MissionsDialog","ui/views/MissionSummary","ui/LevelUpDialog","player/CurrencyTypeEnum","ui/views/PopupDialog","ui/PopupDialogEnum","ui/FUEDialogBase","ui/StandardFUEDialog","ui/DescriptionFUEDialog","ui/FUEDialogBase","ui/LootIntroDialog","ui/HomeInfoEnum","events/GiftOpenedEvent","events/GiftOpenEvent","ui/views/GiftBoxButton","ui/views/DailyGiftBoxButton","ui/views/RaidGiftBoxButton"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=(e("thor/util/FSM"),e("thor/util/Alert"),e("thor/util/TimeoutContext")),a=e("thor/util/StringUtil"),_=e("thor/math/ColorUtil"),l=e("thor/platforms/Google"),h=e("thor/analytics/Seidr"),u=e("thor/audio/SoundManager"),c=e("thor/audio/SoundSprite"),d=e("ui/AudioMuteEnum"),g=e("events/AudioMuteChangedEvent"),p=e("thor/audio/SoundSpriteResourceLoader"),m=(e("thor/resources/ResourceManager"),e("thor/ui/Margin"),e("thor/ui/Anchor")),f=(e("thor/ui/Widget"),e("thor/ui/Geometry")),v=e("thor/ui/Widget").VISIBILITY,y=(e("thor/ui/ImageWidget"),e("thor/ui/resources/WidgetResource")),E=(e("thor/math/MathHelper"),e("thor/graphics/animation/EasingFunctions")),S=e("thor/graphics/animation/actions/Actions"),T=e("thor/graphics/animation/Transform"),C=(e("thor/graphics/resources/TextureRegionResource"),e("events/LevelUpEvent")),I=(e("events/GainedXPEvent"),e("events/GameBoundsEvent")),w=e("events/GameStartingEvent"),b=e("events/TransitionUIStateEvent"),M=(e("GameLogic"),e("GiftManager"),e("thor/ui/DialogManager"),e("player/PlayerManager"),e("ui/views/OpenGiftView")),x=M.GiftTypeEnum,R=e("events/GiftAvailableEvent"),P=e("events/GiftUnavailableEvent"),A=e("events/GiftUpdatedEvent"),N=(e("ShipSkinManager"),e("ui/views/DotGridView")),D=e("./UIState"),L=(e("thor/event/EventManager"),e("Constants")),u=e("thor/audio/SoundManager"),g=e("events/AudioMuteChangedEvent"),d=e("ui/AudioMuteEnum"),O=e("thor/ui/InputEvent"),V=e("mission/MissionSet"),B=e("ui/WalletView"),k=e("ui/CommonActions"),W=e("ManagerRepository"),F=(e("mission/TrackingType"),e("ui/RaidDialog")),U=e("ui/views/RaidSummary"),G=e("ui/MissionsDialog"),H=e("ui/views/MissionSummary"),q=e("ui/LevelUpDialog"),Y=e("player/CurrencyTypeEnum"),z=e("ui/views/PopupDialog"),X=(e("ui/PopupDialogEnum"),e("ui/FUEDialogBase")),K=e("ui/StandardFUEDialog"),j=e("ui/DescriptionFUEDialog"),X=e("ui/FUEDialogBase"),Q=e("ui/LootIntroDialog"),Z=e("ui/HomeInfoEnum"),J=e("events/GiftOpenedEvent"),$=e("events/GiftOpenEvent"),ee=(e("ui/views/GiftBoxButton"),e("ui/views/DailyGiftBoxButton")),te=e("ui/views/RaidGiftBoxButton"),ie=new f(0,0,1,1),ne=new f(0,0,1,1),re=new f(0,0,1,1),se=0,oe=[Z.SCAVENGE|Z.CUSTOMIZE|Z.ACHIEVEMENTS|Z.MISSIONS|Z.DAILY_GIFT|Z.WALLET|Z.RAID,Z.SCAVENGE|Z.CUSTOMIZE|Z.ACHIEVEMENTS|Z.DAILY_GIFT|Z.WALLET,Z.CUSTOMIZE|Z.ACHIEVEMENTS|Z.DAILY_GIFT,Z.ACHIEVEMENTS|Z.DAILY_GIFT,Z.ACHIEVEMENTS|Z.DAILY_GIFT,0,0,0],ae=[0,0,Z.SCAVENGE,Z.CUSTOMIZE,0,0,0,0];i.exports=n.create(D,{initialize:function(e,t,i,n,r,s,_,l,h){D.prototype.initialize.call(this,e);var u=t.get(y.RESOURCE_TYPE,"screen_home");this.__resourceManager=t,this.__widgetResource=u,this.__resourceManager=t,this.__eventManager=i,this.__dialogManager=n,this.__game=r,this.__playerManager=s,this.__giftManager=_,this.__shipSkinManager=h,this.__gameBounds=r.getBounds(),this.__onStartHandler=this.__onStart.bind(this),this.__timeoutContext=new o,this.__tickGiftHandler=this.__tickGift.bind(this);var d=a.getUrlParams();this.__isAutoTest="autoTest"===d.mode,this.__animations=[],this.__createWorld=l,this.__startClicked=!1,
this.__giftUnavailableAnimations=[],this.__giftAvailableAnimations=[],this.__missionAvailableAnimations=[],this.__sounds=t.getOrDefault(p.RESOURCE_TYPE,"game_sounds",c.EMPTY_SOUND_SPRITE),this.__soundButton=null,this.__modal=null,this.__walletView=new B(this.__createWorld),this.__hidePlayContainer=!1,this.__isAnimatingShip=!1,this.__onGiftOpenedHandler=this.__onGiftOpened.bind(this),this.__onGiftOpenHandler=this.__onGiftOpen.bind(this),this.__onGiftUpdatedHandler=this.__updateDailyGift.bind(this)},_constructWidget:function(){return this.__widgetResource.construct()},onEnter:function(){r.debug("HomeState#onEnter");var e=this.__playerManager.getFueCheckpoint(),t=oe[e-1],i=(ae[e-1],W.getFUEManager());this.__startClicked=!1,this.__showingDialog=!1,this.__waitForIntro=!1,D.prototype.onEnter.call(this,!1),l.trackEvent("gqs","Screen Events",{playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),screenName:"home"}),h.event("Screen Events",{contextId:this.__playerManager.getContextId(),playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),screenName:"home"});var n=this;this._widget.findSingleWidgetWithName("btn_dummy").setVisibility(v.HIDDEN),this._widget.findSingleWidgetWithName("popup_FUE1").setVisibility(v.HIDDEN),this._widget.findSingleWidgetWithName("popup_FUE2").setVisibility(v.HIDDEN),this._widget.findSingleWidgetWithName("btn_scavengeFUE").setVisibility(v.HIDDEN),this._widget.findSingleWidgetWithName("btn_shipFUE").setVisibility(v.HIDDEN),this.__modal=this._widget.findSingleWidgetWithName("blackVeil"),this.__modal.setVisibility(v.HIDDEN),this.__raidDialog=new F(this._widget.findSingleWidgetWithName("groupChallenge_panel"),this.__modal,this.__gameBounds,this.__createWorld),this.__raidSummary=new U(this._widget.findSingleWidgetWithName("btn_groupChallenge"),this.__showRaid.bind(this)),this.__missionDialog=new G(this._widget.findSingleWidgetWithName("missions_panel"),this.__modal,this.__gameBounds),this.__missionSummary=new H(this._widget.findSingleWidgetWithName("btn_mission"),this.__showMissions.bind(this)),this.__logo=this._widget.findSingleWidgetWithName("Logo"),this.__gameBoundsEventHandler=this.__onGameBoundsEvent.bind(this),this.__boundShowLevelUpHandler=this.__showLevelUpDialog.bind(this),this.__onGiftAvailableHandler=this.__onGiftAvailable.bind(this),this.__onGiftUnavailableHandler=this.__onGiftUnavailable.bind(this),i.shouldShowPlayDialog()?(this.__startContainer=this._widget.findSingleWidgetWithName("btn_start_FUE"),this._widget.findSingleWidgetWithName("btn_start").setVisibility(v.HIDDEN)):(this.__startContainer=this._widget.findSingleWidgetWithName("btn_start"),this._widget.findSingleWidgetWithName("btn_start_FUE").setVisibility(v.HIDDEN)),this.__startContainer.setVisibility(v.VISIBLE),this.__startButton=this.__startContainer.findSingleWidgetWithName("button"),this.__startButton.setClickHandler(this.__onStartHandler),this.__startButton.setActionOnDown(!0),this.__playPromptLabel=this.__startContainer.findSingleWidgetWithName("btn_label"),this.__leftInnerBracket=this.__startContainer.findSingleWidgetWithName("bracket_left"),this.__leftOuterBracket=this.__startContainer.findSingleWidgetWithName("outer_left"),this.__rightInnerBracket=this.__startContainer.findSingleWidgetWithName("bracket_right"),this.__rightOuterBracket=this.__startContainer.findSingleWidgetWithName("outer_right"),this.__leftChevron=this.__startContainer.findSingleWidgetWithName("inner_left"),this.__rightChevron=this.__startContainer.findSingleWidgetWithName("inner_right"),this.__soundButton=this._widget.findSingleWidgetWithName("btn_settings").findSingleWidgetWithName("button");var s=u.isMuted()||u.isMutedChannel("MASTER");this.__soundButton.setOn(!s).setClickHandler(this.__soundButtonHandler.bind(this)).setSoundSprite(this.__sounds),this.__leftOuterBracket.setTintColor(4107109887),this.__rightOuterBracket.setTintColor(4107109887),this.__leftChevron.setTintColor(4107109887),this.__rightChevron.setTintColor(4107109887);var o=this.__startContainer.findSingleWidgetWithName("Ship");this.__world=o.findSingleWidgetWithName("WorldWidget");var a=this.__createWorld();this.__world.setWorld(a),this.__topTray=this._widget.findSingleWidgetWithName("top_tray"),this.__nextShipmentContainer=this._widget.findSingleWidgetWithName("shipments"),this.__nextShipmentBar=this.__nextShipmentContainer.findSingleWidgetWithName("progress_shipment"),this.__nextShipmentBar.setProgress(0),this.__shipmentWaiting=this._widget.findSingleWidgetWithName("waiting"),this.__shipmentReady=this._widget.findSingleWidgetWithName("ready"),this.__shipmentReady.setVisibility(v.HIDDEN),this.__giftTimerLabel=this._widget.findSingleWidgetWithName("timer_next_shipment"),this.__giftTimerLabel.setText(""),this.__walletView.attach(this.__topTray),this.__walletView.resume();this.__topTray.findSingleWidgetWithName("player_level");this.__updatePlayerLevelXP(),this.__lowerFUEDialog=this._widget.findSingleWidgetWithName("popup_FUE1"),this.__lowerFUEDialog.setVisibility(v.HIDDEN),this.__lowerFUEDialog.findSingleWidgetWithName("CanvasPanel").addSlot(function(e){n.__lowerFUEDialogSlot=e}),this.__upperFUEDialog=this._widget.findSingleWidgetWithName("popup_FUE2"),this.__upperFUEDialog.setVisibility(v.HIDDEN),this.__upperFUEDialog.findSingleWidgetWithName("CanvasPanel").addSlot(function(e){n.__upperFUEDialogSlot=e}),this.__mainNav=this._widget.findSingleWidgetWithName("main_nav"),this.__configureCustomizeAndScavengeButtons(),this.__scavengeNewTag=this.__mainNav.findSingleWidgetWithName("new_tag_scavenge"),this.__scavengeTagLabel=this.__scavengeNewTag.findSingleWidgetWithName("label");var _=this.__playerManager.getPlayerTokens();_>0?(this.__scavengeNewTag.setVisibility(v.VISIBLE),this.__scavengeTagLabel.setText(""+_),this.__scavengeButton.setEnabled(!0)):(this.__scavengeNewTag.setVisibility(v.HIDDEN),this.__scavengeAnimGlow.setVisibility(v.HIDDEN),this.__scavengeButton.setEnabled(!1)),this.__fueShipButton=this._widget.findSingleWidgetWithName("btn_shipFUE"),this.__fueShipButton.setVisibility(v.HIDDEN),this.__fueShipButton.findSingleWidgetWithName("buttonOrange ").setSoundSprite(this.__sounds).setClickHandler(this.__onShipClick.bind(this)),this.__fueLootButton=this._widget.findSingleWidgetWithName("btn_scavengeFUE"),this.__fueLootButton.findSingleWidgetWithName("buttonOrange").setSoundSprite(this.__sounds).setClickHandler(this.__onScavengeClick.bind(this)),this.__fueLootButton.setVisibility(v.HIDDEN),this.__clickShield=this._widget.findSingleWidgetWithName("btn_dummy"),this.__clickShield.setVisibility(v.HIDDEN),i.shouldShowLootDialog()&&this.__showLootDialog(),this.__awardsButton=this.__mainNav.findSingleWidgetWithName("btn_awards").findSingleWidgetWithName("button"),this.__awardsButton.setSoundSprite(this.__sounds).setClickHandler(this.__onAchievementClick.bind(this)),this.__awardsNewTag=this.__mainNav.findSingleWidgetWithName("new_tag_awards"),this.__playerManager.hasNewAchievement()?this.__awardsNewTag.setVisibility(v.VISIBLE):this.__awardsNewTag.setVisibility(v.HIDDEN),this.__rankButton=this.__mainNav.findSingleWidgetWithName("btn_rank").findSingleWidgetWithName("button"),this.__rankButton.setSoundSprite(this.__sounds).setClickHandler(this.__onLeaderboardClick.bind(this)),this.__rankNewTag=this.__mainNav.findSingleWidgetWithName("new_tag_rank"),this.__rankNewTag.setVisibility(v.HIDDEN),this.__bg=this._widget.findSingleWidgetWithName("BG_Gradient"),this.__dots=this._widget.findSingleWidgetWithName("BG_dots"),this.__dotView=new N(this.__dots),this._invalidate(),this._widget.getGeometry(ne),this.__world.getGeometry(re);var c=ne.getHeight()-re.getY();if(0===se){this.__waitForIntro=!0,this.__createShipFlyIn(o,c,1200),this.__fadeInBlink(this.__logo,500,100),this.__fadeInBlink(this.__topTray,300,1300);var d=0;this.__fadeInBlink(this.__mainNav.findSingleWidgetWithName("btn_ship"),300,1500+d,"intro_buttons"),0==(t&Z.CUSTOMIZE)&&(d+=400),this.__fadeInBlink(this.__mainNav.findSingleWidgetWithName("btn_scavenge"),300,1500+d,"intro_buttons"),0==(t&Z.SCAVENGE)&&(d+=200),this.__fadeInBlink(this.__mainNav.findSingleWidgetWithName("btn_awards"),300,1500+d,"intro_buttons"),0==(t&Z.ACHIEVEMENTS)&&(d+=200),this.__fadeInBlink(this.__mainNav.findSingleWidgetWithName("btn_rank"),300,1500+d,"intro_buttons"),0==(t&Z.LEADERBOARD)&&(d+=200),0==(t&Z.DAILY_GIFT)&&(this.__fadeInBlink(this.__nextShipmentContainer,300,1500+d),d+=200),this.__fadeInBlink(this.__missionSummary.getWidget(),300,1500+d),0==(t&Z.MISSIONS)&&(d+=200),this.__fadeInBlink(this.__raidSummary.getWidget(),300,1500+d),0==(t&Z.RAID)&&(d+=400),this.__fadeInBlink(this.__soundButton,300,1500+d),this.__fadeIn(this.__playPromptLabel,100,1200),this.__giftUnavailableAnimations=[this.__animateInnerBracket(this.__leftInnerBracket,1,300,900),this.__animateInnerBracket(this.__rightInnerBracket,-1,300,900),this.__animateOuterBracket(this.__leftOuterBracket,1,1200),this.__animateOuterBracket(this.__rightOuterBracket,-1,1200),this.__animateChevron(this.__leftChevron,1200,!0),this.__animateChevron(this.__rightChevron,1200)]}else this.__createShipLoop(o),this.__giftUnavailableAnimations=[this.__animateOuterBracket(this.__leftOuterBracket,1,0),this.__animateOuterBracket(this.__rightOuterBracket,-1,0)];this.__eventManager.registerEventHandler(I.EVENT_TYPE,this.__gameBoundsEventHandler),this.__eventManager.registerEventHandler(C.EVENT_TYPE,this.__boundShowLevelUpHandler),this._openGiftView=new M(this.__createWorld.bind(this),this.__walletView),this.__dailyGift=new ee(this._widget.findSingleWidgetWithName("btn_gift"),this._openGiftView,this.__createWorld),this.__raidGift=new te(this._widget.findSingleWidgetWithName("btn_raidReward"),this._openGiftView,this.__createWorld),this.__lootContainer=this._widget.findSingleWidgetWithName("btn_lootReward"),this.__lootWorld=this.__createWorld(),this.__lootContainer.findSingleWidgetWithName("animation").setWorld(this.__lootWorld),this.__numGiftsAvailable=this.getNumGiftsAvailable(),this._widget.addSlot(function(e){e.setAnchor(new m(0,0,1,1)),e.setWidget(n._openGiftView.getWidget())});var g=a.getScene(),p=this.__game.createDummyShip(g);if(n.__shipSkinManager.setEquippedSkin(p),this.__dummyShip=p,t&Z.WALLET&&this.__topTray.setVisibility(v.HIDDEN),t&Z.MISSIONS&&this.__missionSummary.getWidget().setVisibility(v.HIDDEN),t&Z.SCAVENGE){this.__mainNav.findSingleWidgetWithName("btn_scavenge").setVisibility(v.HIDDEN)}if(t&Z.RAID&&this.__raidSummary.getWidget().setVisibility(v.HIDDEN),t&Z.DAILY_GIFT)this.__nextShipmentContainer.setVisibility(v.HIDDEN);else{var f=this.__playerManager.needsToDoFirstRun();this.__nextShipmentContainer.setVisibility(f?v.HIDDEN:v.VISIBLE)}if(t&Z.ACHIEVEMENTS){var y=this.__mainNav.findSingleWidgetWithName("btn_awards");y.setVisibility(v.HIDDEN)}if(t&Z.ACHIEVEMENTS){var y=this.__mainNav.findSingleWidgetWithName("btn_rank");y.setVisibility(v.HIDDEN)}this.__isAutoTest&&this.__timeoutContext.setTimeout(this.__onStart.bind(this),1901),this.__waitForDialog=!0,i.isDailyGiftCheckpoint()?(this.__timeoutContext.setTimeout(this.__openGiftFUEDialog.bind(this),0!==se?0:3900),0!==se&&W.getReplayManager().refresh()):i.shouldShowPlayDialog()?this.__timeoutContext.setTimeout(this.__openDoRunFUEDialog.bind(this),0!==se?0:2800):i.isInEquipSequence()?(this.__timeoutContext.setTimeout(this.__openCustomizeShipFUEDialog.bind(this),0!==se?0:2800),this.__hidePlayContainer=!0):this.__waitForDialog=!1,this.__playerManager.shouldGiveGift()&&this.__timeoutContext.setTimeout(function(){n.__waitForDialog=!0;var e=[n.__playerManager.giveGift(),z.showMessage("Update","Pilots! We've released a balance change that should make levelling up more rewarding. Along with this change, we've credited every account with 3 loot chests as a thank you for your continued support! Enjoy the free loot!","Close")];Promise.all(e).then(function(){n.__waitForDialog=!1})},2800),0!=se&&this.__startHandlingGifts(),se++,this._invalidate()},__configureCustomizeAndScavengeButtons:function(){var e=this.__playerManager.getFueCheckpoint(),t=oe[e-1],i=ae[e-1],n=this.__mainNav.findSingleWidgetWithName("btn_ship"),r=n.findSingleWidgetWithName("button"),s=n.findSingleWidgetWithName("buttonOrange "),o=n.findSingleWidgetWithName("anim_glow"),a=this.__mainNav.findSingleWidgetWithName("new_tag_ship");i&Z.CUSTOMIZE?(this.__shipButton=s,r.setVisibility(v.HIDDEN),s.setVisibility(v.VISIBLE),a.setVisibility(v.VISIBLE),o.setVisibility(v.VISIBLE),this.__createPulseAnimation(o,1200,100)):(this.__shipButton=r,r.setVisibility(v.VISIBLE),s.setVisibility(v.HIDDEN),this.__playerManager.hasNewCard()?a.setVisibility(v.VISIBLE):a.setVisibility(v.HIDDEN),o.setVisibility(v.HIDDEN)),this.__shipButton.setSoundSprite(this.__sounds).setClickHandler(this.__onShipClick.bind(this));var _=this.__mainNav.findSingleWidgetWithName("btn_scavenge"),l=_.findSingleWidgetWithName("buttonOrange"),h=_.findSingleWidgetWithName("button");this.__scavengeAnimGlow=_.findSingleWidgetWithName("anim_glow copy"),i&Z.SCAVENGE?(this.__scavengeButton=l,l.setVisibility(v.VISIBLE),h.setVisibility(v.HIDDEN),this.__scavengeAnimGlow.setVisibility(v.VISIBLE),this.__createPulseAnimation(this.__scavengeAnimGlow,1200,100)):(this.__scavengeButton=h,l.setVisibility(v.HIDDEN),h.setVisibility(v.VISIBLE),this.__scavengeAnimGlow.setVisibility(v.HIDDEN)),this.__scavengeButton.setSoundSprite(this.__sounds).setClickHandler(this.__onScavengeClick.bind(this));var u=this.__mainNav.findSingleWidgetWithName("btn_ship");t&Z.CUSTOMIZE?u.setVisibility(v.HIDDEN):u.setVisibility(v.VISIBLE)},__showLootDialog:function(){var e=this;this.__clickShield.setVisibility(v.VISIBLE),this.__raidSummary.setEnabled(!1),this.__missionSummary.setEnabled(!1);var t=new Q,i=0===se?4e3:0;this.__timeoutContext.setTimeout(function(){X.showDialog(t,e.__lowerFUEDialogSlot),e.__lowerFUEDialog.invalidate();var i=e.__playerManager.getPlayerTokens();e.__fueLootButton.setVisibility(v.VISIBLE),e.__fueLootButton.findSingleWidgetWithName("new_tag_scavenge").findSingleWidgetWithName("label").setText(""+i),e.__fueLootButton.invalidate(),e.__lowerFUEDialog.setVisibility(v.VISIBLE),e.__modal.setVisibility(v.VISIBLE);var n=new T,r=S.sequence(S.fadeTo(0,0),S.fadeTo(1,350));n.setAction(r),e.__modal.setTransform(n),e.__animations.push(n)},i)},__createPulseAnimation:function(e,t,i){var n=new T,r=S.loop(k.createPulse(t,i));n.setAction(r),e.setTransform(n),this.__animations.push(n)},__openGiftFUEDialog:function(){this.__modal.setVisibility(v.VISIBLE),this.__giftManager.setTimeRemaining(0);var e=new K(a.interpolate("{name}, take this Daily Shipment; it will greatly increase the value of coins collected the next 5 runs.",{name:W.getPlayerManager().getName()}));X.showDialog(e,this.__upperFUEDialogSlot),this.__upperFUEDialog.setVisibility(v.VISIBLE),this.__upperFUEDialog.invalidate(),this.__waitForDialog=!1},__openDoRunFUEDialog:function(){this.__modal.setVisibility(v.VISIBLE);var e=new K("Let's try out our new upgrades.");X.showDialog(e,this.__upperFUEDialogSlot),this.__upperFUEDialog.setVisibility(v.VISIBLE),this.__upperFUEDialog.invalidate(),this.__waitForDialog=!1},__closeUpperFUEDialog:function(){this.__modal.setVisibility(v.HIDDEN),this.__upperFUEDialog.setVisibility(v.HIDDEN)},__openCustomizeShipFUEDialog:function(){this.__scavengeButton.setEnabled(!1),this.__awardsButton.setEnabled(!1),this.__raidSummary.setEnabled(!1),this.__missionSummary.setEnabled(!1),this.__startContainer.setVisibility(v.HIDDEN),this.__modal.setVisibility(v.VISIBLE),this.__fueShipButton.setVisibility(v.VISIBLE);var e=this.__playerManager.getEquippedCards(),t='Tap on the "Ship" button below to equip it.';s.isObject(e[0])&&(t='Tap on the "Ship" button below to upgrade it.');var i=new j("The Proton Equalizer will increase your bullet damage.",t,"icon_proton_equalizer");X.showDialog(i,this.__lowerFUEDialogSlot),this.__lowerFUEDialog.setVisibility(v.VISIBLE),this.__lowerFUEDialog.invalidate(),this.__waitForDialog=!1},__updateMissionPreview:function(){var e,t=W.getMissionManager(),i=t.getMissionSet();e=i.isComplete()?3:i.getCompleted().length;var n;n=i.isComplete()?"AWAITING NEW ORDERS":e+"/"+V.MISSIONS_PER_SET+" COMPLETE",this.__missionProgressLabel.setText(n),this.__missionMessageLabel.setVisibility(v.HIDDEN),i.isComplete()?(this.__missionActiveBorder.setVisibility(v.HIDDEN),this.__missionInactiveBorder.setVisibility(v.VISIBLE)):(this.__missionActiveBorder.setVisibility(v.VISIBLE),this.__missionInactiveBorder.setVisibility(v.HIDDEN)),i.isComplete()?this.__missionBackground.setTintColor(51):this.__missionBackground.setTintColor(200);var r;r=i.isComplete()?i.computeMissionStartEpochMS():i.computeResetEpochMS(),this.__startMissionPreviewTick(r)},__startMissionPreviewTick:function(e){if(!W.getFUEManager().isMissionResetEnabled())return this.__missionTimerLabel.setVisibility(v.HIDDEN),void this.__missionTimerTitleLabel.setVisibility(v.HIDDEN);this.__missionTimerLabel.setVisibility(v.VISIBLE),this.__missionTimerTitleLabel.setVisibility(v.VISIBLE);var t=this;this.__cancelMissionPreviewTick(),this.__missionPreviewTargetTimestamp=e,this.__missionPreviewTick(),this.__timeoutContext.setTimeout(function(){t.__missionPreviewTick(),t.__missionPreviewIntervalId=t.__timeoutContext.setInterval(t.__missionPreviewTick.bind(t),1e3)},1e3-Date.now()%1e3)},__cancelMissionPreviewTick:function(){this.__missionPreviewIntervalId&&(this.__timeoutContext.cancelInterval(this.__missionPreviewIntervalId),this.__missionPreviewIntervalId=null)},__pickNewMission:function(){var e=W.getMissionManager(),t=e.getMissionSet(),i=W.getPlayerManager(),n=i.getPlayerLevel();t.advance(n,t.shouldDailyReset())},__missionPreviewTick:function(){var e=Math.max(0,this.__missionPreviewTargetTimestamp-Date.now()),t=~~(e/1e3),i=a.getTimeDisplayString(t,"00:00:00","hybridHours");this.__missionTimerLabel.setText(i),e<=0&&(this.__pickNewMission(),this.__cancelMissionPreviewTick(),this.__newMissionIntroAnimationSequence())},onExit:function(){this.__animations.length=0,this.__missionAvailableAnimations.length=0,this.__showingDialog=!1,this.__dummyShip&&(this.__game.destroyEntity(this.__dummyShip.getId()),this.__dummyShip=null),this.__walletView.detach(),this.__timeoutContext.clearAll(),this.__isAutoTest||(this.__eventManager.unregisterEventHandler(I.EVENT_TYPE,this.__gameBoundsEventHandler),this.__eventManager.unregisterEventHandler(C.EVENT_TYPE,this.__boundShowLevelUpHandler)),this.__eventManager.unregisterEventHandler(R.EVENT_TYPE,this.__onGiftAvailableHandler),this.__eventManager.unregisterEventHandler(P.EVENT_TYPE,this.__onGiftUnavailableHandler),this.__eventManager.unregisterEventHandler(J.EVENT_TYPE,this.__onGiftOpenedHandler),this.__eventManager.unregisterEventHandler($.EVENT_TYPE,this.__onGiftOpenHandler),this.__eventManager.unregisterEventHandler(A.EVENT_TYPE,this.__onGiftUpdatedHandler),this.__cancelMissionPreviewTick(),this.__dotView.destroy(),delete this.__dotView,this._openGiftView.destroy(),delete this._openGiftView,this.__raidDialog&&this.__raidDialog.destroy(),delete this.__raidDialog,this.__dailyGift&&this.__dailyGift.destroy(),delete this.__dailyGift,this.__raidGift&&this.__raidGift.destroy(),delete this.__raidGift,D.prototype.onExit.call(this)},__shouldBlockInput:function(){return this.__waitForDialog||this.__waitForIntro||this.__showingDialog},__updatePlayerLevelXP:function(){var e=this.__playerManager.getPlayerLevel(),t=this.__playerManager.getPlayerXP();this.__walletView.setLevelXP(e,t)},__soundButtonHandler:function(e){var t=this.__eventManager.getNewEvent(g);t.setCategory(d.TOGGLE),t.setEnabled(e.isOn()),this.__eventManager.queueEvent(t)},__onGameBoundsEvent:function(e){var t=this.__game.getBounds().invScaleFactor;this.__world.getGeometry(ie);var i=(ie.getX()+ie.getWidth()/2)*t,n=(ie.getY()+ie.getHeight()/2)*t,r=this.__game.getPlayerShip();r.getRootComponent().setTranslation(i,n),r.getComponent("MoveTowardsComponent").moveTowards(i,n),this.__gameBounds.width=e.getWidth(),this.__gameBounds.height=e.getHeight()},__showLevelUpDialog:function(e){this.__levelUpDialog=new q(this.__playerManager,this.__resourceManager,this.__game.__entityManager,this.__eventManager,this.__createWorld,this.__walletView);var t=this.__walletView.getCurrency(Y.TOKENS),i=this.__walletView.getCurrency(Y.GOLD);this.__levelUpDialog.show(this.__dialogManager,e.getArrRewards(),t,i);var n=this;this.__levelUpDialog.waitForClosed().then(function(){delete n.__levelUpDialog,n.__walletView.attach(n.__topTray)})},__createShipFlyIn:function(e,t,i){var n=this;this.__isAnimatingShip=!0,this.__startButton.setEnabled(!1);var r=S.sequence(S.moveBy(0,t,0),S.callback(function(){n.__sounds.play("intro_fly_in")}),S.parallel(S.sequence(S.moveBy(0,-1.25*t,.6*i,E.overshoot),S.moveBy(0,.25*t,.4*i,E.overshoot)),S.parallel(S.sequence(S.wait(.6*i),S.loop(S.moveBy(20,0,3050,function(e){return Math.sin(2*Math.PI*e)}))),S.sequence(S.wait(2*i),S.callback(function(){n.__isAnimatingShip=!1,n.__startHandlingGifts(),n.__waitForIntro=!1}))))),s=new T;return s.setAction(r),e.setTransform(s),this.__animations.push(s),r},__createShipLoop:function(e){var t=S.loop(S.moveBy(20,0,3050,function(e){return Math.sin(2*Math.PI*e)})),i=new T;return i.setAction(t),e.setTransform(i),this.__animations.push(i),t},__animateInnerBracket:function(e,t,i,n){var r=ne.getWidth()/2,s=new T;e.setTransform(s,!0);var o=s.x,a=s.y,_=S.sequence(S.parallel(S.wait(n),S.fadeTo(0,0),S.moveTo(o-r*t,a,0,E.easeIn)),S.parallel(S.moveTo(o,a,i,E.easeIn),S.fadeTo(1,i)));return s.setAction(_),s},__animateOuterBracket:function(e,t,i){var n=54*t,r=new T;e.setTransform(r,!0);var s=r.x,o=r.y,a=S.sequence(S.parallel(S.wait(i),S.moveTo(s+27*t,o,0),S.fadeTo(0,0)),S.loop(S.fadeTo(1,0),S.parallel(S.fadeTo(0,700),S.moveBy(-n,0,700),S.wait(2100)),S.moveBy(n,0,100)));return r.setAction(a),r},__animateChevron:function(e,t,i){s.ifDefined.assertIsBoolean(i);var n=this,r=S.sequence(S.fadeTo(0,0),S.wait(t),S.callback(function e(){e&&n.__sounds.play("brackets")}),S.fadeTo(1,150,E.startBounce),S.fadeTo(1,50,E.bounceLoop)),o=new T;return o.setAction(r),e.setTransform(o),o},__fadeIn:function(e,t,i){var n=new T,r=S.sequence(S.fadeTo(0,0),S.wait(i),S.fadeTo(1,t,E.easeOut));n.setAction(r),this.__animations.push(n),e.setTransform(n,!0)},__fadeInBlink:function(e,t,i,n){s.ifDefined.assertIsNonEmptyString(n);var r=new T,o=k.fadeInBlink(t,i,this.__sounds,n);r.setAction(o),this.__animations.push(r),e.setTransform(r,!0)},__flyIn:function(e,t,i){var n=new T,r=t-n.x,s=i-n.y;n.x+=r,n.y+=s,n.tx-=r,n.ty-=s;var o=S.sequence(S.scaleTo(9,9,0),S.fadeTo(0,0),S.parallel(S.scaleTo(1,1,600,E.interpolateCubic),S.loop(S.rotateBy(2*Math.PI,1e4,E.interpolateCubic)),S.fadeTo(1,800,E.interpolateCubic)));n.setAction(o),e.setTransform(n,!0),this.__animations.push(n)},__flyOut:function(e,t,i){var n=e.getTransform();n||(n=new T,e.setTransform(n,!0),this.__animations.push(n));var r=t-n.x,s=i-n.y;n.x+=r,n.y+=s,n.tx-=r,n.ty-=s;var o=S.parallel(S.scaleTo(9,9,300,E.interpolateCubic),S.fadeTo(0,300,E.interpolateCubic));n.setAction(o)},getNumGiftsAvailable:function(){if(W.getPlayerManager().needsToDoFirstRun())return 0;var e=W.getRaidManager(),t=e.getPendingReward(),i=0;t.hasRewards()&&W.getFUEManager().areRaidsEnabled()&&++i;var n=W.getGiftManager(),r=n.getGift(),s=this.__playerManager.getFueCheckpoint(),o=oe[s-1],a=!(o&Z.DAILY_GIFT);return r&&r.availableAt<=Date.now()&&a&&++i,i},__updateNumGiftsAvailable:function(){this.__numGiftsAvailable=this.getNumGiftsAvailable()},__onGiftAvailable:function(e){if(!this.__showingDialog){switch(this.__startButton.setEnabled(!1),e.getGiftType()){case x.RAID:this.__raidGift.available();break;case x.NORMAL:this.__nextShipmentContainer.setVisibility(v.VISIBLE),this.__nextShipmentBar.setProgress(0),this.__giftTimerLabel.setText("0:00:00").invalidate(),this.__dailyGift.available(),this.__raidGift.unavailable(),this.__shipmentWaiting.setVisibility(v.HIDDEN),this.__shipmentReady.setVisibility(v.VISIBLE);break;default:return void r.warn("Unknown gift type",e.getGiftType())}this.__startContainer.setVisibility(v.HIDDEN),this.__updateNumGiftsAvailable()}},__onGiftOpen:function(e){this.__showingDialog=!0,e.getGiftType()!==x.NORMAL?this.__dailyGift.unavailable():e.getGiftType()!==x.RAID&&this.__raidGift.unavailable(),this.__mainNav.setVisibility(v.HIDDEN),this.__nextShipmentContainer.setVisibility(v.HIDDEN),this.__logo.setVisibility(v.HIDDEN),this.__missionSummary.getWidget().setVisibility(v.HIDDEN),this.__raidSummary.getWidget().setVisibility(v.HIDDEN),this.__soundButton.setVisibility(v.HIDDEN),this.__closeUpperFUEDialog()},__onGiftOpened:function(e){this.__showingDialog=!1,this.__updateDailyGift(),W.getRaidManager().getParticipationRewards();var t=this.__playerManager.getFueCheckpoint(),i=oe[t-1];this.__walletView.attach(this.__topTray),this.__walletView.resume(),this.__mainNav.setVisibility(v.VISIBLE);var n=!!(i&Z.DAILY_GIFT);this.__nextShipmentContainer.setVisibility(n?v.HIDDEN:v.VISIBLE),this.__logo.setVisibility(v.VISIBLE),this.__missionSummary.getWidget().setVisibility(v.VISIBLE),this.__raidSummary.getWidget().setVisibility(v.VISIBLE),this.__soundButton.setVisibility(v.VISIBLE),this.__fadeInBlink(this.__logo,300,200),this.__fadeInBlink(this.__topTray,300,200),this.__fadeInBlink(this.__mainNav,300,200),this.__fadeInBlink(this.__startContainer,300,200),this.__fadeInBlink(this.__missionSummary.getWidget(),300,200),this.__fadeInBlink(this.__raidSummary.getWidget(),300,200),this.__fadeInBlink(this.__soundButton,300,200),this.__shipmentWaiting.setVisibility(v.VISIBLE),this.__shipmentReady.setVisibility(v.HIDDEN),0===this.getNumGiftsAvailable()&&(this.__onNoGiftsAvailable(),this.__giftUnavailableAnimations=[this.__animateInnerBracket(this.__leftInnerBracket,1,300,200),this.__animateOuterBracket(this.__leftOuterBracket,1,300,200),this.__animateInnerBracket(this.__rightInnerBracket,-1,300,200),this.__animateOuterBracket(this.__rightOuterBracket,-1,300,200),this.__animateChevron(this.__leftChevron,300,!0),this.__animateChevron(this.__rightChevron,300)])},__onGiftUnavailable:function(){0===this.getNumGiftsAvailable()?this.__onNoGiftsAvailable():this.__startContainer.setVisibility(v.HIDDEN),this.__updateNumGiftsAvailable()},__onNoGiftsAvailable:function(){this.__showingDialog||(this.__startButton.setEnabled(!0),this.__hidePlayContainer||this.__startContainer.setVisibility(v.VISIBLE))},__onStart:function(e,t){if(!(this.__shouldBlockInput()||this.__isAnimatingShip&&!this.__isAutoTest)){var i=this;if(!(this.getNumGiftsAvailable()>0)&&this.__game.isLoaded()&&!this.__startClicked){this.__startClicked=!0,this.__startContainer.getGeometry(ie);var n=ie.getX()+ie.getWidth()/2,r=ie.getY()+ie.getHeight()/2;this.__flyOut(this.__playPromptLabel,n,r),this.__flyOut(this.__leftInnerBracket,n,r),this.__flyOut(this.__rightInnerBracket,n,r),this.__flyOut(this.__leftOuterBracket,n,r),this.__flyOut(this.__rightOuterBracket,n,r),this.__flyOut(this.__leftChevron,n,r),this.__flyOut(this.__rightChevron,n,r),this.__sounds.play("tap_hold"),W.getFUEManager().startRun(),this.__timeoutContext.setTimeout(function(){var n=i.__eventManager.getNewEvent(b);n.setState("Gameplay"),i.__eventManager.queueEvent(n);var r=i.__eventManager.getNewEvent(w);r.setIsFUE(!1),i.__eventManager.queueEvent(r),i.__game.__world.getScene().getComponent("InputComponent").getInputHandlerForType(O.EVENT_TYPE.POINTER_DOWN)(t),e.isPressed()||i.__game.__world.getScene().getComponent("InputComponent").getInputHandlerForType(O.EVENT_TYPE.POINTER_UP)({touchCount:0,touchIdentifier:"faked"})},500)}}},__onShipClick:function(){if(!this.__shouldBlockInput()){this.__fueShipButton.setVisibility(v.HIDDEN),this.__modal.setVisibility(v.HIDDEN);var e=this.__eventManager.getNewEvent(b);e.setState("Ship Customization"),this.__eventManager.queueEvent(e)}},__onScavengeClick:function(){if(!this.__shouldBlockInput()){if(W.getFUEManager().shouldShowLootDialog()&&(this.__clickShield.setVisibility(v.HIDDEN),this.__lowerFUEDialog.setVisibility(v.HIDDEN),this.__fueLootButton.setVisibility(v.HIDDEN),this.__modal.setVisibility(v.HIDDEN)),this.__showingDialog=!0,this.__scavengeButton.setEnabled(!1),this.__playerManager.getOwnedCards().length>=L.INVENTORY_SIZE){var e=this;return void z.showConfirmation("INVENTORY FULL","You must scrap cards to clear up inventory space before you can open more chests.","GO","NOT NOW").then(function(t){if(t){var i=e.__eventManager.getNewEvent(b);i.setState("Ship Customization"),e.__eventManager.queueEvent(i)}e.__showingDialog=!1,e.__scavengeButton.setEnabled(!0)})}B.pauseCurrencyUpdates(this.__eventManager),this.__startButton.setEnabled(!1),this.__shipmentWaiting.setVisibility(v.HIDDEN),this.__shipmentReady.setVisibility(v.VISIBLE),this.__startContainer.setVisibility(v.HIDDEN),this.__nextShipmentBar.setProgress(0),this.__giftTimerLabel.setText("0:00:00").invalidate(),this.__lootContainer.setVisibility(v.VISIBLE),this.__dailyGift.unavailable(),this.__raidGift.unavailable(),this.__lootContainer.getGeometry(ie);var t=(ie.getX(),ie.getWidth(),ie.getY(),ie.getHeight(),this.__lootWorld),i=W.getSkeletonFactory();this.__giftBox=i.create("giftbox_gold",t,{attachParent:t.getScene().getRootComponent()}),this.__mainNav.setVisibility(v.HIDDEN),this.__nextShipmentContainer.setVisibility(v.HIDDEN),this.__logo.setVisibility(v.HIDDEN),this.__missionSummary.getWidget().setVisibility(v.HIDDEN),this.__raidSummary.getWidget().setVisibility(v.HIDDEN),this.__soundButton.setVisibility(v.HIDDEN);var n=this.__giftBox.getComponent("SkeletonComponent");n.playAnimation("Zoom In",!1,!0),this.__sounds.play("gacha_zoom");var r=!1,e=this;n.setAnimationEndedCallback(function(){return e.__playerManager.purchaseGacha().then(function(t){r=t,e.__game.destroyEntity(e.__giftBox.getId()),e.__giftBox=null;for(var i=W.getGachaManager().getLastReward(),n=i.cards,s={playerLevel:e.__playerManager.getPlayerLevel(),playerXP:e.__playerManager.getPlayerXP(),gold:e.__playerManager.getPlayerGold(),partsGained:i.parts},o=e.__playerManager.getCardParameters(),a=[],_=[],u=0,c=n.length;u<c;u++){var d=n[u],g=o.cardTypes[d.id];s["cardId"+(u+1)]=d.id,a.push(g.name),_.push(d.level),l.trackEvent("gqs","Card Gained",{playerLevel:e.__playerManager.getPlayerLevel(),playerXP:e.__playerManager.getPlayerXP(),gold:e.__playerManager.getPlayerGold(),cardId1:d.id}),h.event("Card Gained",{contextId:e.__playerManager.getContextId(),playerLevel:e.__playerManager.getPlayerLevel(),playerXP:e.__playerManager.getPlayerXP(),gold:e.__playerManager.getPlayerGold(),card:g.name,cardLevel:d.level})}return h.event("Gacha Collected",{contextId:e.__playerManager.getContextId(),playerLevel:e.__playerManager.getPlayerLevel(),playerXP:e.__playerManager.getPlayerXP(),gold:e.__playerManager.getPlayerGold(),partsGained:i.parts,cards:JSON.stringify(a),cardLevels:JSON.stringify(_)}),l.trackEvent("gqs","Gacha Collected",s),e._openGiftView.show(i,M.GiftTypeEnum.GOLD)}).then(function(){var t=e.__eventManager.getNewEvent(J);t.setGiftType(M.GiftTypeEnum.GOLD),e.__eventManager.triggerEvent(t),e.__walletView.attach(e.__topTray),B.unpauseCurrencyUpdates(e.__eventManager),e.__startButton.setEnabled(!0);var i=e.__playerManager.getPlayerTokens();i<=0?(e.__scavengeNewTag.setVisibility(v.HIDDEN),e.__scavengeAnimGlow.setVisibility(v.HIDDEN),e.__scavengeButton.setEnabled(!1)):(e.__scavengeTagLabel.setText(""+i),e.__scavengeButton.setEnabled(!0)),e.__showingDialog=!1,e.__updateDailyGift(),W.getRaidManager().getParticipationRewards(),e.__raidSummary.setEnabled(!0),e.__missionSummary.setEnabled(!0),r&&(e.__configureCustomizeAndScavengeButtons(),W.getFUEManager().isInEquipSequence()&&e.__openCustomizeShipFUEDialog())})})}},__onAchievementClick:function(){if(!this.__shouldBlockInput()){var e=this.__eventManager.getNewEvent(b);e.setState("Achievement"),this.__eventManager.queueEvent(e)}},__onLeaderboardClick:function(){if(!this.__shouldBlockInput()){var e=this.__eventManager.getNewEvent(b)
;e.setState("Leaderboard"),this.__eventManager.queueEvent(e)}},__startHandlingGifts:function(){this.__eventManager.unregisterEventHandler(R.EVENT_TYPE,this.__onGiftAvailableHandler),this.__eventManager.registerEventHandler(R.EVENT_TYPE,this.__onGiftAvailableHandler),this.__eventManager.unregisterEventHandler(P.EVENT_TYPE,this.__onGiftUnavailableHandler),this.__eventManager.registerEventHandler(P.EVENT_TYPE,this.__onGiftUnavailableHandler),this.__eventManager.unregisterEventHandler(A.EVENT_TYPE,this.__onGiftUpdatedHandler),this.__eventManager.registerEventHandler(A.EVENT_TYPE,this.__onGiftUpdatedHandler),this.__eventManager.unregisterEventHandler(J.EVENT_TYPE,this.__onGiftOpenedHandler),this.__eventManager.registerEventHandler(J.EVENT_TYPE,this.__onGiftOpenedHandler),this.__eventManager.unregisterEventHandler($.EVENT_TYPE,this.__onGiftOpenHandler),this.__eventManager.registerEventHandler($.EVENT_TYPE,this.__onGiftOpenHandler),this.__updateDailyGift();var e,t=W.getRaidManager(),i=W.getFUEManager(),n=t.getPendingReward().hasRewards()&&i.areRaidsEnabled();e=n?this.__eventManager.getNewEvent(R):this.__eventManager.getNewEvent(P),e.setGiftType(x.RAID),this.__eventManager.triggerEvent(e)},__updateDailyGift:function(){if(!this.__showingDialog){var e=this,t=oe[this.__playerManager.getFueCheckpoint()-1];if(t&Z.DAILY_GIFT){var i=this.__eventManager.getNewEvent(P);return i.setGiftType(x.NORMAL),void this.__eventManager.triggerEvent(i)}this.__giftIntervalId&&(this.__timeoutContext.cancelInterval(this.__giftIntervalId),this.__giftIntervalId=null);var n=this.__playerManager.getFueCheckpoint(),t=oe[n-1],r=!!(t&Z.DAILY_GIFT)||this.__playerManager.needsToDoFirstRun(),s=this.__giftManager.getGift();if(this.__nextShipmentContainer.setVisibility(r?v.HIDDEN:v.VISIBLE),s&&s.availableAt<=Date.now()&&!r){var i=this.__eventManager.getNewEvent(R);i.setGiftType(x.NORMAL),this.__eventManager.triggerEvent(i)}else{var i=this.__eventManager.getNewEvent(P);i.setGiftType(x.NORMAL),this.__eventManager.triggerEvent(i),this.__tickGift(),e.__timeoutContext.clearAll();var o=1e3-Date.now()%1e3;this.__timeoutContext.setTimeout(function(){e.__giftIntervalId=e.__timeoutContext.setInterval(e.__tickGiftHandler,1e3)},o)}}},__tickGift:function(){var e=this.__giftManager.getGift(),t=this.__playerManager.getFueCheckpoint(),i=oe[t-1],n=!!(i&Z.DAILY_GIFT);if(e&&!n){var r=e.availableAt-Date.now();if(r>0){var s=this.__giftManager.getGiftDelaySeconds(e.giftId),o=~~(r/1e3),_=a.getTimeDisplayString(o,"0:00:00","hybridHours");this.__giftTimerLabel.setText(_).invalidate(),this.__nextShipmentBar.setProgress(o/s)}else{this.__giftIntervalId&&(this.__timeoutContext.cancelInterval(this.__giftIntervalId),this.__giftIntervalId=null);var l=this.__eventManager.getNewEvent(R);l.setGiftType(x.NORMAL),this.__eventManager.triggerEvent(l)}}},__missionIntroFadeOut:function(e,t){var i=new T,n=S.sequence(S.fadeTo(0,400),S.wait(t),S.fadeTo(1,400));i.setAction(n),e.setTransform(i),this.__missionAvailableAnimations.push(i)},__newMissionIntroAnimationSequence:function(){var e=this;this.__missionAvailableAnimations.length=0,this.__missionActiveBorder.setVisibility(v.VISIBLE),this.__missionInactiveBorder.setVisibility(v.VISIBLE);var t=new T,i=S.sequence(S.fadeTo(0,0),S.fadeTo(1,200));t.setAction(i),this.__missionActiveBorder.setTransform(t),this.__missionAvailableAnimations.push(t);var n=new T,r=S.sequence(S.fadeTo(0,200),S.fadeTo(1,0),S.callback(function(){e.__missionInactiveBorder.setVisibility(v.HIDDEN)}));n.setAction(r),this.__missionInactiveBorder.setTransform(n),this.__missionAvailableAnimations.push(n);var s=new T,o=S.tweenCallback(0,1,200,function(t){var i=_.lerp(51,200,t);e.__missionBackground.setTintColor(i)});s.setAction(o),this.__missionBackground.setTransform(s),this.__missionAvailableAnimations.push(s),this.__missionIntroFadeOut(this.__missionTimerLabel,3550),this.__missionIntroFadeOut(this.__missionTimerTitleLabel,3550),this.__missionIntroFadeOut(this.__missionHeading,3550),this.__missionIntroFadeOut(this.__missionProgressLabel,3550),this.__missionMessageLabel.setVisibility(v.VISIBLE),this.__missionMessageLabel.setText("INCOMING TRANSMISSION...");var a=new T,l=S.sequence(k.createPulse(700),k.createPulse(700,600),S.callback(function(){e.__missionMessageLabel.setText("NEW MISSION ORDERS AVAILABLE")}),k.createPulse(700),k.createPulse(700,850),S.wait(1e3),S.callback(function(){e.__missionMessageLabel.setVisibility(v.VISIBLE),e.__missionAvailableAnimations.length=0,e.__updateMissionPreview()}));a.setAction(l),this.__missionMessageLabel.setTransform(a),this.__missionAvailableAnimations.push(a)},__showRaid:function(){if(W.getFUEManager().areRaidsEnabled()&&!this.__shouldBlockInput()){var e=this;this.__showingDialog=!0,this.__raidDialog.show().then(function(){e.__showingDialog=!1})}},__showMissions:function(){if(!this.__shouldBlockInput()){var e=this;this.__showingDialog=!0,this.__missionDialog.show().then(function(){e.__showingDialog=!1})}},update:function(e){this.__dotView.update(e);for(var t=0;t<this.__animations.length;++t)this.__animations[t].update(e);for(var t=0;t<this.__giftUnavailableAnimations.length;++t)this.__giftUnavailableAnimations[t].update(e);for(var t=0;t<this.__giftAvailableAnimations.length;++t)this.__giftAvailableAnimations[t].update(e);this._openGiftView&&this._openGiftView.update(e),this.__levelUpDialog&&this.__levelUpDialog.update(e),this.__raidDialog&&this.__raidDialog.update(e),this.__missionDialog&&this.__missionDialog.update(e),this.__showingDialog||this.__isAnimatingShip||(this.__raidGift&&this.__raidGift.update(e),this.__dailyGift&&this.__dailyGift.update(e)),this.__walletView&&this.__walletView.update(e),this.__missionButtonTransform&&this.__missionButtonTransform.update(e);for(var t=0;t<this.__missionAvailableAnimations.length;t++)this.__missionAvailableAnimations[t].update(e);this.__swapButtonTransform&&this.__swapButtonTransform.update(e)}})}),define("events/DistanceChangedEvent",["require","exports","module","thor/core/Class","thor/core/Validation","thor/event/Event"],function(e,t,i){var n=(e("thor/core/Class"),e("thor/core/Validation")),r=e("thor/event/Event");i.exports=r.generateEventClass("DistanceChanged",635735853,{distance:n.assertIsNumber,totalScore:n.assertIsNumber},!0)}),define("ui/FacebookScoreScreenshot",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Validation","thor/graphics/resources/BitmapFont","thor/resources/ResourceManager","thor/graphics/resources/DOMImageResource","thor/graphics/text/BitmapFontRenderer","ManagerRepository"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Device"),s=(e("thor/core/Validation"),e("thor/graphics/resources/BitmapFont")),o=(e("thor/resources/ResourceManager"),e("thor/graphics/resources/DOMImageResource")),a=e("thor/graphics/text/BitmapFontRenderer"),_=e("ManagerRepository"),l=n.create({initialize:function(e){this.__score=e,this.__resourceManager=_.getResourceManager()},sendScreenshot:function(){var e=this.__renderScreenshot(),t=window.FBInstant.player.getName()+" scored "+this.__score.toLocaleString()+" in Galatron!";return window.FBInstant.shareAsync({intent:"SHARE",image:e.toDataURL(),text:t})},debugShow:function(){this.__renderScreenshot();if(r.debugFeatures[r.DEBUG_FEATURES.DEBUG_OVERLAY]){this.__canvas.style.position="absolute",this.__canvas.style.display="block",document.body.appendChild(this.__canvas);var e=document.getElementById("foreground"),t=e.style.display;e.style.display="none";var i=this;setTimeout(function(){document.body.removeChild(i.__canvas),e.style.display=t},5e3)}},__renderScreenshot:function(){var e=this,t=document.createElement("canvas");t.style.top="0px",t.style.zIndex=1001,this.__canvas=t;var i=t.getContext("2d"),n=this.__resourceManager.get(o.RESOURCE_TYPE,"images/ui/assets/final_score"),r=n.getDOMElement();t.width=r.width,t.height=r.height,i.drawImage(r,0,0);var s;s=void 0!==navigator.languages?navigator.languages[0]:navigator.language;var a;return s&&(a=e.__drawTextAsImage(this.__score.toLocaleString(s+"-u-nu-latn"),r.width,100,"/assets/game_assets/fonts/Raj_B_160pt.xml","#FFFFFF",5)),a||(a=e.__drawTextAsImage(this.__score+"",r.width,100,"/assets/game_assets/fonts/Raj_B_160pt.xml","#FFFFFF",5)),i.drawImage(a,(r.width-a.width)/2,r.height/2-3),t},__drawTextAsImage:function(e,t,i,n,r,o){o=o||0;var _=this.__resourceManager.get(s.RESOURCE_TYPE,n),l=a.measureText(e,_,t,!1),h=i/l.getMaxTextHeight();o&&(l=a.measureText(e,_,t,!1,0,o/h));var u=document.createElement("canvas");u.width=l.getWidthForLine(0)*h,u.height=i;for(var c,d=u.getContext("2d"),g=0,p=0;p<e.length;p++){var m=e.charCodeAt(p),f=_.__charsByOrdinal[m];if(f){var v=_.getOrdinalTextureRegion(m);if(v){var y=v.image.getWidth(),E=v.image.getHeight(),S=v.uvs[0]*y,T=v.uvs[1]*E,C=f.width,I=f.height,w=c?c.ordinal:0,b=0;_.__kerningByOrdinal[w]&&_.__kerningByOrdinal[w][f.ordinal]&&(b=_.__kerningByOrdinal[w][f.ordinal]),d.drawImage(v.image.getDOMElement(),S,T,C,I,g,Math.max(0,i-I),C*h,I*h),g+=(f.xAdvance+b)*h+o,c=f}}}if("#FFFFFF"!==r){var M=document.createElement("canvas");M.width=u.width,M.height=u.height;var x=M.getContext("2d");x.fillStyle=r,x.fillRect(0,0,x.width,x.height),x.globalCompositeOperation="destination-atop",x.drawImage(u,0,0),d.globalAlpha=.5,d.drawImage(M,0,0)}return u},getCanvas:function(){return this.__canvas}});i.exports=l,i.exports.takeScreenshot=function(e){return new l(e).sendScreenshot()},i.exports.showScreenshot=function(e){new l(e).debugShow()}}),define("ui/views/UnlockedAchievementView",["require","exports","module","thor/core/Class","thor/ui/Dialog","thor/core/Logger","thor/core/Validation","thor/ui/Widget","thor/ui/Geometry","thor/graphics/animation/skeleton/SkeletonResource","thor/graphics/resources/TextureRegionResource","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","Constants","thor/event/EventManager","thor/entity/EntityManager","thor/resources/ResourceManager","ManagerRepository","thor/entity/EntityComponent","thor/entity/EntityDestroyedEvent","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/graphics/animation/EasingFunctions","player/CurrencyTypeEnum","ui/WalletView"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/ui/Dialog"),e("thor/core/Logger").getLogger(i),e("thor/core/Validation")),s=e("thor/ui/Widget"),o=s.VISIBILITY,a=e("thor/ui/Geometry"),_=e("thor/graphics/animation/skeleton/SkeletonResource"),l=e("thor/graphics/resources/TextureRegionResource"),h=e("thor/audio/SoundSprite"),u=e("thor/audio/SoundSpriteResourceLoader"),c=e("Constants"),d=(e("thor/event/EventManager"),e("thor/entity/EntityManager"),e("thor/resources/ResourceManager"),e("ManagerRepository")),g=e("thor/entity/EntityComponent"),p=e("thor/entity/EntityDestroyedEvent"),m=e("thor/graphics/animation/actions/Actions"),f=e("thor/graphics/animation/Transform"),v=(e("thor/graphics/animation/EasingFunctions"),e("player/CurrencyTypeEnum")),y=(e("ui/WalletView"),new a(0,0,1,1)),E={0:1079931903,1:4294967295,2:4241658367,3:4255920383},S={channel:"UI_SFX"};i.exports=n.create({initialize:function(e,t,i,n,r,s,o,a){this.__sounds=t.getOrDefault(u.RESOURCE_TYPE,"game_sounds",h.EMPTY_SOUND_SPRITE),this.__widget=e,this.__widget.invalidate(),this.__resourceManager=t,this.__entityManager=i,this.__eventManager=n,this.__achievementManager=r,this.__createWorld=s,this.__walletView=o,this.__onClaimCallback=a,this.__coinSource=e.findSingleWidgetWithName("currency_icon"),this.__credits=e.findSingleWidgetWithName("count_total_credits"),this.__claimButton=e.findSingleWidgetWithName("btn_claim"),this.__claimButton.setClickHandler(this.__onClaimClick.bind(this)),this.__icon=e.findSingleWidgetWithName("icon"),this.__nameLabel=e.findSingleWidgetWithName("award_label2"),this.__unlockDescriptionLabel=e.findSingleWidgetWithName("award_label1"),this.__skeletonFactory=d.getSkeletonFactory();var l=t.get(_.RESOURCE_TYPE,"achievement_upgrade");this.__achievementDotDuration=1e3*l.getAnimation("dot upgrade").duration,this.__achievementFrameDuration=1e3*l.getAnimation("frame upgrade").duration,this.__worldByTier={},this.__skeletonByTier={},this.__containerByTier={},this.__dotByTier={},this.__coins=[],this.__coinSkeletons=[],this.__iconContainer=e.findSingleWidgetWithName("tint"),this.__glow=this.__iconContainer.findSingleWidgetWithName("glow");for(var g=1;g<=c.MAX_ACHIEVEMENT_TIER;g++){var p=e.findSingleWidgetWithName("tier"+g+"_animation"),m=this.__createWorld();p.setWorld(m);var f=this.__skeletonFactory.create("achievement_upgrade",m,{attachTo:m.getScene().getRootComponent()});f.getRootComponent().setTranslation(0,5);var l=f.getComponent("SkeletonComponent"),v=e.findSingleWidgetWithName("tier"+g+"_icon");this.__dotByTier[g]=v,this.__containerByTier[g]=p,this.__worldByTier[g]=m,this.__skeletonByTier[g]=l}this.__iconFrame=e.findSingleWidgetWithName("WorldWidget"),this.__iconFrameWorld=this.__createWorld(),this.__iconFrame.setWorld(this.__iconFrameWorld),f=this.__skeletonFactory.create("achievement_upgrade",this.__iconFrameWorld,{attachTo:m.getScene().getRootComponent()}),f.getRootComponent().setScale(1.55,1.55),this.__iconFrameSkeleton=f.getComponent("SkeletonComponent"),this.__animations=[]},show:function(e,t){for(var i=0,n=this.__animations.length;i<n;++i)this.__animations[i].update(1/0);this.__achievementUpdate=t,this.__credits.setText("+"+t.gold.toLocaleString()).invalidate(),this.__nameLabel.setText(e.name).invalidate(),this.__unlockDescriptionLabel.setText(t.unlockDescription).invalidate(),this.__glow.setVisibility(o.HIDDEN);var r="icon_"+e.type.toLowerCase().replace(" ","_"),s=this.__resourceManager.get(l.RESOURCE_TYPE,r);this.__icon.setTextureRegion(s).invalidate();var a=t.numUnlockedTiers,_=e.tier-a;e.progress<e.requirement&&--_;for(var h=1;h<=c.MAX_ACHIEVEMENT_TIER;++h)if(h>_&&h-_<=a){var u=h-_-1;this.__animateDot(h,u),this.__fadeIn(h,u)}else if(h>_+a)this.__dotByTier[h].setVisibility(o.HIDDEN);else{var d=this.__containerByTier[h];d.setVisibility(o.HIDDEN)}this.__iconContainer.setTintColor(E[_]),this.__animateIconFrame(a),this.__animateIcon(_,a),this.__claimButton.setEnabled(!0),this.__widget.invalidate()},__onClaimClick:function(){this.__claimButton.setEnabled(!1);for(var e=this,t=0,i=this.__animations.length;t<i;++t)this.__animations[t].update(1/0);this.__coinSource.getGeometry(y);var n=y.getX(),r=y.getY();this.__walletView.gain(v.GOLD,this.__achievementUpdate.gold,n,r).then(function(){e.__onClaimCallback()})},__fadeIn:function(e,t){var i=this.__dotByTier[e];i.setVisibility(o.VISIBLE);var n=this.__getOrCreateTransform(i),r=m.sequence(m.fadeTo(0,0),m.wait(t*(this.__achievementDotDuration+400)+.5*this.__achievementDotDuration),m.fadeTo(1,200));n.setAction(r)},__animateIconFrame:function(e){for(var t=this,i=this.__getOrCreateTransform(this.__iconFrame),n=[],r=0;r<e;++r)n.push(m.wait(.05*this.__achievementDotDuration)),r>0&&n.push(m.wait(this.__achievementFrameDuration+400)),n.push(m.callback(function(){t.__iconFrameSkeleton.playAnimation("frame upgrade",!1,!0)}));var s=m.sequence.apply(null,n);i.setAction(s)},__animateIcon:function(e,t){for(var i=[],n=this,r=this.__getOrCreateTransform(this.__icon),s=1;s<=t;++s){i.push(m.wait(this.__achievementDotDuration));var a=e+s,_=E[a];i.push(this.__createTintAction(this.__iconContainer,_)),a===c.MAX_ACHIEVEMENT_TIER&&i.push(m.callback(function(){n.__glow.setVisibility(o.VISIBLE)}))}var l=m.sequence.apply(null,i);r.setAction(l)},__createTintAction:function(e,t){return m.callback(function(){e.setTintColor(t)})},__animateDot:function(e,t){var i=this.__containerByTier[e],n=this.__getOrCreateTransform(i),r=this.__skeletonByTier[e],s=t*(400+this.__achievementFrameDuration),a=this,_=m.sequence(m.callback(function(){i.setVisibility(o.HIDDEN)}),m.wait(s),m.callback(function(){i.setVisibility(o.VISIBLE),r.playAnimation("dot upgrade",!1,!0)}),m.wait(250),m.callback(function(){a.__sounds.play("achievement_earned",S)}));n.setAction(_)},__getOrCreateTransform:function(e){var t;return e.getTransform()?(t=e.getTransform(),t.reset()):(t=new f,e.setTransform(t),this.__animations.push(t)),t},__deleteOwningEntity:function(e){if(r.ifDefined.assertIsInstanceOf(e,g),e){var t=e.getOwningEntity();if(t){var i=t.getId();if(i){var n=this.__eventManager.getNewEvent(p);n.setEntityId(i),this.__eventManager.queueEvent(n)}}}},update:function(e){for(var t=0,i=this.__animations.length;t<i;++t){this.__animations[t].update(e)}},destroy:function(){for(var e=1;e<c.MAX_ACHIEVEMENT_TIER;++e){var t=this.__skeletonByTier[e];this.__deleteOwningEntity(t);this.__worldByTier[e].destroy()}this.__deleteOwningEntity(this.__iconFrameSkeleton),this.__iconFrameWorld.destroy(),this.__animations.length=0}})}),define("ui/views/PowerupView",["require","exports","module","thor/core/Class","thor/config/Config","thor/core/Validation","thor/ui/Widget","thor/ui/Widget","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/graphics/animation/EasingFunctions","thor/math/ColorUtil"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/config/Config"),e("thor/core/Validation"),e("thor/ui/Widget"),e("thor/ui/Widget").VISIBILITY),s=e("thor/graphics/animation/actions/Actions"),o=e("thor/graphics/animation/Transform"),a=e("thor/graphics/animation/EasingFunctions"),_=e("thor/math/ColorUtil");i.exports=n.create({initialize:function(e,t){this.__widget=e,this.__parentWidget=t,this.__lock=e.findSingleWidgetWithName("iconLock"),this.__icon=e.findSingleWidgetWithName("iconHolder"),this.__glow=e.findSingleWidgetWithName("animationGlow")},show:function(){this.__widget.setVisibility(r.VISIBLE),this.__parentWidget.setVisibility(r.VISIBLE);var e=this;return new Promise(function(t,i){e.__widgetTransform=new o,e.__widgetTransform.alpha=0;var n=s.sequence(s.scaleTo(0,1.1,0),s.parallel(s.fadeTo(1,300,a.fastEaseOut),s.scaleTo(1,1,300,a.easeOut)),s.wait(2100),s.parallel(s.fadeTo(0,300,a.fastEaseIn),s.scaleTo(0,1.1,300,a.easeIn)),s.callback(t));e.__widgetTransform.setAction(n),e.__widget.setTransform(e.__widgetTransform,!0),e.__lockTransform=new o;var r=s.sequence(s.scaleTo(2,2,0),s.wait(600),s.scaleTo(2.5,2.5,700/3,a.easeOut),s.parallel(s.fadeTo(0,1400/3,a.easeIn),s.scaleTo(0,1.5,1400/3,a.easeIn)));e.__lockTransform.setAction(r),e.__lock.setTransform(e.__lockTransform,!0),e.__iconTransform=new o,e.__icon.setTintColor(1145324799);var l=s.sequence(s.scaleTo(.9,.9,0),s.wait(600),s.tweenCallback(0,1,400,function(t){e.__icon.setTintColor(_.lerp(1145324799,4294967295,t))}),s.parallel(s.scaleTo(1,1,300)));e.__iconTransform.setAction(l),e.__icon.setTransform(e.__iconTransform,!0),e.__glowTransform=new o,e.__glowTransform.alpha=0;var h=s.sequence(s.scaleTo(1,1,0),s.wait(1e3),s.parallel(s.fadeTo(1,300,a.easeOut),s.scaleTo(1.7,1.5,300)));e.__glowTransform.setAction(h),e.__glow.setTransform(e.__glowTransform,!0)})},hide:function(){this.__widget.setVisibility(r.HIDDEN),this.__parentWidget.setVisibility(r.HIDDEN)},getWidget:function(){return this.__widget},update:function(e){this.__widgetTransform&&this.__widgetTransform.update(e),this.__lockTransform&&this.__lockTransform.update(e),this.__iconTransform&&this.__iconTransform.update(e),this.__glowTransform&&this.__glowTransform.update(e)}})}),define("ui/views/AnimatedRaidProgressView",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","ui/CommonActions","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/graphics/animation/EasingFunctions","thor/ui/Widget","thor/util/StringUtil","thor/util/TimeoutContext","thor/graphics/resources/TextureRegionResource","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","ManagerRepository","player/CurrencyTypeEnum","mission/MissionType","mission/MissionCategory","raid/RaidState","ui/views/RaidEntryView","./RaidProgressView"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=e("thor/core/Validation"),o=e("ui/CommonActions"),a=e("thor/graphics/animation/actions/Actions"),_=e("thor/graphics/animation/Transform"),l=e("thor/graphics/animation/EasingFunctions"),h=e("thor/ui/Widget"),u=h.VISIBILITY,c=e("thor/util/StringUtil"),d=(e("thor/util/TimeoutContext"),e("thor/graphics/resources/TextureRegionResource")),g=e("thor/audio/SoundSprite"),p=e("thor/audio/SoundSpriteResourceLoader"),m=(e("ManagerRepository"),e("player/CurrencyTypeEnum")),f=e("mission/MissionType"),v=(e("mission/MissionCategory"),e("raid/RaidState"),e("ui/views/RaidEntryView"),e("./RaidProgressView"));i.exports=n.create(v,{initialize:function(e,t,i){this._gameBounds=i,this._progressContainer=e;var n=e.findSingleWidgetWithName("groupChallenge_panel");v.prototype.initialize.call(this,n),this._completeLine.setVisibility(u.HIDDEN),this._progressBarFill=this._progressBar.findSingleWidgetWithName("progressBar"),this._containerShadow=e.findSingleWidgetWithName("blackout"),this._heading=e.findSingleWidgetWithName("heading"),this._rewardContainer=n.findSingleWidgetWithName("panel_yourReward"),this._rewardLabel=this._rewardContainer.findSingleWidgetWithName("text_reward"),this._rewardCaption=this._rewardContainer.findSingleWidgetWithName("text_info"),this._rewardBG=this._rewardContainer.findSingleWidgetWithName("panel"),this._rewardGlow=n.findSingleWidgetWithName("glow_reward"),this._nextRewardContainer=n.findSingleWidgetWithName("panel_reward"),this._nextRewardBranch=n.findSingleWidgetWithName("detial1"),this._nextRewardLabel=this._nextRewardContainer.findSingleWidgetWithName("text_reward"),this._contributeBar=t,this._contributeAmount=t.findSingleWidgetWithName("text_amount"),this._contributeIcon=t.findSingleWidgetWithName("icon"),this._tierIcon=n.findSingleWidgetWithName("icon_reward"),this._tierGlow=n.findSingleWidgetWithName("glow_reward"),this._arrTransforms=[],this.__tweenPromiseResolver=null,this.__sounds=this._resourceManager.getOrDefault(p.RESOURCE_TYPE,"game_sounds",g.EMPTY_SOUND_SPRITE)},show:function(){this._progressContainer.setVisibility(u.VISIBLE),this._contributeBar.setVisibility(u.VISIBLE)},hide:function(){this._progressContainer.setVisibility(u.HIDDEN),this._contributeBar.setVisibility(u.HIDDEN)},refresh:function(e){if(s.ifDefined.assertIsNonEmptyObject(e),v.prototype.refresh.call(this,e),e||(e=this._raidManager.getProgression()),e.tier>=0){var t=this._raidManager.getRewards(e.tier);this._rewardContainer.setVisibility(u.VISIBLE),this._rewardLabel.setText("+"+t.amount+m.getSymbol(t.type))}else this._rewardContainer.setVisibility(u.HIDDEN);if(this._raidManager.isComplete())this._nextRewardContainer.setVisibility(u.HIDDEN);else{var i=this._raidManager.getRewards(e.tier+1);i?(this._nextRewardLabel.setText("+"+i.amount+m.getSymbol(i.type)),this._nextRewardLabel.setVisibility(u.VISIBLE)):this._nextRewardLabel.setVisibility(u.HIDDEN)}var n=f.getIcon(this._raidManager.getRaid().type),r=this._resourceManager.get(d.RESOURCE_TYPE,n);this._contributeIcon.setTextureRegion(r),this._contributeBar.invalidate()},tween:function(e,t){function i(e,t){var i=~~(e*(1-t));s._progressBar.setProgress(t),s._progress=t,s._progressLabel.setText(i>0?c.interpolate(v.PROGRESS_FORMAT,{remaining:i}):"Complete")}function n(e,t,i){var n=e-~~(t*i);s._contributeAmount.setText(""+n)}r.trace("#tween",e,t);var s=this,_=t-e,h=this._raidManager.getRaid().type,d=this._raidManager.getSpec(),g=d.getProgression(e),p=d.getProgression(t),y=f.DESCRIPTION_TEXT[h].plural;this.refresh(g),this._widget.invalidate(),this._rewardContainer.setVisibility(u.VISIBLE),this._nextRewardContainer.setVisibility(u.VISIBLE),this._arrTransforms.length=0;var E=new Promise(function(e,t){s.__tweenPromiseResolver=e});this._contributeAmount.setText(""+_);var S=_,T=_>0,C=T?400:0,I=p.tier-g.tier,w=g.relativeProgress/g.relativeRequirement,b=p.relativeProgress/p.relativeRequirement,M=b-w,x=750*M,R=[a.wait(C),a.wait(400)],P=[a.wait(C),a.wait(400)],A=[a.wait(C),a.wait(400)],N=[],D=[a.wait(C)],L=[a.fadeTo(0,0),a.wait(C)],O=[a.fadeTo(0,0),a.wait(C)],V=[a.fadeTo(0,0),a.wait(C)],B=[a.scaleTo(.7,.7,0),a.fadeTo(0,0),a.wait(C)],k=[a.wait(C)],W=[a.wait(C)],F=[a.wait(C)],U=o.fadeIn();this._headingTransform=this._createOrResetTransform(this._headingTransform),this._headingTransform.setAction(U),this._heading.setTransform(this._headingTransform,!0),this._arrTransforms.push(this._headingTransform);var G=a.sequence(a.scaleTo(0,0,0),a.wait(50),o.createGrowIn());this._progressTransform=this._createOrResetTransform(this._progressTransform),this._progressTransform.setAction(G),this._progressContainer.setTransform(this._progressTransform,!0),this._arrTransforms.push(this._progressTransform),T?N.push(a.sequence(a.moveBy(-this._gameBounds.width,0,0),a.fadeTo(1,0),a.callback(function(){s.__sounds.play("mission_tiles")}),a.moveBy(this._gameBounds.width,0,300,l.overshoot),a.wait(C),a.wait(400))):N.push(a.fadeTo(0,0));for(var H=0;H<I;++H){var q,Y,z;0===H?(Y=g.relativeRequirement,q=g.relativeRequirement-g.relativeProgress):(Y=d.getRequirement(g.tier+H+1),q=Y-d.getRequirement(g.tier+H)),z=S,S-=q;var X,K=0===H?w:0,j=1-K,Q=750*j,Z=g.tier+H+1;X=Z+1>d.getMaxTier()?Y:d.getRequirement(Z+1);var J=Z<=0,$=this._raidManager.getRewards(Z),ee=this._raidManager.getRewards(g.tier+H+2);R.push(a.sequence(a.fadeTo(1,0),a.callback(function(){s._progressBarFill.setTintColor(4294967295)}),a.tweenCallback(K,1,Q,i.bind(this,Y),l.easeOut),a.callback(function(){s.__sounds.play("counter_burst"),s._progressBarFill.setTintColor(519754495)}),a.wait(2200),a.fadeTo(0,250))),P.push(a.sequence(a.fadeTo(1,0),a.wait(Q+500+500+100+500+100+500),a.fadeTo(0,250))),N.push(a.sequence(a.wait(Q+500+500+100+500+100+500+250))),A.push(a.sequence(a.tweenCallback(0,1,Q,n.bind(this,z,q),l.easeOut),a.wait(2450))),D.push(a.sequence(a.wait(Q),a.fadeTo(0,1100),a.callback(this._updateMissionDescription.bind(this,y,X)),o.createDialogBlinkIn(500),a.wait(850))),k.push(a.sequence(a.wait(Q),a.fadeTo(0,500))),W.push(a.sequence(a.wait(Q),a.fadeTo(0,500))),ee&&(k.push(a.sequence(a.callback(s._nextRewardLabel.setText.bind(s._nextRewardLabel,"+"+ee.amount+m.getSymbol(ee.type))),a.wait(600),a.fadeTo(1,500),a.wait(850))),W.push(a.sequence(a.wait(600),a.fadeTo(1,500),a.wait(850)))),F.push(a.sequence(a.wait(Q),a.parallel(a.scaleTo(1,1,0),a.fadeTo(1,0)),a.callback(function(){s.__sounds.play("counter_boost")}),a.scaleTo(2.4,2.4,500,l.interpolateCubic),a.parallel(a.scaleTo(0,0,500,l.interpolateCubic),a.fadeTo(0,500,l.interpolateCubic),a.wait(600)),a.parallel(a.fadeTo(1,500),o.createGrowIn(500)),a.wait(850)));var te="+"+$.amount+m.getSymbol($.type);r.log("unlocked tier",Z,te),L.push(this._fadeInRewardElement(J,Q)),O.push(this._fadeInRewardElement(J,Q)),V.push(a.sequence(a.fadeTo(J?0:1,0),a.wait(Q),a.fadeTo(0,500),a.callback(this._rewardLabel.setText.bind(this._rewardLabel,te)),a.fadeTo(1,0),o.createShrinkIn(500),a.wait(1450))),B.push(a.sequence(a.wait(Q),a.fadeTo(0,500),a.parallel(a.sequence(a.scaleTo(.7,.7,0),a.scaleTo(2.4,2.4,250),a.scaleTo(.3,.3,125),a.scaleTo(.7,.7,125)),a.sequence(a.fadeTo(0,0),a.fadeTo(1,250),a.fadeTo(.7,250)),a.wait(1950))))}var ie;ie=I>0?0:g.relativeProgress;var ne=ie/p.relativeRequirement,re=p.relativeProgress/p.relativeRequirement;return M=re-ne,x=750*M,R.push(a.sequence(a.fadeTo(1,0),a.callback(function(){s._progressBarFill.setTintColor(4294967295)}),a.tweenCallback(ne,re,x,i.bind(s,p.relativeRequirement),l.easeOut),a.callback(function(){s._progress=t}))),P.push(a.sequence(a.fadeTo(1,0))),A.push(a.sequence(a.tweenCallback(0,1,x,n.bind(s,S,S)),a.callback(function(){s._contributeAmount.setText("0")}))),T&&N.push(a.sequence(a.wait(x),a.moveBy(-this._gameBounds.width,0,300,l.easeIn))),this._progressBarTransform=this._createOrResetTransform(this._progressBarTransform),this._progressBar.setTransform(this._progressBarTransform,!0),this._progressBarTransform.setAction(this._buildSequence(R)),this._arrTransforms.push(this._progressBarTransform),this._progressTextTransform=this._createOrResetTransform(this._progressTextTransform),this._progressLabel.setTransform(this._progressTextTransform,!0),this._progressTextTransform.setAction(this._buildSequence(P)),this._arrTransforms.push(this._progressTextTransform),this._contributionAmountTransform=this._createOrResetTransform(this._contributionAmountTransform),this._contributionAmountTransform.setAction(this._buildSequence(A)),this._contributeAmount.setTransform(this._contributionAmountTransform),this._arrTransforms.push(this._contributionAmountTransform),this._contributeBarTransform=this._createOrResetTransform(this._contributeBarTransform),this._contributeBarTransform.setAction(this._buildSequence(N)),this._contributeBar.setTransform(this._contributeBarTransform,!0),this._arrTransforms.push(this._contributeBarTransform),this._missionDescriptionTransform=this._createOrResetTransform(this._missionDescriptionTransform),this._missionDescriptionTransform.setAction(this._buildSequence(D)),this._missionDescriptionLabel.setTransform(this._missionDescriptionTransform,!0),this._arrTransforms.push(this._missionDescriptionTransform),this._rewardLabelTransform=this._createOrResetTransform(this._rewardLabelTransform),this._rewardLabelTransform.setAction(this._buildSequence(V)),this._rewardLabel.setTransform(this._rewardLabelTransform,!0),this._arrTransforms.push(this._rewardLabelTransform),this._tierIconTransform=this._createOrResetTransform(this._tierIconTransform),this._tierIconTransform.setAction(this._buildSequence(F)),this._tierIcon.setTransform(this._tierIconTransform,!0),this._arrTransforms.push(this._tierIconTransform),this._rewardGlowTransform=this._createOrResetTransform(this._rewardGlowTransform),this._rewardGlow.setTransform(this._rewardGlowTransform,!0),this._rewardGlowTransform.setAction(this._buildSequence(B)),this._arrTransforms.push(this._rewardGlowTransform),this._rewardBgTransform=this._createOrResetTransform(this._rewardBgTransform),this._rewardBgTransform.setAction(this._buildSequence(L)),this._rewardBG.setTransform(this._rewardBgTransform,!0),this._arrTransforms.push(this._rewardBgTransform),this._rewardCaptionTransform=this._createOrResetTransform(this._rewardCaptionTransform),this._rewardCaptionTransform.setAction(this._buildSequence(O)),this._rewardCaption.setTransform(this._rewardCaptionTransform,!0),this._arrTransforms.push(this._rewardCaptionTransform),this._nextRewardContainerTransform=this._createOrResetTransform(this._nextRewardContainerTransform),this._nextRewardContainerTransform.setAction(this._buildSequence(k)),this._nextRewardContainer.setTransform(this._nextRewardContainerTransform,!0),this._arrTransforms.push(this._nextRewardContainerTransform),this._nextRewardBranchTransform=this._createOrResetTransform(this._nextRewardBranchTransform),this._nextRewardBranchTransform.setAction(this._buildSequence(W)),this._nextRewardBranch.setTransform(this._nextRewardBranchTransform,!0),this._arrTransforms.push(this._nextRewardBranchTransform),E},_fadeInRewardElement:function(e,t){return a.sequence(a.fadeTo(e?0:1,0),a.wait(t),a.fadeTo(0,500),a.wait(50),a.fadeTo(1,500),a.wait(650))},_updateMissionDescription:function(e,t){this._missionDescriptionLabel.setText(c.interpolate(e,{requirement:t}))},_createOrResetTransform:function(e){return s.ifDefined.assertIsInstanceOf(e,_),e?e.reset():new _},_buildSequence:function(e){return a.sequence.apply(a,e)},update:function(e){for(var t=this._arrTransforms.length-1;t>=0;t--){this._arrTransforms[t].update(e)&&(this._arrTransforms.splice(t,1),0===this._arrTransforms.length&&this.__tweenPromiseResolver())}}})}),
define("ui/GameOverSequenceDialog",["require","exports","module","thor/util/FSM","thor/core/Class","thor/ui/Anchor","thor/ui/Margin","thor/ui/Dialog","thor/util/Timing","thor/core/Logger","thor/graphics/animation/actions/Actions","thor/ui/Geometry","thor/graphics/animation/Transform","thor/core/Validation","thor/util/StringUtil","thor/ui/Widget","thor/event/EventManager","thor/util/TimeoutContext","thor/resources/ResourceManager","thor/graphics/resources/TextureRegionResource","thor/audio/SoundSprite","thor/ui/Widget","thor/ui/resources/WidgetResource","thor/ui/InputEvent","thor/audio/SoundSpriteResourceLoader","thor/graphics/animation/EasingFunctions","Constants","thor/entity/EntityManager","AchievementManager","LeaderboardManager","ui/CommonActions","ui/DotJiggleAction","ui/FacebookScoreScreenshot","ui/views/MissionProgressView","ui/views/FUEMissionProgressView","ui/views/MissionDescriptionView","ui/views/UnlockedAchievementView","ui/FUEDialogBase","ui/DescriptionFUEDialog","ui/WalletView","ui/LevelUpDialog","ui/views/PowerupView","mission/MissionSet","mission/MissionInstance","events/GameBoundsEvent","events/ReturnToFacebookEvent","events/CompleteGameEndingEvent","events/GameResetEvent","player/PlayerManager","ManagerRepository","mission/MissionType","player/Player","player/CurrencyTypeEnum","raid/RaidState","ui/views/AnimatedRaidProgressView","ManagerRepository"],function(e,t,i){var n=e("thor/util/FSM"),r=e("thor/core/Class"),s=e("thor/ui/Anchor"),o=e("thor/ui/Margin"),a=e("thor/ui/Dialog"),_=e("thor/util/Timing"),l=e("thor/core/Logger").getLogger(i),h=e("thor/graphics/animation/actions/Actions"),u=e("thor/ui/Geometry"),c=e("thor/graphics/animation/Transform"),d=e("thor/core/Validation"),g=e("thor/util/StringUtil"),p=e("thor/ui/Widget").VISIBILITY,m=(e("thor/event/EventManager"),e("thor/util/TimeoutContext")),f=(e("thor/resources/ResourceManager"),e("thor/graphics/resources/TextureRegionResource"),e("thor/audio/SoundSprite")),v=(e("thor/ui/Widget"),e("thor/ui/resources/WidgetResource")),y=(e("thor/ui/InputEvent"),e("thor/audio/SoundSpriteResourceLoader")),E=e("thor/graphics/animation/EasingFunctions"),S=e("Constants"),T=(e("thor/entity/EntityManager"),e("AchievementManager"),e("LeaderboardManager")),C=e("ui/CommonActions"),I=e("ui/DotJiggleAction"),w=e("ui/FacebookScoreScreenshot"),b=e("ui/views/MissionProgressView"),M=e("ui/views/FUEMissionProgressView"),x=e("ui/views/MissionDescriptionView"),R=e("ui/views/UnlockedAchievementView"),P=e("ui/FUEDialogBase"),A=e("ui/DescriptionFUEDialog"),N=e("ui/WalletView"),D=e("ui/LevelUpDialog"),L=e("ui/views/PowerupView"),O=e("mission/MissionSet"),V=(e("mission/MissionInstance"),e("events/GameBoundsEvent")),B=e("events/ReturnToFacebookEvent"),k=(e("events/CompleteGameEndingEvent"),e("events/GameResetEvent")),W=(e("player/PlayerManager"),e("ManagerRepository")),F=(e("mission/MissionType"),e("player/Player"),e("player/CurrencyTypeEnum")),U=(e("raid/RaidState"),e("ui/views/AnimatedRaidProgressView")),W=e("ManagerRepository"),G=new u(0,0,1,1),H=["raid","missions","leaderboard"],q=["missions","leaderboard"],Y={channel:"UI_SFX"};i.exports=r.create(a,{initialize:function(e,t,i,r,s,o,_,l,h,u){a.prototype.initialize.call(this,e,"screen_end_score"),this.__resourceManager=e,this.__eventManager=s,this.__entityManager=r,this.__playerManager=t,this.__raidManager=W.getRaidManager(),this.__achievementManager=i,this.__createWorld=o,this.__continueGameCallback=_,this.__noContinueGameCallback=l,this.__sendResultCallback=h,this.__timeoutContext=new m,this.__gameBounds={width:u.width,height:u.height},this.__sounds=e.getOrDefault(y.RESOURCE_TYPE,"game_sounds",f.EMPTY_SOUND_SPRITE),this.__walletView=new N(this.__createWorld),this.__timer=null,this.__timerText=null,this.__countdownTargetTimestamp=0,this.__countdownIntervalId=null,this.__continues=null,this.__awards=null,this.__finalScore=null,this.__unlockedAchievements=[],this.__completedMissions=[],this.__arrMissionViews=[],this.__powerupView=null,this.__score=0,this.__totalGoldEarned=0,this.__dotsTransform=new c,this.__loadTextTransform=new c,this.__wheel1Transform=new c,this.__wheel2Transform=new c,this.__dotsAction=null,this.__fsm=new n("Game End Sequence"),this.__fsm.addState("initial"),this.__fsm.addState("continue",{onEnter:this.__showContinue.bind(this),onExit:this.__hideContinue.bind(this)}),this.__fsm.addState("awards",{onEnter:this.__showAwards.bind(this),onExit:this.__hideAwards.bind(this)}),this.__fsm.addState("pages",{onEnter:this.__showPages.bind(this),onExit:this.__hidePages.bind(this)}),this.__fsm.addState("powerup unlocked",{onEnter:this.__showPowerupUnlocked.bind(this),onExit:this.__hidePowerupUnlocked.bind(this)}),this.__fsm.addState("level up",{onEnter:this.__showLevelUp.bind(this)}),this.__fsm.addState("final score",{onEnter:this.__showFinalScore.bind(this)}),this.__fsm.addState("exit",{onEnter:this.__onEnterExitState.bind(this)}),this.__fsm.addTransition("initial","continue"),this.__fsm.addTransition("initial","powerup unlocked"),this.__fsm.addTransition("initial","awards"),this.__fsm.addTransition("initial","pages"),this.__fsm.addTransition("initial","final score"),this.__fsm.addTransition("continue","awards"),this.__fsm.addTransition("continue","pages"),this.__fsm.addTransition("awards","awards"),this.__fsm.addTransition("awards","pages"),this.__fsm.addTransition("pages","level up"),this.__fsm.addTransition("pages","final score"),this.__fsm.addTransition("level up","final score"),this.__fsm.addTransition("level up","pages"),this.__fsm.addTransition("continue","final score"),this.__fsm.addTransition("awards","final score"),this.__fsm.addTransition("continue","exit"),this.__fsm.addTransition("final score","exit"),this.__fsm.setStartState("initial"),this.__boundGameBoundsEventHandler=this.__gameBoundsEventHandler.bind(this),this.__eventManager.registerEventHandler(V.EVENT_TYPE,this.__boundGameBoundsEventHandler),this.__leaderboardManager=T},close:function(){this.__timeoutContext.clearAll(),this.__unlockedAchievements.length=0,this.__achievementView.destroy(),this.__walletView.detach(),a.prototype.close.call(this)},__gameBoundsEventHandler:function(e){this.__gameBounds.width=e.getWidth(),this.__gameBounds.height=e.getHeight()},show:function(e,t,i,n){var r=this;this._widget=this.__dialogResource.construct();var _=F.CURRENCY_SYMBOLS[F.GOLD];this.__score=n,this.__blackVeil=this._widget.findSingleWidgetWithName("blackVeil"),this.__blackVeilTransform=new c,this.__blackVeil.setTransform(this.__blackVeilTransform),this.__fadeIn(200),this.__fueDialogButton=this._widget.findSingleWidgetWithName("btn_dummy"),this.__fueDialogButton.setVisibility(p.HIDDEN),this.__fueDialogContainer=this._widget.findSingleWidgetWithName("popup_FUE"),this.__fueDialogContainer.setVisibility(p.HIDDEN),this.__fueDialogContainer.findSingleWidgetWithName("CanvasPanel").addSlot(function(e){r.__fueDialogSlot=e}),this.__fueFinger=this._widget.findSingleWidgetWithName("finger"),this.__fueFinger.addSlot(function(e){var t=W.getResourceManager().get(v.RESOURCE_TYPE,"element_tapToContinue"),i=t.construct();e.setAnchor(new s(0,0,1,1)),e.setOffset(new o(0,0,1,1)),e.setWidget(i)}),this.__fueFinger.setVisibility(p.HIDDEN),this._widget.findSingleWidgetWithName("BG_dots").setTransform(this.__dotsTransform,!0);var l=new I;l.jiggle(10,10),this.__dotsTransform.setAction(l),this.__dotsAction=l;var u=(this.__playerManager.getPlayerGold(),this._widget.findSingleWidgetWithName("top_tray"));this.__walletView.attach(u),this.__walletView.resume(),this.__finalScore=this._widget.findSingleWidgetWithName("final_score"),this.__continues=this._widget.findSingleWidgetWithName("continues"),this.__awards=this._widget.findSingleWidgetWithName("awards"),this.__missions=this._widget.findSingleWidgetWithName("missions"),this.__achievementView=new R(this.__awards,this.__resourceManager,this.__entityManager,this.__eventManager,this.__achievementManager,this.__createWorld,this.__walletView,this.__onClaimedAchievement.bind(this)),this.__rewardTease=this._widget.findSingleWidgetWithName("rewardTease"),this.__fbPlayButtonSection=this._widget.findSingleWidgetWithName("fbPlay"),this.__playAgainButton=this._widget.findSingleWidgetWithName("btn_playAgain"),this.__playAgainButton.setClickHandler(this.__playAgainButtonClickHandler.bind(this));var d=this._widget.findSingleWidgetWithName("unlocked"),g=d.findSingleWidgetWithName("dialogue");this.__powerupView=new L(g,d),this.__groupChallenge=this._widget.findSingleWidgetWithName("groupChallenge"),this.__contributionBar=this._widget.findSingleWidgetWithName("contributeBar"),this.__restartFailContainer=this.__rewardTease.findSingleWidgetWithName("failText"),this.__boxTeaseContainer=this.__rewardTease.findSingleWidgetWithName("reward"),this.__initialBoxTease=this.__boxTeaseContainer.findSingleWidgetWithName("teaserText"),this.__finalBoxTease=this.__boxTeaseContainer.findSingleWidgetWithName("teaser2Text"),this.__raidProgressView=new U(this._widget.findSingleWidgetWithName("groupChallenge"),this._widget.findSingleWidgetWithName("contributeBar"),this.__gameBounds),this.__raidProgressView.refresh(),this.__initialRaidState=this.__raidManager.getState(),this.__finalScore.setVisibility(p.VISIBLE),this.__continues.setVisibility(p.HIDDEN),this.__awards.setVisibility(p.HIDDEN),this.__missions.setVisibility(p.HIDDEN),this.__rewardTease.setVisibility(p.HIDDEN),this.__fbPlayButtonSection.setVisibility(p.HIDDEN),this.__playAgainButton.setVisibility(p.HIDDEN),this.__powerupView.hide(),this.__groupChallenge.setVisibility(p.HIDDEN),this.__contributionBar.setVisibility(p.HIDDEN),this.__missionProgressContainer=this.__missions.findSingleWidgetWithName("mission_progress"),this.__missionsMessagingContainer=this.__missions.findSingleWidgetWithName("mission_messaging"),this.__missionsDailyMessagingContainer=this.__missionsMessagingContainer.findSingleWidgetWithName("finished_daily"),this.__missionsSetMessagingContainer=this.__missionsMessagingContainer.findSingleWidgetWithName("finished_set"),this.__missionsDailyTimer=this.__missionsDailyMessagingContainer.findSingleWidgetWithName("timer"),this.__missionsSetTimer=this.__missionsSetMessagingContainer.findSingleWidgetWithName("timer"),this.__dailyMissionsHeading=this.__missions.findWidgetsWithName("heading")[0],this.__missions.findSingleWidgetWithName("instructionText").setVisibility(p.HIDDEN);var m=W.getMissionManager();this.__missionInstances=m.getMissionSet().getMissions().filter(function(e){return!e.completed||e.recentlyCompleted}),this.__missionsListContainer=this.__missions.findSingleWidgetWithName("mission_list");var f=this.__missionsListContainer.findSingleWidgetWithName("ListPanel");this.__missionDescriptionContainers=[];for(var y=0,E=f.getNumSlots();y<E;y++)if(y<this.__missionInstances.length){var T=f.getSlotAtIndex(y).getWidget();this.__missionDescriptionContainers.push(T.findSingleWidgetWithName("mission_description"))}else f.removeSlotAtIndex(y);W.getFUEManager().showShortenedMissionProgress()?this.__missionProgress=new M(this.__resourceManager,this.__missionProgressContainer):this.__missionProgress=new b(this.__resourceManager,this.__missionProgressContainer),this.__leaderboard=this._widget.findSingleWidgetWithName("rank"),this.__leaderboardScroll=this.__leaderboard.findSingleWidgetWithName("leader_scroll"),this.__leaderboardList=this.__leaderboardScroll.getNamedSlot("content").getWidget(),this.__pagesCarousel=this._widget.findSingleWidgetWithName("CarouselPanel"),this.__pagingDotsContainer=this._widget.findSingleWidgetWithName("paging"),this.__activePagingDots=this.__pagingDotsContainer.findWidgetsWithName("active"),this.__notActivePagingDots=this.__pagingDotsContainer.findWidgetsWithName("notActive"),this.__pagingDotsContainer.setVisibility(p.HIDDEN),this.__currentPageIdx=0,this.__coverBtn=this._widget.findSingleWidgetWithName("btn_cover"),this.__coverBtn.setVisibility(p.HIDDEN),this.__totalGoldEarned=i;var w=this.__finalScore.findSingleWidgetWithName("credits");this.__earnedGoldLabel=w.findSingleWidgetWithName("count_total_credits"),this.__earnedGoldLabel.setText(_+i.toLocaleString());var x=w.findSingleWidgetWithName("coin_multiplier");this.__playerManager.getPlayer().goldMultipliers>0?(x.setVisibility(p.VISIBLE),x.setText("x"+S.GOLD_MULTIPLIER),this.__totalGoldEarned*=S.GOLD_MULTIPLIER):x.setVisibility(p.HIDDEN),this.__finalScore.findSingleWidgetWithName("score_total").setText(n.toLocaleString());var P=this.__continues.findSingleWidgetWithName("btn_yes");P.setClickHandler(function(){C.blinkButton(P,["BG","frame"]),r.__animateOutContinue().then(function(){return r.__continueGameCallback().then(function(e){e?r.__fsm.transitionTo("exit"):r.__sendGameResult()})})}),P.findWidgetsWithName("cost").forEach(function(e){e.setText(_+S.COST_TO_CONTINUE)}),P.setEnabled(!0),this.__continueYesButton=P,P.runAction(h.fadeTo(1,0));var A=this.__continues.findSingleWidgetWithName("btn_no");A.setClickHandler(function(){C.blinkButton(A,["BG","frame"]),r.__animateOutContinue().then(function(){r.__noContinueGameCallback(),r.__sendGameResult()})}),A.runAction(h.fadeTo(1,0)),this.__timer=this.__continues.findSingleWidgetWithName("timer"),this.__timer.setVisibility(p.VISIBLE),this.__timerLabel=this.__timer.findSingleWidgetWithName("timer_continue"),this.__walletView.pause(),this.__loader=this._widget.findSingleWidgetWithName("loader"),this.__loader.setVisibility(p.HIDDEN),this._widget.invalidate(),a.prototype.show.call(this,e),this.__fsm.reset(),t&&W.getFUEManager().isContinueEnabled()?this.__fsm.transitionTo("continue"):(this.__noContinueGameCallback(),this.__sendGameResult())},__showLoader:function(){this.__loader.setVisibility(p.VISIBLE);var e=this.__loader.findSingleWidgetWithName("loadText"),t=this.__loader.findSingleWidgetWithName("loadwheel1"),i=this.__loader.findSingleWidgetWithName("loadwheel2"),n=h.loop(h.sequence(h.wait(1e3),h.fadeTo(0,167,E.easeInOut),h.fadeTo(1,167,E.easeInOut))),r=h.sequence(h.rotateBy(Math.PI,0),h.loop(h.rotateBy(2*Math.PI,667))),s=h.loop(h.rotateBy(2*Math.PI,667));this.__loadTextTransform=new c,this.__wheel1Transform=new c,this.__wheel2Transform=new c,this.__loadTextTransform.setAction(n),this.__wheel1Transform.setAction(r),this.__wheel2Transform.setAction(s),e.setTransform(this.__loadTextTransform),t.setTransform(this.__wheel1Transform,!0),i.setTransform(this.__wheel2Transform,!0)},__fadeIn:function(e){this.__blackVeilTransform.setAction(h.sequence(h.fadeTo(1,0),h.fadeTo(0,e)))},__sendGameResult:function(){this.__showLoader();var e=this;this.__raidResponse=null,this.__sendResultCallback().then(function(t){var i=t.result;e.__isLevelUp=i.levelUp,e.__unlockedAchievements=e.__achievementManager.update(i.achievements),e.__completedMissions=i.completedMissions,e.__raidResponse=t.raid,e.__loader.setVisibility(p.HIDDEN),e.__unlockedAchievements.length?e.__fsm.transitionTo("awards",{enterBeforePages:!0}):e.__fsm.transitionTo("pages",{needPageReset:!0,firstTimeUpdate:!0,autoSlide:!0})}).catch(function(t){l.error("Error sending game result: "+t),e.__fsm.transitionTo("final score")}).then(function(){e.__loader.setVisibility(p.HIDDEN)})},__showContinue:function(){this.__continues.runAction(C.createDialogBlinkIn(),!0,!1),this.__continues.setVisibility(p.VISIBLE),this.__continues.invalidate(),this.__startCountdownTick()},__animateOutContinue:function(){var e=this;return new Promise(function(t,i){var n=C.createDialogBlinkOut();n.addAction(h.callback(function(){e.__continues.setVisibility(p.HIDDEN),t()})),e.__continues.runAction(n,!0,!1)})},__hideContinue:function(){this.__cancelCountdownTick()},__showMissionExplanationDialog:function(){function e(){i.__fueFinger.setVisibility(p.HIDDEN),i.__fueDialogButton.setVisibility(p.HIDDEN),t.close()}var t=new A("Complete 3 missions to receive a Loot Chest. Completed Missions will refresh every 4 hours. New Missions arrive daily, so check back often!","dummygiftbox");t._closableByModalClick=!0,P.showDialog(t,this.__fueDialogSlot);var i=this;this.__fueDialogButton.setClickHandler(e),this.__fueDialogButton.setVisibility(p.VISIBLE),this.__fueFinger.setVisibility(p.VISIBLE),this.__fueDialogContainer.setVisibility(p.VISIBLE),this.__fueFinger.invalidate(),this.__fueDialogContainer.invalidate()},__showPages:function(e){d.ifDefined.assertIsObject(e);var t=this;this.__coverBtn.setVisibility(p.VISIBLE);var i=d.isNonEmptyObject(this.__raidResponse.raid),n=!1,r=!1,s=!0,o="";if(e&&(n=e.needPageReset,o=e.page,r=e.autoSlide,s=e.firstTimeUpdate),n){if(i){var a=this.__pagesCarousel.getNumSlots();a<3&&this.__pagesCarousel.addSlot(function(){t.__pagesCarousel.getSlotAtIndex(0).setWidget(this.__raidProgressView),t.__pagesCarousel.getSlotAtIndex(1).setWidget(this.__mission),t.__pagesCarousel.getSlotAtIndex(2).setWidget(this.__leaderboard)})}else if(n){var a=this.__pagesCarousel.getNumSlots();3===a&&(this.__pagesCarousel.removeSlotAtIndex(0),this.__raidProgressView.hide())}this.__pagesCarousel.invalidate()}s&&this.__updateLeaderboard(),o?this.__showSinglePage(o,s,r):i?this.__showSinglePage("raid",s,r):this.__showSinglePage("missions",s,r)},__showSinglePage:function(e,t,i){var n=d.isNonEmptyObject(this.__raidResponse.raid),r=H;n||(r=q);var s=r.indexOf(e);if(s<0)return void l.warn("Invalid page name",e);this.__pagesCarousel.goToPage(s),this.__updatePagingDots(s),"leaderboard"===e&&this.__coverBtn.setVisibility(p.HIDDEN),n?0===s?this.__showRaid(t,i):1===s&&this.__showMissions(t,i):0===s&&this.__showMissions(t,i)},__hidePages:function(){this.__coverBtn.setVisibility(p.HIDDEN)},__updatePagingDots:function(){this.__pagingDotsContainer.setVisibility(p.VISIBLE);for(var e=this.__currentPageIdx,t=d.isNonEmptyObject(this.__raidResponse.raid),i=0;i<3;i++)if(0===i)this.__activePagingDots[i].setVisibility(e===i?p.VISIBLE:p.HIDDEN),this.__notActivePagingDots[i].setVisibility(p.VISIBLE);else if(1===i)this.__activePagingDots[i].setVisibility(t&&e===i?p.VISIBLE:p.HIDDEN),this.__notActivePagingDots[i].setVisibility(t?p.VISIBLE:p.HIDDEN);else if(2===i){var n=t&&e===i||!t&&e+1===i;this.__activePagingDots[i].setVisibility(n?p.VISIBLE:p.HIDDEN),this.__notActivePagingDots[i].setVisibility(p.VISIBLE)}this.__pagingDotsContainer.invalidate()},__showRaid:function(e,t){var i=this.__raidResponse.raid.progress,n=i-this.__raidResponse.contribution;if(!d.isNumber(i)||!d.isNumber(n))return void(this.__unlockedAchievements.length&&this.__fsm.transitionTo("awards",{enterBeforePages:!1}));if(this.__raidProgressView.refresh(),this.__raidProgressView.show(),t){var r=this;this.__raidProgressView.tween(n,i).then(_.delayGenerator(850)).then(function(){0===r.__pagesCarousel.getCurrentPage()&&r.__pagesCarousel.nextPage()}).then(_.delayGenerator(200)).then(r.__showMissions.bind(r,!0,!0))}},__showAwards:function(e){var t=e.enterBeforePages,i=!1;t&&(i=!0),this.__awards.setVisibility(p.VISIBLE);var n=this.__unlockedAchievements.shift(),r=this.__achievementManager.getAchievementForDisplay(n.id);this.__achievementView.show(r,n),this.__awards.invalidate(),"autoTest"===g.getUrlParams().mode&&(this.__fsm.transitionTo("final score"),this.__fsm.transitionTo("pages",{firstTimeUpdate:!1,needPageReset:i,autoSlide:!0}))},__onClaimedAchievement:function(){this.__unlockedAchievements.length?this.__fsm.transitionTo("awards",{enterBeforePages:!0}):this.__fsm.transitionTo("pages",{needPageReset:!0,firstTimeUpdate:!0,autoSlide:!0})},__hideAwards:function(){this.__awards.setVisibility(p.HIDDEN)},__showPowerupUnlocked:function(){var e=this;this.__missions.setVisibility(p.HIDDEN),this.__powerupView.show().then(function(){e.__fsm.transitionTo("final score")})},__hidePowerupUnlocked:function(){this.__powerupView.hide(),this.__missions.setVisibility(p.VISIBLE)},__showLevelUp:function(){var e=this.__playerManager.getPlayerLevel(),t=this.__playerManager.getLevelRewards(e);this._widget.setVisibility(p.HIDDEN);var i=this;this.__levelUpDialog=new D(this.__playerManager,this.__resourceManager,this.__entityManager,this.__eventManager,this.__createWorld,this.__walletView);var n=this.__walletView.getCurrency(F.TOKENS),r=this.__walletView.getCurrency(F.GOLD);this.__levelUpDialog.show(this.__dialogManager,t,n,r),this.__levelUpDialog.waitForClosed().then(function(){delete i.__levelUpDialog;var e=i._widget.findSingleWidgetWithName("top_tray");i.__walletView.attach(e),i._widget.setVisibility(p.VISIBLE),i.__fsm.transitionTo("pages",{page:"missions",needPageReset:!1,firstTimeUpdate:!1,autoSlide:!0})})},__slideToLeaderboardPage:function(e){var t=this,i=d.isNonEmptyObject(this.__raidResponse.raid);i?H.indexOf("leaderboard"):q.indexOf("leaderboard");this.__pagesCarousel.runAction(h.sequence(h.wait(e),h.callback(function(){t.__pagesCarousel.nextPage(),t.__leaderboard.runAction(h.sequence(h.wait(200),h.callback(function(){t.__coverBtn.setVisibility(p.HIDDEN),t.__animateInPlayAgainButton()})))})))},__showMissions:function(e,t){if(!e)return void(t&&this.__slideToLeaderboardPage(1e3));this.__missions.setVisibility(p.VISIBLE);var i=W.getMissionManager(),n=i.getMissionSet(),r=n.getCompletedSets(),s=n.getCompleted().length;s=n.isComplete()?0:n.getCompleted().length;var o=r*O.MISSIONS_PER_SET+s,a=r>=O.MAX_COMPLETED_SETS,_=this.__completedMissions.length;if(this.__missionProgress.setNumMissionsComplete(o-_),n.isComplete()&&0===_){this.__missionsListContainer.setVisibility(p.HIDDEN),this.__missionsMessagingContainer.setVisibility(p.VISIBLE);var l;return a?(this.__missionsSetMessagingContainer.setVisibility(p.HIDDEN),this.__missionsDailyMessagingContainer.setVisibility(p.VISIBLE),l=n.computeResetEpochMS()):(this.__missionsSetMessagingContainer.setVisibility(p.VISIBLE),this.__missionsDailyMessagingContainer.setVisibility(p.HIDDEN),l=n.computeMissionStartEpochMS()),this.__startMissionMessagingTick(l),this.__fsm.transitionTo("final score"),this.__coverBtn.setVisibility(p.VISIBLE),void(t&&this.__slideToLeaderboardPage(1500))}this.__missionsListContainer.setVisibility(p.VISIBLE),this.__missionsMessagingContainer.setVisibility(p.HIDDEN),this.__missionProgressContainer.setVisibility(p.VISIBLE),this.__dailyMissionsHeading.setVisibility(p.VISIBLE);var h=0;this.__arrMissionViews.length=0;for(var u=[],c=0;c<this.__missionInstances.length;c++,h+=33){var d=this.__missionDescriptionContainers[c],g=this.__missionInstances[c],m=new x(d,g,this.__gameBounds.width,!0,!0),f=m.slideIn(h);u.push(f),this.__arrMissionViews.push(m),d.invalidate()}this.__missionsListContainer.invalidate();var v=this;this.__sounds.play("mission_tiles",Y),Promise.all(u).then(function(){return v.__flashRecentlyCompletedMissions(v.__missionInstances)}).then(function(){return v.__addGachaToken(o,_)}).then(function(){n.isComplete()&&(v.__missionsListContainer.setVisibility(p.HIDDEN),v.__missionsMessagingContainer.setVisibility(p.VISIBLE),v.__missionsSetMessagingContainer.setVisibility(p.VISIBLE),v.__missionsDailyMessagingContainer.setVisibility(p.HIDDEN),l=n.computeMissionStartEpochMS(),v.__startMissionMessagingTick(l)),v.__isLevelUp?v.__timeoutContext.setTimeout(function(){v.__fsm.transitionTo("level up")},850):(v.__fsm.transitionTo("final score"),v.__coverBtn.setVisibility(p.VISIBLE),t&&v.__slideToLeaderboardPage(1500))})},__addMissionRewards:function(e,t,i){var n=W.getMissionManager(),r=n.getReward(e.level),s=r.gold,o=r.xp,a=this;return new Promise(function(e,n){a.__timeoutContext.setTimeout(function(){a.__missionProgress.getNotchGeometry(t,G);var i=G.getX(),n=G.getY(),r=a.__walletView.gain(F.GOLD,s,i,n),_=a.__walletView.getLevel(),l=a.__walletView.getXP(),h=a.__walletView.gainXp(0,o,i,n);Promise.all([r,h]).then(function(){a.__walletView.setLevelXP(_,l+o,!0),e(!0)})},i)})},__updateLeaderboard:function(){var e=this;T.generateLeaderboardEntries(T.LEADERBOARD_LIMIT,e.__score).then(function(){return T.setupLeaderboardListWidget(e.__leaderboardScroll,e.__leaderboardList)})},__flashRecentlyCompletedMissions:function(e){for(var t=this,i=Promise.resolve(!0),n=0,r=e.length;n<r;n++){var s=this.__arrMissionViews[n],o=e[n];if(o.recentlyCompleted){o.recentlyCompleted=!1;var a=function(e,i){return function(){var n=t.__missionProgress.getNumCompleted(),r=e.animateComplete(),s=t.__missionProgress.addCompletedMission(200),o=t.__addMissionRewards(i,n,300);return Promise.all([r,s,o])}}(s,o);i=i.then(a)}}return i},__addGachaToken:function(e,t){if(0===t||e%O.MISSIONS_PER_SET!=0)return Promise.resolve(!0);var i=~~(e/O.MISSIONS_PER_SET),n=this.__missionProgress.addToken(300),r=this,s=new Promise(function(e,t){r.__timeoutContext.setTimeout(function(){r.__missionProgress.getTokenSource(i-1).getGeometry(G);var t=G.getX(),n=G.getY();return r.__walletView.gain(F.TOKENS,1,t,n).then(function(){e(!0)})},300)});return Promise.all([n,s])},__startMissionMessagingTick:function(e){var t=this;this.__cancelMissionMessagingTick(),this.__missionMessagingTargetTimestamp=e,this.__missionMessagingTick(),this.__timeoutContext.setTimeout(function(){t.__missionMessagingTick(),t.__missionMessagingIntervalId=t.__timeoutContext.setInterval(t.__missionMessagingTick.bind(t),1e3)},1e3-Date.now()%1e3)},__cancelMissionMessagingTick:function(){this.__missionMessagingIntervalId&&(this.__timeoutContext.cancelInterval(this.__missionMessagingIntervalId),this.__missionMessagingIntervalId=null)},__missionMessagingTick:function(){var e=Math.max(0,this.__missionMessagingTargetTimestamp-Date.now()),t=~~(e/1e3),i=g.getTimeDisplayString(t,"-","hybridHours");this.__missionsDailyTimer.setText(i),this.__missionsSetTimer.setText(i),e<=0&&this.__cancelMissionMessagingTick()},__gainCoins:function(e){if(!(e<=0)){this.__earnedGoldLabel.getGeometry(G);var t=G.getX(),i=G.getY();this.__walletView.gain(F.GOLD,e,t,i)}},__animateInPlayAgainButton:function(){this.__playAgainButton.setVisibility(p.VISIBLE);var e=new c,t=h.sequence(h.moveBy(0,300,0),h.moveBy(0,-300,500,E.sigmoid));e.setAction(t),this.__playAgainButton.setTransform(e),this.__playAgainButtonTransform=e},__showFinalScore:function(){this.__finalScore.invalidate(),this.__gainCoins(this.__totalGoldEarned),W.getFUEManager().shouldExplainMissions()&&this.__showMissionExplanationDialog()},__playAgainButtonClickHandler:function(){this.__playAgainButton.setEnabled(!1),this.__pagingDotsContainer.setVisibility(p.HIDDEN);var e=this.__eventManager.getNewEvent(k);this.__eventManager.queueEvent(e)},__takeScreenshot:function(){w.takeScreenshot(this.__score).then(function(){l.log("Screenshot sent")}).catch(function(e){l.error("Error sending screenshot: "+e)});var e=this.__eventManager.getNewEvent(B);this.__eventManager.queueEvent(e)},__onEnterExitState:function(){this.close()},__cancelCountdownTick:function(){this.__countdownIntervalId&&(this.__timeoutContext.cancelInterval(this.__countdownIntervalId),this.__countdownIntervalId=null)},__startCountdownTick:function(){var e=this;this.__cancelCountdownTick(),this.__countdownTargetTimestamp=Date.now()+1e4,this.__countdownTick(),this.__timeoutContext.setTimeout(function(){e.__countdownTick(),e.__countdownIntervalId=e.__timeoutContext.setInterval(e.__countdownTick.bind(e),1e3)},1e3-Date.now()%1e3)},__countdownTick:function(){var e=Math.max(0,this.__countdownTargetTimestamp-Date.now()),t=~~(e/1e3);if(this.__timerLabel.setText(""+t),this.__timer.invalidate(),e<=0){this.__continueYesButton.setEnabled(!1),this.__cancelCountdownTick();var i=this.__continues.findSingleWidgetWithName("btn_no");C.blinkButton(i,["BG","frame"]);var n=this;this.__animateOutContinue().then(function(){n.__noContinueGameCallback(),n.__sendGameResult()})}},update:function(e){this.__blackVeilTransform.update(e),this.__achievementView&&this.__achievementView.update(e),this.__walletView&&this.__walletView.update(e),this.__levelUpDialog&&this.__levelUpDialog.update(e),this.__powerupView&&this.__powerupView.update(e),this.__raidProgressView&&this.__raidProgressView.update(e);for(var t=0,i=this.__arrMissionViews.length;t<i;t++){this.__arrMissionViews[t].update(e)}this.__missionProgress&&this.__missionProgress.update(e),this.__loadTextTransform.update(e),this.__wheel1Transform.update(e),this.__wheel2Transform.update(e),this.__playAgainButtonTransform&&this.__playAgainButtonTransform.update(e),this.__currentPageIdx!==this.__pagesCarousel.getCurrentPage()&&(this.__currentPageIdx=this.__pagesCarousel.getCurrentPage(),this.__updatePagingDots(this.__currentPageIdx))}})}),define("ui/views/MissionFlyinView",["require","exports","module","thor/core/Class","thor/core/Logger","thor/ui/Widget","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/core/Validation","thor/ui/Widget","thor/math/ColorUtil","thor/graphics/animation/EasingFunctions","thor/graphics/resources/TextureRegionResource","mission/MissionType","mission/MissionCategory","mission/MissionInstance","ManagerRepository","ui/views/MissionDescriptionView"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/ui/Widget"),e("thor/graphics/animation/actions/Actions")),s=e("thor/graphics/animation/Transform"),o=e("thor/core/Validation"),a=e("thor/ui/Widget").VISIBILITY,_=e("thor/math/ColorUtil"),l=e("thor/graphics/animation/EasingFunctions"),h=e("thor/graphics/resources/TextureRegionResource"),u=e("mission/MissionType"),c=e("mission/MissionCategory"),d=(e("mission/MissionInstance"),e("ManagerRepository")),g=e("ui/views/MissionDescriptionView"),p={};p[c.KILL]="BG_kills",p[c.COLLECT]="BG_collect",p[c.SKILL]="BG_skill";i.exports=n.create({initialize:function(e){this.__iconContainer=e.findSingleWidgetWithName("icon_container"),this.__label=e.findSingleWidgetWithName("label1"),this.__icon=this.__iconContainer.findSingleWidgetWithName("icon"),this.__check=this.__iconContainer.findSingleWidgetWithName("check"),this.__glow=this.__iconContainer.findSingleWidgetWithName("glow"),this.__backgrounds={};for(var t in p)this.__backgrounds[t]=this.__iconContainer.findSingleWidgetWithName(p[t])},setupAnimation:function(e){var t=u.CATEGORY[e.type];for(var i in this.__backgrounds)this.__backgrounds[i].setVisibility(a.HIDDEN);var n=this.__backgrounds[t];n.setVisibility(a.VISIBLE);var c=d.getResourceManager(),p=g.MISSION_ICON_RESOURCE_NAMES[e.type];if(o.isNonEmptyString(p)&&c.has(h.RESOURCE_TYPE,p)){var m=c.get(h.RESOURCE_TYPE,p);this.__icon.setTextureRegion(m)}this.__icon.setTintColor(4294967295),n.setTintColor(4294967295),this.__iconContainer.invalidate();var f=this;this.__iconContainerTransform=new s,this.__iconContainerTransform.alpha=0;var v=r.sequence(r.scaleTo(.5,.5,0),r.wait(150),r.parallel(r.fadeTo(1,100,l.easeIn),r.scaleTo(1,1,200,l.exponentialOvershoot)),r.tweenCallback(0,1,100,function(e){var t=_.lerp(4294967295,1145324799,e);f.__icon.setTintColor(t),n.setTintColor(t)}));this.__iconContainerTransform.setAction(v),this.__iconContainer.setTransform(this.__iconContainerTransform,!0),this.__glowTransform=new s,this.__glowTransform.alpha=0;var y=r.sequence(r.scaleTo(5,5,0),r.wait(350),r.fadeTo(1,150,l.easeIn),r.fadeTo(0,150,l.easeOut));this.__glowTransform.setAction(y),this.__glow.setTransform(this.__glowTransform,!0),this.__checkTransform=new s,this.__checkTransform.alpha=0;var E=r.sequence(r.scaleTo(3,3,0),r.wait(350),r.parallel(r.fadeTo(1,150,l.easeIn),r.scaleTo(1,1,300,l.overshoot)));this.__checkTransform.setAction(E),this.__check.setTransform(this.__checkTransform,!0),this.__textTransform=new s,this.__textTransform.alpha=0;var S=r.sequence(r.moveBy(-40,0,0),r.wait(350),r.parallel(r.fadeTo(1,300,l.easeIn),r.moveBy(40,0,300,l.easeIn)));this.__textTransform.setAction(S),this.__label.setTransform(this.__textTransform)},update:function(e){this.__iconContainerTransform&&this.__iconContainerTransform.update(e),this.__glowTransform&&this.__glowTransform.update(e),this.__checkTransform&&this.__checkTransform.update(e),this.__textTransform&&this.__textTransform.update(e)}})}),
define("ui/IntroFUEDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Widget","thor/util/StringUtil","thor/graphics/resources/TextureRegionResource","ManagerRepository","ui/FUEDialogBase","mission/MissionType","mission/MissionCategory","ui/views/MissionDescriptionView"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/ui/Widget").VISIBILITY),s=(e("thor/util/StringUtil"),e("thor/graphics/resources/TextureRegionResource")),o=e("ManagerRepository"),a=e("ui/FUEDialogBase"),_=e("mission/MissionType"),l=e("mission/MissionCategory"),h=e("ui/views/MissionDescriptionView"),u={};u[l.KILL]="BG_kills",u[l.COLLECT]="BG_collect",u[l.SKILL]="BG_skill";var c=n.create(a,{initialize:function(e,t,i,n){var l=o.getResourceManager();a.prototype.initialize.call(this,"popup_FUEDialogue_intro"),this._closableByModalClick=!0,this._widget.findSingleWidgetWithName("text_paragraph1").setText(e),this._widget.findSingleWidgetWithName("text_paragraph2").setText(t),this._widget.findSingleWidgetWithName("text_missionDescription").setText(i);var c=this._widget.findSingleWidgetWithName("icon_container"),d={};for(var g in u){var p=u[g],m=c.findSingleWidgetWithName(p);d[g]=m,m.setVisibility(r.HIDDEN)}d[_.CATEGORY[n]].setVisibility(r.VISIBLE);var f=c.findSingleWidgetWithName("icon"),v=h.MISSION_ICON_RESOURCE_NAMES[n];if(l.has(s.RESOURCE_TYPE,v)){var y=l.get(s.RESOURCE_TYPE,v);f.setTextureRegion(y)}}});i.exports=c}),define("ui/Run1IntroDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Widget","thor/util/StringUtil","ManagerRepository","ui/IntroFUEDialog","mission/MissionType"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/ui/Widget").VISIBILITY,e("thor/util/StringUtil")),s=e("ManagerRepository"),o=e("ui/IntroFUEDialog"),a=e("mission/MissionType"),_=n.create(o,{initialize:function(){var e=r.interpolate("Hey {name}! My name is Artemis. I'll be assisting with your training!",{name:s.getPlayerManager().getName()});o.prototype.initialize.call(this,e,"Your first mission is to collect Fuel.","Collect 1 Fuel",a.COLLECT_FUEL)}});i.exports=_}),define("ui/FuelIntroDialog",["require","exports","module","thor/core/Class","thor/core/Validation","ManagerRepository","ui/StandardFUEDialog"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("ManagerRepository"),e("ui/StandardFUEDialog")),s=n.create(r,{initialize:function(){r.prototype.initialize.call(this,"Your fuel depletes over time and when you take damage. If you run out of fuel, your ship will explode, so be careful!")}});i.exports=s}),define("ui/FuelPickupIntroDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Widget","ManagerRepository","ui/DescriptionFUEDialog"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/ui/Widget").VISIBILITY,e("ManagerRepository"),e("ui/DescriptionFUEDialog")),s=n.create(r,{initialize:function(){r.prototype.initialize.call(this,"Enemies sometimes drop Fuel. Collect it to replenish your Fuel supply!","icon_collect_x_fuel")}});i.exports=s}),define("ui/CompleteFUEDialog",["require","exports","module","thor/core/Class","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/core/Validation","thor/ui/Widget","thor/audio/SoundSprite","thor/graphics/animation/EasingFunctions","thor/graphics/resources/TextureRegionResource","thor/audio/SoundSpriteResourceLoader","ManagerRepository","ui/FUEDialogBase","mission/MissionType","mission/MissionCategory","ui/views/MissionDescriptionView"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/graphics/animation/actions/Actions"),s=(e("thor/graphics/animation/Transform"),e("thor/core/Validation")),o=e("thor/ui/Widget").VISIBILITY,a=e("thor/audio/SoundSprite"),_=e("thor/graphics/animation/EasingFunctions"),l=e("thor/graphics/resources/TextureRegionResource"),h=e("thor/audio/SoundSpriteResourceLoader"),u=e("ManagerRepository"),c=e("ui/FUEDialogBase"),d=e("mission/MissionType"),g=e("mission/MissionCategory"),p=e("ui/views/MissionDescriptionView"),m={};m[g.KILL]="BG_kills",m[g.COLLECT]="BG_collect",m[g.SKILL]="BG_skill";var f={channel:"UI_SFX"},v=n.create(c,{initialize:function(e,t,i,n,r){s.ifDefined.assertIsBoolean(r),r=r||!1;var _=u.getResourceManager();c.prototype.initialize.call(this,"pop_FUEDialogue_complete"),this._closableByModalClick=!0,this._widget.findSingleWidgetWithName("text_Header").setText(e),this._widget.findSingleWidgetWithName("text_paragraph").setText(t),this._widget.findSingleWidgetWithName("text_missionDescription").setText(i);var g=this._widget.findSingleWidgetWithName("icon_container"),f={};for(var v in m){var y=m[v],E=g.findSingleWidgetWithName(y);f[v]=E,E.setVisibility(o.HIDDEN)}f[d.CATEGORY[n]].setVisibility(o.VISIBLE);var S=g.findSingleWidgetWithName("icon"),T=p.MISSION_ICON_RESOURCE_NAMES[n];if(_.has(l.RESOURCE_TYPE,T)){var C=_.get(l.RESOURCE_TYPE,T);S.setTextureRegion(C)}this.__check=g.findSingleWidgetWithName("check"),this.__check.setVisibility(r?o.VISIBLE:o.HIDDEN),this.__sounds=_.getOrDefault(h.RESOURCE_TYPE,"game_sounds",a.EMPTY_SOUND_SPRITE)},animateCheck:function(){var e=this;return new Promise(function(t,i){e.__check.setVisibility(o.VISIBLE);var n=r.sequence(r.fadeTo(0,0),r.wait(500),r.callback(function(){e.__sounds.play("check_mark",f)}),r.scaleTo(2,2,0),r.parallel(r.fadeTo(1,300),r.scaleTo(1,1,400,_.easeOut)),r.callback(function(){t(!0)}));e.__check.runAction(n,!0),e.__check.getTransform().alpha=0})}});i.exports=v}),define("ui/FuelMissionCompleteDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Widget","ManagerRepository","mission/MissionType","ui/CompleteFUEDialog"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/ui/Widget").VISIBILITY,e("ManagerRepository"),e("mission/MissionType")),s=e("ui/CompleteFUEDialog"),o=n.create(s,{initialize:function(){s.prototype.initialize.call(this,"GREAT JOB!","You completed your first mission.","Collect 1 Fuel",r.COLLECT_FUEL,!1)},show:function(){return s.prototype.show.call(this).then(this.animateCheck.bind(this))}});i.exports=o}),define("ui/Run2IntroDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Widget","thor/util/StringUtil","ManagerRepository","ui/IntroFUEDialog","mission/MissionType"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/ui/Widget").VISIBILITY,e("thor/util/StringUtil"),e("ManagerRepository"),e("ui/IntroFUEDialog")),s=e("mission/MissionType"),o=n.create(r,{initialize:function(){r.prototype.initialize.call(this,"Let's use the Gun Power-up you unlocked to defeat the Miniboss.","","Destroy 1 Miniboss",s.KILL_MINIBOSS)}});i.exports=o}),define("ui/CoinPickupIntroDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Widget","ManagerRepository","ui/DescriptionFUEDialog"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/ui/Widget").VISIBILITY,e("ManagerRepository"),e("ui/DescriptionFUEDialog")),s=n.create(r,{initialize:function(){r.prototype.initialize.call(this,"Enemies can drop coins, which can be used for ship upgrades.","icon_collect_x_coins")}});i.exports=s}),define("ui/FlashingEnemyIntroDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Widget","ManagerRepository","ui/DescriptionFUEDialog"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/ui/Widget").VISIBILITY,e("ManagerRepository"),e("ui/DescriptionFUEDialog")),s=n.create(r,{initialize:function(){r.prototype.initialize.call(this,"Flashing enemies drop power-ups.","icon_collect_x_bullets")}});i.exports=s}),define("ui/MinibossMissionCompleteDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/ui/Widget","ManagerRepository","mission/MissionType","ui/CompleteFUEDialog"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/ui/Widget").VISIBILITY,e("ManagerRepository"),e("mission/MissionType")),s=e("ui/CompleteFUEDialog"),o=n.create(s,{initialize:function(){s.prototype.initialize.call(this,"GREAT JOB!","Congratulations, you're a natural!","Destroy 1 Miniboss",r.KILL_MINIBOSS,!1)},show:function(){return s.prototype.show.call(this).then(this.animateCheck.bind(this))}});i.exports=o}),define("ui/states/GameplayState",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/core/Enum","thor/config/Config","thor/ui/Anchor","thor/ui/Margin","thor/util/StringUtil","thor/ui/TextWidget","thor/ui/Widget","thor/ui/Widget","thor/ui/Geometry","thor/ui/ImageWidget","thor/graphics/text/TextAlignment","thor/ui/resources/WidgetResource","thor/ui/DialogManager","thor/resources/ResourceManager","thor/util/LocalStorage","thor/audio/SoundManager","thor/audio/SoundSprite","thor/graphics/animation/EasingFunctions","thor/graphics/animation/Transform","thor/graphics/animation/actions/Actions","thor/graphics/resources/TextureRegionResource","thor/util/TimeoutContext","ui/AudioMuteEnum","thor/graphics/animation/Tween","thor/graphics/animation/TweenGroup","thor/math/ColorUtil","thor/platforms/Google","thor/analytics/Seidr","thor/entity/EntityManager","thor/audio/SoundSpriteResourceLoader","./UIState","Constants","GameLogic","player/PlayerManager","gameplay/Tournament","ResourceTypes","events/BossEntityCreatedEvent","events/BossSpawnedEvent","events/BossClearedEvent","events/BossPinataEvent","events/BossCompleteEvent","events/ComboUpdateEvent","events/ScoreChangedEvent","events/PlayerHealthEvent","events/PlayerEnergyEvent","events/DistanceChangedEvent","thor/entity/EntityDestroyedEvent","events/HideMenuUIEvent","events/ShowMenuUIEvent","events/AudioMuteChangedEvent","events/ActivateLaserEvent","events/KeyboardInputEvent","events/InputActivateEvent","events/SystemUpgradeComboEvent","events/GameOverEvent","events/GameResetEvent","events/PlayerDoneExplodingEvent","events/GameEndSequenceEvent","events/GoldChangedEvent","events/MissionCompleteEvent","events/IntroStartEvent","events/IntroEndEvent","events/SpawnPopupDialogEvent","events/InputStartedEvent","events/InputEndedEvent","LaserManager","KeyboardInputEnum","SystemType","ui/GameOverSequenceDialog","AchievementManager","ui/CommonActions","ManagerRepository","mission/Mission","mission/MissionSet","mission/MissionInstance","mission/DifficultyType","mission/MissionType","mission/TrackingType","ui/views/MissionDescriptionView","ui/views/MissionFlyinView","ui/views/PopupDialog","ui/views/RaidProgressView","raid/RaidManager","raid/RaidState","player/CurrencyTypeEnum","ui/FUEDialogBase","ui/Run1IntroDialog","ui/FuelIntroDialog","ui/FuelPickupIntroDialog","ui/FuelMissionCompleteDialog","ui/Run2IntroDialog","ui/CoinPickupIntroDialog","ui/FlashingEnemyIntroDialog","ui/MinibossMissionCompleteDialog","gameplay/GamePopupTypeEnum"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Device"),s=e("thor/core/Logger").getLogger(i),o=e("thor/core/Validation"),a=e("thor/core/Enum"),_=e("thor/config/Config"),l=e("thor/ui/Anchor"),h=e("thor/ui/Margin"),u=e("thor/util/StringUtil"),c=(e("thor/ui/TextWidget"),e("thor/ui/Widget"),e("thor/ui/Widget").VISIBILITY),d=e("thor/ui/Geometry"),g=(e("thor/ui/ImageWidget"),e("thor/graphics/text/TextAlignment"),e("thor/ui/resources/WidgetResource")),p=(e("thor/ui/DialogManager"),e("thor/resources/ResourceManager"),e("thor/util/LocalStorage"),e("thor/audio/SoundManager")),m=e("thor/audio/SoundSprite"),f=e("thor/graphics/animation/EasingFunctions"),v=e("thor/graphics/animation/Transform"),y=e("thor/graphics/animation/actions/Actions"),E=e("thor/graphics/resources/TextureRegionResource"),S=e("thor/util/TimeoutContext"),T=e("ui/AudioMuteEnum"),C=e("thor/graphics/animation/Tween"),I=e("thor/graphics/animation/TweenGroup"),w=e("thor/math/ColorUtil"),b=e("thor/platforms/Google"),M=e("thor/analytics/Seidr"),x=(e("thor/entity/EntityManager"),e("thor/audio/SoundSpriteResourceLoader")),R=e("./UIState"),P=e("Constants"),A=(e("GameLogic"),e("player/PlayerManager"),e("gameplay/Tournament")),N=e("ResourceTypes"),D=e("events/BossEntityCreatedEvent"),L=e("events/BossSpawnedEvent"),O=e("events/BossClearedEvent"),V=e("events/BossPinataEvent"),B=e("events/BossCompleteEvent"),k=e("events/ComboUpdateEvent"),W=e("events/ScoreChangedEvent"),F=e("events/PlayerHealthEvent"),U=e("events/PlayerEnergyEvent"),G=e("events/DistanceChangedEvent"),H=e("thor/entity/EntityDestroyedEvent"),q=e("events/HideMenuUIEvent"),Y=e("events/ShowMenuUIEvent"),z=e("events/AudioMuteChangedEvent"),X=e("events/ActivateLaserEvent"),K=e("events/KeyboardInputEvent"),j=e("events/InputActivateEvent"),Q=e("events/SystemUpgradeComboEvent"),Z=(e("events/GameOverEvent"),e("events/GameResetEvent")),J=e("events/PlayerDoneExplodingEvent"),$=e("events/GameEndSequenceEvent"),ee=e("events/GoldChangedEvent"),te=e("events/MissionCompleteEvent"),ie=e("events/IntroStartEvent"),ne=e("events/IntroEndEvent"),re=e("events/SpawnPopupDialogEvent"),se=e("events/InputStartedEvent"),oe=e("events/InputEndedEvent"),ae=(e("LaserManager"),e("KeyboardInputEnum")),_e=e("SystemType"),le=e("ui/GameOverSequenceDialog"),he=(e("AchievementManager"),e("ui/CommonActions")),ue=e("ManagerRepository"),ce=e("mission/Mission"),de=e("mission/MissionSet"),ge=e("mission/MissionInstance"),pe=e("mission/DifficultyType"),me=e("mission/MissionType"),fe=e("mission/TrackingType"),ve=e("ui/views/MissionDescriptionView"),ye=e("ui/views/MissionFlyinView"),Ee=e("ui/views/PopupDialog"),Se=e("ui/views/RaidProgressView"),Te=(e("raid/RaidManager"),e("raid/RaidState"),e("player/CurrencyTypeEnum")),Ce=e("ui/FUEDialogBase"),Ie=e("ui/Run1IntroDialog"),we=e("ui/FuelIntroDialog"),be=e("ui/FuelPickupIntroDialog"),Me=e("ui/FuelMissionCompleteDialog"),xe=e("ui/Run2IntroDialog"),Re=e("ui/CoinPickupIntroDialog"),Pe=e("ui/FlashingEnemyIntroDialog"),Ae=e("ui/MinibossMissionCompleteDialog"),Ne=e("gameplay/GamePopupTypeEnum"),De={},Le=_.SKIP_RUN_INTRO?0:300,Oe=_.SKIP_RUN_INTRO?0:1500,Ve=_.SKIP_RUN_INTRO?0:2e3,Be={ACTIVE:"Active_warning",BOSS:"Boss_warning",COMBO:"Combo_max",MISSION_COMPLETE:"Mission_complete",COIN_MULTIPLIER:"Coin_multiplier",MISSION_INTRO:"Mission_intro",GROUP_INTRO:"group_intro",RAID:"group_intro"},ke={ACTIVE:2163605503,BOSS:4285822207,COMBO:4294967295,MISSION_COMPLETE:4294967295,COIN_MULTIPLIER:4294967295,MISSION_INTRO:4294967295,GROUP_INTRO:4294967295,RAID:4294967295},We={};We[_e.GUN]="gun_upgrade_03",We[_e.MISSILE]="missile_upgrade_03",We[_e.COMPANION]="companion_upgrade_03";var Fe={};Fe[_e.GUN]=4293661695,Fe[_e.MISSILE]=3527933951,Fe[_e.COMPANION]=4170456575;var Ue={};Ue[_e.GUN]="GUNS",Ue[_e.MISSILE]="MISSILES",Ue[_e.COMPANION]="COMPANIONS";var Ge="+"+Te.getSymbol(Te.GOLD),He=["TRY COLLECTING 4 GUN POWERUPS FIRST.","COMPLETE MISSIONS TO UNLOCK NEW UPGRADES.","CHECK OUT THE SHIP SCREEN TO SEE WHAT UPGRADES YOU OWN.","YOU CAN ALWAYS SCRAP UNWANTED UPGRADES TO ENHANCE THE ONES YOU LIKE!","CHECK YOUR MISSION STATUS BY PAUSING THE GAME."],qe=a.create("PauseTab",{MISSIONS:0,RAIDS:1});i.exports=n.create(R,{initialize:function(e,t,i,n,r,s,o,a,_,l,h){R.prototype.initialize.call(this,e);var u=t.get(g.RESOURCE_TYPE,"game_ui");this.__widgetResource=u,this.__entityManager=i,this.__createWorld=h,this.__dialogManager=r,this.__sounds=t.getOrDefault(x.RESOURCE_TYPE,"game_sounds",m.EMPTY_SOUND_SPRITE),this.__playerManager=o,this.__timeoutContext=new S,this.__tournament=null,this.__gameLogic=s,this.__eventManager=n,this.__laserManager=a,this.__achievementManager=_,this.__raidManager=l,this.__boundEntityDestroyedEventHandler=this.__entityDestroyedEventHandler.bind(this),this.__boundBossEntityCreatedEventHandler=this.__bossEntityCreatedEventHandler.bind(this),this.__boundBossSpawnedEventHandler=this.__bossSpawnedEventHandler.bind(this),this.__boundBossClearedEventHandler=this.__bossClearedEventHandler.bind(this),this.__boundComboUpdateEventHandler=this.__comboUpdateEventHandler.bind(this),this.__boundPlayerHealthEventHandler=this.__playerHealthEventHandler.bind(this),this.__boundScoreChangedEventHandler=this.__scoreChangedEventHandler.bind(this),this.__boundDistanceChangedEventHandler=this.__distanceChangedEventHandler.bind(this),this.__boundShowMenuHandler=this.__showMenuHandler.bind(this),this.__boundHideMenuHandler=this.__hideMenuHandler.bind(this),this.__boundPlayerEnergyEventHandler=this.__playerEnergyEventHandler.bind(this),this.__boundKeyboardInputEventHandler=this.__keyboardInputEventHandler.bind(this),this.__boundSystemUpgradeComboEventHandler=this.__systemUpgradeComboEventHandler.bind(this),this.__boundGameResetEvent=this.__gameResetEventHandler.bind(this),this.__boundInputActivateEventHandler=this.__activateLaser.bind(this),this.__boundPlayerDoneExplodingEventHandler=this.__playerDoneExplodingEventHandler.bind(this),this.__boundGameEndSequenceEventHandler=this.__gameEndSequenceEventHandler.bind(this),this.__boundGoldChangedEvent=this.__goldChangedEvent.bind(this),this.__boundMissionCompleteEvent=this.__missionCompleteEvent.bind(this),this.__boundIntroStartEvent=this.__introStartEvent.bind(this),this.__boundSpawnPopupDialogEventHandler=this.__spawnPopupDialogEventHandler.bind(this),this.__boundInputStartedEventHandler=this.__inputStartedEventHandler.bind(this),this.__energyProgressBar=null,this.__energyTint=null,this.__energyTweenGroup=new I,this.__energyTintTween=new C(0,1,200),this.__energyTween=new C(0,0,200),this.__energyContainer=null,this.__laserCard=null,this.__laserCardShield=null,this.__lastSystemType=null,this.__flyOutQueue=[],this.__flyOutInProgress=!1,this.__totalLabel=null,this.__userRank=null,this.__arrScores=null,this.__comboLabel=null,this.__comboCount=null,this.__bossHealthProgress=null,this.__bossHealthLossProgress=null,this.__bossHealthBG=null,this.__bossHealthBGTransform=new v,this.__bossHealthProgressTweenGroup=new I,this.__bossHealthProgressTween=new C(0,1,700,f.easeOut),this.__bossHealthProgressTransform=new v,this.__maxBossHealth=1,this.__bossEntity=null,this.__bossEntityId=-1,this.__bossFrameTab=null,this.__bossFrameLeft=null,this.__bossFrameRight=null,this.__bossFrameTabTransform=new v,this.__bossFrameLeftTransform=new v,this.__bossFrameRightTransform=new v,this.__fuelProgress=null,this.__fuelLossProgress=null,this.__fuelLossProgressTweenGroup=new I,this.__fuelLossProgressTween=new C(1,1,500,f.easeInOut),this.__tracers=null,this.__tracersTransform=new v,this.__edgeGlow=null,this.__edgeGlowTransform=new v,this.__edgeGlowHitTransform=new v,this.__edgeGlowPulseTransform=new v,this.__edgeGlowFlyouts=null,this.__edgeGlowFlyoutsTransform=new v,this.__flyOuts={ACTIVE:null,BOSS:null,COMBO:null,MISSION_COMPLETE:null,COIN_MULTIPLIER:null,MISSION_INTRO:null,GROUP_INTRO:null,RAID:null},this.__flyOutTransforms={ACTIVE:new v,BOSS:new v,COMBO:new v,MISSION_COMPLETE:new v,COIN_MULTIPLIER:new v,MISSION_INTRO:new v,GROUP_INTRO:new v,RAID:new v},this.__activeCircle=null,this.__activeCircleTransform=new v,this.__warningText=null,this.__warningTextTransform=new v,this.__activeTextContainer=null,this.__missionCompleteText=null,this.__killStreakBonusLeft=null,this.__killStreakBonusRight=null,this.__killStreakBonusValue=null,this.__pauseContainer=null,this.__releaseContainer=null,this.__releaseContainerTransform=new v,this.__pauseButton=null,this.__quitConfirmContainer=null,this.__showingQuitConfirmation=!1,this.__shipOverlay=null,this.__soundButton=null,this.__pauseSoundButton=null,this.__pauseScoreLabel=null,this.__pauseCreditsContainer=null,this.__pauseCreditsLabel=null,this.__pauseTab=qe.MISSIONS,this.__pauseMissionsTab=null,this.__pauseMissionsContainer=null,this.__pauseMissionsFrame=null,this.__pauseRaidsTab=null,this.__pauseRaidsContainer=null,this.__pauseRaidsFrame=null,this.__pauseRaidProgressView=null,this.__quitButton=null,this.__tipsContainer=null,this.__tipsLabel=null,this.__laserBeam=null,this.__missionDescriptionViews=[],this.__activeOverlay=null,this.__activeOverlayTransform=new v,this.__comboLabelTransform=new v,this.__comboCountTransform=new v,this.__comboLineTransform=new v,this.__killStreakBonusLeftTransform=new v,this.__killStreakBonusRightTransform=new v,this.__killStreakBonusValueTransform=new v,this.__laserCardTransform=new v,this.__shipOverlayTransform=new v,this.__upgradeTransforms=[];for(var c=0;c<4;++c)this.__upgradeTransforms[c]=new v;this.__upgradeBorderTransforms=[];for(var c=0;c<4;++c)this.__upgradeBorderTransforms[c]=new v;this.__upgradesOccupied=0,this.__upgradeBorderWidgets=[],this.__upgradeImageWidgets=[],this.__powerupContainer=null,this.__resourceManager=t,this.__playerHealth=1,this.__playerEnergy=0,this.__gameOverDialog=new le(t,this.__playerManager,this.__achievementManager,this.__entityManager,this.__eventManager,this.__createWorld,this.__handleContinue.bind(this),this.__gameLogic.noContinueHandler.bind(this.__gameLogic),this.__gameLogic.sendGameResult.bind(this.__gameLogic),this.__gameLogic.getBounds()),this.__animations=[]},_constructWidget:function(){return this.__widgetResource.construct()},onEnter:function(e){o.ifDefined.assertIsInstanceOf(e,A),R.prototype.onEnter.call(this,!1),b.trackEvent("gqs","Screen Events",{playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),screenName:"game"}),M.event("Screen Events",{contextId:this.__playerManager.getContextId(),playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),screenName:"game"}),this.__flyOutQueue.length=0,this.__flyOutInProgress=!1,this.__previousHint="",this.__totalLabel=this._widget.findSingleWidgetWithName("Totalscore_value"),window.GALATRONVS_DEMO_VERSION&&(e=null),this.__eventManager.registerEventHandler(H.EVENT_TYPE,this.__boundEntityDestroyedEventHandler),this.__eventManager.registerEventHandler(D.EVENT_TYPE,this.__boundBossEntityCreatedEventHandler),this.__eventManager.registerEventHandler(L.EVENT_TYPE,this.__boundBossSpawnedEventHandler),this.__eventManager.registerEventHandler(O.EVENT_TYPE,this.__boundBossClearedEventHandler),this.__eventManager.registerEventHandler(k.EVENT_TYPE,this.__boundComboUpdateEventHandler),this.__eventManager.registerEventHandler(F.EVENT_TYPE,this.__boundPlayerHealthEventHandler),this.__eventManager.registerEventHandler(W.EVENT_TYPE,this.__boundScoreChangedEventHandler),this.__eventManager.registerEventHandler(G.EVENT_TYPE,this.__boundDistanceChangedEventHandler),this.__eventManager.registerEventHandler(Y.EVENT_TYPE,this.__boundShowMenuHandler),this.__eventManager.registerEventHandler(q.EVENT_TYPE,this.__boundHideMenuHandler),this.__eventManager.registerEventHandler(U.EVENT_TYPE,this.__boundPlayerEnergyEventHandler),this.__eventManager.registerEventHandler(K.EVENT_TYPE,this.__boundKeyboardInputEventHandler),this.__eventManager.registerEventHandler(Q.EVENT_TYPE,this.__boundSystemUpgradeComboEventHandler),this.__eventManager.registerEventHandler(Z.EVENT_TYPE,this.__boundGameResetEvent),this.__eventManager.registerEventHandler(j.EVENT_TYPE,this.__boundInputActivateEventHandler),this.__eventManager.registerEventHandler(J.EVENT_TYPE,this.__boundPlayerDoneExplodingEventHandler),this.__eventManager.registerEventHandler($.EVENT_TYPE,this.__boundGameEndSequenceEventHandler),this.__eventManager.registerEventHandler(ee.EVENT_TYPE,this.__boundGoldChangedEvent),this.__eventManager.registerEventHandler(te.EVENT_TYPE,this.__boundMissionCompleteEvent),this.__eventManager.registerEventHandler(ie.EVENT_TYPE,this.__boundIntroStartEvent),this.__eventManager.registerEventHandler(re.EVENT_TYPE,this.__boundSpawnPopupDialogEventHandler),this.__eventManager.registerEventHandler(se.EVENT_TYPE,this.__boundInputStartedEventHandler),this.__health=1,this.__blackVeil=this._widget.findSingleWidgetWithName("blackVeil"),this.__blackVeilTransform=new v,this.__blackVeilTransform.alpha=0,this.__blackVeil.setTransform(this.__blackVeilTransform);var t=this._widget.findSingleWidgetWithName("fuel");this.__fuelProgress=t.findSingleWidgetWithName("fuel_bar"),this.__fuelProgress.setProgress(1),this.__fuelLossProgress=t.findSingleWidgetWithName("fuel_loss"),this.__fuelLossProgress.setProgress(1),this.__fuelGlowProgress=t.findSingleWidgetWithName("fuel_glow"),this.__fuelGlowProgress.setProgress(1);var i=this._widget.findSingleWidgetWithName("boss health");this.__bossHealthBG=i.findSingleWidgetWithName("BG"),this.__bossHealthProgress=i.findSingleWidgetWithName("fuel_bar"),this.__bossHealthLossProgress=i.findSingleWidgetWithName("fuel_loss"),this.__bossHealthLossProgress.setVisibility(c.HIDDEN);var n=this._widget.findSingleWidgetWithName("frame_boss_health");this.__bossFrameTab=this._widget.findSingleWidgetWithName("frame_notch_bosshealth"),this.__bossFrameLeft=n.findSingleWidgetWithName("border_left"),this.__bossFrameRight=n.findSingleWidgetWithName("border_right"),this.__bossFrameTab.setVisibility(c.HIDDEN),this.__bossHealthBG.setVisibility(c.HIDDEN),this.__bossFrameLeft.setVisibility(c.HIDDEN),this.__bossFrameRight.setVisibility(c.HIDDEN),this.__bossHealthProgress.setVisibility(c.HIDDEN),this.__tracers=this._widget.findSingleWidgetWithName("tracers"),this.__tracers.setTintColor(452645631),this.__tracers.setTransform(this.__tracersTransform,!0),this.__tracersHitAction=y.sequence(),this.__tracersPulseAction=y.sequence(),this.__edgeGlow=this._widget.findSingleWidgetWithName("edge_glow"),this.__edgeGlow.setTransform(this.__edgeGlowTransform,!0),this.__edgeGlowHitTransform.alpha=0,this.__edgeGlowPulseTransform.alpha=0,this.__energyContainer=this._widget.findSingleWidgetWithName("energy"),this.__energyProgressBar=this.__energyContainer.findSingleWidgetWithName("charge"),this.__energyProgressBar.setProgress(.5);var a=this;this.__pauseContainer=this._widget.findSingleWidgetWithName("pause"),this.__pauseContainer.setVisibility(c.HIDDEN),this.__pauseMissionsContainer=this.__pauseContainer.findSingleWidgetWithName("missions"),this.__pauseMissionsFrame=this.__pauseContainer.findSingleWidgetWithName("frame_mission"),this.__pauseRaidsContainer=this.__pauseContainer.findSingleWidgetWithName("groupChallenge"),this.__pauseRaidsFrame=this.__pauseContainer.findSingleWidgetWithName("frame_group"),this.__pauseRaidProgressView=new Se(this.__pauseRaidsContainer.findSingleWidgetWithName("groupChallenge_panel")),this.__pauseMissionsTab=this.__pauseContainer.findSingleWidgetWithName("btn_toggle_missions"),this.__pauseRaidsTab=this.__pauseContainer.findSingleWidgetWithName("btn_toggle_group"),this.__pauseRaidsTab.setEnabled(ue.getFUEManager().areRaidsEnabled()),this.__pauseMissionsTab.setClickHandler(this.__showPauseMissions.bind(this)),this.__pauseRaidsTab.setClickHandler(this.__showPauseRaids.bind(this)),this.__pauseResumeButton=this.__pauseContainer.findSingleWidgetWithName("btn_resume"),this.__pauseResumeButton.setClickHandler(this.__hideMenuHandler.bind(this)),this.__pauseRaidsTab.invalidate(),this.__quitButton=this.__pauseContainer.findSingleWidgetWithName("btn_quit").findSingleWidgetWithName("SimpleButtonWidget"),this.__quitButton.setClickHandler(this.__quitButtonHandler.bind(this)).setSoundSprite(this.__sounds).invalidate();var _=p.isMuted()||p.isMutedChannel("MASTER");this.__pauseSoundButton=this.__pauseContainer.findSingleWidgetWithName("btn_audio").findSingleWidgetWithName("button"),this.__pauseSoundButton.setOn(!_).setClickHandler(this.__soundButtonHandler.bind(this)).setSoundSprite(this.__sounds).invalidate(),this.__pauseContainer.findSingleWidgetWithName("score_label").setText("CURRENT SCORE"),this.__pauseContainer.invalidate(),this.__pauseScoreLabel=this.__pauseContainer.findSingleWidgetWithName("score_total"),this.__pauseCreditsContainer=this.__pauseContainer.findSingleWidgetWithName("credits"),this.__pauseCreditsLabel=this.__pauseCreditsContainer.findSingleWidgetWithName("count_total_credits");var m=Ge+0;this.__pauseCreditsLabel.setText(m),this.__missionsMessagingContainer=this.__pauseMissionsContainer.findSingleWidgetWithName("mission_messaging"),this.__missionsDailyMessagingContainer=this.__missionsMessagingContainer.findSingleWidgetWithName("finished_daily"),this.__missionsSetMessagingContainer=this.__missionsMessagingContainer.findSingleWidgetWithName("finished_set"),this.__missionsDailyTimer=this.__missionsDailyMessagingContainer.findSingleWidgetWithName("timer"),this.__missionsSetTimer=this.__missionsSetMessagingContainer.findSingleWidgetWithName("timer"),this.__missionsListContainer=this.__pauseMissionsContainer.findSingleWidgetWithName("mission_list");var f=this.__missionsListContainer.findSingleWidgetWithName("ListPanel"),E=ue.getMissionManager(),S=E.getMissionSet(),T=S.getMissions();this.__missionInstances=T.filter(function(e){return!e.completed}),this.__missionDescriptionViews.length=0;for(var C=0,I=f.getNumSlots();C<I;C++){var w,x=f.getSlotAtIndex(C).getWidget();C<this.__missionInstances.length?(x.setVisibility(c.VISIBLE),(w=T[C])||s.error("Could not find mission instance for slot index ",C)):x.setVisibility(c.HIDDEN),w||(w=new ge(new ce(1,pe.NORMAL,me.KILL_BRUISER,fe.TOTAL,1),0,!1,0));var P=new ve(x,w,this.__gameLogic.__gameBounds.width);this.__missionDescriptionViews.push(P)}S.setStartingRunProperties(),this.__releaseContainer=this._widget.findSingleWidgetWithName("release"),this.__releaseContainer.setVisibility(c.HIDDEN),this.__releaseContainer.setTransform(this.__releaseContainerTransform),this.__tipsContainer=this.__releaseContainer.findSingleWidgetWithName("tips"),this.__tipsLabel=this.__tipsContainer.findSingleWidgetWithName("tip"),this.__fueContainer=this._widget.findSingleWidgetWithName("fue_container"),this.__fuePopupSection=this.__fueContainer.findSingleWidgetWithName("dialog_container"),this.__fuePopupSection.setVisibility(c.HIDDEN),this.__fueArrow=this.__fueContainer.findSingleWidgetWithName("arrow"),this.__fueArrow.setVisibility(c.HIDDEN),this.__fueFuel=this.__fueContainer.findSingleWidgetWithName("fuel_container"),this.__fueFuel.setVisibility(c.HIDDEN),this.__fueFuel.findSingleWidgetWithName("fuel_glow").setVisibility(c.HIDDEN),this.__fueFuel.findSingleWidgetWithName("fuel_loss").setVisibility(c.HIDDEN),this.__fueDialogButton=this.__fueContainer.findSingleWidgetWithName("btn_dummy"),this.__fueDialogButton.setVisibility(c.HIDDEN),this.__fueFinger=this.__fueContainer.findSingleWidgetWithName("finger_root"),this.__fueFinger.addSlot(function(e){var t=a.__resourceManager.get(g.RESOURCE_TYPE,"element_tapToContinue"),i=t.construct();e.setAnchor(new l(0,0,1,1)),e.setOffset(new h(0,0,1,1)),e.setWidget(i)}),this.__fueFinger.setVisibility(c.HIDDEN),this.__fuePopupContainer=this.__fuePopupSection.findSingleWidgetWithName("dialog_root");for(var C=0,I=this.__fuePopupContainer.getNumSlots();C<I;C++)this.__fuePopupContainer.removeSlotAtIndex(0);if(this.__fuePopupContainer.addSlot(function(e){a.__fuePopupSlot=e}),this.__fueShipOverlay=this.__fueContainer.findSingleWidgetWithName("ship_overlay"),this.__fueShipOverlay.setVisibility(c.HIDDEN),this.__pauseButton=this.__releaseContainer.findSingleWidgetWithName("btn_pause"),this.__pauseButton.setClickHandler(this.__pauseButtonHandler.bind(this)).setSoundSprite(this.__sounds).invalidate(),this.__quitConfirmContainer=this._widget.findSingleWidgetWithName("quit_confirm"),this.__quitConfirmContainer.setVisibility(c.HIDDEN),this.__quitConfirmButton=this.__quitConfirmContainer.findSingleWidgetWithName("btn_yes"),this.__quitConfirmButton.setClickHandler(this.__quitConfirmButtonHandler.bind(this)).setSoundSprite(this.__sounds).invalidate(),this.__quitCancelButton=this.__quitConfirmContainer.findSingleWidgetWithName("btn_no"),this.__quitCancelButton.setClickHandler(this.__quitCancelButtonHandler.bind(this)).setSoundSprite(this.__sounds).invalidate(),this.__shipOverlay=this.__releaseContainer.findSingleWidgetWithName("ship_overlay"),this.__shipOverlay.setTransform(this.__shipOverlayTransform,!0),ue.getFUEManager().isFingerAnimationEnabled()){
this.__fingerWorld=this.__releaseContainer.findSingleWidgetWithName("finger_world");var N=this.__createWorld();this.__fingerWorld.setWorld(N);var V=ue.getSkeletonFactory();this.__releaseFinger=V.create("finger_tap",N,{attachParent:N.getScene().getRootComponent()}),this.__fingerSkeletonComponent=this.__releaseFinger.getComponent("SkeletonComponent"),this.__fingerSkeletonComponent.setTranslation(24,152),this.__fingerSkeletonComponent.setDefaultAnimation("animation"),this.__fingerSkeletonComponent.playAnimation("animation",!0)}this.__soundButton=this.__releaseContainer.findSingleWidgetWithName("btn_audio").findSingleWidgetWithName("button"),this.__soundButton.setOn(!_).setClickHandler(this.__soundButtonHandler.bind(this)).setSoundSprite(this.__sounds).invalidate();this._widget.findSingleWidgetWithName("play");this.__totalLabel.setText("0000000"),this._invalidate(),this.__bossFrameTab.setTransform(this.__bossFrameTabTransform,!0),this.__bossHealthBG.setTransform(this.__bossHealthBGTransform,!0),this.__bossFrameLeft.setTransform(this.__bossFrameLeftTransform,!0),this.__bossFrameRight.setTransform(this.__bossFrameRightTransform,!0),this.__bossHealthProgress.setTransform(this.__bossHealthProgressTransform,!0),this.__laserBeam=this.__laserManager.getLaserInfo(),this.__laserCard=this._widget.findSingleWidgetWithName("activeCardMain"),this.__laserCardShield=this._widget.findSingleWidgetWithName("button_shield"),this.__laserCardShield.setVisibility(c.VISIBLE),this.__activeOverlay=this._widget.findSingleWidgetWithName("active_overlay"),this.__activeOverlay.setTransform(this.__activeOverlayTransform,!0),this.__activeOverlay.setVisibility(c.HIDDEN);var B=this._widget.findSingleWidgetWithName("iconLock"),z=this._widget.findSingleWidgetWithName("charge_border"),X=this._widget.findSingleWidgetWithName("charge_BG");ue.getFUEManager().isLaserEnabled()?(this.__laserCard.setEnabled(!0),this.__energyProgressBar.setVisibility(c.VISIBLE),z.setVisibility(c.VISIBLE),X.setVisibility(c.VISIBLE),B.setVisibility(c.HIDDEN)):(this.__laserCard.setEnabled(!1),this.__energyProgressBar.setVisibility(c.HIDDEN),z.setVisibility(c.HIDDEN),X.setVisibility(c.HIDDEN),B.setVisibility(c.VISIBLE));var ne=this.__laserBeam.energyCost;this.__laserCard.findWidgetsWithName("label copy").forEach(function(e){e.setText(ne.toString())}),this.__laserCard.setClickHandler(this.__activateLaser.bind(this)).setSoundSprite(this.__sounds).setEnabled(!1).setTransform(this.__laserCardTransform,!0),this.__isShowingGold=!1;var oe=this._widget.findSingleWidgetWithName("coin_counter");this.__goldLabelTransform=new v,this.__goldLabel=oe.findSingleWidgetWithName("multiplier"),this.__goldLabel.setText(Ge+0),this.__goldLabel.setTransform(this.__goldLabelTransform,!0),this.__goldLineTransform=new v,this.__goldLine=oe.findSingleWidgetWithName("line"),this.__goldLine.setTransform(this.__goldLineTransform,!0),this.__goldBgTransform=new v,this.__goldBg=oe.findSingleWidgetWithName("BG"),this.__goldBg.setTransform(this.__goldBgTransform),this.__goldLabel.setVisibility(c.HIDDEN),this.__goldLine.setVisibility(c.HIDDEN),this.__goldBg.setVisibility(c.HIDDEN),this.__lastGoldPickupMS=0;var ae=this._widget.findSingleWidgetWithName("combo_counter");this.__comboLabel=ae.findSingleWidgetWithName("label3"),this.__comboCount=ae.findSingleWidgetWithName("multiplier"),this.__comboLabel.setTransform(this.__comboLabelTransform,!0),this.__comboCount.setTransform(this.__comboCountTransform,!0),this.__comboCountTransform.x+=65,this.__comboCountTransform.tx-=65,this.__comboCountTransform.saveOrigin(),this.__comboLabel.setVisibility(c.HIDDEN),this.__comboCount.setVisibility(c.HIDDEN),this.__comboLine=ae.findSingleWidgetWithName("line"),this.__comboLine.setTransform(this.__comboLineTransform,!0),this.__comboLine.setVisibility(c.HIDDEN),this.__killStreakBonusLeft=ae.findSingleWidgetWithName("label"),this.__killStreakBonusRight=ae.findSingleWidgetWithName("label2"),this.__killStreakBonusValue=ae.findSingleWidgetWithName("bonus"),this.__killStreakBonusLeft.setTransform(this.__killStreakBonusLeftTransform,!0),this.__killStreakBonusRight.setTransform(this.__killStreakBonusRightTransform,!0),this.__killStreakBonusValue.setTransform(this.__killStreakBonusValueTransform,!0),this.__killStreakBonusLeft.setVisibility(c.HIDDEN),this.__killStreakBonusRight.setVisibility(c.HIDDEN),this.__killStreakBonusValue.setVisibility(c.HIDDEN),this.__edgeGlowFlyouts=this._widget.findSingleWidgetWithName("edge_glow_flyouts"),this.__edgeGlowFlyouts.setTransform(this.__edgeGlowFlyoutsTransform,!0),this.__edgeGlowFlyouts.setVisibility(c.HIDDEN);for(var _e in this.__flyOuts)this.__flyOuts[_e]=this._widget.findSingleWidgetWithName(Be[_e]),this.__flyOuts[_e].setTransform(this.__flyOutTransforms[_e],!0),this.__flyOuts[_e].setVisibility(c.HIDDEN);this._widget.findSingleWidgetWithName("Combo_lost").setVisibility(c.HIDDEN),this.__activeCircle=this.__flyOuts.ACTIVE.findSingleWidgetWithName("frame_circle"),this.__activeCircle.setTransform(this.__activeCircleTransform,!0);var le=this.__flyOuts.ACTIVE.findSingleWidgetWithName("label1");r.isDesktopPlatform()?le.setText("DOUBLE CLICK TO USE"):le.setText("DOUBLE TAP TO USE"),this.__warningText=this.__flyOuts.BOSS.findSingleWidgetWithName("label1"),this.__warningText.setTransform(this.__warningTextTransform,!0),this.__coinMultipliersLeft=this.__playerManager.getPlayer().goldMultipliers;var he=this.__coinMultipliersLeft+" MORE RUN";this.__coinMultipliersLeft>1&&(he+="S"),this.__flyOuts.COIN_MULTIPLIER.findSingleWidgetWithName("run_count").setText(he),this.__powerupContainer=this._widget.findWidgetsWithName("powerups")[0];for(var de=this._widget.findSingleWidgetWithName("frame_popups"),Ee=0;Ee<4;++Ee){var Te="powerup"+(Ee+1),Ce=this.__powerupContainer.findSingleWidgetWithName(Te),Ie=de.findSingleWidgetWithName(Te),we=Ce.findSingleWidgetWithName("sprite"),be=Ie.findSingleWidgetWithName("frame");we.setTransform(this.__upgradeTransforms[Ee],!0),be.setTransform(this.__upgradeBorderTransforms[Ee],!0),this.__upgradeImageWidgets[Ee]=we,this.__upgradeBorderWidgets[Ee]=be}this.__missionFlyinView=new ye(this.__flyOuts.MISSION_COMPLETE);var Me=new d(0,0,1,1);if(this.__energyContainer.getGeometry(Me),r.debugFeatures[r.DEBUG_FEATURES.DEBUG_OVERLAY]){if("dev"===u.getUrlParams().mode){var xe=r.sdpToCss(Me.getY()),Re=document.createElement("div");Re.id="energy-instrument",Re.style.position="absolute",Re.style.left="0px",Re.style.top=xe+"px",Re.style.color="cyan",document.body.appendChild(Re),this.__energyDiv=Re}}},__fadeOut:function(e){this.__blackVeilTransform.setAction(y.sequence(y.fadeTo(0,0),y.fadeTo(1,e)))},__fadeIn:function(e){this.__blackVeilTransform.setAction(y.sequence(y.fadeTo(1,0),y.fadeTo(0,e)))},__handleContinue:function(){var e=this;return this.__gameLogic.continueHandler().then(function(t){return e.__fadeIn(250),Promise.resolve(t)})},__activateLaser:function(){var e=this.__eventManager.getNewEvent(X);e.setCardId(this.__laserBeam.name),this.__eventManager.queueEvent(e)},onExit:function(){this.__animations.length=0,this.__tournament=null,this.__timeoutContext.clearAll(),this.__fingerSkeletonComponent=null,this.__releaseFinger&&(this.__fingerWorld.__world.destroy(),this.__gameLogic.destroyEntity(this.__releaseFinger.getId()),this.__releaseFinger=null),R.prototype.onExit.call(this),this.__eventManager.unregisterEventHandler(H.EVENT_TYPE,this.__boundEntityDestroyedEventHandler),this.__eventManager.unregisterEventHandler(D.EVENT_TYPE,this.__boundBossEntityCreatedEventHandler),this.__eventManager.unregisterEventHandler(L.EVENT_TYPE,this.__boundBossSpawnedEventHandler),this.__eventManager.unregisterEventHandler(O.EVENT_TYPE,this.__boundBossClearedEventHandler),this.__eventManager.unregisterEventHandler(k.EVENT_TYPE,this.__boundComboUpdateEventHandler),this.__eventManager.unregisterEventHandler(F.EVENT_TYPE,this.__boundPlayerHealthEventHandler),this.__eventManager.unregisterEventHandler(W.EVENT_TYPE,this.__boundScoreChangedEventHandler),this.__eventManager.unregisterEventHandler(G.EVENT_TYPE,this.__boundDistanceChangedEventHandler),this.__eventManager.unregisterEventHandler(Y.EVENT_TYPE,this.__boundShowMenuHandler),this.__eventManager.unregisterEventHandler(q.EVENT_TYPE,this.__boundHideMenuHandler),this.__eventManager.unregisterEventHandler(U.EVENT_TYPE,this.__boundPlayerEnergyEventHandler),this.__eventManager.unregisterEventHandler(K.EVENT_TYPE,this.__boundKeyboardInputEventHandler),this.__eventManager.unregisterEventHandler(Q.EVENT_TYPE,this.__boundSystemUpgradeComboEventHandler),this.__eventManager.unregisterEventHandler(j.EVENT_TYPE,this.__boundInputActivateEventHandler),this.__eventManager.unregisterEventHandler(J.EVENT_TYPE,this.__boundPlayerDoneExplodingEventHandler),this.__eventManager.unregisterEventHandler($.EVENT_TYPE,this.__boundGameEndSequenceEventHandler),this.__eventManager.unregisterEventHandler(ee.EVENT_TYPE,this.__boundGoldChangedEvent),this.__eventManager.unregisterEventHandler(te.EVENT_TYPE,this.__boundMissionCompleteEvent),this.__eventManager.unregisterEventHandler(ie.EVENT_TYPE,this.__boundIntroStartEvent),this.__eventManager.unregisterEventHandler(re.EVENT_TYPE,this.__boundSpawnPopupDialogEventHandler),this.__eventManager.unregisterEventHandler(se.EVENT_TYPE,this.__boundInputStartedEventHandler),this.__showingQuitConfirmation=!1,this.__totalLabel=null,this.__modalBackground=null,this.__instructionLabel=null,this.__userRank=null,this.__arrScores=null,this.__health=null,this.__comboLabel=null,this.__comboCount=null,this.__killStreakBonusLeft=null,this.__killStreakBonusRight=null,this.__killStreakBonusValue=null,this.__energyContainer=null,this.__laserCard=null,this.__laserBeam=null,this.__pauseContainer=null,this.__quitButton=null,this.__pauseSoundButton=null,this.__pauseCreditsContainer=null,this.__pauseCreditsLabel=null,this.__releaseContainer=null,this.__tipsContainer=null,this.__tipsLabel=null,this.__pauseButton=null,this.__quitConfirmContainer=null,this.__quitConfirmButton=null,this.__quitCancelButton=null,this.__introMissionView=null,this.__raidProgressView=null,this.__bossFrameTab.setVisibility(c.HIDDEN),this.__bossHealthBG.setVisibility(c.HIDDEN),this.__bossFrameLeft.setVisibility(c.HIDDEN),this.__bossFrameRight.setVisibility(c.HIDDEN),this.__bossHealthProgress.setVisibility(c.HIDDEN),this.__killStreakBonusValueTransform.setAction(y.fadeTo(0,0)),this.__killStreakBonusLeftTransform.setAction(y.fadeTo(0,0)),this.__killStreakBonusRightTransform.setAction(y.fadeTo(0,0)),this.__shipOverlayTransform.reset(),this.__energyDiv&&document.body.removeChild(this.__energyDiv)},__playerDoneExplodingEventHandler:function(e){this.__fadeOut(500)},__soundButtonHandler:function(e){b.trackEvent("gqs","UI Event",{playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),interactionName:"sound"}),M.event("UI Event",{contextId:this.__playerManager.getContextId(),playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),interactionName:"sound"});var t=this.__eventManager.getNewEvent(z);t.setCategory(T.TOGGLE),t.setEnabled(e.isOn()),this.__eventManager.queueEvent(t),this.__soundButton.setOn(e.isOn()),this.__pauseSoundButton.setOn(e.isOn())},__systemUpgradeComboEventHandler:function(e){var t,i=e.getSystemType(),n=e.getComboLength(),r=this;if(0===n){this.__animateFlyIn("COMBO",{systemType:i});this.__animateUpgradeIn(3,i).addAction(y.sequence(y.callback(function(){for(var e=0;e<4;++e)r.__upgradeBorderTransforms[e].completeAction()}),y.wait(100),y.wait(100),y.callback(function(){for(var e=0;e<4;++e)r.__upgradeTransforms[e].setAction(y.sequence(y.wait(40*e),y.parallel(y.fadeTo(0,600),y.scaleTo(2,2,300,f.easeOut)),y.scaleTo(1,1,0)))})))}else if(1===n)if(this.__upgradesOccupied>0){for(var s=0;s<this.__upgradesOccupied;++s)t=this.__upgradeTransforms[s],t.completeAction(),t.setAction(y.sequence(y.moveTo(t.xOrigin,t.yOrigin,0),y.wait(500),y.parallel(y.moveBy(0,160,300,f.easeInOut),y.fadeTo(0,300))));var o=this.__upgradesOccupied;this.__setUpgradeImage(o,i),t=this.__upgradeTransforms[o];var a=this.__upgradeTransforms[0];t.completeAction(),t.setAction(y.sequence(y.parallel(y.moveTo(t.xOrigin,t.yOrigin+160,0),y.fadeTo(0,0)),y.parallel(y.moveBy(0,-160,300,f.easeInOut),y.fadeTo(1,300),y.sequence(y.wait(270),y.callback(function(){r.__animateBorderFrame(o,4248518911)}))),y.wait(200),y.parallel(y.moveTo(a.xOrigin,a.yOrigin,300,f.easeInOut),y.sequence(y.callback(function(){r.__animateBorderFrame(0);for(var e=1;e<4;++e)r.__upgradeBorderTransforms[e].completeAction()}))),y.callback(function(){r.__setUpgradeImage(0,i),a.completeAction(),a.setAction(y.parallel(y.moveTo(a.xOrigin,a.yOrigin,0),y.fadeTo(1,0))),a.completeAction(),r.__clearUpgradeImage(o)}),y.moveTo(t.xOrigin,t.yOrigin,0)))}else this.__animateUpgradeIn(0,i);else this.__animateUpgradeIn(n-1,i);this.__lastSystemType=i,this.__upgradesOccupied=n},__playerHealthEventHandler:function(e){var t=e.getOldHealth(),i=e.getNewHealth(),n=e.getMaxHealth(),r=t/n,s=i/n;this.__fuelProgress.setProgress(s),this.__fuelGlowProgress.setProgress(s+.008*(1-s)),e.getWasHit()?(this.__fuelLossProgressTween.setInitialValue(r),this.__fuelLossProgressTween.reset(),this.__tracersHitAction=y.tweenCallback(0,1,646,function(e){o.__tracers.setTintColor(w.lerp(4285822207,452645631,e))}),this.__tracersTransform.setAction(y.parallel(this.__tracersHitAction,this.__tracersPulseAction)),this.__edgeGlowHitTransform.setAction(he.createGlowHit())):this.__fuelLossProgressTweenGroup.isAnimating()||this.__fuelLossProgressTween.setInitialValue(s),this.__fuelLossProgressTween.setFinalValue(s),this.__fuelLossProgressTweenGroup.isAnimating()||this.__fuelLossProgressTweenGroup.addTweenable(this.__fuelLossProgressTween);var o=this;s<=.2&&r>.2?(this.__tracersPulseAction=y.sequence(y.wait(100),y.loop(y.tweenCallback(0,1,750,function(e){o.__tracers.setTintColor(w.lerp(452645631,4285822207,e))}),y.tweenCallback(0,1,750,function(e){o.__tracers.setTintColor(w.lerp(4285822207,452645631,e))}))),this.__tracersTransform.setAction(y.parallel(this.__tracersHitAction,this.__tracersPulseAction)),this.__edgeGlowPulseTransform.setAction(y.sequence(y.fadeTo(0,0),y.fadeTo(.4,100),y.loop(y.fadeTo(.6,750),y.callback(function(){o.__sounds.play("fuel_warning")}),y.fadeTo(.4,750))))):s>.2?(this.__tracersHitAction.isComplete()&&452645631!==this.__tracers.getTintColor()&&(this.__tracersPulseAction=y.sequence(y.tweenCallback(0,1,100,function(e){o.__tracers.setTintColor(w.lerp(4285822207,452645631,e))}))),this.__tracersTransform.setAction(y.parallel(this.__tracersHitAction,this.__tracersPulseAction)),this.__edgeGlowPulseTransform.setAction(y.fadeTo(0,100))):s<=0&&this.__edgeGlowPulseTransform.setAction(y.fadeTo(0,100))},__pulseActiveButton:function(){this.__laserCardTransform.setAction(y.loop(y.scaleTo(1.1,1.1,100,f.startBounce),y.scaleTo(1,1,100,f.startBounce),y.scaleTo(1.1,1.1,100,f.startBounce),y.scaleTo(1,1,100,f.startBounce),y.wait(2e3)))},__stopActiveButtonPulse:function(){this.__laserCardTransform.setAction(y.scaleTo(1,1,100))},__playerEnergyEventHandler:function(e){var t=e.getOldEnergy(),i=e.getNewEnergy();if(t!==P.MAXIMUM_ENERGY||i!==P.MAXIMUM_ENERGY){var n=this,r=this.__laserBeam.energyCost;this.__laserCard.getVisibility()===c.VISIBLE&&(i>=r&&!this.__laserCard.isEnabled()?(this.__animateFlyIn("ACTIVE"),this.__laserCard.setEnabled(!0),this.__laserCardShield.setVisibility(c.HIDDEN),this.__pulseActiveButton(),this.__sounds.play("lasers_ready")):i<r&&this.__laserCard.isEnabled()&&(this.__laserCard.setEnabled(!1),this.__laserCardShield.setVisibility(c.VISIBLE),this.__stopActiveButtonPulse()));var s=P.MAXIMUM_ENERGY,o=Math.max(0,Math.min(1,t/s)),a=Math.max(0,Math.min(1,i/s)),_=this.__energyTween,l=this.__energyTintTween;if(a<o){var h=1e3*this.__laserBeam.duration;_.setDuration(h),l.setDuration(h),l.setInitialValue(0),l.reset(),this.__laserCardShield.setVisibility(c.VISIBLE),this.__stopActiveButtonPulse(),this.__energyProgressBar.setTintColor(4294967295),this.__activeOverlay.setVisibility(c.VISIBLE),this.__activeOverlayTransform.setAction(y.sequence(y.fadeTo(0,0),y.loop(y.fadeTo(1,300),y.fadeTo(0,300)))),this.__energyTweenGroup.hasTweenable(l)||this.__energyTweenGroup.addTweenable(l,null,function(){n.__activeOverlayTransform.setAction(y.sequence(y.fadeTo(0,100),y.callback(function(){n.__activeOverlay.setVisibility(c.HIDDEN),n.__energyProgressBar.setTintColor(519754495),n.__laserCard.isEnabled()&&(n.__pulseActiveButton(),n.__laserCardShield.setVisibility(c.HIDDEN))})))})}this.__energyTweenGroup.hasTweenable(_)||this.__energyTweenGroup.addTweenable(_),l.isAnimating()||_.setDuration(200),_.setInitialValue(_.getValue()),_.setFinalValue(a),_.reset(),this.__energyDiv&&(this.__energyDiv.textContent=u.interpolate("Energy: {energy}",{energy:i}))}},__setUpgradeImage:function(e,t){this.__upgradeImageWidgets[e].setTextureRegion(this.__resourceManager.get(E.RESOURCE_TYPE,We[t])),this.__powerupContainer.invalidate()},__clearUpgrades:function(){for(var e=0;e<this.__upgradesOccupied;++e)this.__clearUpgrade(e);this.__upgradesOccupied=0},__clearUpgrade:function(e){this.__clearUpgradeImage(e);var t=this.__upgradeTransforms[e];t&&t.resetToOrigin();var i=this.__upgradeBorderWidgets[e];i&&i.setTintColor(4294967295);var n=this.__upgradeBorderTransforms[e];n&&n.resetToOrigin()},__clearUpgradeImage:function(e){this.__upgradeImageWidgets[e].clearTextureRegion()},__animateBorderFrame:function(e){var t=(this.__upgradeBorderWidgets[e],this.__upgradeBorderTransforms[e]);t.completeAction(),t.setAction(y.sequence(y.parallel(y.fadeTo(1,20),y.scaleTo(1.25,1.25,60,f.easeOut)),y.scaleTo(1,1,60,f.easeOut)))},__animateUpgradeIn:function(e,t){var i=this.__upgradeTransforms[e];i.completeAction();var n=this,r=y.sequence(y.parallel(y.fadeTo(0,0),y.moveTo(i.xOrigin,i.yOrigin+160,0)),y.callback(function(){n.__setUpgradeImage(e,t)}),y.parallel(y.moveBy(0,-160,300,f.easeInOut),y.fadeTo(1,300),y.sequence(y.wait(270),y.callback(function(){n.__animateBorderFrame(e)}))));return i.completeAction(),i.setAction(r),r},__scoreChangedEventHandler:function(e){var t=e.getTotalScore();this.__pauseScoreLabel.setText(t.toLocaleString());var i=""+t;i=u.withLeadingZeros(t,P.SCORE_DIGITS),this.__totalLabel.setText(i),this.__totalLabel.invalidate()},__goldChangedEvent:function(e){var t=e.getGold(),i=Ge+t;this.__pauseCreditsLabel.setText(i),this.__goldLabel.setText(i);var n=Date.now()-this.__lastGoldPickupMS;this.__lastGoldPickupMS=Date.now(),(n>=3e3||!this.__isShowingGold)&&this.__animateGoldIn()},__animateGoldIn:function(){var e=this;this.__isShowingGold=!0,this.__goldLineTransform.setAction(y.sequence(y.scaleTo(1,0,0),y.callback(function(){e.__goldLine.setVisibility(c.VISIBLE)}),y.scaleTo(1,1,200,f.easeOut))),this.__goldBgTransform.setAction(y.sequence(y.scaleTo(0,1,0),y.callback(function(){e.__goldBg.setVisibility(c.VISIBLE)}),y.wait(100),y.scaleTo(1,1,200))),this.__goldLabelTransform.setAction(y.sequence(y.fadeTo(0,0),y.scaleTo(1,1,0),y.callback(function(){e.__goldLabel.setVisibility(c.VISIBLE)}),y.wait(200),y.fadeTo(1,200)))},__animateGoldOut:function(){var e=this;this.__isShowingGold=!1,this.__goldLabelTransform.setAction(y.parallel(y.sequence(y.scaleTo(1.2,1.2,100),y.scaleTo(0,0,100)),y.sequence(y.fadeTo(0,200),y.callback(function(){e.__goldLabel.setVisibility(c.HIDDEN)})))),this.__goldBgTransform.setAction(y.sequence(y.wait(100),y.scaleTo(0,1,200),y.callback(function(){e.__goldBg.setVisibility(c.HIDDEN)}))),this.__goldLineTransform.setAction(y.sequence(y.wait(300),y.scaleTo(1,0,200),y.callback(function(){e.__goldLine.setVisibility(c.HIDDEN)})))},__distanceChangedEventHandler:function(e){var t=e.getTotalScore();this.__totalLabel.setText(t.toLocaleString()),this.__totalLabel.invalidate()},__keyboardInputEventHandler:function(e){e.getKeyPressed()===ae.ACTIVATE&&this.__activateLaser()},__tryChangeTip:function(){var e,t=ue.getFUEManager().getTooltips();if(e=t?t:He,0!==e.length){if(1===e.length)return this.__tipsLabel.setText(e[0]),void(this.__previousHint=r);var i=this.__previousHint,n=e.filter(function(e){return e!==i}),r=n[~~(Math.random()*n.length)];this.__tipsLabel.setText(r),this.__previousHint=r}},__showMenuHandler:function(){var e=this.__gameLogic.getShipPosition(),t=this.__gameLogic.getMapOffset(),i=Math.max(this.__gameLogic.__gameBounds.scaleFactor,this.__gameLogic.__gameBounds.invScaleFactor);if(this.__shipOverlayTransform.setAction(y.moveTo(e[0]+t,e[1]+P.SHIP_OVERLAY_OFFSET*i,0)),e[1]<0?this.__tipsContainer.setVisibility(c.HIDDEN):(this.__tryChangeTip(),this.__tipsContainer.setVisibility(c.VISIBLE)),this.__releaseContainer.getVisibility()!==c.VISIBLE&&!this.__gameLogic.__gamePaused){this.__sounds.play("spaceship_slowmo");var n=this,r=y.sequence(y.fadeTo(0,0),y.callback(function(){n.__releaseContainer.setVisibility(c.VISIBLE)}),y.wait(100),y.fadeTo(1,150,f.easeOut));this.__releaseContainerTransform.setAction(r)}},__hideMenuHandler:function(){if(!this.__showingQuitConfirmation){if(this.__sounds.play("spaceship_launch"),this.__releaseContainer.setVisibility(c.HIDDEN),this.__releaseContainerTransform.clearAction(),this.__hidePauseScreen(),ue.getFUEManager().isLaserEnabled()){var e=this.__laserBeam.energyCost,t=this.__gameLogic.getCurrentEnergy();this.__laserCard.setEnabled(t>=e)}else this.__laserCard.setEnabled(!1);this.__gameLogic.setGamePaused(!1)}},__showPauseScreen:function(){b.trackEvent("gqs","UI Event",{playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),interactionName:"pause"}),M.event("UI Event",{contextId:this.__playerManager.getContextId(),playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),interactionName:"pause"}),this.__pauseContainer.setVisibility(c.VISIBLE),o.isInEnum(this.__pauseTab,qe)||(this.__pauseTab=qe.MISSIONS),ue.getFUEManager().areRaidsEnabled()||(this.__pauseTab=qe.MISSIONS),this.__pauseTab===qe.MISSIONS?this.__showPauseMissions():this.__pauseTab===qe.RAIDS&&this.__showPauseRaids()},__hidePauseScreen:function(){this.__pauseContainer.setVisibility(c.HIDDEN),this.__cancelMissionMessagingTick()},__showPauseMissions:function(){this.__pauseTab=qe.MISSIONS,this.__pauseMissionsContainer.setVisibility(c.VISIBLE),this.__pauseMissionsFrame.setVisibility(c.VISIBLE),this.__pauseRaidsContainer.setVisibility(c.HIDDEN),this.__pauseRaidsFrame.setVisibility(c.HIDDEN),this.__pauseMissionsTab.setOn(!0),this.__pauseRaidsTab.setOn(!1);var e=ue.getMissionManager(),t=e.getMissionSet();if(t.isComplete()){this.__missionsMessagingContainer.setVisibility(c.VISIBLE),this.__missionsListContainer.setVisibility(c.HIDDEN);var i;t.getCompletedSets()>=de.MAX_COMPLETED_SETS?(this.__missionsSetMessagingContainer.setVisibility(c.HIDDEN),this.__missionsDailyMessagingContainer.setVisibility(c.VISIBLE),i=t.computeResetEpochMS()):(this.__missionsSetMessagingContainer.setVisibility(c.VISIBLE),this.__missionsDailyMessagingContainer.setVisibility(c.HIDDEN),i=t.computeMissionStartEpochMS()),this.__startMissionMessagingTick(i)}else{this.__missionsMessagingContainer.setVisibility(c.HIDDEN),this.__missionsListContainer.setVisibility(c.VISIBLE);var n=t.getMissions().slice().filter(function(e){return!e.completed||e.recentlyCompleted&&ue.getFUEManager().isFUEComplete()}),r=n.length,o=this.__missionDescriptionViews.length;r>o&&(s.error("The number of missions ",r," is larger than the number of mission description views ",o),r=o);for(var a=0;a<r;a++){var _=n[a];this.__missionDescriptionViews[a].setMissionInstance(_,!0,!1,!0)}}},__showPauseRaids:function(){this.__pauseTab=qe.RAIDS,this.__pauseMissionsContainer.setVisibility(c.HIDDEN),this.__pauseMissionsFrame.setVisibility(c.HIDDEN),this.__pauseRaidsContainer.setVisibility(c.VISIBLE),this.__pauseRaidsFrame.setVisibility(c.VISIBLE),this.__pauseMissionsTab.setOn(!1),this.__pauseRaidsTab.setOn(!0);var e=this.__raidManager.getProgression(),t=this.__raidManager.getContribution(this.__gameLogic.getStats());e.relativeProgress=Math.min(e.relativeProgress+t,e.relativeRequirement),this.__pauseRaidProgressView.refresh(e)},__startMissionMessagingTick:function(e){var t=this;this.__cancelMissionMessagingTick(),this.__missionMessagingTargetTimestamp=e,this.__missionMessagingTick(),this.__timeoutContext.setTimeout(function(){t.__missionMessagingTick(),t.__missionMessagingIntervalId=t.__timeoutContext.setInterval(t.__missionMessagingTick.bind(t),1e3)},1e3-Date.now()%1e3)},__cancelMissionMessagingTick:function(){this.__missionMessagingIntervalId&&(this.__timeoutContext.cancelInterval(this.__missionMessagingIntervalId),this.__missionMessagingIntervalId=null)},__missionMessagingTick:function(){var e=Math.max(0,this.__missionMessagingTargetTimestamp-Date.now()),t=~~(e/1e3),i=u.getTimeDisplayString(t,"-","hybridHours");this.__missionsDailyTimer.setText(i),this.__missionsSetTimer.setText(i),e<=0&&this.__cancelMissionMessagingTick()},__pauseButtonHandler:function(){this.__releaseContainer.setVisibility(c.HIDDEN),this.__showPauseScreen(),this.__laserCard.setEnabled(!1),this.__gameLogic.setGamePaused(!0)},__quitButtonHandler:function(){b.trackEvent("gqs","UI Event",{playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),interactionName:"quit"}),M.event("UI Event",{contextId:this.__playerManager.getContextId(),playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),interactionName:"quit"}),this.__quitConfirmContainer.setVisibility(c.VISIBLE),this.__quitButton.setEnabled(!1),this.__showingQuitConfirmation=!0},__quitConfirmButtonHandler:function(){ue.getMissionManager().getMissionSet().revertMissionProgress(),this.__gameLogic.resetGame(),this.__clearUpgrades(),this.__gameLogic.__handleComboBreak()},__quitCancelButtonHandler:function(){this.__quitConfirmContainer.setVisibility(c.HIDDEN),this.__quitButton.setEnabled(!0),this.__showingQuitConfirmation=!1},update:function(e){if(this.__blackVeilTransform.update(e),this.__bossHealthProgressTweenGroup.update(e),this.__bossHealthProgressTweenGroup.isAnimating())this.__bossHealthProgress.setProgress(+this.__bossHealthProgressTween);else if(this.__bossHealthProgress.getVisibility()===c.VISIBLE&&this.__bossEntity&&this.__bossEntity.isActive()){var t=this.__bossEntity.getComponent("ResourceComponent");if(t){var i=t.getResource(N.HEALTH)||0;this.__bossHealthProgress.setProgress(i/this.__maxBossHealth)}}if(this.__fingerSkeletonComponent){var n,r=this.__gameLogic.getSlowMotionMultiplier(e);n=0===r?0:1/r,this.__fingerSkeletonComponent.setPlaybackRate(n)}if(this.__isShowingGold){Date.now()-this.__lastGoldPickupMS>3e3&&this.__animateGoldOut()}this.__energyTweenGroup.update(e),this.__energyProgressBar.setProgress(.256*+this.__energyTween+.5),this.__fuelLossProgressTweenGroup.update(e),this.__fuelLossProgress.setProgress(+this.__fuelLossProgressTween-.01);for(var s in this.__flyOutTransforms)this.__flyOutTransforms[s].update(e);this.__activeOverlayTransform.update(e),this.__comboLabelTransform.update(e),this.__comboCountTransform.update(e),this.__comboLineTransform.update(e),this.__killStreakBonusLeftTransform.update(e),this.__killStreakBonusRightTransform.update(e),this.__killStreakBonusValueTransform.update(e),this.__laserCardTransform.update(e),this.__shipOverlayTransform.update(e),this.__gameOverDialog.isShowing()&&this.__gameOverDialog.update(e),this.__goldLineTransform.update(e),this.__goldBgTransform.update(e),this.__goldLabelTransform.update(e),this.__tracersTransform.update(e),this.__bossFrameTabTransform.update(e),this.__bossHealthBGTransform.update(e),this.__bossFrameLeftTransform.update(e),this.__bossFrameRightTransform.update(e),this.__bossHealthProgressTransform.update(e),this.__edgeGlowHitTransform.update(e),this.__edgeGlowPulseTransform.update(e),this.__edgeGlowFlyoutsTransform.update(e),this.__activeCircleTransform.update(e),this.__warningTextTransform.update(e),this.__edgeGlowTransform.alpha=Math.min(1,this.__edgeGlowPulseTransform.alpha+this.__edgeGlowHitTransform.alpha),this.__edgeGlowTransform.alpha>0?this.__edgeGlow.setVisibility(c.VISIBLE):this.__edgeGlow.setVisibility(c.HIDDEN);for(var o=0;o<this.__animations.length;++o)this.__animations[o].update(e);for(var o=0;o<4;++o)this.__upgradeTransforms[o].update(e),this.__upgradeBorderTransforms[o].update(e);this.__introMissionView&&this.__introMissionView.update(e),this.__releaseContainerTransform.update(e),this.__missionFlyinView&&this.__missionFlyinView.update(e)},__bossEntityCreatedEventHandler:function(e){this.__bossEntity=e.getBossEntity(),this.__bossEntityId=this.__bossEntity.getId();var t=this.__bossEntity.getComponent("ResourceComponent");this.__maxBossHealth=t?t.getResource(N.HEALTH)||1:1,this.__gameLogic.__boss&&this.__gameLogic.__boss.getId()===this.__bossEntityId||this.__animateBossHealthBarIn()},__animateBossHealthBarIn:function(){this.__bossFrameTab.setVisibility(c.VISIBLE),this.__bossFrameLeft.setVisibility(c.VISIBLE),this.__bossFrameRight.setVisibility(c.VISIBLE),this.__bossHealthBG.setVisibility(c.VISIBLE),this.__bossFrameTabTransform.alpha=0,this.__bossFrameTabTransform.setAction(y.sequence(y.fadeTo(1,150))),this.__bossFrameLeftTransform.setAction(y.sequence(y.scaleTo(1,0,0),y.wait(150),y.scaleTo(1,1,100))),this.__bossFrameRightTransform.setAction(y.sequence(y.moveTo(this.__bossFrameRightTransform.xOrigin,this.__bossFrameRightTransform.yOrigin,0),y.scaleTo(1,0,0),y.moveBy(-930,0,0),y.wait(150),y.scaleTo(1,1,100),y.wait(100),y.moveBy(930,0,500,f.easeOut)));var e=this;this.__bossHealthBGTransform.alpha=0,this.__bossHealthBGTransform.setAction(y.sequence(y.wait(600),y.fadeTo(1,100),y.callback(function(){e.__bossHealthProgressTweenGroup.isAnimating()||(e.__bossHealthProgress.setProgress(0),e.__bossHealthProgress.setVisibility(c.VISIBLE),e.__bossHealthProgressTween.reset(),e.__bossHealthProgressTweenGroup.addTweenable(e.__bossHealthProgressTween),e.__bossHealthProgressTransform.setAction(y.fadeTo(1,0)))})))},__bossSpawnedEventHandler:function(e){this.__animateFlyIn("BOSS"),this.__animateBossHealthBarIn()},__showFUEMissionComplete:function(e){if(e===me.COLLECT_FUEL){var t=this.__eventManager.getNewEvent(re);return t.setPopupType(Ne.FUEL_MISSION_COMPLETE),this.__eventManager.queueEvent(t),!0}if(e===me.KILL_MINIBOSS){var t=this.__eventManager.getNewEvent(re);return t.setPopupType(Ne.MINIBOSS_MISSION_COMPLETE),this.__eventManager.queueEvent(t),!0}return!1},__animateFlyIn:function(e,t){function i(e){s.__warningText.setTintColor(w.lerp(4278190335,4294967295,e))}function n(e){s.__warningText.setTintColor(w.lerp(4294967295,4278190335,e))}if(o.ifDefined.assertIsObject(t),t=t||De,"COMBO"===e);else if("MISSION_COMPLETE"===e&&!ue.getFUEManager().isMissionResetEnabled()){var r=this.__showFUEMissionComplete(t.mission.type);if(r)return}var s=this;if(this.__flyOutInProgress)return void this.__flyOutQueue.push([e,t]);this.__flyOutInProgress=!0;var a=this.__flyOuts[e],_=this.__flyOutTransforms[e];a.setVisibility(c.VISIBLE);var l=1400;if("BOSS"===e?(l=2100,this.__warningTextTransform.setAction(y.sequence(y.wait(300),y.callback(function(){s.__sounds.play("boss_warning_loop")}),y.parallel(y.sequence(y.scaleTo(1.2,1.2,250,f.startBounce),y.scaleTo(1,1,250,f.startBounce),y.scaleTo(1.2,1.2,250,f.startBounce),y.scaleTo(1,1,250,f.startBounce),y.scaleTo(1.2,1.2,250,f.startBounce),y.scaleTo(1,1,250,f.startBounce),y.scaleTo(1.2,1.2,250,f.startBounce),y.scaleTo(1,1,250,f.startBounce)),y.sequence(y.tweenCallback(0,1,250,i),y.tweenCallback(0,1,250,n),y.tweenCallback(0,1,250,i),y.tweenCallback(0,1,250,n),y.tweenCallback(0,1,250,i),y.tweenCallback(0,1,250,n),y.tweenCallback(0,1,250,i),y.tweenCallback(0,1,250,n)))))):"ACTIVE"===e&&this.__activeCircleTransform.setAction(y.sequence(y.wait(300),y.rotateBy(2*Math.PI,l/2))),
_.completeAction(),_.setAction(y.sequence(y.moveTo(_.xOrigin,_.yOrigin,0),he.createDialogBlinkIn(),y.wait(l),y.parallel(y.fadeTo(0,250),y.moveBy(0,660,300)),y.callback(function(){if(a.setVisibility(c.HIDDEN),s.__flyOutInProgress=!1,s.__flyOutQueue.length>0){_.clearAction();var e=s.__flyOutQueue.shift();s.__animateFlyIn.call(s,e[0],e[1])}}))),this.__edgeGlowFlyouts.setTintColor(ke[e]),"COMBO"===e){a.findSingleWidgetWithName("label1").setText(Ue[t.systemType]+" MAXED");var h=Fe[t.systemType];a.findSingleWidgetWithName("frame").setTintColor(h),this.__edgeGlowFlyouts.setTintColor(h),a.findSingleWidgetWithName("sprite").setTextureRegion(this.__resourceManager.get(E.RESOURCE_TYPE,We[t.systemType])),a.invalidate()}else if("MISSION_COMPLETE"===e){var u=t.mission;this.__missionFlyinView.setupAnimation(u)}this.__edgeGlowFlyouts.setVisibility(c.VISIBLE),this.__edgeGlowFlyoutsTransform.alpha=0,this.__edgeGlowFlyoutsTransform.setAction(y.sequence(he.createGlowHit(),y.callback(function(){s.__edgeGlowFlyouts.setVisibility(c.HIDDEN)})))},__entityDestroyedEventHandler:function(e){if(this.__bossEntity&&this.__bossEntityId===e.getEntityId()){this.__bossHealthBGTransform.setAction(y.sequence(y.fadeTo(0,100))),this.__bossHealthProgressTransform.setAction(y.sequence(y.fadeTo(0,100)));var t=this;this.__bossFrameTabTransform.setAction(y.sequence(y.wait(800),y.fadeTo(0,150),y.callback(function(){t.__bossFrameTab.setVisibility(c.VISIBLE),t.__bossFrameLeft.setVisibility(c.VISIBLE),t.__bossFrameRight.setVisibility(c.VISIBLE),t.__bossHealthBG.setVisibility(c.VISIBLE),t.__bossHealthProgress.setVisibility(c.VISIBLE)}))),this.__bossFrameLeftTransform.setAction(y.sequence(y.wait(700),y.scaleTo(1,0,100))),this.__bossFrameRightTransform.setAction(y.sequence(y.wait(100),y.moveBy(-930,0,500,f.easeOut),y.wait(100),y.scaleTo(1,0,100))),this.__bossEntity=null,this.__bossEntityId=-1}},__bossClearedEventHandler:function(e){var t=e.getEntityId(),i=this;this.__timeoutContext.setTimeout(function(){var e=i.__eventManager.getNewEvent(V);e.setEntityId(t),i.__eventManager.queueEvent(e)},P.BOSS_PINATA_DELAY_MS),this.__timeoutContext.setTimeout(function(){var e=i.__eventManager.getNewEvent(B);i.__eventManager.queueEvent(e)},P.BOSS_DEATH_DELAY_MS)},__gameEndSequenceEventHandler:function(e){this.__gameOverDialog.show(this.__dialogManager,e.getShowContinue(),e.getGoldCollected(),e.getScore())},__gameResetEventHandler:function(e){this.__clearUpgrades(),this.__gameOverDialog.isShowing()&&this.__gameOverDialog.close()},__missionCompleteEvent:function(e){this.__animateFlyIn("MISSION_COMPLETE",{mission:e.getMissionInstance()}),this.__sounds.play("mission_complete")},__comboUpdateEventHandler:function(e){var t=e.getCount(),i=(e.getMultiplier(),e.getBonus());t>=this.__gameLogic.getGameParameters().maxComboDisplay?this.__comboCount.setText("MAX"):t>0&&this.__comboCount.setText("x"+t);var n=this;if(10===t)this.__comboLineTransform.setAction(y.sequence(y.scaleTo(1,0,0),y.callback(function(){n.__comboLine.setVisibility(c.VISIBLE)}),y.scaleTo(1,1,300,f.easeOut))),this.__comboLabelTransform.setAction(y.sequence(y.moveTo(this.__comboLabelTransform.xOrigin+300,this.__comboLabelTransform.yOrigin,0),y.fadeTo(0,0),y.callback(function(){n.__comboLabel.setVisibility(c.VISIBLE),n.__comboCount.setVisibility(c.VISIBLE)}),y.wait(300),y.parallel(y.fadeTo(1,150),y.moveBy(-300,0,200,f.easeOut)))),this.__comboCountTransform.setAction(y.sequence(y.moveTo(this.__comboCountTransform.xOrigin+300,this.__comboCountTransform.yOrigin,0),y.fadeTo(0,0),y.callback(function(){n.__comboLabel.setVisibility(c.VISIBLE),n.__comboCount.setVisibility(c.VISIBLE)}),y.wait(300),y.parallel(y.fadeTo(1,150),y.moveBy(-300,0,200,f.easeOut))));else if(0===t){var r=200;this.__comboLabelTransform.setAction(y.sequence(y.moveTo(this.__comboLabelTransform.xOrigin,this.__comboLabelTransform.yOrigin,0),y.fadeTo(0,200),y.callback(function(){n.__comboLabel.setVisibility(c.HIDDEN)}))),this.__comboCountTransform.setAction(y.sequence(y.moveTo(this.__comboCountTransform.xOrigin,this.__comboCountTransform.yOrigin,0),y.parallel(y.fadeTo(0,200),y.moveBy(0,200,200)),y.callback(function(){n.__comboCount.setVisibility(c.HIDDEN)}))),i>0&&(this.__killStreakBonusValue.setText("+"+i),this.__killStreakBonusValueTransform.setAction(y.sequence(y.moveTo(this.__killStreakBonusValueTransform.xOrigin,this.__killStreakBonusValueTransform.yOrigin-200,0),y.fadeTo(0,0),y.callback(function(){n.__killStreakBonusValue.setVisibility(c.VISIBLE)}),y.parallel(y.fadeTo(1,200),y.moveBy(0,200,200)),y.scaleTo(1.6,1.6,80,f.startBounce),y.scaleTo(1,1,80,f.startBounce),y.wait(840),y.parallel(y.fadeTo(0,200),y.moveBy(300,0,200)),y.callback(function(){n.__killStreakBonusValue.setVisibility(c.HIDDEN)}))),this.__killStreakBonusLeftTransform.setAction(y.sequence(y.moveTo(this.__comboLabelTransform.xOrigin,this.__comboLabelTransform.yOrigin,0),y.fadeTo(0,0),y.callback(function(){n.__killStreakBonusLeft.setVisibility(c.VISIBLE)}),y.parallel(y.fadeTo(1,200),y.moveTo(this.__killStreakBonusLeftTransform.xOrigin,this.__killStreakBonusLeftTransform.yOrigin,200)),y.wait(1e3),y.parallel(y.fadeTo(0,200),y.moveBy(300,0,200)),y.callback(function(){n.__killStreakBonusLeft.setVisibility(c.HIDDEN)}))),this.__killStreakBonusRightTransform.setAction(y.sequence(y.moveTo(this.__comboLabelTransform.xOrigin,this.__comboLabelTransform.yOrigin,0),y.fadeTo(0,0),y.callback(function(){n.__killStreakBonusRight.setVisibility(c.VISIBLE)}),y.parallel(y.fadeTo(1,200),y.moveTo(this.__killStreakBonusRightTransform.xOrigin,this.__killStreakBonusRightTransform.yOrigin,200)),y.wait(1e3),y.parallel(y.fadeTo(0,200),y.moveBy(300,0,200)),y.callback(function(){n.__killStreakBonusRight.setVisibility(c.HIDDEN)}))),r=1400),this.__comboLineTransform.getAction()&&!this.__comboLineTransform.getAction().isComplete()||this.__comboLineTransform.setAction(y.sequence(y.wait(r),y.scaleTo(1,0,300,f.easeOut),y.callback(function(){n.__comboLine.setVisibility(c.HIDDEN)})))}else t>10&&this.__comboCountTransform.setAction(y.sequence(y.fadeTo(1,0),y.moveTo(this.__comboCountTransform.xOrigin,this.__comboCountTransform.yOrigin,0),y.scaleTo(1.6,1.6,80,f.easeOut),y.scaleTo(1,1,80,f.easeOut)))},__showFUEDialog:function(e,t){function i(){n.__fuePopupSection.setVisibility(c.HIDDEN),t||n.__fueDialogButton.setVisibility(c.HIDDEN),e.close()}o.ifDefined.assertIsNumber(t),this.__fuePopupSection.setVisibility(c.VISIBLE),Ce.showDialog(e,this.__fuePopupSlot),this.__fueContainer.invalidate();var n=this;if(t)this.__timeoutContext.setTimeout(i,t);else{var r=this.__eventManager.getNewEvent(oe,1);this.__eventManager.queueEvent(r),this.__fueDialogButton.setVisibility(c.VISIBLE),this.__fueDialogButton.setClickHandler(i)}return e.waitForClosed()},__hideReleaseDetail:function(){this.__fingerWorld&&this.__fingerWorld.setVisibility(c.HIDDEN),this.__shipOverlay.setVisibility(c.HIDDEN),this.__pauseButton.setVisibility(c.HIDDEN)},__showReleaseDetail:function(){this.__fingerWorld&&this.__fingerWorld.setVisibility(c.VISIBLE),this.__shipOverlay.setVisibility(c.VISIBLE),this.__pauseButton.setVisibility(c.VISIBLE)},__spawnPopupDialogEventHandler:function(e){var t=this,i=e.getPopupType();if(i===Ne.RUN_1_INTRO){var n=new Ie,r=new we,s=new be;this.__fueFinger.setVisibility(c.VISIBLE),this.__hideReleaseDetail(),this.__showFUEDialog(n).then(function(){return t.__fueFuel.setVisibility(c.VISIBLE),t.__fueArrow.setVisibility(c.VISIBLE),t.__showFUEDialog(r).then(function(){t.__fueFuel.setVisibility(c.HIDDEN),t.__fueArrow.setVisibility(c.HIDDEN)})}).then(function(){return t.__fueFinger.setVisibility(c.HIDDEN),t.__fueShipOverlay.setVisibility(c.VISIBLE),t.__closeDialogOnTapAndHold=s,t.__showFUEDialog(s,36e5)}).then(function(){t.__fueShipOverlay.setVisibility(c.HIDDEN),t.__showReleaseDetail()})}else if(i===Ne.FUEL_MISSION_COMPLETE){var o=new Me;this.__showFUEDialog(o,3e3)}else if(i===Ne.RUN_2_INTRO){var a=new xe,_=new Re,l=new Pe;this.__fueFinger.setVisibility(c.VISIBLE),this.__hideReleaseDetail(),this.__showFUEDialog(a).then(function(){return t.__showFUEDialog(_)}).then(function(){return t.__fueFinger.setVisibility(c.HIDDEN),t.__fueShipOverlay.setVisibility(c.VISIBLE),t.__closeDialogOnTapAndHold=l,t.__showFUEDialog(l,36e5)}).then(function(){t.__fueShipOverlay.setVisibility(c.HIDDEN),t.__showReleaseDetail()})}else if(i===Ne.MINIBOSS_MISSION_COMPLETE){var h=new Ae;this.__showFUEDialog(h,3e3)}else Ee.showMessage("FUE Dialog","FUE Dialog type `"+i+"` unimplemented")},__inputStartedEventHandler:function(){this.__closeDialogOnTapAndHold&&(this.__closeDialogOnTapAndHold.close(),this.__fuePopupSection.setVisibility(c.HIDDEN),this.__closeDialogOnTapAndHold=null)},__introStartEvent:function(e){var t=this,i=Promise.resolve();ue.getFUEManager().areRaidsEnabled()&&!this.__raidManager.isComplete()&&(i=i.then(this.__showRaidIntro.bind(this))),this.__missionInstances.length>0&&(i=i.then(this.__showMissionIntro.bind(this))),this.__coinMultipliersLeft>0&&i.then(this.__animateFlyIn.bind(this,"COIN_MULTIPLIER")),i.then(function(){var e=t.__eventManager.getNewEvent(ne);t.__eventManager.queueEvent(e)})},__showRaidIntro:function(){var e=this.__flyOuts.RAID,t=this.__flyOutTransforms.RAID;if(!this.__raidProgressView){var i=this.__flyOuts.RAID.findSingleWidgetWithName("groupChallenge_panel");this.__raidProgressView=new Se(i)}return this.__raidProgressView.refresh(),new Promise(function(i,n){e.setVisibility(c.VISIBLE),t.setAction(y.sequence(y.scaleTo(1,0,0),y.fadeTo(0,0),y.parallel(y.fadeTo(1,Le),y.scaleTo(1,1,Le)),y.wait(Oe),y.parallel(y.fadeTo(0,Le),y.scaleTo(1,0,Le)),y.callback(function(){i()})))})},__showMissionIntro:function(){var e=this,t=ue.getFUEManager(),i=t.showMissionIntro();return 0!==this.__missionInstances.length&&i?new Promise(function i(n,r){var i=e.__flyOuts.MISSION_INTRO,s=e.__flyOutTransforms.MISSION_INTRO;i.setVisibility(c.VISIBLE);var o=t.isSlowRunIntro()?Ve:Oe;s.setAction(y.sequence(y.scaleTo(1,0,0),y.fadeTo(0,0),y.parallel(y.fadeTo(1,Le),y.scaleTo(1,1,Le)),y.callback(function(){e.__slideInMissions.bind(e)(e.__missionInstances,o)}),y.wait(e.__missionInstances.length*o),y.parallel(y.fadeTo(0,Le),y.scaleTo(1,0,Le)),y.callback(function(){i.setVisibility(c.HIDDEN),n()})))}):Promise.resolve()},__slideInMissions:function(e){function t(a){var _=e[a];r.__introMissionView?r.__introMissionView.setMissionInstance(_):r.__introMissionView=new ve(i,_,r.__gameLogic.__gameBounds.width);var l=r.__introMissionView.slidePast(o);a+=1,a<s&&l.then(function(){t(a)}),n.invalidate()}var i=this.__flyOuts.MISSION_INTRO.findSingleWidgetWithName("mission1"),n=this.__flyOuts.MISSION_INTRO.findSingleWidgetWithName("mission_list"),r=this,s=e.length,o=ue.getFUEManager().isSlowRunIntro()?Ve:Oe;t(0)}})}),define("ui/views/AchievementView",["require","exports","module","thor/core/Class","thor/config/Config","thor/core/Validation","thor/resources/ResourceManager","thor/ui/Slot","thor/ui/Anchor","thor/ui/Widget","thor/ui/Widget","thor/ui/resources/WidgetResource","thor/graphics/resources/TextureRegionResource","Constants"],function(e,t,i){var n,r=e("thor/core/Class"),s=(e("thor/config/Config"),e("thor/core/Validation"),e("thor/resources/ResourceManager"),e("thor/ui/Slot"),e("thor/ui/Anchor")),o=(e("thor/ui/Widget"),e("thor/ui/Widget").VISIBILITY),a=e("thor/ui/resources/WidgetResource"),_=e("thor/graphics/resources/TextureRegionResource"),l=e("Constants"),h={0:1079931903,1:4294967295,2:4241658367,3:4255920383},u=i.exports=r.create({initialize:function(e,t){this._widget=e,this._resourceManager=t,this._iconContainer=this._widget.findSingleWidgetWithName("award_icon"),this._awardIcon=this._iconContainer.findSingleWidgetWithName("icon"),this._tierIcons={1:this._iconContainer.findSingleWidgetWithName("tier1_icon"),2:this._iconContainer.findSingleWidgetWithName("tier2_icon"),3:this._iconContainer.findSingleWidgetWithName("tier3_icon")},this._glow=this._iconContainer.findSingleWidgetWithName("glow"),this._name=this._widget.findSingleWidgetWithName("award_name"),this._description=this._widget.findSingleWidgetWithName("award_description"),this._progressLabel=this._widget.findSingleWidgetWithName("award_progress"),this._progressBar=this._widget.findSingleWidgetWithName("ProgressBarWidget")},show:function(e){this._name.setText(e.name).invalidate(),this._description.setText(e.description).invalidate(),e.progress<e.requirement?this._progressLabel.setText(e.progress.toLocaleString()+"/"+e.requirement.toLocaleString()):this._progressLabel.setText(e.progress.toLocaleString());for(var t=this.getMaxUnlockedTier(e),i=1;i<=l.MAX_ACHIEVEMENT_TIER;++i){var n=this._tierIcons[i],r=i<=t;n.setVisibility(r?o.VISIBLE:o.HIDDEN),n.invalidate()}var s="icon_"+e.type.toLowerCase().replace(" ","_"),a=this._resourceManager.get(_.RESOURCE_TYPE,s);this._awardIcon.setTextureRegion(a).invalidate(),this._iconContainer.setTintColor(h[t]),this._glow.setVisibility(t===l.MAX_ACHIEVEMENT_TIER?o.VISIBLE:o.HIDDEN);var u=Math.min(e.progress,e.requirement)/e.requirement;this._progressBar.setProgress(u),this._widget.invalidate()},getMaxUnlockedTier:function(e){return e.progress>=e.requirement?e.tier:e.tier-1},getWidget:function(){return this._widget}});i.exports.addToContainer=function(e,t){return new Promise(function(i,n){e.addSlot(function(e){i(u.create(e,t))})})},i.exports.create=function(e,t){n||(n=t.get(a.RESOURCE_TYPE,"screen_awards_listentry"));var i=n.construct();return e.setAnchor&&e.setAnchor(new s(0,0,1,1)),e.setWidget(i),new u(i,t)}}),define("ui/states/AchievementState",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","Constants","thor/config/Config","thor/ui/Panel","thor/resources/ResourceManager","thor/ui/resources/WidgetResource","thor/util/JSONLoader","thor/platforms/Google","thor/analytics/Seidr","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","./UIState","thor/event/EventManager","player/PlayerManager","AchievementManager","ui/views/DotGridView","ui/views/AchievementView","ui/WalletView","events/TransitionUIStateEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("Constants"),e("thor/config/Config"),e("thor/ui/Panel"),e("thor/resources/ResourceManager"),e("thor/ui/resources/WidgetResource")),s=(e("thor/util/JSONLoader"),e("thor/platforms/Google")),o=e("thor/analytics/Seidr"),a=e("thor/audio/SoundSprite"),_=e("thor/audio/SoundSpriteResourceLoader"),l=e("./UIState"),h=(e("thor/event/EventManager"),e("player/PlayerManager"),e("AchievementManager"),e("ui/views/DotGridView")),u=e("ui/views/AchievementView"),c=e("ui/WalletView"),d=e("events/TransitionUIStateEvent");i.exports=n.create(l,{initialize:function(e,t,i,n,s,o,h){l.prototype.initialize.call(this,e),this.__eventManager=i,this.__resourceManager=t,this.__playerManager=s,this.__achievementManager=o;var u=t.get(r.RESOURCE_TYPE,"screen_awards");this.__sounds=t.getOrDefault(_.RESOURCE_TYPE,"game_sounds",a.EMPTY_SOUND_SPRITE),this.__widgetResource=u,this.__walletView=new c(h)},_constructWidget:function(){return this.__widgetResource.construct()},onEnter:function(){l.prototype.onEnter.call(this,!1),s.trackEvent("gqs","Screen Events",{playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),screenName:"achievement"}),o.event("Screen Events",{contextId:this.__playerManager.getContextId(),playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),screenName:"achievement"});var e=this,t=this._widget.findSingleWidgetWithName("BG_dots");this.__dotView=new h(t),this.__backButton=this._widget.findSingleWidgetWithName("btn_back").findSingleWidgetWithName("button"),this.__backButton.setClickHandler(this._onBack.bind(this));var i=this._widget.findSingleWidgetWithName("top_tray");this.__walletView.attach(i),this.__walletView.resume();this._widget.findSingleWidgetWithName("top_tray").findSingleWidgetWithName("player_level");this.__updatePlayerLevelXP(),this.__achievementList=this._widget.findSingleWidgetWithName("ships_scroll").findSingleWidgetWithName("HListPanel"),this.__achievementList.setSpacing(25),this._invalidate();var n=this.__achievementManager.getAchievementsForDisplay(),r=[];for(var a in n){var _=n[a];r.push(this._addAchievementToList(_))}r.push(this.__playerManager.clearAchievementSeenFlags()),Promise.all(r).then(function(){e._widget&&e._invalidate()})},onExit:function(){l.prototype.onExit.call(this),this.__walletView.detach(),this.__dotView.destroy(),delete this.__dotView},_onBack:function(){this.__sounds.play("back");var e=this.__eventManager.getNewEvent(d);e.setState("Home"),this.__eventManager.queueEvent(e)},_addAchievementToList:function(e){return u.addToContainer(this.__achievementList,this.__resourceManager).then(function(t){t.show(e)})},__updatePlayerLevelXP:function(){var e=this.__playerManager.getPlayerLevel(),t=this.__playerManager.getPlayerXP();this.__walletView.setLevelXP(e,t)},update:function(e){this.__dotView.update(e)}})}),define("ui/states/LeaderboardState",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","Constants","thor/config/Config","thor/ui/Panel","thor/resources/ResourceManager","thor/ui/resources/WidgetResource","thor/util/JSONLoader","thor/platforms/Google","thor/analytics/Seidr","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","./UIState","thor/event/EventManager","player/PlayerManager","LeaderboardManager","ui/views/DotGridView","ui/WalletView","events/GameResetEvent","events/TransitionUIStateEvent"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Logger").getLogger(i),e("thor/core/Validation"),e("Constants"),e("thor/config/Config"),e("thor/ui/Panel"),e("thor/resources/ResourceManager"),e("thor/ui/resources/WidgetResource")),s=(e("thor/util/JSONLoader"),e("thor/platforms/Google")),o=e("thor/analytics/Seidr"),a=e("thor/audio/SoundSprite"),_=e("thor/audio/SoundSpriteResourceLoader"),l=e("./UIState"),h=(e("thor/event/EventManager"),e("player/PlayerManager"),e("LeaderboardManager")),u=e("ui/views/DotGridView"),c=e("ui/WalletView"),d=(e("events/GameResetEvent"),e("events/TransitionUIStateEvent"));i.exports=n.create(l,{initialize:function(e,t,i,n,s,o){l.prototype.initialize.call(this,e),this.__eventManager=i,this.__resourceManager=t,this.__playerManager=s;var h=t.get(r.RESOURCE_TYPE,"scene_rank");this.__sounds=t.getOrDefault(_.RESOURCE_TYPE,"game_sounds",a.EMPTY_SOUND_SPRITE),this.__widgetResource=h,this.__walletView=new c(o)},_constructWidget:function(){return this.__widgetResource.construct()},onEnter:function(){l.prototype.onEnter.call(this,!1),s.trackEvent("gqs","Screen Events",{playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),screenName:"Leaderboard"}),o.event("Screen Events",{contextId:this.__playerManager.getContextId(),playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),screenName:"Leaderboard"});var e=this,t=this._widget.findSingleWidgetWithName("BG_dots");this.__dotView=new u(t),this.__backButton=this._widget.findSingleWidgetWithName("btn_back").findSingleWidgetWithName("button"),this.__backButton.setClickHandler(this._onBack.bind(this));var i=this._widget.findSingleWidgetWithName("top_tray");this.__walletView.attach(i),this.__walletView.resume();this._widget.findSingleWidgetWithName("top_tray").findSingleWidgetWithName("player_level");this.__updatePlayerLevelXP(),this.__leaderboardScroll=this._widget.findSingleWidgetWithName("leader_scroll"),this.__leaderboardList=this.__leaderboardScroll.getNamedSlot("content").getWidget(),this._invalidate(),h.generateLeaderboardEntries(h.LEADERBOARD_PAGE_LIMIT).then(function(){return h.setupLeaderboardListWidget(e.__leaderboardScroll,e.__leaderboardList)}).then(function(){e._invalidate()})},onExit:function(){l.prototype.onExit.call(this),this.__walletView.detach(),this.__dotView.destroy(),delete this.__dotView},_onBack:function(){this.__sounds.play("back");var e=this.__eventManager.getNewEvent(d);e.setState("Home"),this.__eventManager.queueEvent(e)},__updatePlayerLevelXP:function(){var e=this.__playerManager.getPlayerLevel(),t=this.__playerManager.getPlayerXP();this.__walletView.setLevelXP(e,t)},update:function(e){this.__dotView.update(e)}})}),define("ui/MessageDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/resources/ResourceManager","ui/GalatronDialog"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/resources/ResourceManager"),e("ui/GalatronDialog"));i.exports=n.create(r,{initialize:function(e,t,i){r.prototype.initialize.call(this,e,"popup_generic"),this.__resourceManager=e,this._widget.findSingleWidgetWithName("btn_yes").setClickHandler(this.close.bind(this)),this._widget.findSingleWidgetWithName("heading").setText(t),this._widget.findSingleWidgetWithName("body").setText(i),this._closableByModalClick=!0},show:function(e){r.prototype.show.call(this,e)}})}),define("ui/views/SmallCardView",["require","exports","module","thor/core/Class","thor/config/Config","thor/core/Validation","ManagerRepository","thor/ui/Slot","thor/ui/Anchor","thor/ui/Widget","thor/ui/Widget","thor/ui/resources/WidgetResource","thor/graphics/resources/TextureRegionResource","thor/graphics/animation/Transform","thor/graphics/animation/actions/Actions","thor/graphics/animation/EasingFunctions","ui/CommonActions","cards/CardInstance","cards/CardRarityEnum","cards/CardParameters"],function(e,t,i){var n,r=e("thor/core/Class"),s=(e("thor/config/Config"),e("thor/core/Validation"),e("ManagerRepository")),o=(e("thor/ui/Slot"),e("thor/ui/Anchor")),a=(e("thor/ui/Widget"),e("thor/ui/Widget").VISIBILITY),_=e("thor/ui/resources/WidgetResource"),l=e("thor/graphics/resources/TextureRegionResource"),h=e("thor/graphics/animation/Transform"),u=e("thor/graphics/animation/actions/Actions"),c=(e("thor/graphics/animation/EasingFunctions"),e("ui/CommonActions")),d=(e("cards/CardInstance"),e("cards/CardRarityEnum")),g=(e("cards/CardParameters"),i.exports=r.create({initialize:function(e){this.__shouldAnimate=!1,this._widget=e,this.__optionsButton=e.findSingleWidgetWithName("options_button"),this.__newTag=e.findSingleWidgetWithName("new_tag"),this.__animGlow=e.findSingleWidgetWithName("anim_glow"),this.__cardAvailable=e.findSingleWidgetWithName("card_available"),this.__availableUpgradeIcon=this.__cardAvailable.findSingleWidgetWithName("upgrade_icon"),this.__availableFrame=this.__cardAvailable.findWidgetsWithName("frame")[0],this.__availableLevel=this.__cardAvailable.findSingleWidgetWithName("card_level"),this.__cardUnavailable=e.findSingleWidgetWithName("card_unavailable"),this.__unavailableUpgradeIcon=this.__cardUnavailable.findSingleWidgetWithName("upgrade_icon"),this.__unavailabledLocked=this.__cardUnavailable.findSingleWidgetWithName("card_locked"),this.__unavailableLevel=this.__unavailabledLocked.findSingleWidgetWithName("level")},show:function(e,t,i){var n=this;this.__optionsButton.setClickHandler(function(){e.newFlag=!1,n.__newTag.setVisibility(a.HIDDEN),i()}),this.__animGlow.setVisibility(a.HIDDEN);var r=t.cardTypes[e.id],o=s.getResourceManager();if(o.has(l.RESOURCE_TYPE,r.imageName)){var _=o.get(l.RESOURCE_TYPE,r.imageName);this.__availableUpgradeIcon.setTextureRegion(_)}this.__availableFrame.setTintColor(d.getColor(r.rarity)),this.__availableLevel.setText("LEVEL "+(e.level+1)),this.__cardUnavailable.setVisibility(a.HIDDEN),this.__newTag.setVisibility(e.newFlag?a.VISIBLE:a.HIDDEN);var h=t.rarities[r.rarity][e.level],u=s.getPlayerManager().getPlayerParts()/h.requiredParts,c=!t.cardLevels[e.id][e.level+1],g=s.getFUEManager();this.__shouldAnimate=g.isInEquipSequence()&&!g.hasLeveledUpCard()&&u>=1&&!c,this.__shouldAnimate&&this.tryAnimateFlash(),this._widget.invalidate()},showUnavailable:function(e,t,i,n){this.__optionsButton.setClickHandler(n),this.__cardAvailable.setVisibility(a.HIDDEN),this.__animGlow.setVisibility(a.HIDDEN);var r=t.cardTypes[e],o=r.imageName;r.rarity>=d.EPIC&&(o="icon_mystery_epic");var _=s.getResourceManager();if(_.has(l.RESOURCE_TYPE,o)){var h=_.get(l.RESOURCE_TYPE,o);this.__unavailableUpgradeIcon.setTextureRegion(h)}i>=r.minPlayerLevel?this.__unavailabledLocked.setVisibility(a.HIDDEN):this.__unavailableLevel.setText("LEVEL "+r.minPlayerLevel.toLocaleString()),this.__newTag.setVisibility(a.HIDDEN),this._widget.invalidate()},tryAnimateFlash:function(){this.__shouldAnimate&&(this.__animGlow.setVisibility(a.VISIBLE),this.__transform=new h,this.__transform.setAction(u.loop(c.createPulse(1200,100))),this.__animGlow.setTransform(this.__transform))},stopAnimating:function(){this.__transform=null,this.__animGlow.setVisibility(a.HIDDEN)},getWidget:function(){return this._widget},update:function(e){this.__transform&&this.__transform.update(e)}}));i.exports.addToContainer=function(e){return new Promise(function(t,i){e.addSlot(function(e){t(g.create(e))})})},i.exports.create=function(e){n||(n=s.getResourceManager().get(_.RESOURCE_TYPE,"element_card_mini"));var t=n.construct();return e.setAnchor&&e.setAnchor(new o(0,0,1,1)),e.setWidget(t),new g(t)}}),define("ui/views/OptionsRowView",["require","exports","module","thor/core/Class","thor/config/Config","thor/core/Validation","ManagerRepository","thor/ui/Anchor","thor/ui/Widget","thor/ui/Widget","thor/graphics/animation/Transform","thor/graphics/animation/actions/Actions","thor/audio/SoundSprite","ui/CommonActions","cards/CardInstance","cards/CardRarityEnum","cards/CardParameters"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/config/Config"),e("thor/core/Validation"),e("ManagerRepository"),e("thor/ui/Anchor"),e("thor/ui/Widget"),e("thor/ui/Widget").VISIBILITY),s=e("thor/graphics/animation/Transform"),o=e("thor/graphics/animation/actions/Actions"),a=(e("thor/audio/SoundSprite"),e("ui/CommonActions"));e("cards/CardInstance"),e("cards/CardRarityEnum"),e("cards/CardParameters"),i.exports=n.create({initialize:function(e){this.__infoButtons=[],this.__infoGlows=[],this.__infoOrangeButtons=[],this.__equipButtons=[],this.__equipGlows=[],this.__equipOrangeButtons=[];var t=e.findSingleWidgetWithName("row");this.__numColumns=t.getNumSlots();for(var i=1;i<=this.__numColumns;++i){var n=t.findSingleWidgetWithName("slot"+i);this.__infoButtons.push(n.findSingleWidgetWithName("btn_info")),this.__infoGlows.push(n.findSingleWidgetWithName("glowInfo")),this.__infoOrangeButtons.push(n.findSingleWidgetWithName("btn_InfoFUE")),this.__equipButtons.push(n.findSingleWidgetWithName("btn_equip")),this.__equipGlows.push(n.findSingleWidgetWithName("glowEquip")),this.__equipOrangeButtons.push(n.findSingleWidgetWithName("btn_equipFUE"))}for(var i=0;i<this.__numColumns;++i)this.__infoGlows[i].setVisibility(r.HIDDEN),this.__infoOrangeButtons[i].setVisibility(r.HIDDEN),this.__equipGlows[i].setVisibility(r.HIDDEN),this.__equipOrangeButtons[i].setVisibility(r.HIDDEN)},setupButtonCallbacks:function(e,t,i,n){this.__infoButtons[e].setSoundSprite(t).setClickHandler(i),this.__infoOrangeButtons[e].setSoundSprite(t).setClickHandler(i),this.__equipButtons[e].setSoundSprite(t).setClickHandler(n),this.__equipOrangeButtons[e].setSoundSprite(t).setClickHandler(n)},animateFlashEquip:function(e){this.__equipButtons[e].setVisibility(r.HIDDEN),this.__equipGlows[e].setVisibility(r.VISIBLE),this.__equipOrangeButtons[e].setVisibility(r.VISIBLE),this.__transform=new s,this.__transform.setAction(o.loop(a.createPulse(1200,100))),this.__equipGlows[e].setTransform(this.__transform)},stopAnimatingEquip:function(e){this.__transform=null,this.__equipButtons[e].setVisibility(r.VISIBLE),this.__equipGlows[e].setVisibility(r.HIDDEN),this.__equipOrangeButtons[e].setVisibility(r.HIDDEN)},disableInfoButtons:function(){for(var e=0;e<this.__numColumns;++e)this.__infoButtons[e].setEnabled(!1),this.__infoOrangeButtons[e].setEnabled(!1),this.__infoGlows[e].setVisibility(r.HIDDEN)},update:function(e){this.__transform&&this.__transform.update(e)}})}),define("ui/views/EquippedCardsView",["require","exports","module","thor/core/Class","thor/config/Config","thor/core/Validation","thor/event/EventManager","thor/graphics/animation/actions/Actions","thor/graphics/animation/EasingFunctions","thor/ui/Slot","thor/ui/Anchor","thor/ui/Widget","thor/ui/Widget","thor/graphics/animation/Transform","thor/ui/resources/WidgetResource","thor/graphics/resources/TextureRegionResource","player/Player","player/PlayerManager","cards/CardInstance","cards/CardParameters","ui/CommonActions","player/PlayerLevelRewardEnum","ui/views/SmallCardView","ManagerRepository"],function(e,t,i){var n,r=e("thor/core/Class"),s=(e("thor/config/Config"),e("thor/core/Validation"),e("thor/event/EventManager"),e("thor/graphics/animation/actions/Actions")),o=e("thor/graphics/animation/EasingFunctions"),a=(e("thor/ui/Slot"),e("thor/ui/Anchor")),_=(e("thor/ui/Widget"),e("thor/ui/Widget").VISIBILITY),l=e("thor/graphics/animation/Transform"),h=e("thor/ui/resources/WidgetResource"),u=(e("thor/graphics/resources/TextureRegionResource"),e("player/Player")),c=(e("player/PlayerManager"),e("cards/CardInstance"),e("cards/CardParameters"),e("ui/CommonActions")),d=(e("player/PlayerLevelRewardEnum"),e("ui/views/SmallCardView")),g=e("ManagerRepository"),p=[0,1,2,3],m=2*Math.PI*.005,f=300,v=1200,y=100,v=1200,y=100,E=i.exports=r.create({initialize:function(e,t,i,n){this._slot=e,this._widget=t,this._playerManager=i,this._eventManager=n,this._widget.findSingleWidgetWithName("anim_glow").setVisibility(_.HIDDEN);for(var r=0;r<4;++r){var s=this._widget.findSingleWidgetWithName("slot"+(r+1));s.findSingleWidgetWithName("equipped_frame").setVisibility(_.HIDDEN),s.findSingleWidgetWithName("locked_slot").setVisibility(_.HIDDEN),s.findSingleWidgetWithName("empty_slot").setVisibility(_.HIDDEN)}this.__optionsContainer=null,this.__smallCardViews=[]},__getSlotUnlockLevels:function(){var e=[u.DEFAULT_LEVEL,-1,-1,-1],t=u.DEFAULT_NUM_UPGRADE_SLOTS;return this._playerManager.getAllPlayerRewards().forEach(function(i){t>=4||"CARD_SLOT"===i.type&&(e[t]=i.level-1,t++)}),e},clearOptions:function(){p.forEach(function(e){this.__optionsContainer.findSingleWidgetWithName("slot"+(e+1)).setVisibility(_.HIDDEN)},this)},showEquipping:function(e,t,i,n,r){function a(e,a){if(E[a]&&r()){p.forEach(function(e){I._widget.findSingleWidgetWithName("slot"+(e+1)).cancelAction()});var l,h=I._widget.findSingleWidgetWithName("slot"+(a+1)),u=h.findSingleWidgetWithName("equipped_frame");e?l=C[a]:(u.setVisibility(_.VISIBLE),u.runAction(s.sequence(s.fadeTo(0,0),s.fadeTo(1,100))),u.getTransform().alpha=0,l=h.findSingleWidgetWithName("empty_slot")),d.addToContainer(h).then(function(e){e.show(t,i,function(){}),e.stopAnimating(),e.getWidget().runAction(s.sequence(s.fadeTo(0,0),s.moveBy(0,-100,0),s.wait(2*f),s.parallel(s.fadeTo(1,f),s.moveBy(0,100,f,o.easeOut)))),e.getWidget().getTransform().alpha=0}),h.invalidate(),l.runAction(s.sequence(s.wait(f/4),s.parallel(s.fadeTo(0,f),s.moveBy(0,300,f,o.easeOut)),s.callback(function(){n(e,a),g.getFUEManager().setEquippedCard(!0)})))}}for(var l=this._playerManager.getPlayerCardSlots(),h=this.__getSlotUnlockLevels(),u=i.cardTypes[t.id].effect,E=[!0,!0,!0,!0],S=0;S<e.length;++S)if(e[S]&&i.cardTypes[e[S].id].effect===u){for(var T=0;T<4;++T)E[T]=S===T;break}var C=[],I=this;p.forEach(function(t){var n=e[t],r=this._widget.findSingleWidgetWithName("slot"+(t+1));if(t+1>l){var o=r.findSingleWidgetWithName("locked_slot");o.setVisibility(_.VISIBLE),o.findSingleWidgetWithName("level_req").setText("LEVEL "+(h[t]+1))}else{if(n)r.findSingleWidgetWithName("equipped_frame").setVisibility(_.VISIBLE),d.addToContainer(r).then(function(e){C[t]=e.getWidget(),e.show(n,i,a.bind(null,n,t))}),E[t]||r.setTintColor(4294967190);else{var u=r.findSingleWidgetWithName("empty_slot");u.setVisibility(_.VISIBLE),E[t]||u.setTintColor(4294967190)
;u.findSingleWidgetWithName("button").setClickHandler(a.bind(null,null,t))}if(E[t])if(0===t&&g.getFUEManager().isInEquipSequence()){var p=r.findSingleWidgetWithName("anim_glow");p.setVisibility(_.VISIBLE),p.runAction(s.loop(c.createPulse(v,y)))}else r.runAction(s.sequence(s.rotateBy(.5*m,50),s.loop(s.rotateBy(-m,100),s.rotateBy(m,100))),!0)}},this),this._widget.invalidate()},show:function(e,t,i,n,r){this.__optionsContainer=i,this.__smallCardViews=[];var s=g.getFUEManager(),o=s.isInEquipSequence()&&!s.hasLeveledUpCard();o?this.__animateFUEInfoButton(n.bind(null,e[0])):this.__hideFUEInfoButton();var a=this,l=this._playerManager.getPlayerCardSlots(),h=this.__getSlotUnlockLevels();p.forEach(function(s){function u(){var e=m.getVisibility();if(r(),e===_.VISIBLE){if(m.setVisibility(_.HIDDEN),o)for(var t=0;t<a.__smallCardViews.length;++t)a.__smallCardViews[t].tryAnimateFlash()}else if(m.setVisibility(_.VISIBLE),c.expandOptionsWidget(m),o)for(var t=0;t<a.__smallCardViews.length;++t)a.__smallCardViews[t].stopAnimating()}var g=e[s],p=this._widget.findSingleWidgetWithName("slot"+(s+1)),m=i.findSingleWidgetWithName("slot"+(s+1));if(m.setVisibility(_.HIDDEN),m.findSingleWidgetWithName("btn_info").setClickHandler(n.bind(null,g)),s+1>l){var f=p.findSingleWidgetWithName("locked_slot");f.setVisibility(_.VISIBLE),f.findSingleWidgetWithName("level_req").setText("LEVEL "+(h[s]+1))}else g?(p.findSingleWidgetWithName("equipped_frame").setVisibility(_.VISIBLE),d.addToContainer(p).then(function(e){a.__smallCardViews.push(e),e.show(g,t,u)})):p.findSingleWidgetWithName("empty_slot").setVisibility(_.VISIBLE)},this),this._widget.invalidate()},__animateFUEInfoButton:function(e){this.__optionsContainer.findSingleWidgetWithName("slot1").findSingleWidgetWithName("btn_info").setVisibility(_.HIDDEN);var t=this.__optionsContainer.findSingleWidgetWithName("btn_InfoFUE");t.setVisibility(_.VISIBLE),t.setClickHandler(e);var i=this.__optionsContainer.findSingleWidgetWithName("glowInfo");i.setVisibility(_.VISIBLE),this.__glowTransform=new l,this.__glowTransform.setAction(s.loop(c.createPulse(v,y))),i.setTransform(this.__glowTransform)},__hideFUEInfoButton:function(){this.__glowTransform=null,this.__optionsContainer.findSingleWidgetWithName("slot1").findSingleWidgetWithName("btn_info").setVisibility(_.VISIBLE),this.__optionsContainer.findSingleWidgetWithName("btn_InfoFUE").setVisibility(_.HIDDEN),this.__optionsContainer.findSingleWidgetWithName("glowInfo").setVisibility(_.HIDDEN)},update:function(e){for(var t=0;t<this.__smallCardViews.length;++t)this.__smallCardViews[t].update(e);this.__glowTransform&&this.__glowTransform.update(e)},getWidget:function(){return this._widget},getSlot:function(){return this._slot}});i.exports.addToContainer=function(e,t,i){return new Promise(function(n,r){e.addSlot(function(e){n(E.create(e,t,i))})})},i.exports.create=function(e,t,i){n||(n=g.getResourceManager().get(h.RESOURCE_TYPE,"element_equipped_cards"));var r=n.construct();return e.setAnchor&&e.setAnchor(new a(0,0,1,1)),e.setWidget(r),new E(e,r,t,i)}}),define("ui/CardScrapDialog",["require","exports","module","thor/core/Class","thor/ui/Widget","thor/core/Validation","thor/ui/Widget","thor/entity/EntityManager","thor/resources/ResourceManager","Constants","ManagerRepository","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/graphics/animation/EasingFunctions","ui/GalatronDialog","ui/CommonActions","ui/views/LargeCardView","cards/CardInstance","cards/CardParameters","player/CurrencyTypeEnum","thor/util/TimeoutContext"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/ui/Widget"),e("thor/core/Validation"),e("thor/ui/Widget").VISIBILITY),s=(e("thor/entity/EntityManager"),e("thor/resources/ResourceManager"),e("Constants")),o=e("ManagerRepository"),a=e("thor/audio/SoundSprite"),_=e("thor/audio/SoundSpriteResourceLoader"),l=e("thor/graphics/animation/actions/Actions"),h=(e("thor/graphics/animation/Transform"),e("thor/graphics/animation/EasingFunctions"),e("ui/GalatronDialog")),u=e("ui/CommonActions"),c=e("ui/views/LargeCardView"),d=(e("cards/CardInstance"),e("cards/CardParameters"),e("player/CurrencyTypeEnum"),e("thor/util/TimeoutContext")),g={x:-12,y:-61};i.exports=n.create(h,{initialize:function(e,t,i,n,r,s,l){h.prototype.initialize.call(this,e,"popup_card_scrap"),this.__resourceManager=e,this.__entityManager=t,this.__createWorld=l,this.__sounds=e.getOrDefault(_.RESOURCE_TYPE,"game_sounds",a.EMPTY_SOUND_SPRITE);var u=this._widget.findSingleWidgetWithName("scrapping_animation");this.__cardContainer=u.findSingleWidgetWithName("card"),this.__cardNameLabel=u.findSingleWidgetWithName("card_name");var p=s.toLocaleString(),m=r.toLocaleString();this.__playerParts=r,this.__acquiredParts=s,this.__availablePartsContainer=u.findWidgetsWithName("available_parts")[0];var f=this.__availablePartsContainer.findSingleWidgetWithName("count_parts");f.setText(m),this.__availablePartsCountLabel=f,this.__awardedPartsContainer=u.findSingleWidgetWithName("awarded_parts"),this.__awardedPartsContainer.findSingleWidgetWithName("count_total_credits").setText("+"+p),this.__animationWorldWidget=u.findSingleWidgetWithName("animation"),this.__attachWorld(),this.__skeletonFactory=o.getSkeletonFactory();var v=this.__skeletonFactory.load("card_scrap"),y=v.getRootComponent();y.setTranslation(g.x,g.y),y.setScale(2,2);var E=n.cardTypes[i.id];u.findSingleWidgetWithName("card_name");this.__cardNameLabel.setText(E.name),u.findSingleWidgetWithName("button").setClickHandler(this.__buttonClickHandler.bind(this));var S=this;c.addToContainer(this.__cardContainer,e).then(function(e){e.show(i.id,i.level,n),S.__cardView=e}),this.__resourceManager=e,this._closableByModalClick=!1,this.__isAnimating=!1,this.__isScrapComplete=!1,this.__entity={},this.__skipped=!1,this.__timeoutContext=new d},__attachWorld:function(){this.__world||(this.__world=this.__createWorld()),this.__animationWorldWidget.setWorld(this.__world)},__fadeOutComponent:function(e,t){return new Promise(function(i,n){var s=l.sequence(l.fadeTo(0,t),l.fadeTo(1,0),l.callback(function(){i(!0),e.setVisibility(r.HIDDEN)}));e.runAction(s)})},__fadeInComponent:function(e,t,i){return new Promise(function(n,s){e.setVisibility(r.VISIBLE);var o=l.sequence(l.fadeTo(0,0),l.fadeTo(1,t),l.wait(i),l.callback(function(){n(!0)}));e.runAction(o),e.getTransform().alpha=0})},__startGlow:function(e,t,i){e.setVisibility(r.VISIBLE);var n=l.sequence(l.fadeTo(0,0),l.wait(t),l.fadeTo(1,i));e.runAction(n),e.getTransform().alpha=0},__hideCard:function(e,t,i){var n=l.sequence(l.wait(t),l.fadeTo(0,i),l.fadeTo(1,0),l.callback(function(){e.setVisibility(r.HIDDEN)}));e.runAction(n)},__triggerAnimation:function(){if(this.__timeoutContext.clearTimeouts(),!this.__isAnimating){this.__isAnimating=!0;var e=this,t=this.__fadeOutComponent(this.__cardNameLabel,500);this.__startGlow(this.__cardView.getGlow(),100,500),this.__hideCard(this.__cardContainer,500,100),this.__entity=this.__skeletonFactory.create("card_scrap",this.__world,{attachParent:this.__world.getScene().getRootComponent()}),t.then(function(){e.__sounds.play("scrap_card");var t=e.__entity.getComponent("SkeletonComponent");return t.setDefaultAnimation("Parts Idle"),t.playAnimation("Card Scrapping"),new Promise(function(i,n){t.setAnimationEndedCallback(function(){e.__isScrapComplete=!0,i(!0)})})}).then(this.__fadeInUI.bind(e)).then(function(){e.__isAnimating=!1})}},__fadeInUI:function(){var e=this;return this.__fadeInComponent(this.__awardedPartsContainer,300,480).then(function(){return e.__fadeOutComponent(e.__awardedPartsContainer,96,96)}).then(function(){return e.__cardNameLabel.setText("PARTS ACQUIRED"),e.__fadeInComponent(e.__cardNameLabel,160,0),e.__fadeInComponent(e.__availablePartsContainer,160,240)}).then(function(){e.__availablePartsCountLabel.runAction(l.tweenCallback(e.__playerParts,e.__playerParts+e.__acquiredParts,192,function(t){e.__availablePartsCountLabel.setText((~~t).toLocaleString())}))}).then(function(){e.__timeoutContext.setTimeout(e.__handleClose.bind(e),s.ANIMATION_TRIGGER_DELAY_MS)})},__skip:function(){if(!this.__skipped){this.__skipped=!0;var e=this.__entity.getComponent("SkeletonComponent");e.playAnimation("Parts Idle"),e.setEnabled(!1),this.__isAnimating=!1}},__buttonClickHandler:function(){var e=this;if(this.__isAnimating&&this.__skip(),this.__isScrapComplete)this.__handleClose();else{if(this.__skipped)return this.__awardedPartsContainer.setVisibility(r.VISIBLE),this.__isScrapComplete=!0,this.__fadeInUI().then(function(){e.__isAnimating=!1});this.__triggerAnimation()}},__handleClose:function(){this.__timeoutContext.clearTimeouts(),this.close()},close:function(){var e=this;this._widget.runAction(l.sequence(u.createDialogBlinkOut(),l.callback(function(){h.prototype.close.call(e)})))},show:function(e){h.prototype.show.call(this,e),this.__availablePartsContainer.setVisibility(r.HIDDEN),this.__awardedPartsContainer.setVisibility(r.HIDDEN),this._widget.runAction(u.createDialogBlinkIn()),this.__timeoutContext.setTimeout(this.__triggerAnimation.bind(this),s.ANIMATION_TRIGGER_DELAY_MS)}})}),define("ui/CardDetailDialog",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/resources/ResourceManager","thor/math/ColorUtil","thor/entity/EntityManager","thor/core/Scheduler","thor/ui/Geometry","thor/ui/resources/WidgetResource","thor/ui/Anchor","thor/ui/Dialog","thor/graphics/animation/actions/Actions","thor/graphics/animation/EasingFunctions","thor/ui/Widget","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","ui/WalletView","ui/views/LargeCardView","ui/CommonActions","cards/CardInstance","cards/CardParameters","player/PlayerManager","player/CurrencyTypeEnum","ui/CardScrapDialog","ManagerRepository","ui/LevelUpDialog","ui/FUEDialogBase","ui/StandardFUEDialog"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Logger").getLogger(i),s=(e("thor/core/Validation"),e("thor/resources/ResourceManager"),e("thor/math/ColorUtil")),o=(e("thor/entity/EntityManager"),e("thor/core/Scheduler")),a=e("thor/ui/Geometry"),_=(e("thor/ui/resources/WidgetResource"),e("thor/ui/Anchor"),e("thor/ui/Dialog")),l=e("thor/graphics/animation/actions/Actions"),h=e("thor/graphics/animation/EasingFunctions"),u=e("thor/ui/Widget").VISIBILITY,c=e("thor/audio/SoundSprite"),d=e("thor/audio/SoundSpriteResourceLoader"),g=(e("ui/WalletView"),e("ui/views/LargeCardView")),p=e("ui/CommonActions"),m=(e("cards/CardInstance"),e("cards/CardParameters"),e("player/PlayerManager"),e("player/CurrencyTypeEnum")),f=e("ui/CardScrapDialog"),v=e("ManagerRepository"),y=e("ui/LevelUpDialog"),E=e("ui/FUEDialogBase"),S=e("ui/StandardFUEDialog"),T={channel:"UI_SFX"};i.exports=n.create(_,{initialize:function(e,t,i,n,r,s,o){_.prototype.initialize.call(this,e,"popup_card_detail"),this.__resourceManager=e,this.__entityManager=t,this.__createWorld=s,this.__playerManager=r,this.__sounds=e.getOrDefault(d.RESOURCE_TYPE,"game_sounds",c.EMPTY_SOUND_SPRITE),this.__largeCardView=null,this.__progressBar=null,this.__cardContainer=null,this.__cardDescription=null,this.__upgradeArrow=null,this.__descriptionGlow=null,this.__levelUpInProgress=!1,this.__walletView=o;var a=this;this.__enhanceFUEDialog=this._widget.findSingleWidgetWithName("popup_FUE2"),this.__enhanceFUEDialog.findSingleWidgetWithName("CanvasPanel").addSlot(function(e){a.__enhanceFUEDialogSlot=e}),this.__updateDisplay(i,n,r),this._closableByModalClick=!1},__updateDisplay:function(e,t,i){this.__enhanceFUEDialog.setVisibility(u.HIDDEN),this._widget.findSingleWidgetWithName("unavailable_card").setVisibility(u.HIDDEN);var n=this._widget.findSingleWidgetWithName("available_card"),r=this._widget.findSingleWidgetWithName("scrap_confirm");r.setVisibility(u.HIDDEN),this.__closeWidget=n.findSingleWidgetWithName("btn_back"),this.__closeButton=this.__closeWidget.findSingleWidgetWithName("button"),this.__closeButton.setClickHandler(this.close.bind(this)),this.__closeButton.setSoundSprite(this.__sounds),this.__closeButton.setClickSound("back"),this.__orangeCloseWidget=this._widget.findSingleWidgetWithName("btn_backOrange"),this.__orangeCloseButton=this.__orangeCloseWidget.findSingleWidgetWithName("button"),this.__orangeCloseButton.setClickHandler(this.close.bind(this)),this.__orangeCloseWidget.findSingleWidgetWithName("anim_glow").runAction(l.loop(p.createPulse(1200,100))),this.__orangeCloseButton.setSoundSprite(this.__sounds),this.__orangeCloseButton.setClickSound("back");var o=v.getFUEManager();(o.isInEquipSequence()||o.shouldShowPlayDialog())&&o.hasLeveledUpCard()?(this.__closeWidget.setVisibility(u.HIDDEN),this.__orangeCloseWidget.setVisibility(u.VISIBLE)):(o.isInEquipSequence()?(this.__showEnhanceFUEDialog(),this.__closeWidget.setVisibility(u.HIDDEN)):this.__closeWidget.setVisibility(u.VISIBLE),this.__orangeCloseWidget.setVisibility(u.HIDDEN));var a=n.findSingleWidgetWithName("available_card_info"),_=t.cardTypes[e.id],h=t.rarities[_.rarity][e.level],c=!t.cardLevels[e.id][e.level+1],d=a.findSingleWidgetWithName("card_name"),f=r.findSingleWidgetWithName("card_name"),y=a.findSingleWidgetWithName("card_description"),E=a.findWidgetsWithName("word_glow")[0],S=a.findSingleWidgetWithName("card"),T=a.findSingleWidgetWithName("max level"),C=a.findSingleWidgetWithName("btn_no"),I=r.findSingleWidgetWithName("btn_yes"),w=r.findSingleWidgetWithName("btn_no"),b=a.findSingleWidgetWithName("parts_progress"),M=b.findSingleWidgetWithName("ProgressBarWidget"),x=b.findSingleWidgetWithName("upgrade_arrow"),R=b.findSingleWidgetWithName("cost"),P=a.findSingleWidgetWithName("bottom_tray"),A=P.findSingleWidgetWithName("count_parts");this.__buttonEnhance=a.findSingleWidgetWithName("btn_yes"),this.__buttonEnhanceOrange=a.findSingleWidgetWithName("btn_equipFUE"),this.__buttonOrangeGlow=a.findSingleWidgetWithName("glowEquip"),this.__upgradeArrow=x,this.__cardDescription=y,this.__cardContainer=S,this.__progressBar=M,this.__descriptionGlow=E,E.setVisibility(u.HIDDEN),b.findSingleWidgetWithName("ShineWidget").setVisibility(u.HIDDEN),d.setText(_.name),f.setText(_.name+"?"),y.setText(e.getDescription(t));var N=i.getPlayerParts(),D=i.getPlayerGold();A.setText(N.toLocaleString());var L=N.toLocaleString()+"/"+h.requiredParts;R.setText(L);var O=Math.min(1,N/h.requiredParts);if(M.setProgress(O),O>=1&&!c){x.setVisibility(u.VISIBLE);var V=M.getNamedSlot("fill").getWidget().findSingleWidgetWithName("NineSliceWidget");M.runAction(l.loop(l.tweenCallback(0,1,500,function(e){V.setTintColor(s.lerp(519754390,2328739583,e))}),l.tweenCallback(0,1,500,function(e){V.setTintColor(s.lerp(2328739583,519754390,e))})))}else x.setVisibility(u.HIDDEN);if(c)this.__buttonEnhance.setVisibility(u.HIDDEN),this.__buttonEnhanceOrange.setVisibility(u.HIDDEN),this.__buttonOrangeGlow.setVisibility(u.HIDDEN),b.setVisibility(u.HIDDEN);else{T.setVisibility(u.HIDDEN);for(var B=m.CURRENCY_SYMBOLS[m.GOLD]+h.requiredCoins,k=N>=h.requiredParts&&D>=h.requiredCoins,W=this.levelUpCard.bind(this,e,t,i),F=this.__buttonEnhance.findWidgetsWithName("cost"),U=F.length,G=0;G<U;++G)F[G].setText(B);if(this.__buttonEnhance.setEnabled(k),this.__buttonEnhance.setClickHandler(W),this.__buttonEnhance.setSoundSprite(this.__sounds),o.isInEquipSequence()&&!o.hasLeveledUpCard()){F=this.__buttonEnhanceOrange.findWidgetsWithName("cost"),U=F.length;for(var G=0;G<U;++G)F[G].setText(B);this.__buttonEnhanceOrange.setEnabled(k),this.__buttonEnhanceOrange.setClickHandler(W),this.__buttonEnhanceOrange.setSoundSprite(this.__sounds),this.__buttonOrangeGlow.runAction(l.loop(p.createPulse(1200,100))),this.__buttonEnhance.setVisibility(u.HIDDEN)}else this.__buttonEnhanceOrange.setVisibility(u.HIDDEN),this.__buttonOrangeGlow.setVisibility(u.HIDDEN)}var H=this;S.removeSlotAtIndex(0);var q=g.addToContainer(S,this.__resourceManager).then(function(i){H.__largeCardView=i,i.show(e.id,e.level,t),S.invalidate()});return C.setEnabled(v.getFUEManager().isCardScrappingEnabled()),C.setClickHandler(this.transitionToScrap.bind(this)),C.setSoundSprite(this.__sounds),w.setClickHandler(this.transitionFromScrap.bind(this)),w.setSoundSprite(this.__sounds),w.setClickSound("back"),I.setClickHandler(this.scrapCard.bind(this,e,t,i)),I.setSoundSprite(this.__sounds),q},levelUpCard:function(e,t,i){function n(e){if(r.warn("Card leveling up player level gains:",e),e&&e.length>0){var t=e.shift(),i=l.sequence(p.createDialogBlinkOut(),l.callback(function(){_._widget.setVisibility(u.HIDDEN);var i=new y(v.getPlayerManager(),v.getResourceManager(),v.getEntityManager(),v.getEventManager(),_.__createWorld,_.__walletView),r=_.__walletView.getCurrency(m.TOKENS),s=_.__walletView.getCurrency(m.GOLD);i.show(v.getDialogManager(),t.rewards,r,s);var a=o.addAnimationTask(function(e,t){i.update(t)});i.waitForClosed().then(function(){o.removeAnimationTask(a),e.length>0?n(e):(_._widget.setVisibility(u.VISIBLE),_._widget.runAction(p.createDialogBlinkIn(),!1,!0),_.__walletView.attach(_._widget.findSingleWidgetWithName("top_tray")),_.__walletView.resume())})}));_.__walletView.gainXp(1,s,d,g).then(function(){_._widget.runAction(i),_.__levelUpInProgress=!1})}else _.__walletView.gainXp(0,s,d,g).then(function(){_.__walletView.resume(),_.__levelUpInProgress=!1})}if(!this.__levelUpInProgress){this.__levelUpInProgress=!0;var s,_=this,c=new a(0,0,1,1);this.__largeCardView.getWidget().getGeometry(c);var d=c.getX()+c.getWidth()+-50,g=c.getY()+c.getHeight()+-80,f=v.getFUEManager();f.isInEquipSequence()&&!f.hasLeveledUpCard()&&(f.setLeveledUpCard(!0),this.__buttonEnhance.setVisibility(u.VISIBLE),this.__buttonEnhanceOrange.setVisibility(u.HIDDEN),this.__buttonOrangeGlow.setVisibility(u.HIDDEN)),i.levelUpCard(e,t).then(function(e){if(!e)return void(_.__levelUpInProgress=!1);_.__walletView.pause();var r=e[0];s=e[1];_.__sounds.play("card_level_up",T),_.__progressBar.runAction(l.sequence(l.tweenCallback(1,0,1400,function(e){_.__progressBar.setProgress(e)},h.easeOut))),_.__cardDescription.runAction(l.sequence(l.wait(1400),l.fadeTo(0,0),p.createDialogBlinkIn()));var o=_.__largeCardView.getGlow();o.setVisibility(u.VISIBLE),o.runAction(l.sequence(l.fadeTo(0,0),l.fadeTo(1,1400))),o.getTransform().alpha=0,_.__cardContainer.runAction(l.sequence(l.parallel(p.createShake(14,20,20,50),l.scaleTo(1.05,1.05,1400)),l.callback(function(){_.__upgradeArrow.setVisibility(u.HIDDEN),_.__updateDisplay(r,t,i).then(function(){var e=_.__largeCardView.getGlow();e.setVisibility(u.VISIBLE),e.runAction(l.fadeTo(0,800));var t=_.__largeCardView.getGlowFrame();t.setVisibility(u.VISIBLE),t.runAction(l.sequence(l.scaleTo(1.15,1.15,0),l.parallel(l.scaleTo(1.8,1.8,400),l.fadeTo(0,400))),!0)})}),l.scaleTo(1.15,1.15,16),l.scaleTo(1,1,800,h.easeOut),l.callback(function(){i.addXP(s).then(n)})),!0),_._setResult("LEVEL_UP")})}},__showEnhanceFUEDialog:function(){var e=new S("Enhancing a Card will make your Card stronger, but consumes Coins and Parts.","Go ahead and give it a try!");E.showDialog(e,this.__enhanceFUEDialogSlot),this.__enhanceFUEDialog.setVisibility(u.VISIBLE),this.__enhanceFUEDialog.invalidate()},scrapCard:function(e,t,i){var n=this.__playerManager.getPlayerParts(),r=this;i.scrapCard(e,t).then(function(i){var s=v.getDialogManager();new f(r.__resourceManager,r.__entityManager,e,t,n,i,r.__createWorld).show(s),r._setResult("SCRAP"),r.close()})},transitionToScrap:function(){if(!this.__levelUpInProgress){var e=this._widget.findSingleWidgetWithName("available_card"),t=this._widget.findSingleWidgetWithName("scrap_confirm");e.runAction(l.sequence(p.createDialogBlinkOut(),l.callback(function(){e.setVisibility(u.HIDDEN),t.runAction(l.sequence(p.createDialogBlinkIn(),l.callback(function(){}))),t.getTransform().alpha=0,t.setVisibility(u.VISIBLE)})))}},transitionFromScrap:function(){var e=this._widget.findSingleWidgetWithName("available_card"),t=this._widget.findSingleWidgetWithName("scrap_confirm");t.runAction(l.sequence(p.createDialogBlinkOut(),l.callback(function(){t.setVisibility(u.HIDDEN),e.runAction(l.sequence(p.createDialogBlinkIn(),l.callback(function(){}))),e.getTransform().alpha=0,e.setVisibility(u.VISIBLE)})))},close:function(){if(!this.__levelUpInProgress){this.__closeButton.setEnabled(!1),this.__orangeCloseButton.setEnabled(!1),this.__progressBar&&this.__progressBar.cancelAction();var e=this;this._widget.runAction(l.sequence(p.createDialogBlinkOut(),l.callback(function(){_.prototype.close.call(e)}))),this.__walletView.detach()}},show:function(e){_.prototype.show.call(this,e),this.__sounds.play("popup");var t=this._widget.findSingleWidgetWithName("top_tray");this.__walletView.attach(t),this._widget.runAction(p.createDialogBlinkIn())}}),i.exports.RESULT_SCRAP="SCRAP",i.exports.RESULT_LEVEL_UP="LEVEL_UP"}),define("ui/CardUnavailableDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/resources/ResourceManager","thor/graphics/animation/actions/Actions","thor/ui/Widget","ui/WalletView","ui/GalatronDialog","ui/CommonActions","ui/views/LargeCardView","cards/CardInstance","cards/CardParameters","player/PlayerManager","player/CurrencyTypeEnum"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/resources/ResourceManager"),e("thor/graphics/animation/actions/Actions")),s=e("thor/ui/Widget").VISIBILITY,o=(e("ui/WalletView"),e("ui/GalatronDialog")),a=e("ui/CommonActions"),_=e("ui/views/LargeCardView"),l=e("cards/CardInstance");e("cards/CardParameters"),e("player/PlayerManager"),e("player/CurrencyTypeEnum");i.exports=n.create(o,{initialize:function(e,t,i,n){o.prototype.initialize.call(this,e,"popup_card_detail"),this.__walletView=n,this._widget.findSingleWidgetWithName("available_card").setVisibility(s.HIDDEN);var r=this._widget.findSingleWidgetWithName("unavailable_card");this._widget.findSingleWidgetWithName("scrap_confirm").setVisibility(s.HIDDEN),this._widget.findSingleWidgetWithName("btn_backOrange").setVisibility(s.HIDDEN),this._widget.findSingleWidgetWithName("popup_FUE2").setVisibility(s.HIDDEN),r.findSingleWidgetWithName("btn_back").findSingleWidgetWithName("button").setClickHandler(this.close.bind(this));var a=i.cardTypes[t],h=r.findSingleWidgetWithName("card_name"),u=r.findSingleWidgetWithName("card_description"),c=r.findSingleWidgetWithName("card");h.setText(a.name),u.setText(l.getDescription(t,0,i)),_.addToContainer(c,e).then(function(e){e.show(t,-1,i)}),this.__resourceManager=e,this._closableByModalClick=!0},close:function(){var e=this;this._widget.runAction(r.sequence(a.createDialogBlinkOut(),r.callback(function(){o.prototype.close.call(e)}))),this.__walletView.detach()},show:function(e){o.prototype.show.call(this,e);var t=this._widget.findSingleWidgetWithName("top_tray");this.__walletView.attach(t),this._widget.runAction(a.createDialogBlinkIn())}})}),define("ui/CardEquipDialog",["require","exports","module","thor/core/Class","thor/core/Validation","thor/resources/ResourceManager","thor/event/EventManager","thor/graphics/animation/actions/Actions","thor/graphics/animation/EasingFunctions","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","ui/GalatronDialog","ui/views/LargeCardView","ui/views/EquippedCardsView","ui/CommonActions","cards/CardInstance","cards/CardParameters","player/PlayerManager"],function(e,t,i){var n=e("thor/core/Class"),r=(e("thor/core/Validation"),e("thor/resources/ResourceManager"),e("thor/event/EventManager"),e("thor/graphics/animation/actions/Actions")),s=e("thor/graphics/animation/EasingFunctions"),o=e("thor/audio/SoundSprite"),a=e("thor/audio/SoundSpriteResourceLoader"),_=e("ui/GalatronDialog"),l=e("ui/views/LargeCardView"),h=e("ui/views/EquippedCardsView"),u=e("ui/CommonActions");e("cards/CardInstance"),e("cards/CardParameters"),e("player/PlayerManager");i.exports=n.create(_,{initialize:function(e,t,i,n,u){_.prototype.initialize.call(this,e,"screen_equip_card"),this.__sounds=e.getOrDefault(a.RESOURCE_TYPE,"game_sounds",o.EMPTY_SOUND_SPRITE);var c=this._widget.findSingleWidgetWithName("dialogue"),d=c.findSingleWidgetWithName("card_name"),g=c.findSingleWidgetWithName("card_description"),p=c.findSingleWidgetWithName("card"),m=c.findSingleWidgetWithName("equipped_cards");c.findSingleWidgetWithName("btn_cancel").setClickHandler(this.close.bind(this));var f=i.cardTypes[t.id];d.setText(f.name),g.setText(t.getDescription(i));var v;l.addToContainer(p,e).then(function(e){v=e.getWidget(),e.show(t.id,t.level,i)});var y=c.findSingleWidgetWithName("card_glow_top"),E=c.findSingleWidgetWithName("card_glow_bottom");this.__isEquipping=!1;var S=this;h.addToContainer(m,n,u).then(function(e){e.showEquipping(n.getEquippedCards(),t,i,function(e,i){S.__sounds.play("equip"),v.runAction(r.sequence(r.parallel(r.fadeTo(0,300),r.moveBy(0,300,300,s.easeOut)),r.wait(600),r.callback(function(){n.equipCard(t,i).then(function(){S.__isEquipping=!1,S.close()})}))),y.runAction(r.sequence(r.parallel(r.fadeTo(0,300),r.moveBy(0,300,300,s.easeOut)))),E.runAction(r.sequence(r.parallel(r.fadeTo(0,300),r.moveBy(0,300,300,s.easeOut))))},function(){return!S.__isEquipping&&(S.__sounds.play("click"),S.__isEquipping=!0,!0)})}),this.__resourceManager=e},close:function(){this.__isEquipping||_.prototype.close.call(this)},show:function(e){_.prototype.show.call(this,e),this._widget.runAction(u.createDialogBlinkIn())}})}),define("ui/WarningPopup",["require","exports","module","thor/core/Enum","thor/core/Class","thor/ui/Panel","thor/core/Logger","thor/ui/Anchor","thor/graphics/animation/actions/Actions","thor/graphics/animation/Transform","thor/core/Validation","thor/ui/Geometry","thor/ui/Widget","thor/ui/resources/WidgetResource","thor/util/TimeoutContext","thor/resources/ResourceManager","thor/math/MathHelper","ui/CommonActions"],function(e,t,i){var n=e("thor/core/Enum"),r=e("thor/core/Class"),s=(e("thor/ui/Panel"),e("thor/core/Logger").getLogger(i)),o=e("thor/ui/Anchor"),a=e("thor/graphics/animation/actions/Actions"),_=e("thor/graphics/animation/Transform"),l=e("thor/core/Validation"),h=e("thor/ui/Geometry"),u=e("thor/ui/Widget").VISIBILITY,c=e("thor/ui/resources/WidgetResource"),d=e("thor/util/TimeoutContext"),g=(e("thor/resources/ResourceManager"),e("thor/math/MathHelper")),p=e("ui/CommonActions"),m=n.create("WarningTypeEnum",{INSUFFICIENT:1,CLASSIFIED:2}),f=new h(0,0,1,1);i.exports=r.create({initialize:function(e){var t=e.get(c.RESOURCE_TYPE,"popup_warning");this.__warningPopupWidget=t.construct();var i=this.__warningPopupWidget.findSingleWidgetWithName("insufficient"),n=this.__warningPopupWidget.findSingleWidgetWithName("classified");this.__insufficientWidgets={widget:i,bgBox:i.findSingleWidgetWithName("BG"),frame:i.findSingleWidgetWithName("frame"),text:i.findSingleWidgetWithName("label")},this.__classifiedWidgets={widget:n,bgBox:n.findSingleWidgetWithName("BG"),frame:n.findSingleWidgetWithName("frame"),text:n.findSingleWidgetWithName("label")},this.__warningSlot=null,this.__container=null,this.__timeoutContext=new d,this.__transform=null,this.__bgBoxTransform=null,this.__frameTransform=null,this.__textTransform=null},__setupScaleIn:function(e,t,i){this.__transform=new _;var n=a.moveBy(e,t,0);this.__transform.setAction(n),this.__warningPopupWidget.setTransform(this.__transform);var r=i.bgBox,s=i.frame,o=i.text,l=i.widget,h=new _;r.setTransform(h,!0);var c=a.sequence(a.callback(function(){l.setVisibility(u.VISIBLE)}),a.fadeTo(0,0),a.scaleTo(1,.5,0),a.fadeTo(1,100),a.wait(50),a.scaleTo(1,1,50));h.setAction(c),this.__bgBoxTransform=h;var d=new _;s.setTransform(d,!0);var g=a.sequence(a.fadeTo(0,0),a.scaleTo(1,.01,0),a.wait(100),a.fadeTo(1,0),a.scaleTo(1,.5,50),a.scaleTo(1,1,50));d.setAction(g),this.__frameTransform=d;var m=new _;o.setTransform(m);var f=a.sequence(a.fadeTo(0,0),a.wait(200),p.createDialogBlinkIn());m.setAction(f),this.__textTransform=m},__setupFadeOut:function(e){var t=e.bgBox,i=e.frame,n=e.text,r=e.widget,s=this,o=new Promise(function(e,i){var n=new _;t.setTransform(n,!0);var o=a.sequence(a.wait(100),a.fadeTo(0,50),a.callback(function(){r.setVisibility(u.HIDDEN),e(!0)}));n.setAction(o),s.__bgBoxTransform=n}),l=new Promise(function(e,t){var n=new _;i.setTransform(n,!0);var r=a.sequence(a.wait(100),a.fadeTo(0,50),a.callback(function(){e(!0)}));n.setAction(r),s.__frameTransform=n}),h=new Promise(function(e,t){var i=new _;n.setTransform(i);var r=a.sequence(a.fadeTo(0,50),a.callback(function(){e(!0)}));i.setAction(r),s.__textTransform=i});return Promise.all([o,l,h])},attach:function(e,t,i,n,r){if(l.ifDefined.assertIsNumber(i),l.ifDefined.assertIsNumber(n),l.ifDefined.assertIsObject(r),this.__container)return void s.error("Cannot attach twice.");i=i||0,n=n||0,this.__container=e;var a=this;e.addSlot(function(s){a.__warningSlot=s,s.setAnchor(new o(0,0,1,1)),s.setWidget(a.__warningPopupWidget),s.setAutoSize(!0);var _;if(t===m.INSUFFICIENT?(a.__insufficientWidgets.widget.setVisibility(u.VISIBLE),a.__classifiedWidgets.widget.setVisibility(u.HIDDEN),_=a.__insufficientWidgets):t===m.CLASSIFIED&&(a.__insufficientWidgets.widget.setVisibility(u.HIDDEN),a.__classifiedWidgets.widget.setVisibility(u.VISIBLE),_=a.__classifiedWidgets),e.invalidate(),r){_.widget.getGeometry(f);var l=r.canvasWidth-f.getWidth();i=g.clamp(0,l,i)}a.__setupScaleIn(i,n,_),a.__timeoutContext.setTimeout(function(){a.__setupFadeOut(_).then(function(){a.detach()})},1500)})},detach:function(){this.__container&&this.__warningSlot&&(this.__container.removeSlot(this.__warningSlot),this.__container.invalidate(),this.__warningSlot=null,this.__container=null,this.__transform=null,this.__bgBoxTransform=null,this.__frameTransform=null,this.__textTransform=null),this.__timeoutContext.clearAll()},update:function(e){this.__transform&&this.__transform.update(e),this.__bgBoxTransform&&this.__bgBoxTransform.update(e),this.__frameTransform&&this.__frameTransform.update(e),this.__textTransform&&this.__textTransform.update(e)}}),i.exports.WarningTypeEnum=m}),define("ui/states/ShipCustomizationState",["require","exports","module","thor/core/Class","thor/core/Logger","thor/core/Validation","thor/util/FSM","thor/util/TimeoutContext","thor/util/StringUtil","thor/graphics/animation/EasingFunctions","thor/event/EventManager","thor/resources/ResourceManager","thor/ui/resources/WidgetResource","thor/ui/Anchor","thor/ui/DialogManager","thor/ui/Panel","thor/ui/Widget","thor/platforms/Google","thor/analytics/Seidr","thor/audio/SoundSprite","thor/audio/SoundSpriteResourceLoader","thor/graphics/animation/actions/Actions","thor/ui/Geometry","thor/graphics/animation/Transform","events/GameStartingEvent","thor/entity/EntityDestroyedEvent","events/TransitionUIStateEvent","thor/ui/Widget","ShipSkinManager","GameLogic","player/PlayerManager","EntityFactory","ui/DotJiggleAction","ui/CommonActions","ui/MessageDialog","ui/WalletView","ui/UIUtil","ui/views/SmallCardView","ui/views/OptionsRowView","ui/views/EquippedCardsView","ui/CardDetailDialog","ui/CardUnavailableDialog","ui/CardEquipDialog","ui/views/PopupDialog","ui/PopupDialogEnum","ui/FUEDialogBase","ui/StandardFUEDialog","ui/WarningPopup","cards/CardRarityEnum","cards/CardInstance","./UIState","Constants","ManagerRepository","player/CurrencyTypeEnum"],function(e,t,i){var n,r=e("thor/core/Class"),s=e("thor/core/Logger").getLogger(i),o=e("thor/core/Validation"),a=(e("thor/util/FSM"),e("thor/util/TimeoutContext")),_=(e("thor/util/StringUtil"),e("thor/graphics/animation/EasingFunctions")),l=(e("thor/event/EventManager"),e("thor/resources/ResourceManager"),e("thor/ui/resources/WidgetResource")),h=(e("thor/ui/Anchor"),e("thor/ui/DialogManager"),e("thor/ui/Panel"),e("thor/ui/Widget"),e("thor/platforms/Google")),u=e("thor/analytics/Seidr"),c=e("thor/audio/SoundSprite"),d=e("thor/audio/SoundSpriteResourceLoader"),g=e("thor/graphics/animation/actions/Actions"),p=e("thor/ui/Geometry"),m=e("thor/graphics/animation/Transform"),f=(e("events/GameStartingEvent"),e("thor/entity/EntityDestroyedEvent")),v=e("events/TransitionUIStateEvent"),y=e("thor/ui/Widget").VISIBILITY,E=(e("ShipSkinManager"),e("GameLogic"),e("player/PlayerManager"),
e("EntityFactory"),e("ui/DotJiggleAction")),S=e("ui/CommonActions"),T=e("ui/MessageDialog"),C=e("ui/WalletView"),I=e("ui/UIUtil"),w=e("ui/views/SmallCardView"),b=e("ui/views/OptionsRowView"),M=e("ui/views/EquippedCardsView"),x=e("ui/CardDetailDialog"),R=e("ui/CardUnavailableDialog"),P=e("ui/CardEquipDialog"),A=(e("ui/views/PopupDialog"),e("ui/PopupDialogEnum"),e("ui/FUEDialogBase")),N=e("ui/StandardFUEDialog"),D=e("ui/WarningPopup"),L=e("cards/CardRarityEnum"),O=(e("cards/CardInstance"),e("./UIState")),V=e("Constants"),B=e("ManagerRepository"),k=(e("player/CurrencyTypeEnum"),["vfx_thruster","vfx_thruster_no_tint"]),W=new p(0,0,1,1);i.exports=r.create(O,{initialize:function(e,t,i,r,s,o,_,h,u){O.prototype.initialize.call(this,e),this.__resourceManager=t,this.__widgetResource=t.get(l.RESOURCE_TYPE,"screen_ship_customize"),this.__eventManager=i,this.__dialogManager=r,this.__playerManager=s,this.__shipSkinManager=o,this.__entityFactory=_,this.__entityManager=_.getEntityManager(),this.__createWorld=h,this.__gameLogic=u,this.__timeoutContext=new a,this.__dotsTransform=new m,this.__dotsAction=null,this.__boundOrientationEvent=this.__onOrientationEvent.bind(this),this.__selectedColorIdx=-1,this.__selectedTextureIdx=-1,this.__shipSlotData={},this.__colorButtons=[],this.__buyButton=null,this.__buyButtonEquipLabels=[],this.__buyButtonBuyEquipLabels=[],this.__buyButtonCostLabels=[],this.__textureButtons=[],this.__shipWidget=null,this.__shipWorld=null,this.__shipEntity=null,this.__sounds=t.getOrDefault(d.RESOURCE_TYPE,"game_sounds",c.EMPTY_SOUND_SPRITE),this.__insufficientFundsContainer=null,this.__animations=[],this.__insufficientShowing=!1,this.__walletView=new C(h),this.__equippedCardsView=null,this.__optionsRowWidgets=null,this.__upgradesScrollWidget=null,this.__warningPopup=new D(t),this.__cardTransforms=[],this.__availableRowResource=t.get(l.RESOURCE_TYPE,"element_card_row"),this.__availableOptionsRowResource=t.get(l.RESOURCE_TYPE,"element_options_row"),n=this.__availableOptionsRowResource.construct().findSingleWidgetWithName("row").getNumSlots()},_constructWidget:function(){return this.__widgetResource.construct()},__animateScrollWidget:function(e){var t=this;this.__upgradesScrollWidget.runAction(g.tweenCallback(t.__upgradesScrollWidget.getVerticalScrollAmount(),e,100,function(e){t.__upgradesScrollWidget.setVerticalScrollRatio(e)},_.easeOut))},onEnter:function(){O.prototype.onEnter.call(this,!1),h.trackEvent("gqs","Screen Events",{playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),screenName:"ship"}),u.event("Screen Events",{contextId:this.__playerManager.getContextId(),playerLevel:this.__playerManager.getPlayerLevel(),playerXP:this.__playerManager.getPlayerXP(),gold:this.__playerManager.getPlayerGold(),screenName:"ship"}),this.__shipSlotData={};var e=this.__shipSkinManager.getAllShipsData();this.__playerManager.getPlayerShips();this.__topTray=this._widget.findSingleWidgetWithName("top_tray"),this.__walletView.attach(this.__topTray),this.__walletView.resume();this._widget.findSingleWidgetWithName("top_tray").findSingleWidgetWithName("player_level");this.__updatePlayerLevelXP(),this.__backButton=this._widget.findSingleWidgetWithName("btn_back");var t=this.__backButton.findSingleWidgetWithName("button");t.setClickHandler(this.__goHome.bind(this)),this.__backButtonOrange=this._widget.findSingleWidgetWithName("btn_backOrange"),this.__backButtonOrange.findSingleWidgetWithName("button").setClickHandler(this.__goHome.bind(this)),this.__backGlowTransform=new m,this.__backGlowTransform.setAction(g.loop(S.createPulse(1200,100))),this.__backButtonOrange.findSingleWidgetWithName("anim_glow").setTransform(this.__backGlowTransform),this.__backButtonOrange.setVisibility(y.HIDDEN),this.__shipWidget=this._widget.findSingleWidgetWithName("Ship").findSingleWidgetWithName("ship_preview"),this.__shipWorld=this.__createWorld(),this.__shipWidget.setWorld(this.__shipWorld),this.__shipEntity=I.createShip(this.__shipWorld,this.__entityFactory,this.__shipSkinManager,2,2),this._widget.findSingleWidgetWithName("BG_dots").setTransform(this.__dotsTransform,!0);var i=new E;i.jiggle(10,10),this.__dotsTransform.setAction(i),this.__dotsAction=i;var n=e[1],r=n.name;this._widget.findSingleWidgetWithName("label_ship_name").setText(r);var s={textures:[]},a=this._widget.findSingleWidgetWithName("skins"),_=a.getNumSlots(),l=n.arrTextureIds,c=Math.min(l.length,_);this.__textureButtons.length=0;for(var d=0;d<_;d++){var p=a.getSlotAtIndex(d).getWidget();if(d<c){for(var f=l[d],v=n.textures[f],T=[],C=v.arrSkinIds,w=0,b=C.length;w<b;w++){var M=C[w],x=n.skins[M];T.push({skinId:M,name:x.colorName})}s.textures.push({id:f,name:v.name,colors:T});var R=p.findSingleWidgetWithName("unequipped");R.setClickHandler(this.__textureSlotButtonClickHandler.bind(this,d)),R.setSoundSprite(this.__sounds);var P=p.findSingleWidgetWithName("equipped"),A=p.findSingleWidgetWithName("selected"),N={unequipped:R,equippedMask:P,selectedMask:A};this.__textureButtons.push(N)}else p.setVisibility(y.HIDDEN)}var D=this._widget.findSingleWidgetWithName("colours");this.__colorButtons.length=0;for(var L=D.getNumSlots(),d=0;d<L;d++){var p=D.getSlotAtIndex(d).getWidget(),R=p.findSingleWidgetWithName("unequipped");R.setClickHandler(this.__colorSlotButtonClickHandler.bind(this,d)),R.setSoundSprite(this.__sounds);var V=R.findWidgetsWithName("icon_colour"),k=p.findSingleWidgetWithName("unowned"),W=k.findSingleWidgetWithName("cost"),P=p.findSingleWidgetWithName("equipped"),A=p.findSingleWidgetWithName("selected"),F={unownedMask:k,unownedCostLabel:W,unequipped:R,unequippedColorSwatches:V,equippedMask:P,selectedMask:A};this.__colorButtons.push(F)}this.__shipSlotData[1]=s,this.__buyButton=this._widget.findSingleWidgetWithName("btn_yes"),this.__buyButton.setAutoToggle(!1),this.__buyButtonEquipLabels=this.__buyButton.findWidgetsWithName("label_center"),this.__buyButtonBuyEquipLabels=this.__buyButton.findWidgetsWithName("label_left"),this.__buyButtonCostLabels=this.__buyButton.findWidgetsWithName("cost"),this.__buyButton.setClickHandler(this.__buyButtonClickHandler.bind(this)),this.__insufficientFundsContainer=this._widget.findWidgetsWithName("insufficient")[0],this.__insufficientFundsContainer.setVisibility(y.HIDDEN);var U=this,G=this._widget.findSingleWidgetWithName("nav");this.__skinsTabButton=G.findSingleWidgetWithName("option2"),this.__skinsTabButton.setOn(!1),this.__skinsTabButton.setClickHandler(function(){if(!U.__skinsTabButton.isOn())return void U.__skinsTabButton.setOn(!0);U.__sounds.play("click"),U.__skinsContainer.setVisibility(y.VISIBLE),U.__upgradesTabButton.setOn(!1),U.__upgradesContainer.setVisibility(y.HIDDEN)}),this.__skinsContainer=this._widget.findSingleWidgetWithName("skins_tab"),this.__skinsContainer.setVisibility(y.HIDDEN),this.__insufficientFundsColorContainer=this.__skinsContainer.findSingleWidgetWithName("insufficient"),this.__insufficientFundsColorContainer.setVisibility(y.HIDDEN),this.__upgradesTabButton=G.findSingleWidgetWithName("option1"),this.__upgradesTabButton.setOn(!0),this.__upgradesTabButton.setClickHandler(function(){if(!U.__upgradesTabButton.isOn())return void U.__upgradesTabButton.setOn(!0);U.__sounds.play("click"),U.__upgradesContainer.setVisibility(y.VISIBLE),U.__skinsTabButton.setOn(!1),U.__skinsContainer.setVisibility(y.HIDDEN)}),this.__upgradesContainer=this._widget.findSingleWidgetWithName("upgrades_tab"),this.__upgradesContainer.setVisibility(y.VISIBLE),this.__upgradesScrollWidget=this.__upgradesContainer.findSingleWidgetWithName("scrolling"),this.__lowerFUEDialog=this._widget.findSingleWidgetWithName("popup_FUE"),this.__lowerFUEDialog.setVisibility(y.HIDDEN),this.__lowerFUEDialog.findSingleWidgetWithName("CanvasPanel").addSlot(function(e){U.__lowerFUEDialogSlot=e}),this.__upperFUEDialog=this._widget.findSingleWidgetWithName("popup_FUE2"),this.__upperFUEDialog.setVisibility(y.HIDDEN),this.__upperFUEDialog.findSingleWidgetWithName("CanvasPanel").addSlot(function(e){U.__upperFUEDialogSlot=e}),this.__populateCards(),this.__refreshPurchaseData(),this._invalidate(),o.isDefined(window.DeviceOrientationEvent)&&window.addEventListener("deviceorientation",this.__boundOrientationEvent,!0);var H=B.getFUEManager();if(H.isInEquipSequence()){this.__skinsTabButton.setEnabled(!1),t.setEnabled(!1);var q=this.__playerManager.getOwnedCards();q[0].equipped?(H.setEquippedCard(!0),q[0].level>0?(H.setLeveledUpCard(!0),this.__backButton.setVisibility(y.HIDDEN),H.tryFinishEquipSequence().then(function(){U.__backButtonOrange.setVisibility(y.VISIBLE)})):this.__showEnhanceFUEDialog()):this.__showEquipFUEDialog()}this._invalidate()},__showEquipFUEDialog:function(){var e=new N("Tap the card and equip it to your ship.");A.showDialog(e,this.__lowerFUEDialogSlot),this.__lowerFUEDialog.setVisibility(y.VISIBLE),this.__lowerFUEDialog.invalidate()},__showEnhanceFUEDialog:function(){var e=new N('Now that the Proton Equalizer is equipped to your ship, let\'s "ENHANCE" it to make it stronger.','Tap the card and select "INFO".');A.showDialog(e,this.__upperFUEDialogSlot),this.__upperFUEDialog.setVisibility(y.VISIBLE),this.__upperFUEDialog.invalidate()},__hideLowerFUEDialog:function(){this.__lowerFUEDialog.setVisibility(y.HIDDEN)},__hideUpperFUEDialog:function(){this.__upperFUEDialog.setVisibility(y.HIDDEN)},__populateCards:function(){function e(e,t,i){this.__cardViews.push(i),i.show(t,this.__gameLogic.getCardParameters(),this.__onUnequippedCardPressed.bind(this,e))}this.__openOptionsIndex=null,this.__setupLockedCards();for(var t=this,i=this.__playerManager.getOwnedCards(),r=this.__upgradesContainer.findSingleWidgetWithName("available_options"),s=this.__upgradesContainer.findSingleWidgetWithName("available"),o=s.getNumSlots(),a=o-1;a>0;--a)s.removeSlotAtIndex(a);o=r.getNumSlots();for(var a=o-1;a>0;--a)r.removeSlotAtIndex(a);var _=[],l=[];this.__cardViews=[],this.__optionsRowWidgets=[],this.__optionsRowViews=[],r.addSlot(function(e){var i=t.__availableOptionsRowResource.construct();i.setVisibility(y.HIDDEN),e.setWidget(i)});for(var h=0,u=0;u<i.length;++u)i[u].equipped&&h++;for(var c=Math.max(1,Math.ceil((i.length-h)/n)),u=0;u<c;++u)s.addSlot(function(e){var i=t.__availableRowResource.construct();_.push(i);for(var r=0;r<n;++r)l.push(i.findSingleWidgetWithName("slot"+(r+1)));e.setWidget(i)}),r.addSlot(function(e){for(var i=t.__availableOptionsRowResource.construct(),r=0;r<n;++r){i.findSingleWidgetWithName("slot"+(r+1)).setVisibility(y.HIDDEN)}t.__optionsRowViews.push(new b(i)),t.__optionsRowWidgets.push(i),e.setWidget(i)});s.findSingleWidgetWithName("remaining_space").setText("("+i.length+"/"+V.INVENTORY_SIZE+")"),this.__unequippedCards=i.filter(function(e){return!e.equipped});for(var d=this.__unequippedCards.length,g=0;g<d;++g){var p=this.__unequippedCards[g],m=g%n,f=~~(g/n);this.__optionsRowViews[f].setupButtonCallbacks(m,this.__sounds,this.__onInfoPressed.bind(this,p),this.__onEquipPressed.bind(this,p)),w.addToContainer(l[g]).then(e.bind(this,g,p))}var v=this.__upgradesContainer.findWidgetsWithName("equipped")[0];this.__equippedCardsView&&v.removeSlot(this.__equippedCardsView.getSlot()),M.addToContainer(v,this.__playerManager,this.__eventManager).then(function(e){t.__equippedCardsView=e,e.show(t.__playerManager.getEquippedCards(),t.__gameLogic.getCardParameters(),v.findSingleWidgetWithName("options"),t.__onInfoPressed.bind(t),t.__onEquippedCardPressed.bind(t))}),this.__upgradesScrollWidget.setVerticalScrollRatio(0),this._widget.invalidate()},__setupLockedCards:function(){for(var e=this.__playerManager.getOwnedCards(),t=this.__upgradesContainer.findSingleWidgetWithName("not_available"),i=t.getNumSlots(),r=i-1;r>0;--r)t.removeSlotAtIndex(r);var o=[],a=[];for(var _ in this.__gameLogic.getCardParameters().cardTypes){_=+_;e.find(function(e){return e.id===_})||a.push(_)}var l=this;a.sort(function(e,t){var i=l.__gameLogic.getCardParameters().cardTypes[e],n=l.__gameLogic.getCardParameters().cardTypes[t];return i.minPlayerLevel!==n.minPlayerLevel?i.minPlayerLevel-n.minPlayerLevel:i.rarity-n.rarity});for(var h=a.length,u=Math.max(1,Math.ceil(h/n)),c=0;c<u;++c)t.addSlot(function(e){var t=l.__availableRowResource.construct();o.push(t),e.setWidget(t)});var d=-1,g=0,p=0,m=this.__playerManager.getPlayer().level;a.forEach(function(e){function t(){if(l.__sounds.play("click"),i.rarity===L.EPIC){a.getGeometry(W);var t=W.getX(),n=W.getY(),r=W.getWidth();return l.__sounds.play("insufficient_funds"),void l.__warningPopup.attach(l._widget,D.WarningTypeEnum.CLASSIFIED,t-r/2,n,l.__gameLogic.getBounds())}var o=new R(l.__resourceManager,e,l.__gameLogic.getCardParameters(),l.__walletView);o.show(l.__dialogManager),o.waitForClosed().then(function(e){s.warn("Result:",e),l.__walletView.attach(l.__topTray),l.__walletView.resume(),l.__walletView.getContainer().runAction(S.createDialogBlinkIn())})}var i=this.__gameLogic.getCardParameters().cardTypes[e];p%n==0&&(d++,g=0);var r=o[d],a=r.findSingleWidgetWithName("slot"+(g+1));w.addToContainer(a).then(function(i){i.showUnavailable(e,l.__gameLogic.getCardParameters(),m,t)}),g++,p++},this)},__closeLastOptionsView:function(){if(o.isNumber(this.__openOptionsIndex)){var e=~~(this.__openOptionsIndex/n),t=this.__openOptionsIndex%n;this.__optionsRowWidgets[e].findSingleWidgetWithName("slot"+(t+1)).setVisibility(y.HIDDEN),this.__cardViews[this.__openOptionsIndex].tryAnimateFlash(),this.__optionsRowViews[e].stopAnimatingEquip(t),this.__openOptionsIndex=null}this.__equippedCardsView.clearOptions()},__onEquippedCardPressed:function(){this.__sounds.play("click"),this.__closeLastOptionsView(),this.__animateScrollWidget(0)},__onUnequippedCardPressed:function(e){this.__sounds.play("click");var t=~~(e/n),i=e%n,r=this.__optionsRowWidgets[t].findSingleWidgetWithName("slot"+(i+1)),s=r.getVisibility();this.__closeLastOptionsView(),s===y.HIDDEN&&(this.__openOptionsIndex=e,r.setVisibility(y.VISIBLE),B.getFUEManager().isInEquipSequence()&&(this.__optionsRowViews[t].animateFlashEquip(i),this.__optionsRowViews[t].disableInfoButtons()),this.__cardViews[e].stopAnimating(),S.expandOptionsWidget(r));var o=624*(t+1)/this.__upgradesScrollWidget.getDesiredSize().y;this.__animateScrollWidget(o)},__onEquipPressed:function(e){var t=new P(this.__resourceManager,e,this.__gameLogic.getCardParameters(),this.__playerManager,this.__eventManager),i=this;t.show(this.__dialogManager),t.waitForClosed().then(function(){i.__populateCards(),i._widget.runAction(S.createDialogBlinkIn());var e=B.getFUEManager();e.isInEquipSequence()&&e.hasEquippedCard()&&(i.__hideLowerFUEDialog(),i.__showEnhanceFUEDialog())}),this._widget.runAction(S.createDialogBlinkOut())},__onInfoPressed:function(e){var t=new x(this.__resourceManager,this.__entityManager,e,this.__gameLogic.getCardParameters(),this.__playerManager,this.__createWorld,this.__walletView);this.__walletView.getContainer().runAction(S.createDialogBlinkOut()),this.__hideUpperFUEDialog();var i=this;t.show(this.__dialogManager),t.waitForClosed().then(function(e){s.warn("CardDetailDialog result:",e),e!==x.RESULT_SCRAP&&e!==x.RESULT_LEVEL_UP||(i.__populateCards(),i.__updatePlayerLevelXP()),i.__walletView.attach(i.__topTray),i.__walletView.resume(),i.__walletView.getContainer().runAction(S.createDialogBlinkIn()),B.getFUEManager().wasInEquipSequence()&&(i.__backButtonOrange.setVisibility(y.VISIBLE),i.__backButton.setVisibility(y.HIDDEN))})},__createInsufficientFundsAnimation:function(e){this.__insufficientShowing=!0;var t=this.__animations.length;if(t>0)for(var i=0;i<t;++i)this.__animations[i].getAction().reset();else{var n=this.__insufficientFundsColorContainer.findSingleWidgetWithName("BG"),r=this.__insufficientFundsColorContainer.findSingleWidgetWithName("frame"),s=this.__insufficientFundsColorContainer.findSingleWidgetWithName("label_insufficient");this.__insufficientFundsColorContainer.invalidate();var o=this,a=new m;n.setTransform(a,!0);var _=g.sequence(g.callback(function(){o.__insufficientFundsColorContainer.setVisibility(y.VISIBLE)}),g.fadeTo(0,0),g.scaleTo(1,.5,0),g.fadeTo(1,100),g.wait(50),g.scaleTo(1,1,50),g.wait(294),g.wait(e),g.wait(100),g.fadeTo(0,50),g.callback(function(){o.__insufficientFundsColorContainer.setVisibility(y.HIDDEN),o.__insufficientShowing=!1}));a.setAction(_),this.__animations.push(a);var l=new m;r.setTransform(l,!0);var h=g.sequence(g.fadeTo(0,0),g.scaleTo(1,.01,0),g.wait(100),g.fadeTo(1,0),g.scaleTo(1,.5,50),g.scaleTo(1,1,50),g.wait(294),g.wait(e),g.wait(100),g.fadeTo(0,50));l.setAction(h),this.__animations.push(l);var u=new m;s.setTransform(u);var c=g.sequence(g.fadeTo(0,0),g.wait(200),S.createDialogBlinkIn(),g.wait(e),g.fadeTo(0,50));u.setAction(c),this.__animations.push(u)}},__createPlayerShip:function(){var e=this.__shipWorld.getScene(),t=this.__entityFactory.createEntity("Ship07",this.__shipWorld,{sortOrder:V.PLAYER_Z_INDEX,attachParent:e.getRootComponent()}),i=t.getRootComponent();i.setTranslation(0,0),i.setScale(2,2);for(var n=0,r=k.length;n<r;++n){var o=k[n],a=t.getComponentByName(o);a?a.setTintColor(V.TINT_INVISIBLE):s.warn("Could not find layer "+o+" to hide")}return this.__shipSkinManager.setEquippedSkin(t),t},__refreshPurchaseData:function(){for(var e=this.__playerManager.getPlayer(),t=e.equippedShipId,i=(this.__playerManager.getPlayerShips(),this.__shipSlotData[t]),n=e.equippedSkinId,r=this.__getTextureIdForSkinId(t,n),s=0,o=this.__textureButtons.length;s<o;s++){var a=i.textures[s],_=this.__textureButtons[s],l=r===a.id;_.equippedMask.setVisibility(l?y.VISIBLE:y.HIDDEN)}this.__selectEquipped()},__setupBuyEquipButton:function(e,t,i){if(this.__buyButton.setEnabled(!e),t)this.__buyButton.setOn(!0),this.__buyButtonEquipLabels.forEach(function(t){t.setVisibility(y.VISIBLE),e?t.setText("ALREADY EQUIPPED"):t.setText("EQUIP")}),this.__buyButtonBuyEquipLabels.forEach(function(e){e.setVisibility(y.HIDDEN)}),this.__buyButtonCostLabels.forEach(function(e){e.setVisibility(y.HIDDEN)});else{var n=this.__playerManager.getPlayerGold(),r=n>=i;this.__buyButton.setOn(r),this.__buyButtonCostLabels.forEach(function(e){e.setVisibility(y.VISIBLE),e.setText(V.COINS_SYMBOL+i)}),this.__buyButtonEquipLabels.forEach(function(e){e.setVisibility(y.HIDDEN)}),r?this.__buyButtonBuyEquipLabels.forEach(function(e){e.setVisibility(y.VISIBLE),e.setText("BUY & EQUIP")}):this.__buyButtonBuyEquipLabels.forEach(function(e){e.setVisibility(y.VISIBLE),e.setText("BUY")})}this.__buyButton.invalidate()},__selectEquipped:function(){var e=this.__playerManager.getPlayer(),t=e.equippedShipId,i=e.equippedSkinId,n=this.__getTextureIdForSkinId(t,i),r=this.__getTextureIdx(t,n),s=this.__getColorIdx(t,r,i);this.__select(t,r,s)},__getColorIdx:function(e,t,i){for(var n=this.__shipSlotData[e],r=n.textures[t],o=0,a=r.colors.length;o<a;o++){if(r.colors[o].skinId===i)return o}return s.error("Could not find color slot for ship "+e+" texture index "+t+" and skin id "+i),0},__getTextureIdx:function(e,t){for(var i=this.__shipSlotData[e],n=0,r=i.textures.length;n<r;n++){if(i.textures[n].id===t)return n}return s.error("Could not find texture slot for ship "+e+" and texture "+t),0},__getTextureIdForSkinId:function(e,t){for(var i=this.__shipSlotData[e],n=0,r=i.textures.length;n<r;n++)for(var o=i.textures[n],a=0,_=o.colors.length;a<_;a++){var l=o.colors[a];if(l.skinId===t)return o.id}return s.error("Could not find skin id "+t+" for ship "+e),"unknown"},__setColorsForTexture:function(e,t,i){for(var n=this.__shipSlotData[e],r=n.textures[t],s=r.colors,o=s.length,a=this.__colorButtons.length,_=0;_<a;_++){var l=this.__colorButtons[_];if(l.unownedMask.setVisibility(y.HIDDEN),l.equippedMask.setVisibility(y.HIDDEN),l.selectedMask.setVisibility(y.HIDDEN),_<o){l.unequipped.setVisibility(y.VISIBLE);var h=s[_],u=h.skinId;if(_===i)l.equippedMask.setVisibility(y.VISIBLE);else if(!this.__shipSkinManager.isSkinOwned(e,u)){l.unownedMask.setVisibility(y.VISIBLE);var c=this.__shipSkinManager.getSkinCost(e,u);l.unownedCostLabel.setText(V.COINS_SYMBOL+c.toLocaleString())}for(var d=0,g=l.unequippedColorSwatches.length;d<g;d++){var p=l.unequippedColorSwatches[d],h=this.__shipSkinManager.getPrimarySkinColor(e,u);p.setTintColor(h)}}else l.unequipped.setVisibility(y.HIDDEN)}},__select:function(e,t,i){var n=this.__shipSlotData[e],r=n.textures[t],s=r.colors[i],o=this.__playerManager.getPlayer(),a=o.equippedShipId,_=o.equippedSkinId,l=this.__getTextureIdForSkinId(a,_),h=this.__getTextureIdx(a,l),u=t===h,c=-1;u&&(c=this.__getColorIdx(a,t,_));for(var d=0,g=this.__textureButtons.length;d<g;d++){var p=this.__textureButtons[d],m=d===t;p.selectedMask.setVisibility(m?y.VISIBLE:y.HIDDEN)}this.__setColorsForTexture(e,t,c);for(var f=0,v=this.__colorButtons.length;f<v;f++){var E=this.__colorButtons[f],m=f===i;E.selectedMask.setVisibility(m?y.VISIBLE:y.HIDDEN)}this.__selectedColorIdx=i,this.__selectedTextureIdx=t;var S=s.skinId;this.__shipSkinManager.setShipSkin(this.__shipEntity,e,S);var T=e===a&&S===_,C=this.__shipSkinManager.isSkinOwned(e,S),I=this.__shipSkinManager.getSkinCost(e,S);this.__setupBuyEquipButton(T,C,I)},__selectTexture:function(e,t){var i=this.__shipSlotData[e].textures[t].id,n=this.__shipSkinManager.getFirstOwnedSkinForTexture(e,i),r=0;o.isNumber(n)&&(r=this.__getColorIdx(e,t,n)),this.__select(e,t,r)},__selectColor:function(e,t){this.__select(e,this.__selectedTextureIdx,t)},__textureSlotButtonClickHandler:function(e){if(this.__selectedTextureIdx!==e){var t=this.__playerManager.getPlayer(),i=t.equippedShipId,n=t.equippedSkinId,r=this.__getTextureIdForSkinId(i,n),s=this.__getTextureIdx(i,r);if(e===s){var o=this.__getColorIdx(i,s,n);return void this.__select(i,s,o)}this.__selectTexture(i,e)}},__colorSlotButtonClickHandler:function(e){this.__selectedColorIdx!==e&&this.__selectColor(1,e)},__buyButtonClickHandler:function(){var e=this,t=this.__selectedColorIdx,i=this.__selectedTextureIdx,n=this.__shipSlotData[1],r=n.textures[i],o=r.colors[t],a=o.skinId,_=this.__playerManager.getPlayer(),l=_.equippedShipId,h=_.equippedSkinId;if(1===l&&a===h)return void this.__sounds.play("click");if(!this.__buyButton.isOn()){if(this.__insufficientShowing)return;return this.__sounds.play("insufficient_funds"),void this.__createInsufficientFundsAnimation(1e3)}if(this.__buyButton.setEnabled(!1),this.__shipSkinManager.isSkinOwned(1,a))return this.__sounds.play("equip"),void this.__playerManager.equipShipSkin(1,a).then(function(t){if(e.__buyButton.setEnabled(!0),!t)return void e.__showMessageDialog("Data Error","There was an error handling your request. Please try again.");e.__refreshPurchaseData()}).catch(function(t){s.error("Got an error from equip: ",t),e.__showMessageDialog("Server Error","There was an error with the server and we could not process your request. Please try again.")});this.__sounds.play("buy"),this.__playerManager.purchaseSkin(1,a,!0).then(function(){e.__buyButton.setEnabled(!0),e.__refreshPurchaseData()}).catch(function(t){s.error("Got an error from purchase: ",t),"Not Enough Gold"===t?e.__showMessageDialog("Insufficient Funds","You have insufficient funds. Please collect more coins and try again."):e.__showMessageDialog("Data Error","There was an error handling your purchase request. We have not deducted coins from your balance. Please try again.")})},onExit:function(){this.__timeoutContext.clearAll(),this.__walletView.detach(),o.isDefined(window.DeviceOrientationEvent)&&window.removeEventListener("deviceorientation",this.__boundOrientationEvent),this.__colorButtons.length=0,this.__buyButton=null,this.__buyButtonEquipLabels.length=0,this.__buyButtonBuyEquipLabels.length=0,this.__buyButtonCostLabels.length=0,this.__textureButtons.length=0,this.__skinsTabButton=null,this.__skinsContainer=null,this.__upgradesTabButton=null,this.__upgradesContainer=null,this.__upgradesScrollWidget=null,this.__insufficientFundsContainer=null,this.__insufficientFundsColorContainer=null,this.__optionsRowWidgets=null,this.__shipWidget.clearWorld(),this.__shipWorld.destroy();var e=this.__eventManager.getNewEvent(f);e.setEntityId(this.__shipEntity.getId()),this.__eventManager.queueEvent(e),this.__shipWidget=null,this.__shipWorld=null,this.__shipEntity=null,this.__playerManager.markAllCardsSeen(),O.prototype.onExit.call(this)},__onOrientationEvent:function(e){var t=e.gamma||0;this.__dotsAction.setOrientation(t)},__goHome:function(){this.__sounds.play("back"),B.getFUEManager().setWasInEquipSequence(!1);var e=this.__eventManager.getNewEvent(v);e.setState("Home"),this.__eventManager.queueEvent(e)},__showMessageDialog:function(e,t){new T(this.__resourceManager,e,t).show(this.__dialogManager)},__updatePlayerLevelXP:function(){var e=this.__playerManager.getPlayerLevel(),t=this.__playerManager.getPlayerXP();this.__walletView.setLevelXP(e,t)},update:function(e){this.__dotsTransform.update(e),this.__warningPopup.update(e),this.__equippedCardsView&&this.__equippedCardsView.update(e),this.__backGlowTransform&&this.__backGlowTransform.update(e);for(var t=this.__animations.length,i=0;i<t;++i)this.__animations[i].update(e);t=this.__cardViews.length;for(var i=0;i<t;++i)this.__cardViews[i].update(e);t=this.__optionsRowViews.length;for(var i=0;i<t;++i)this.__optionsRowViews[i].update(e)}})}),define("ui/UIManager",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Validation","thor/graphics/Surface","thor/platforms/Facebook","thor/ui/Anchor","thor/config/Config","thor/ui/Widget","thor/core/Logger","thor/ui/Widget","thor/audio/SoundSprite","thor/event/EventManager","thor/util/LocalStorage","thor/audio/SoundManager","thor/ui/resources/WidgetResource","thor/resources/ResourceManager","thor/ui/DialogManager","thor/graphics/resources/TextureRegionResource","thor/util/FSM","thor/util/Timing","thor/util/StringUtil","thor/util/Alert","events/ExplodePlayerEvent","events/HideMenuUIEvent","events/ShowMenuUIEvent","events/GameEndStatsEvent","events/AudioMuteChangedEvent","events/FriendScoresLoadedEvent","events/GameResetEvent","events/ChangeMusicEvent","events/GameStartingEvent","events/ReturnToFacebookEvent","events/TransitionUIStateEvent","thor/entity/EntityManager","Constants","GameLogic","GiftManager","LaserManager","EntityFactory","player/PlayerManager","ShipSkinManager","AchievementManager","LeaderboardManager","GachaManager","raid/RaidManager","gameplay/Tournament","thor/ui/CanvasPanel","thor/ui/ImageWidget","ui/AudioMuteEnum","ui/MusicTypeEnum","ui/states/HomeState","ui/states/GameplayState","ui/states/AchievementState","ui/states/LeaderboardState","ui/states/ShipCustomizationState"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Device"),s=(e("thor/core/Validation"),e("thor/graphics/Surface"),e("thor/platforms/Facebook"),e("thor/ui/Anchor"),e("thor/config/Config"),e("thor/ui/Widget"),e("thor/core/Logger").getLogger(i)),o=(e("thor/ui/Widget").VISIBILITY,e("thor/audio/SoundSprite"),e("thor/event/EventManager"),e("thor/util/LocalStorage"),e("thor/audio/SoundManager")),a=(e("thor/ui/resources/WidgetResource"),e("thor/resources/ResourceManager"),e("thor/ui/DialogManager"),e("thor/graphics/resources/TextureRegionResource"),e("thor/util/FSM")),_=(e("thor/util/Timing"),e("thor/util/StringUtil")),l=(e("thor/util/Alert"),e("events/ExplodePlayerEvent")),h=e("events/HideMenuUIEvent"),u=e("events/ShowMenuUIEvent"),c=(e("events/GameEndStatsEvent"),e("events/AudioMuteChangedEvent")),d=(e("events/FriendScoresLoadedEvent"),e("events/GameResetEvent")),g=e("events/ChangeMusicEvent"),p=(e("events/GameStartingEvent"),e("events/ReturnToFacebookEvent")),m=e("events/TransitionUIStateEvent"),f=(e("thor/entity/EntityManager"),e("Constants")),v=(e("GameLogic"),e("GiftManager"),e("LaserManager"),e("EntityFactory"),e("player/PlayerManager"),e("ShipSkinManager"),e("AchievementManager"),e("LeaderboardManager")),y=(e("GachaManager"),e("raid/RaidManager"),e("gameplay/Tournament"),e("thor/ui/CanvasPanel"),e("thor/ui/ImageWidget"),e("ui/AudioMuteEnum")),E=e("ui/MusicTypeEnum"),S=e("ui/states/HomeState"),T=e("ui/states/GameplayState"),C=e("ui/states/AchievementState"),I=e("ui/states/LeaderboardState"),w=e("ui/states/ShipCustomizationState");n.create({initialize:function(){this.reset()},reset:function(){this.killPoints=0,this.distancePoints=0,this.distance=0,this.goldGained=0,this.missionProgress=null,this.tournament=null,this.maxKillStreak=0}});i.exports=n.create({initialize:function(e,t,i,n,s,o,_,f,y,E,b,M,x,R){this.__resourceManager=e,this.__eventManager=t,this.__gameLogic=_,this.__dialogManager=o,this.__playerManager=f,this.__giftManager=E,this.__shipSkinManager=b,this.__achievementManager=M,this.__raidManager=R;var P=new a("UIManager");P.addState("Home",new S(i,e,t,o,_,f,E,s,b)),P.addState("Gameplay",new T(i,e,n.getEntityManager(),t,o,_,f,y,M,R,s)),P.addState("Ship Customization",new w(i,e,t,o,f,b,n,s,_)),P.addState("Achievement",new C(i,e,t,o,f,M,s)),P.addState("Leaderboard",new I(i,e,t,o,f,s)),P.addTransition("Home","Gameplay"),P.addTransition("Gameplay","Home"),P.addTransition("Home","Ship Customization"),P.addTransition("Ship Customization","Home"),P.addTransition("Home","Achievement"),P.addTransition("Achievement","Home"),P.addTransition("Home","Leaderboard"),P.addTransition("Leaderboard","Home"),P.setStartState("Home"),P.reset(),this.__fsm=P,v.setCreateWorld(s),t.registerEventHandler(l.EVENT_TYPE,this.__playerExplodedEventHandler.bind(this)),t.registerEventHandler(h.EVENT_TYPE,this.__hideMenuUIEventHandler.bind(this)),t.registerEventHandler(u.EVENT_TYPE,this.__showMenuUIEventHandler.bind(this)),t.registerEventHandler(c.EVENT_TYPE,this.__audioMuteChangedEventHandler.bind(this)),t.registerEventHandler(p.EVENT_TYPE,this.__returnToFacebookEventHandler.bind(this)),t.registerEventHandler(m.EVENT_TYPE,this.__transitionUIStateEventHandler.bind(this)),t.registerEventHandler(d.EVENT_TYPE,this.__gameResetEventHandler.bind(this)),t.registerEventHandler(g.EVENT_TYPE,this.__ensureMusicIsPlaying.bind(this)),r.isAndroidDevice&&this.__setAndroidMusicHandlers()},__audioMuteChangedEventHandler:function(e){var t=e.getCategory(),i=e.getEnabled();o.isMuted()&&o.unmute();var n=o.isMutedChannel("MASTER"),r=o.isMutedChannel("SFX"),a=o.isMutedChannel("BGM");switch(t){case y.TOGGLE:i?(o.unmuteChannel("MASTER"),r&&a&&(o.unmuteChannel("SFX"),o.unmuteChannel("UI_SFX"),o.unmuteChannel("BGM"))):o.muteChannel("MASTER");break;case y.SOUND:i?(o.unmuteChannel("SFX",!0),o.unmuteChannel("UI_SFX",!0),n&&(o.muteChannel("BGM"),o.unmuteChannel("MASTER"))):(o.muteChannel("SFX"),o.muteChannel("UI_SFX"),a&&o.muteChannel("MASTER"));break;case y.MUSIC:i?(o.unmuteChannel("BGM",!0),n&&(o.muteChannel("SFX"),o.muteChannel("UI_SFX"),o.unmuteChannel("MASTER"))):(o.muteChannel("BGM"),r&&o.muteChannel("MASTER"));break;default:s.warn("Not a valid audio state.")}},__playerExplodedEventHandler:function(e){if("autoTest"!==_.getUrlParams().mode){var t=this.__gameLogic.getPoints();v.setScoreToFBLeaderboard(t)}},__returnToFacebookEventHandler:function(e){var t=this.__eventManager.getNewEvent(d);this.__eventManager.queueEvent(t)},__hideMenuUIEventHandler:function(e){this.__changeMusicVolume(1,f.PAUSE_VOLUME_FADE_DURATION_SECONDS)},__showMenuUIEventHandler:function(e){this.__changeMusicVolume(f.PAUSE_VOLUME,f.PAUSE_VOLUME_FADE_DURATION_SECONDS)},__ensureMusicIsPlaying:function(e){var t=this.__fsm.getCurrentState(),i=0;if(e&&(i=e.getMusicType()),i===E.GAMEPLAY||0===i&&"Gameplay"===t){if(this.__musicSprite.isSoundPlaying("intro")||this.__musicSprite.isSoundPlaying("loopable_track"))return;this.__musicSprite.isSoundPlaying("menu_loop")&&this.__musicSprite.stop("menu_loop");var n=this;this.__musicSprite.play("intro",{loop:!1,channel:"BGM",onFinished:function(){"Gameplay"===n.__fsm.getCurrentState()&&n.__musicSprite.playLoopingMusicWithTail("loopable_track",{tailDuration:1.0507057,channel:"BGM"})}})}else{if(this.__musicSprite.isSoundPlaying("menu_loop"))return;this.__musicSprite.isSoundPlaying("intro")&&this.__musicSprite.stop("intro"),this.__musicSprite.isSoundPlaying("loopable_track")&&this.__musicSprite.stop("loopable_track"),
this.__musicSprite.playLoopingMusicWithTail("menu_loop",{tailDuration:.37333,channel:"BGM"})}},__changeMusicVolume:function(e,t){var i=o.isMutedChannel("BGM");o.isMuted()||o.isMutedChannel("MASTER")||i||o.transitionGainForChannel("BGM",{endValue:e,duration:t})},__setAndroidMusicHandlers:function(){window.document.addEventListener("visibilitychange",function(e){"hidden"===e.currentTarget.visibilityState?o.muteChannel("BGM"):o.unmuteChannel("BGM")})},__transitionUIStateEventHandler:function(e){var t=e.getState();this.__fsm.transitionTo(t),this.__ensureMusicIsPlaying()},__gameResetEventHandler:function(e){this.__fsm.reset(),this.__ensureMusicIsPlaying(),o.setChannelGain("SFX",1,0)},setMusicSprite:function(e){this.__musicSprite=e,this.__ensureMusicIsPlaying()},update:function(e){this.__fsm.getCurrentStateInstance().update(e)}})}),define("SkeletonFactory",["require","exports","module","thor/core/Class","thor/core/Validation","thor/entity/Entity","thor/entity/World","thor/resources/ResourceManager","thor/entity/EntityManager","thor/graphics/animation/skeleton/SkeletonInstance","thor/graphics/animation/skeleton/SkeletonResource"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation"),s=(e("thor/entity/Entity"),e("thor/entity/World"),e("thor/resources/ResourceManager"),e("thor/entity/EntityManager"),e("thor/graphics/animation/skeleton/SkeletonInstance")),o=e("thor/graphics/animation/skeleton/SkeletonResource");i.exports=n.create({initialize:function(e,t){this.__resourceManager=e,this.__entityManager=t,this.__templates={}},load:function(e){var t=this.__templates[e];if(t)return t;var i=this.__entityManager.createEntity(),n=this.__entityManager.addComponent(i,"SceneComponent",!1);return i.setRootComponent(n),this.addToEntity(i,e),this.__templates[e]=i,i},addToEntity:function(e,t){var i=this.__resourceManager.get(o.RESOURCE_TYPE,t),n=new s(i),r=e.getRootComponent(),a=this.__entityManager.addComponent(e,"SkeletonComponent",!1);return a.attachTo(r),a.setSkeleton(n),a},create:function(e,t,i){r.ifDefined.assertIsObject(i);var n=this.__templates[e];if(n||(n=this.load(e)),!n)throw new Error("Failed to create spine name "+e);return t.spawnEntity(n,i)}})}),define("thor/util/CompressUtil",["require","exports","module","thor/core/Validation"],function(e,t,i){e("thor/core/Validation");i.exports={writeVarInt:function(e,t,i){var n=0,r=(4294967295&i)<<1^(4294967295&i)>>31;do{var s=127&r;r>>=7,0!=r&&(s|=128),e[t]=s,t++,n++}while(r);return n},readVarInt:function(e,t){for(var i=0,n=0,r=!1;!r;){var s=e[t];i+=(127&s)<<n,t++,n+=7,0==(128&s)&&(r=!0)}return 1&i?(i+1)/-2:i/2},readVarIntBytes:function(e,t){for(var i=0;;){var n=e[t];if(i++,t++,0==(128&n))break}return i}}}),define("ReplayManager",["require","exports","module","thor/core/Base","thor/core/Class","thor/config/Config","thor/core/Logger","thor/core/Validation","thor/platforms/Google","thor/analytics/Seidr","thor/util/Network","thor/util/CompressUtil","thor/util/StringUtil","ManagerRepository"],function(e,t,i){var n=(e("thor/core/Base"),e("thor/core/Class")),r=e("thor/config/Config"),s=e("thor/core/Logger").getLogger(i),o=e("thor/core/Validation"),a=e("thor/platforms/Google"),_=e("thor/analytics/Seidr"),l=e("thor/util/Network"),h=e("thor/util/CompressUtil"),u=e("thor/util/StringUtil"),c=e("ManagerRepository"),d=r.REST_SERVER_URL+"/replay",g=r.REST_SERVER_URL+"/pick",p=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date);i.exports=n.create({initialize:function(){this.__replays=[],this.__nextReplayLocalName=null,this.__lastRefresh=0,this.__generation=0,this.__pending=0,this.__picks={replays:[],playerRank:-1},this.__isEnabled=!1},isEnabled:function(){return this.__isEnabled},clearReplay:function(){this.__guid=null,this.__seed=null,this.__replays.length=0},getReplays:function(){return this.__replays},setReplays:function(e){this.__picks={replays:e.map(function(e){return e.id}),playerRank:-1},this.__replays=e,this.__pending=0,this.__lastRefresh=Date.now(),this.__generation++},handleAuth:function(){return this.__isEnabled=!0,this.__isEnabled||s.trace("Replays disabled for player/group",playerManager.getFacebookId(),playerManager.getTestingGroup()),Promise.resolve(this.__isEnabled)},getLastRefresh:function(){return this.__lastRefresh},refresh:function(){c.getFUEManager().areReplaysEnabled()&&this.__isEnabled&&(this.__lastRefresh=Date.now(),this.__generation++,s.trace("refreshing replays gen",this.__generation),this.__pick(this.__generation))},__pick:function(e){var t=c.getPlayerManager(),i=(t.getFacebookId(),t.getContextId());if(!o.isNonEmptyString(i))return Promise.resolve([]);if(!this.__isEnabled)return Promise.resolve([]);var n=this,r=g+u.interpolate("?playerId={playerId}&contextId={contextId}",{playerId:t.getFacebookId(),contextId:i});return l.getJSON(r).then(function(t){if(!(n.__generation>e)){s.debug("Loaded replays: ",t);var i=t.replays;n.__picks=t,n.__replays.length=0,n.__pending=i.length;var r=i.map(function(t){return n.__loadReplay(t.replayId,t.position).catch(function(e){return s.error("failed to load replay "+t.replayId+": "+e),null}).then(function(t){return n.__generation===e&&(n.__pending--,t&&(n.__replays.push(t),s.log("loaded replay (rank ",t.rank+1,"): ",n.__replays.length,"/",i.length))),t})});return Promise.all(r)}})},__loadReplay:function(e,t){var i=this,n=d+"?replayId="+e,r={responseType:"arraybuffer"},a=p(),_=0;return l.request("GET",n,r).then(function(n){var r=+n.getResponseHeader("X-GQS-Ship-Id"),a=+n.getResponseHeader("X-GQS-Skin-Id"),l=n.getResponseHeader("X-GQS-Player-Profile-Url");o.ifDefined.assertIsNonEmptyString(l);var h=new Uint8Array(n.response);_=h.byteLength;var u=i.__decompressPositions(h);s.debug("Loaded replay positions:",u.length);var d={shipId:r,skinId:a,playerProfileURL:l,playerProfileRegion:null,positions:u,rank:t,id:e};if(o.isNonEmptyString(l)){return c.getPlayerManager().getProfileImage(l).then(function(t){return t?d.playerProfileRegion=t:s.error("Failed to load profile image for replay "+e+"."),d})}return d}).then(function(e){var t=p();return i.__trackTimedEvent("Replay Download",t-a,_),e})},getReplay:function(){return this.__replay},getSeed:function(){return this.__seed},getRatioLoaded:function(){var e=this.getNumRequested();return 0===e?1:1-this.__pending/e},getNumRequested:function(){return this.__picks.replays.length},getPlayerRank:function(){return this.__picks.playerRank},__trackTimedEvent:function(e,t,i){a.trackEvent("gqs",e,{elapsedTimeMS:~~t,size:i});var n=c.getPlayerManager();_.event(e,{contextId:n.getContextId(),elapsedTimeMS:t,size:i})},setNextReplayLocalName:function(e){this.__nextReplayLocalName=e},getLocalReplayNames:function(){for(var e=[],t=localStorage.length,i=0;i<t;i++){var n=localStorage.key(i);if(0===n.indexOf("BVG_REPLAY")){var r=n.substr("BVG_REPLAY".length);e.push(r)}}return e},clearLocalReplays:function(){for(var e=localStorage.length,t=e-1;t>=0;t--){var i=localStorage.key(t);0===i.indexOf("BVG_REPLAY")&&localStorage.removeItem(i)}},loadLocalReplay:function(e){var t="BVG_REPLAY"+e,i=localStorage.getItem(t),n=new Uint8Array(atob(i).split("").map(function(e){return e.charCodeAt(0)}));return{shipId:1,skinId:1,playerProfileURL:"",playerProfileRegion:null,positions:this.__decompressPositions(n),rank:0,id:0}},saveToServer:function(e,t){if(!c.getFUEManager().areReplaysEnabled())return Promise.resolve({});if(!this.__isEnabled)return Promise.resolve({});if(0===t.length)return s.warn("Replay had no positions, will not save to server."),Promise.resolve({});var i=p(),n=new XMLHttpRequest;n.open("PUT",d),n.timeout=5e3;var r=c.getPlayerManager();n.setRequestHeader("X-GQS-Player-Id",r.getFacebookId()),n.setRequestHeader("X-GQS-Context-Id",r.getContextId()),n.setRequestHeader("X-GQS-Player-Profile-Url",r.getFacebookProfilePhotoUrl()||""),n.setRequestHeader("X-GQS-Score",e),n.setRequestHeader("X-GQS-Ship-Id",r.getPlayer().equippedShipId),n.setRequestHeader("X-GQS-Skin-Id",r.getPlayer().equippedSkinId),n.setRequestHeader("Content-Type","application/octet-stream");var a=this.__compressPositions(t);if(o.isNonEmptyString(this.__nextReplayLocalName)){var _=btoa(String.fromCharCode.apply(null,a)),l="BVG_REPLAY"+this.__nextReplayLocalName;localStorage.setItem(l,_),this.__nextReplayLocalName=null}var h=this;return new Promise(function(e,t){n.onload=function(){if(0===this.status||200===this.status){var n=p();h.__trackTimedEvent("Replay Upload",n-i,a.byteLength),e(this.response)}else t(new Error("Failed to save replay: Code "+this.status))},n.onerror=function(e){t(new Error("Failed save replay: "+e.message))},n.ontimeout=function(e){t(new Error("Failed save replay: Timeout"+e.message))},n.send(a)})},__encodeReplay:function(e){return JSON.stringify(e)},__compressPositions:function(e){var t=16*e.length,i=0,n=new Uint8Array(t),r=0,s=0,o=0,a=0;i+=h.writeVarInt(n,i,e.length);for(var _=0;_<e.length;++_){var l=e[_],u=Math.round(l.x),c=Math.round(l.y),d=Math.round(l.count),g=Math.round(l.time),p=u-r,m=c-s,f=d-o,v=g-a;i+=h.writeVarInt(n,i,p),i+=h.writeVarInt(n,i,m),i+=h.writeVarInt(n,i,f),i+=h.writeVarInt(n,i,v),r=u,s=c,o=d,a=g}return n.subarray(0,i)},__decompressPositions:function(e){var t=[],i=0,n=0,r=0,s=0,o=0,a=h.readVarInt(e,i);i+=h.readVarIntBytes(e,i);for(var _=0;_<a;++_){var l=h.readVarInt(e,i);i+=h.readVarIntBytes(e,i);var u=h.readVarInt(e,i);i+=h.readVarIntBytes(e,i);var c=h.readVarInt(e,i);i+=h.readVarIntBytes(e,i);var d=h.readVarInt(e,i);i+=h.readVarIntBytes(e,i);var g=l+n,p=u+r,m=c+s,f=d+o;t.push({x:g,y:p,c:m,t:f}),n=g,r=p,s=m,o=f}return t}})}),define("thor/debug/DebugOverlay",["require","exports","module","thor/core/Class","thor/core/Validation"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Validation");i.exports=n.create({initialize:function(e){r.ifDefined.assertIsBoolean(e),e=e||!1,this.__roots=[this.__createDebugMenu(e)]},remove:function(){document.body.removeChild(this.__debugButton),document.body.removeChild(this.__debugOverlay),this.__debugButton=null,this.__debugOverlay=null},close:function(){this.__debugOverlay.style.display="none",this.__debugButton.style.display="block"},__createDebugMenu:function(e){var t=this,i=document.createElement("div");i.style.position="absolute",i.style.top="0px",i.style.display="none",i.style.width="100%",i.style.height="100%",i.style.background="rgba(0, 0, 0, 0.65)",i.style.zIndex=1001,document.body.appendChild(i);var n=document.createElement("div");n.style.position="absolute",n.style.color="red",n.style.width="35px",n.style.height="35px",n.style.lineHeight="35px",n.style.border="2px solid red",n.style.top=e?"50%":"0px",n.style.right="0px",n.style.zIndex=1e3,n.style.textAlign="center",n.style.fontSize="2em",n.style.lineHeight="1.3em",n.innerHTML="⚙",n.addEventListener("mouseover",function(){n.style.background="rgba(255, 0, 0, 0.2)"}),n.addEventListener("mouseout",function(){n.style.background="transparent"}),n.onclick=function(){i.style.display="block",n.style.display="none"},document.body.appendChild(n),this.__debugOverlay=i,this.__debugButton=n;var r=document.createElement("div");return r.style.width="35px",r.style.height="35px",r.style.lineHeight="35px",r.style.border="2px solid red",r.style.color="red",r.style.fontSize="2rem",r.style.position="absolute",r.style.top="0px",r.style.right="0px",r.style.textAlign="center",r.style.cursor="pointer",r.innerHTML="✗",r.addEventListener("mouseover",function(){r.style.background="#FFAAAA"}),r.addEventListener("mouseout",function(){r.style.background="transparent"}),r.onclick=this.close.bind(this),i.appendChild(r),document.addEventListener("keydown",function(e){192===e.which&&("none"===i.style.display?n.onclick():t.close())}),i},__getCurrentRoot:function(){return this.__roots[this.__roots.length-1]},addSection:function(e,t){var i=document.createElement("div");i.style.border="2px solid darkgray",i.style.backgroundColor="lightgray",i.style.padding="5px",i.style.margin="5px",this.__getCurrentRoot().appendChild(i);var n=document.createElement("div");return n.style.color="darkgreen",n.style.fontWeight="bold",n.style.fontSize="larger",n.innerHTML=e,i.appendChild(n),this.__roots.push(i),t(i,this),this.__roots.pop(),this},addDiv:function(e){var t=document.createElement("div");return t.style.padding="4px",this.__getCurrentRoot().appendChild(t),this.__roots.push(t),e(t,this),this.__roots.pop(),t},addSpan:function(e){var t=document.createElement("span");return t.style.padding="4px",this.__getCurrentRoot().appendChild(t),this.__roots.push(t),e(t,this),this.__roots.pop(),t},addLabel:function(e){var t=document.createElement("span");return t.innerHTML=e,t.style.padding="4px",this.__getCurrentRoot().appendChild(t),t},addButton:function(e,t){var i=document.createElement("button");return i.innerHTML=e,i.style.padding="4px",this.__getCurrentRoot().appendChild(i),i.onclick=t,i},addInput:function(e){var t=document.createElement("input");return t.style.padding="4px",t.value=e,this.__getCurrentRoot().appendChild(t),t},addSlider:function(e,t,i){r.ifDefined.assertIsNumber(i);var n=document.createElement("input");return n.type="range",n.min=e,n.max=t,r.isNumber(i)&&(n.value=i),this.__getCurrentRoot().appendChild(n),n},addDropDown:function(e){for(var t=document.createElement("select"),i=0;i<e.length;++i){var n=document.createElement("option");n.innerHTML=e[i],t.appendChild(n)}return this.__getCurrentRoot().appendChild(t),t},editDropDown:function(e,t){e.innerHTML="";for(var i=0;i<t.length;++i){var n=document.createElement("option");n.innerHTML=t[i],e.appendChild(n)}return e}})}),define("ProjectV",["require","exports","module","thor/core/Class","thor/core/Device","thor/core/Logger","thor/core/Validation","thor/debug/FPSMeter","thor/debug/PerformanceOverlay","thor/config/Config","Version","thor/analytics/Seidr","thor/math/MersenneTwister","thor/resources/ResourceManager","thor/util/Alert","thor/util/XMLLoader","thor/util/JSONLoader","thor/util/StringUtil","thor/util/LocalStorage","thor/util/BulkXMLLoader","thor/util/BulkJSONLoader","thor/audio/SoundSprite","thor/audio/SoundManager","thor/audio/SoundResourceLoader","thor/audio/SoundSpriteResourceLoader","thor/graphics/resources/DOMImageLoader","thor/graphics/resources/DOMImageResource","thor/graphics/resources/BitmapFontLoader","thor/graphics/resources/BitmapFont","thor/graphics/resources/TextureRegionResource","thor/graphics/resources/TextureRegionResourceLoader","thor/graphics/resources/ThorTextureAtlas","thor/graphics/resources/ThorTextureAtlasLoader","thor/ui/DialogManager","thor/ui/resources/WidgetResource","thor/ui/resources/WidgetResourceLoader","thor/graphics/resources/AnimatedSpriteResource","thor/graphics/resources/AnimatedSpriteResourceLoader","thor/graphics/resources/ParticleSystemResource","thor/graphics/resources/ParticleSystemResourceLoader","thor/graphics/imagecache/ImageCache","thor/webgl/Texture","thor/ui/InputEvent","thor/ui/resources/NineSliceResource","thor/ui/resources/NineSliceResourceLoader","thor/graphics/animation/skeleton/SkeletonResource","thor/graphics/resources/SkeletonResourceLoader","thor/event/EventManager","events/LevelUpEvent","events/GameBoundsEvent","events/InputEndedEvent","events/InputMovedEvent","events/InputStartedEvent","events/InputActivateEvent","events/KeyboardInputEvent","events/GameResetEvent","gameplay/BulletManagerActionGlobals","bulletml/BulletMLLoader","bulletml/BulletMLResource","gameplay/Level","gameplay/LevelLoader","thor/entity/World","thor/entity/UiComponent","thor/entity/SpriteComponent","thor/entity/SkeletonComponent","thor/graphics/animation/skeleton/RegionAttachmentComponent","thor/entity/AnimatedSpriteComponent","thor/entity/ParticleSystemComponent","components/SCTComponent","components/TextComponent","components/BlinkComponent","components/DriftComponent","components/FlashComponent","components/ActionComponent","components/BulletComponent","components/FollowComponent","components/LookAtComponent","components/RotateComponent","components/ShieldComponent","components/ThrustComponent","components/AttractComponent","components/TileMapComponent","components/AttachToComponent","components/BulletMLComponent","components/ResourceComponent","components/CollisionComponent","components/SoundLoopComponent","components/DelayEventComponent","components/FollowPathComponent","components/MoveTowardsComponent","components/SoundOnEventComponent","components/KillChildrenComponent","components/TimedDespawnComponent","components/MoveToTargetComponent","components/RectCollisionComponent","components/SprayMovementComponent","components/SystemUpgradeComponent","components/ReplayPositionComponent","components/RecordPositionComponent","components/PositionDespawnComponent","components/IntervalSpawnerComponent","components/BackgroundMovementComponent","components/AnimationControllerComponent","components/TemporaryInvincibilityComponent","components/LaserBeamComponent","components/ExpandingAOEComponent","components/GlowingSpriteComponent","Constants","ui/UIManager","GameLogic","EntityFactory","thor/entity/EntityManager","GiftManager","GachaManager","LaserManager","StaticShockManager","player/PlayerManager","BulletManager","mission/MissionManager","StorageManager","ShipSkinManager","TestManager","FUEManager","CollisionManager","AchievementManager","SkeletonFactory","ReplayManager","raid/RaidManager","ManagerRepository","ResourceTypes","gameplay/EnemyTypeEnum","gameplay/GameParameters","cards/CardParameters","UpgradeTypeEnum","KeyboardInputEnum","mission/MissionType","thor/debug/DebugOverlay","gacha/Gacha","gacha/PlayerGachaBag","mission/MissionSet","ui/FacebookScoreScreenshot"],function(e,t,i){var n=e("thor/core/Class"),r=e("thor/core/Device"),s=e("thor/core/Logger").getLogger(i),o=e("thor/core/Validation"),a=e("thor/debug/FPSMeter"),_=e("thor/debug/PerformanceOverlay"),l=e("thor/config/Config"),h=(e("Version"),e("thor/analytics/Seidr")),u=e("thor/math/MersenneTwister"),c=e("thor/resources/ResourceManager"),d=e("thor/util/Alert"),g=e("thor/util/XMLLoader"),p=e("thor/util/JSONLoader"),m=e("thor/util/StringUtil"),f=e("thor/util/LocalStorage"),v=e("thor/util/BulkXMLLoader"),y=e("thor/util/BulkJSONLoader"),E=e("thor/audio/SoundSprite"),S=e("thor/audio/SoundManager"),T=e("thor/audio/SoundResourceLoader"),C=e("thor/audio/SoundSpriteResourceLoader"),I=e("thor/graphics/resources/DOMImageLoader"),w=e("thor/graphics/resources/DOMImageResource"),b=e("thor/graphics/resources/BitmapFontLoader"),M=e("thor/graphics/resources/BitmapFont"),x=e("thor/graphics/resources/TextureRegionResource"),R=e("thor/graphics/resources/TextureRegionResourceLoader"),P=e("thor/graphics/resources/ThorTextureAtlas"),A=e("thor/graphics/resources/ThorTextureAtlasLoader"),N=e("thor/ui/DialogManager"),D=e("thor/ui/resources/WidgetResource"),L=e("thor/ui/resources/WidgetResourceLoader"),O=e("thor/graphics/resources/AnimatedSpriteResource"),V=e("thor/graphics/resources/AnimatedSpriteResourceLoader"),B=e("thor/graphics/resources/ParticleSystemResource"),k=e("thor/graphics/resources/ParticleSystemResourceLoader"),W=(e("thor/graphics/imagecache/ImageCache"),e("thor/webgl/Texture")),F=e("thor/ui/InputEvent"),U=e("thor/ui/resources/NineSliceResource"),G=e("thor/ui/resources/NineSliceResourceLoader"),H=e("thor/graphics/animation/skeleton/SkeletonResource"),q=e("thor/graphics/resources/SkeletonResourceLoader"),Y=e("thor/event/EventManager"),z=e("events/LevelUpEvent"),X=e("events/GameBoundsEvent"),K=e("events/InputEndedEvent"),j=e("events/InputMovedEvent"),Q=e("events/InputStartedEvent"),Z=e("events/InputActivateEvent"),J=e("events/KeyboardInputEvent"),$=e("events/GameResetEvent"),ee=e("gameplay/BulletManagerActionGlobals"),te=e("bulletml/BulletMLLoader"),ie=e("bulletml/BulletMLResource"),ne=e("gameplay/Level"),re=e("gameplay/LevelLoader"),se=e("thor/entity/World"),oe=e("thor/entity/UiComponent"),ae=e("thor/entity/SpriteComponent"),_e=e("thor/entity/SkeletonComponent"),le=e("thor/graphics/animation/skeleton/RegionAttachmentComponent"),he=e("thor/entity/AnimatedSpriteComponent"),ue=e("thor/entity/ParticleSystemComponent"),ce=e("components/SCTComponent"),de=e("components/TextComponent"),ge=e("components/BlinkComponent"),pe=e("components/DriftComponent"),me=e("components/FlashComponent"),fe=e("components/ActionComponent"),ve=e("components/BulletComponent"),ye=e("components/FollowComponent"),Ee=e("components/LookAtComponent"),Se=e("components/RotateComponent"),Te=e("components/ShieldComponent"),Ce=e("components/ThrustComponent"),Ie=e("components/AttractComponent"),we=e("components/TileMapComponent"),be=e("components/AttachToComponent"),Me=e("components/BulletMLComponent"),xe=e("components/ResourceComponent"),Re=e("components/CollisionComponent"),Pe=e("components/SoundLoopComponent"),Ae=e("components/DelayEventComponent"),Ne=e("components/FollowPathComponent"),De=e("components/MoveTowardsComponent"),Le=e("components/SoundOnEventComponent"),Oe=e("components/KillChildrenComponent"),Ve=e("components/TimedDespawnComponent"),Be=e("components/MoveToTargetComponent"),ke=e("components/RectCollisionComponent"),We=e("components/SprayMovementComponent"),Fe=e("components/SystemUpgradeComponent"),Ue=e("components/ReplayPositionComponent"),Ge=e("components/RecordPositionComponent"),He=e("components/PositionDespawnComponent"),qe=e("components/IntervalSpawnerComponent"),Ye=e("components/BackgroundMovementComponent"),ze=e("components/AnimationControllerComponent"),Xe=e("components/TemporaryInvincibilityComponent"),Ke=e("components/LaserBeamComponent"),je=e("components/ExpandingAOEComponent"),Qe=e("components/GlowingSpriteComponent"),Ze=e("Constants"),Je=e("ui/UIManager"),$e=e("GameLogic"),et=e("EntityFactory"),tt=e("thor/entity/EntityManager"),it=e("GiftManager"),nt=e("GachaManager"),rt=e("LaserManager"),st=e("StaticShockManager"),ot=e("player/PlayerManager"),at=e("BulletManager"),_t=e("mission/MissionManager"),lt=e("StorageManager"),ht=e("ShipSkinManager"),ut=e("TestManager"),ct=e("FUEManager"),dt=e("CollisionManager"),gt=e("AchievementManager"),pt=e("SkeletonFactory"),mt=e("ReplayManager"),ft=e("raid/RaidManager"),vt=e("ManagerRepository"),yt=e("ResourceTypes"),Et=(e("gameplay/EnemyTypeEnum"),e("gameplay/GameParameters")),St=e("cards/CardParameters"),Tt=e("UpgradeTypeEnum"),Ct=e("KeyboardInputEnum"),It=e("mission/MissionType"),wt=e("thor/debug/DebugOverlay"),bt=(e("gacha/Gacha"),e("gacha/PlayerGachaBag")),Mt=e("mission/MissionSet"),xt=e("ui/FacebookScoreScreenshot");S.setupDynamicsCompressor(-8,8,5,.002,.08),S.addAudioChannel("UI_SFX","MASTER"),S.load(),r.isAndroidDevice&&S.unmuteChannel("BGM",1);var Rt={" ":Ct.ACTIVATE,ArrowLeft:Ct.LEFT,ArrowRight:Ct.RIGHT,ArrowUp:Ct.UP,ArrowDown:Ct.DOWN},Pt={Space:Ct.ACTIVATE,ArrowLeft:Ct.LEFT,ArrowRight:Ct.RIGHT,ArrowUp:Ct.UP,ArrowDown:Ct.DOWN},At={32:Ct.ACTIVATE,37:Ct.LEFT,39:Ct.RIGHT,38:Ct.UP,40:Ct.DOWN};i.exports=n.create({initialize:function(e,t,i,n,s){window.ProjectV=this,l.ENABLE_EVENT_TRACING&&t.setEventTracing(!0),this.entityManager=e,this.entityFactory=new et(t,e),this.eventManager=t,this.world=i,this.uiRoot=n,this.resourceManager=s,this.collisionManager=new dt(t,550),this.bulletManager=new at(e,400),this.storageManager=new lt,this.__hasStarted=!1;var o=""+window.VERSION;s.registerLoader(w.RESOURCE_TYPE,new I(s,o)),s.registerLoader(M.RESOURCE_TYPE,new b(s,o,null)),s.registerLoader(g.RESOURCE_TYPE,new g(o)),s.registerLoader(p.RESOURCE_TYPE,new p(o)),s.registerLoader(x.RESOURCE_TYPE,new R),s.registerLoader(P.RESOURCE_TYPE,new A(s)),s.registerLoader(T.RESOURCE_TYPE,new T),s.registerLoader(C.RESOURCE_TYPE,new C(s,o)),s.registerLoader(D.RESOURCE_TYPE,new L(s)),s.registerLoader(O.RESOURCE_TYPE,new V(s)),s.registerLoader(B.RESOURCE_TYPE,new k(s)),s.registerLoader(v.RESOURCE_TYPE,new v(s,o)),s.registerLoader(y.RESOURCE_TYPE,new y(s,o)),s.registerLoader(ie.RESOURCE_TYPE,new te(s)),s.registerLoader(U.RESOURCE_TYPE,new G(s,o)),s.registerLoader(ne.RESOURCE_TYPE,new re(s)),s.registerLoader(H.RESOURCE_TYPE,new q(s,t));var d=new u,f=new u;vt.addType(tt,"EntityManager",e),vt.addType(Y,"EventManager",t),vt.addType(c,"ResourceManager",s),vt.addType(et,"EntityFactory",this.entityFactory),vt.addType(lt,"StorageManager",this.storageManager);var E={createWorld:this.createWorld.bind(this)};Object.freeze(E),vt.addType(Object,"WorldFactory",E),this.dialogManager=null,this.skeletonFactory=new pt(s,this.entityManager),vt.addType(pt,"SkeletonFactory",this.skeletonFactory),this.playerManager=new ot(s,t,this.storageManager,i.getSurface().getRenderer()),vt.addType(ot,"PlayerManager",this.playerManager);var S=h.get(),N=FBInstant.getPlatform();this.platform=N,N||(N="web"),S.setPlatform(N),S.setSource(this.playerManager.getFacebookId()),S.setSessionId(window.SESSION_ID),this.giftManager=new it(s,t,this.playerManager,this.storageManager),vt.addType(it,"GiftManager"),vt.setGiftManager(this.giftManager),this.playerManager.setGiftManager(this.giftManager),this.achievementManager=new gt(s),this.playerManager.setAchievementManager(this.achievementManager),this.laserManager=new rt(i,this.entityFactory,t),this.staticShockManager=new st(i,t),this.shipSkinManager=new ht(s,this.playerManager),this.playerManager.setShipSkinManager(this.shipSkinManager),vt.addType(ht,"ShipSkinManager",this.shipSkinManager),this.missionManager=new _t(this.playerManager,this.storageManager,t),vt.addType(_t,"MissionManager",this.missionManager),this.testManager=new ut(s),vt.addType(ut,"TestManager",this.testManager),this.fueManager=new ct(s),vt.addType(ct,"FUEManager",this.fueManager),this.actionGlobals=new ee(f,this.bulletManager,this.eventManager,this.entityManager),this.replayManager=new mt,vt.addType(mt,"ReplayManager",this.replayManager),this.raidManager=new ft(this.eventManager,this.storageManager),vt.addType(ft,"RaidManager",this.raidManager),this.gameLogic=new $e(i,this.entityFactory,t,this.bulletManager,this.collisionManager,this.playerManager,this.laserManager,f,this.actionGlobals,s,this.shipSkinManager,this.achievementManager,this.missionManager,this.staticShockManager),this.gachaManager=new nt(this.playerManager,f,this.storageManager,this.gameLogic),vt.addType(nt,"GachaManager",this.gachaManager);var W=this.gameLogic.getDistance.bind(this.gameLogic);e.registerComponentType("RecordPositionComponent",Ge,[W],2),e.registerComponentType("UiComponent",oe,[],100),e.registerComponentType("SCTComponent",ce,[this.eventManager],20),e.registerComponentType("TextComponent",de,[],20),e.registerComponentType("BlinkComponent",ge,[],40),e.registerComponentType("TileMapComponent",we,[],100),e.registerComponentType("KillChildrenComponent",Oe,[this.eventManager]),e.registerComponentType("AttachToComponent",be,[]),e.registerComponentType("AttractComponent",Ie,[this.entityManager]),e.registerComponentType("TimedDespawnComponent",Ve,[this.eventManager],80),e.registerComponentType("BulletManager",at,[],0),e.registerComponentType("BulletComponent",ve,[this.bulletManager],401),e.registerComponentType("ThrustComponent",Ce,[]),e.registerComponentType("SpriteComponent",ae,[],200),e.registerComponentType("AnimatedSpriteComponent",he,[],100),e.registerComponentType("ShieldComponent",Te,[],2),e.registerComponentType("LaserBeamComponent",Ke,[this.eventManager],2),e.registerComponentType("GlowingSpriteComponent",Qe,[],32),e.registerComponentType("ExpandingAOEComponent",je,[this.eventManager],2),e.registerComponentType("ResourceComponent",xe,[],501),e.registerComponentType("CollisionComponent",Re,[this.collisionManager],501),e.registerComponentType("RectCollisionComponent",ke,[this.collisionManager],50),e.registerComponentType("SprayMovementComponent",We,[],100),e.registerComponentType("MoveTowardsComponent",De,[]),e.registerComponentType("SoundOnEventComponent",Le,[],40),e.registerComponentType("SoundLoopComponent",Pe,[],10),e.registerComponentType("LookAtComponent",Ee,[this.entityManager],20),e.registerComponentType("IntervalSpawnerComponent",qe,[this.eventManager],20),e.registerComponentType("AnimationControllerComponent",ze,[],20),e.registerComponentType("BackgroundMovementComponent",Ye,[this.eventManager],100),e.registerComponentType("PositionDespawnComponent",He,[this.eventManager]),e.registerComponentType("FollowPathComponent",Ne,[this.eventManager],40),e.registerComponentType("ParticleSystemComponent",ue,[d,i],20),e.registerComponentType("ReplayPositionComponent",Ue,[this.eventManager,W],4),e.registerComponentType("FollowComponent",ye,[this.entityManager,this.eventManager],5),e.registerComponentType("RotateComponent",Se,[],15),e.registerComponentType("ActionComponent",fe,[this.actionGlobals,this.eventManager],500),e.registerComponentType("DelayEventComponent",Ae,[this.eventManager],10),e.registerComponentType("BulletMLComponent",Me,[this.eventManager],50),e.registerComponentType("MoveToTargetComponent",Be,[this.eventManager],2),e.registerComponentType("SystemUpgradeComponent",Fe,[this.eventManager],2),e.registerComponentType("DriftComponent",pe,[],2),e.registerComponentType("FlashComponent",me,[],2),e.registerComponentType("TemporaryInvincibilityComponent",Xe,[],2),e.registerComponentType("SkeletonComponent",_e,[],64),e.registerComponentType("RegionAttachmentComponent",le,[],4);var z=i.getScene().getComponent("InputComponent");z.setInputHandlerForType(F.EVENT_TYPE.POINTER_DOWN,this.__onPointerDown.bind(this)),z.setInputHandlerForType(F.EVENT_TYPE.POINTER_UP,this.__onPointerUp.bind(this)),r.isMobileDevice&&z.setInputHandlerForType(F.EVENT_TYPE.CANCEL,this.__onPointerUp.bind(this)),z.setInputHandlerForType(F.EVENT_TYPE.POINTER_MOVE,this.__onPointerMove.bind(this)),document.addEventListener("keydown",this.__onKeyDown.bind(this),!0),this.__isMouseDown=!1,this.__lastMouseDownTime=0;var X=m.getUrlParams();if(r.debugFeatures[r.DEBUG_FEATURES.DEBUG_OVERLAY]&&("dev"===X.mode||"autoTest"===X.mode)){var K=_.getInstance();if(this.preUpdate=K.addInstrumentedTask("PV Preupdate",this.preUpdate.bind(this),1e3,2,5),this.postUpdate=K.addInstrumentedTask("PV Postupdate",this.postUpdate.bind(this),1e3,2,5),r.debugFeatures[r.DEBUG_FEATURES.FPS_METER]){var j=new a(!1);j.load({}),this.__fpsMeter=j}}},sendGameBoundsEvent:function(){var e=this.uiRoot.getGeometry(),t=Ze.GAME_AREA_WIDTH,i=e.getWidth(),n=e.getHeight(),r=this.eventManager.getNewEvent(X,1);r.setWidth(t),r.setCanvasWidth(i),r.setHeight(n),this.eventManager.triggerEvent(r),this.bulletManager.setBounds(t,n)},__verifyInputValid:function(e){return 1===e.touchCount?(this.__touchIdentifier=e.touchIdentifier,!0):this.__touchIdentifier===e.touchIdentifier},__onPointerDown:function(e){if(!this.__verifyInputValid(e))return!1;var t;if("mouse"==e.touchIdentifier&&e.originalEvent.button>0)return t=this.eventManager.getNewEvent(Z,1),this.eventManager.queueEvent(t),!0;var i=Date.now();i-this.__lastMouseDownTime<350&&(t=this.eventManager.getNewEvent(Z,1),this.eventManager.queueEvent(t)),this.__touchIdentifier=e.touchIdentifier,this.__isMouseDown=!0,this.__lastMouseDownTime=i;var n=this.eventManager.getNewEvent(Q,1);return this.eventManager.queueEvent(n),this.__sendInputMovedEvent(e.x,e.y,!1),!0},__onPointerUp:function(e){if(0!==e.touchCount)return!1;if("mouse"==e.touchIdentifier&&e.originalEvent.button>0)return!0;this.__touchIdentifier=null,this.__isMouseDown=!1;var t=this.eventManager.getNewEvent(K,1);return this.eventManager.queueEvent(t),!0},__onPointerMove:function(e){var t=this.__touchIdentifier;if(!this.__verifyInputValid(e))return!1;if(!this.__isMouseDown)return!1;var i=t!==e.touchIdentifier;return this.__sendInputMovedEvent(e.x,e.y,i),!0},__onKeyDown:function(e){var t;if(e.key)t=Rt[e.key];else if(e.code)t=Pt[e.code];else{if(!e.keyCode)return s.warn("Tried to handle keyboard event, but no appropriate key lookup was found.",e),!1;t=At[""+e.keyCode]}if(o.isUndefined(t))return!1;var e=this.eventManager.getNewEvent(J);return e.setKeyPressed(t),this.eventManager.queueEvent(e),!0},__sendInputMovedEvent:function(e,t,i){var n=this.eventManager.getNewEvent(j);n.setXPercent(e/this.uiRoot.__geometry.__sizeX),n.setYPercent(t/this.uiRoot.__geometry.__sizeY),n.setResetRelativeLocation(i),
this.eventManager.queueEvent(n)},preUpdate:function(e){this.gameLogic.update(e),this.__uiManager.update(e)},postUpdate:function(e){this.bulletManager.processExpiredBullets()},init:function(){var t=this;s.debug("Init"),this.__gameParameters&&this.gameLogic.setGameParameters(this.__gameParameters),this.sendGameBoundsEvent();var i=this.resourceManager.get(p.RESOURCE_TYPE,"data/bullets");this.bulletManager.init(this.world,this.resourceManager,i),this.gameLogic.init(this.resourceManager),this.__createUI();var n=this.resourceManager.getOrDefault(C.RESOURCE_TYPE,"music_sprite",E.EMPTY_SOUND_SPRITE);this.__uiManager.setMusicSprite(n),this.entityManager.createEntity().setRootComponent(this.bulletManager),this.bulletManager.attachTo(this.gameLogic.getGameplayScene().getRootComponent()),this.bulletManager.register(this.world),this.bulletManager.beginPlay();var o=m.getUrlParams();r.debugFeatures[r.DEBUG_FEATURES.DEBUG_OVERLAY]&&("dev"===o.mode||"autoTest"===o.mode||window.ENABLE_DEV_MODE)&&this.__addDebugOverlay();var a=Date.now();window.THOR_LOAD_START;"CHROME"===r.browserName&&!r.isMobileDevice&&l.ENABLE_DESIGNER_TOOLS&&"dev"===o.mode&&e(["tools/DesignerTools"],function(e){new e(t.gameLogic,t.resourceManager,t.entityManager,t.world,t.eventManager,t.playerManager,t.missionManager,t.gachaManager,t.raidManager).loadTools()})},start:function(){if(this.__hasStarted)return void s.error("Attempted to start when already started");this.__hasStarted=!0,this.replayManager.refresh(),this.raidManager.refresh(),this.eventManager.registerEventHandler($.EVENT_TYPE,this._maybeRefreshReplays.bind(this)),this.playerManager.trackSessionInitialized(),this.__debugOverlayContextTypeLabel&&(this.__debugOverlayContextTypeLabel.innerHTML="Context type: "+this.playerManager.getContextType())},_maybeRefreshReplays:function(){var e=this.replayManager.getNumRequested(),t=Date.now()-this.replayManager.getLastRefresh()>Ze.MAX_REPLAY_AGE_MS,i=this.gameLogic.lastRunRatioReplaysLoaded>=Ze.MIN_RATIO_REPLAYS_LOADED;(0===e||i||t)&&this.replayManager.refresh()},load:function(){var e=this;return this.resourceManager.unlock(),Promise.all([this.__loadBulkResources(),this.__doLogin()]).then(function(t){s.debug("Bulk resources load complete");var i=t[1];return e.__loadTests().then(function(){return s.debug("Tests load complete"),e.__setupResourceMappings(),i})}).then(function(t){return Promise.all([e.__loadAtlases(),e.__loadEntities(),e.__loadGameParams(),e.__loadCardParams(),e.__loadRequiredAudio(),e.__loadServerData(),e.__loadScreenshot(),e.__loadMissions(),e.__loadTests(),e.__loadFUE()]).then(function(){return e.playerManager.finalizePlayerLogin(),t}).catch(function(e){var t=m.getUrlParams(),i="retry"in t?+t.retry:0;if(!(i<1))throw e instanceof Error?e:new Error(e);t.retry=""+(i+1),m.setUrlParams(t)})}).then(function(t){return s.debug("Atlas phase load complete"),Promise.all([e.__loadGachas(),e.__loadLevels(),e.__loadFonts(),e.__loadUI(),e.__loadAnimations(),e.__updateAncillaryPlayerState(t)])}).then(function(){l.ENABLE_DESIGNER_TOOLS||e.resourceManager.lock()})},__setupResourceMappings:function(){for(var e={},t=this.testManager.getTestNames(),i=this.playerManager.getTestingGroup(),n=0,r=t.length;n<r;n++){var s=t[n],o=this.testManager.getCohortData(s,i);if(o){var a=o.mappings;if(a)for(var _ in a){var l=e[_];l||(e[_]={},l=e[_]);var h=a[_];for(var u in h){if(l[u])throw new Error("Only one mapping per source name allowed, cannot map `"+u+"` for test `"+s+"`");l[u]=h[u]}}}}this.resourceManager.setOverrideMappings(e)},__doLogin:function(){function e(e){if(o.isInstanceOf(e,Error))throw e;var t;try{t=JSON.stringify(e)}catch(i){t="(unserializeable) "+e}throw new Error("Authenication Error: "+t)}return this.playerManager.authenticate().then(function(e){return s.debug("Player auth complete."),e}).catch(e)},__updateAncillaryPlayerState:function(e){return Promise.all([this.giftManager.handleAuth(e),this.achievementManager.handleAuth(e),this.missionManager.handleAuth(e),this.replayManager.handleAuth(e),this.raidManager.handleAuth(e)])},__createUI:function(){var e=this.resourceManager.get(D.RESOURCE_TYPE,"main_ui"),t=e.construct(),i=this.uiRoot;i.setUiSize(e.getDesiredWidth(),e.getDesiredHeight()),i.setWidget(t),t.findSingleWidgetWithName("WorldWidget").setWorld(this.world);var n=t.findSingleWidgetWithName("UI"),r=t.findSingleWidgetWithName("Dialogs"),s=this.resourceManager.get(x.RESOURCE_TYPE,"modal_background"),o=.5/s.image.getWidth(),a=.5/s.image.getHeight();s.uvs[0]+=o,s.uvs[1]+=a,s.uvs[2]+=o,s.uvs[3]-=a,s.uvs[4]-=o,s.uvs[5]-=a,s.uvs[6]-=o,s.uvs[7]+=a;var _=new N(s,.8,r);this.dialogManager=_,vt.addType(N,"DialogManager",this.dialogManager),this.__uiManager=new Je(this.resourceManager,this.eventManager,n,this.entityFactory,this.createWorld.bind(this),_,this.gameLogic,this.playerManager,this.laserManager,this.giftManager,this.shipSkinManager,this.achievementManager,this.gachaManager,this.raidManager)},createWorld:function(){var e=this.world.getSurface(),t=new se(e,this.entityManager,this.eventManager),i=this.entityManager.createEntity(),n=this.entityManager.addComponent(i,"SceneComponent",!1);return i.setRootComponent(n),t.setScene(i),t.setClearMode(se.CLEAR_MODE.PRESERVE),t},__loadGameParams:function(){var e=this;return this.resourceManager.loader(p.RESOURCE_TYPE).load("data/GameParameters","data/GameParameters.json").then(function(t){e.__gameParameters=Et.fromExisting(t)}).catch(function(e){s.error("failed to load game parameters json",e)}).then(function(e){return s.debug("loadGameParams complete"),e})},__loadCardParams:function(){var e=this;return this.resourceManager.loader(p.RESOURCE_TYPE).load("data/CardParameters","data/CardParameters.json").then(function(t){e.__cardParameters=St.fromExisting(t),e.__cardParameters&&(e.gameLogic.setCardParameters(e.__cardParameters),e.playerManager.setCardParameters(e.__cardParameters))}).catch(function(e){s.error("failed to load card parameters json",e)}).then(function(e){return s.debug("loadCardParams complete"),e})},__loadGachas:function(){var e=this;return this.resourceManager.loader(p.RESOURCE_TYPE).load("data/gacha","data/gacha.json").then(function(t){return e.gachaManager.setGachaData(t),e.gachaManager.retrieveCurrentPlayerGacha()}).catch(function(e){s.error("failed to load gacha json",e)})},__loadMissions:function(){return this.missionManager.load(this.resourceManager)},__loadTests:function(){return this.testManager.load(this.resourceManager)},__loadFUE:function(){return this.fueManager.load()},__loadLevels:function(){var e=["levels/GalatronVS Quicksilver/level","levels/FUE/fue_run_1","levels/FUE/fue_run_2"],t=this;return Promise.all([this.resourceManager.loader(v.RESOURCE_TYPE).load("levels/patterns.xml","levels/patterns.xml"),this.resourceManager.loader(ie.RESOURCE_TYPE).load("bullets/spawners/boss_death","bullets/spawners/boss_death.xml")]).then(function(){for(var i=[],n=0,r=e.length;n<r;n++){var s=e[n],o=s+".json",a=t.resourceManager.loader(ne.RESOURCE_TYPE).load(s,o);i.push(a)}return Promise.all(i)}).then(function(t){return s.debug("Loaded levels: ",e),t})},__loadScreenshot:function(){return this.resourceManager.loader(w.RESOURCE_TYPE).load("images/ui/assets/final_score","images/ui/assets/final_score.jpg")},__loadUI:function(){return this.resourceManager.loadBulk({widget:[{name:"main_ui",parameters:["scenes/main_ui.json"]},{name:"game_ui",parameters:["scenes/game_ui.json"]},{name:"screen_end_score",parameters:["scenes/screen_end_score.json"]},{name:"screen_home",parameters:["scenes/screen_home.json"]},{name:"screen_ship_customize",parameters:["scenes/screen_ship_customize.json"]},{name:"screen_awards",parameters:["scenes/screen_awards.json"]},{name:"screen_awards_listentry",parameters:["scenes/screen_awards_listentry.json"]},{name:"scene_rank",parameters:["scenes/scene_rank.json"]},{name:"popup_warning",parameters:["scenes/popup_warning.json"]},{name:"popup_generic",parameters:["scenes/popup_generic.json"]},{name:"popup_card_detail",parameters:["scenes/popup_card_detail.json"]},{name:"popup_card_scrap",parameters:["scenes/popup_card_scrap.json"]},{name:"popup_confirmationDialog",parameters:["scenes/popup_confirmationDialog.json"]},{name:"pop_FUEDialogue_complete",parameters:["scenes/pop_FUEDialogue_complete.json"]},{name:"popup_FUEDialogue_description",parameters:["scenes/popup_FUEDialogue_description.json"]},{name:"popup_FUEDialogue_intro",parameters:["scenes/popup_FUEDialogue_intro.json"]},{name:"popup_FUEDialogue_standard",parameters:["scenes/popup_FUEDialogue_standard.json"]},{name:"screen_scavenge",parameters:["scenes/screen_scavenge.json"]},{name:"screen_drone_animation",parameters:["scenes/screen_drone_animation.json"]},{name:"element_mission_description",parameters:["scenes/element_mission_description.json"]},{name:"element_mission_progress",parameters:["scenes/element_mission_progress.json"]},{name:"element_mission_progressFUE",parameters:["scenes/element_mission_progressFUE.json"]},{name:"screen_equip_card",parameters:["scenes/screen_equip_card.json"]},{name:"element_equipped_cards",parameters:["scenes/element_equipped_cards.json"]},{name:"element_card_row",parameters:["scenes/element_card_row.json"]},{name:"element_options_row",parameters:["scenes/element_options_row.json"]},{name:"element_card_mini",parameters:["scenes/element_card_mini.json"]},{name:"element_card_full",parameters:["scenes/element_card_full.json"]},{name:"element_tapToContinue",parameters:["scenes/element_tapToContinue.json"]},{name:"screen_gift_box",parameters:["scenes/screen_gift_box.json"]},{name:"screen_level_up",parameters:["scenes/screen_level_up.json"]},{name:"element_rank",parameters:["scenes/element_rank.json"]},{name:"element_playerSlot",parameters:["scenes/element_playerSlot.json"]}]})},__loadEntities:function(){var e=this;return this.resourceManager.loader(p.RESOURCE_TYPE).load("levels/first","levels/first.json").then(function(t){s.debug("Loading Entities: Got level data");for(var i=[],n={json:i},r=0;r<t.entities.length;++r){var o=t.entities[r];i.push({name:"entities/"+o.name,parameters:["entities/"+o.name+".json"]})}for(var a=[],r=0;r<t.mapSections.length;r++){var _=t.mapSections[r],l="maps/"+_;a.push(l),i.push({name:l,parameters:["maps/"+_+".json"]})}for(var h=[],r=0;r<t.particleSystems.length;++r){var u=t.particleSystems[r];h.push({name:"particles/"+u,parameters:["particles/"+u+".json"]})}return h.length>0&&(n.particlesystem=h),Promise.all([e.resourceManager.loadBulk(n),a])}).then(function(t){s.debug("Loading Entities: Results built");for(var i=t[1],n=[],r=0;r<i.length;++r){var o=i[r],a=e.resourceManager.get(p.RESOURCE_TYPE,o),_=a.tilesets;if(_)for(var l=0;l<_.length;++l){var h=_[l],u=h.image;n.push({name:"maps/"+u,parameters:["maps/"+u]})}}return e.resourceManager.loadBulk({domimage:n})}).then(function(e){return s.debug("loadEntities Complete"),e})},__loadFonts:function(){return this.resourceManager.loader(M.RESOURCE_TYPE).load("/assets/game_assets/fonts/bender_bold_64pt_sct.xml","fonts/bender_bold_64pt_sct.xml")},__loadAtlases:function(){var e=this.resourceManager.loader(P.RESOURCE_TYPE),t=this.world.getSurface().getRenderer();return Promise.all([e.load("game_atlas","atlases/game_atlas.json"),e.load("font_atlas","atlases/font_atlas.json"),e.load("ui_atlas","atlases/ui_atlas.json"),e.load("ui_atlas2","atlases/ui_atlas2.json"),e.load("player_atlas","atlases/pixel_atlas.json")]).then(function(e){s.debug("loadAtlases Complete");for(var i=e.length,n=0;n<i;++n){var r=e[n],o={},a=r.getRegions();for(var _ in a){var l=a[_],h=l.getTextureFilter();if(h){var u=t.gl[h];o.minFilter=u,o.magFilter=u}W.getTextureFromDomImage(t,r.getImage().getDOMElement(),o);break}}return e})},__loadBulkResources:function(){return Promise.all([this.resourceManager.loader(y.RESOURCE_TYPE).load("resource_atlas","resources/json_resources.json"),this.resourceManager.loader(v.RESOURCE_TYPE).load("xml_resource_atlas","resources/xml_resources.xml"),this.resourceManager.loader(v.RESOURCE_TYPE).load("levels/patterns.xml","levels/patterns.xml")])},__loadAnimations:function(){return this.resourceManager.loadBulk({animatedsprite:[{name:"char_bullet_anim",parameters:["animated_sprites/bullets/char_bullet.json"]},{name:"upgrades/hexagon_star",parameters:["animated_sprites/upgrades/hexagon_star.json"]},{name:"upgrades/star_wing",parameters:["animated_sprites/upgrades/star_wing.json"]},{name:"upgrades/fuel_pickup",parameters:["animated_sprites/upgrades/fuel_pickup.json"]},{name:"upgrades/fuel_upgrade_pickup",parameters:["animated_sprites/upgrades/fuel_upgrade_pickup.json"]},{name:"char_explosion",parameters:["animated_sprites/enemies/char_explosion.json"]},{name:"char_gunshot",parameters:["animated_sprites/player/char_gunshot.json"]},{name:"system_upgrade",parameters:["animated_sprites/upgrades/system_upgrade.json"]},{name:"vfx_thruster",parameters:["animated_sprites/player/vfx_thruster.json"]},{name:"vfx_thruster_no_tint",parameters:["animated_sprites/player/vfx_thruster_no_tint.json"]},{name:"vfx_laserbeam_bottom",parameters:["animated_sprites/player/vfx_laserbeam_bottom.json"]},{name:"vfx_laserbeam_mid",parameters:["animated_sprites/player/vfx_laserbeam_mid.json"]},{name:"vfx_laserbeam_top",parameters:["animated_sprites/player/vfx_laserbeam_top.json"]},{name:"cockpit_shine",parameters:["animated_sprites/player/cockpit_shine.json"]}],skeleton:[{name:"explosion",parameters:["spine/entity_death/skeleton.json","spine/atlases/spine_atlas.json","entity_death/skeleton#"]},{name:"giftbox",parameters:["spine/giftbox/skeleton.json","spine/atlases/spine_atlas.json","giftbox/skeleton#"]},{name:"giftbox_gold",parameters:["spine/giftbox_gold/skeleton.json","spine/atlases/spine_atlas.json","giftbox_gold/skeleton#"]},{name:"giftbox_raid",parameters:["spine/giftbox_raid/skeleton.json","spine/atlases/spine_atlas.json","giftbox_raid/skeleton#"]},{name:"currency",parameters:["spine/currency/skeleton.json","spine/atlases/spine_atlas.json","currency/skeleton#"]},{name:"boss_death",parameters:["spine/boss_death/skeleton.json","spine/atlases/spine_atlas.json","boss_death/skeleton#"]},{name:"achievement_upgrade",parameters:["spine/achievement_upgrade/skeleton.json","spine/atlases/spine_atlas.json","achievement_upgrade/skeleton#"]},{name:"player_death",parameters:["spine/player_death/skeleton.json","spine/atlases/spine_atlas.json","player_death/skeleton#"]},{name:"ghost_death",parameters:["spine/ghost_death/skeleton.json","spine/atlases/spine_atlas.json","ghost_death/skeleton#"]},{name:"bars",parameters:["spine/bars/skeleton.json","spine/atlases/spine_atlas.json","bars/skeleton#"]},{name:"node",parameters:["spine/node/skeleton.json","spine/atlases/spine_atlas.json","node/skeleton#"]},{name:"drones",parameters:["spine/drones/skeleton.json","spine/atlases/spine_atlas.json","drones/skeleton#"]},{name:"static_shock",parameters:["spine/static_shock/skeleton.json","spine/atlases/spine_atlas.json","static_shock/skeleton#"]},{name:"card_scrap",parameters:["spine/card_scrap/skeleton.json","spine/atlases/spine_atlas.json","card_scrap/skeleton#"]},{name:"level_up",parameters:["spine/level_up/skeleton.json","spine/atlases/spine_atlas.json","level_up/skeleton#"]},{name:"card_unlock",parameters:["spine/card_unlock/skeleton.json","spine/atlases/spine_atlas.json","card_unlock/skeleton#"]},{name:"card_abilities",parameters:["spine/card_abilities/skeleton.json","spine/atlases/spine_atlas.json","card_abilities/skeleton#"]},{name:"finger_tap",parameters:["spine/finger_tap/skeleton.json","spine/atlases/spine_atlas.json","finger_tap/skeleton#"]}]})},__loadServerData:function(){return Promise.all([this.playerManager.load(),this.shipSkinManager.load(),this.giftManager.load(),this.achievementManager.load(),this.raidManager.load(this.resourceManager)])},__loadRequiredAudio:function(){return this.resourceManager.loadBulk({soundsprite:[{name:"game_sounds",parameters:["audio/game_sounds"]},{name:"music_sprite",parameters:["audio/music_sprite"]}]}).then(function(e){return s.debug("loadRequiredAudio Complete"),e}).catch(function(e){s.error("Could not load required audio, but can still continue. ",e)})},__addDebugOverlay:function(){function e(e,t){return function(){i.__debugOverlay.close(),d.showModal(e,t,"","restart",function(){window.location.reload()})}}function t(){f.removeItem(Ze.LS_FARTHEST),f.removeItem(Ze.LS_TOTAL_ENEMIES),f.removeItem(Ze.LS_EVENT_NAME),f.removeItem(Ze.LS_EVENT_HIGHSCORE),f.removeItem(Ze.LS_EVENT_USERNAME),f.removeItem(Ze.LS_MISSION_PROGRESS),f.removeItem(Ze.LS_LAST_MISSION_ID),f.removeItem(Ze.LS_OPEN_WEB_USER_ID),f.removeItem(Ze.LS_OPEN_WEB_AUTH_TOKEN)}var i=this;document.addEventListener("keydown",function(e){if(90===e.which){if(!i.gameLogic.isPlaying())return;i.gameLogic.setPlayerInvincible(!1);var t=i.gameLogic.getPlayerShip(),n=t.getComponent("ResourceComponent").getResource(yt.HEALTH);i.gameLogic._changePlayerHealth(-n)}}),this.__debugOverlay=new wt(!0).addSection("Gameplay",function(e,t){var n=t.addLabel("Invincibility Disabled");t.addButton("Toggle",function(){var e=!i.gameLogic.getPlayerInvincible();i.gameLogic.setPlayerInvincible(e),n.innerHTML="Invincibility "+(e?"Enabled":"Disabled")});var r=t.addLabel("Bullets Enabled");t.addButton("Toggle",function(){i.gameLogic.toggleBulletsEnabled();var e=i.gameLogic.getBulletsEnabled();r.innerHTML="Bullets "+(e?"Enabled":"Disabled")});var s=t.addLabel("Fast Motion Disabled");t.addButton("Toggle",function(){i.gameLogic.toggleFastMotion();var e=i.gameLogic.isFastMotionEnabled();s.innerHTML="Fast Motion "+(e?"Enabled":"Disabled")});var o=t.addLabel("Slow Motion Enabled");t.addButton("Toggle",function(){i.gameLogic.setSlowMotionEnabled(i.gameLogic.__disableSlowMotion);var e=!i.gameLogic.__disableSlowMotion;o.innerHTML="Slow Motion "+(e?"Enabled":"Disabled")}),t.addLabel("Temporarily Disable Player Projectiles"),t.addButton("Disable Player Projectiles",function(){i.gameLogic.__startPlayerBulletsDisabledTimer(),t.close()}),t.addLabel("Maximize Ship Upgrades"),t.addButton("Max",function(){i.gameLogic.__isPlayingGame&&(i.gameLogic.__shipSystems.debugUpgradeToMax(),t.close())})}).addSection("Local Storage",function(e,i){i.addLabel("Clear local storage"),i.addButton("Clear",function(){t(),document.location.reload()}),i.addButton("Clear Tool State",function(){for(var e=[],t=0;t<localStorage.length;++t){var i=localStorage.key(t);0===i.indexOf("V_TOOL")&&e.push(i)}e.forEach(localStorage.removeItem.bind(localStorage)),s.log("removed tool states",e),document.location.reload()})}).addSection("BulletML Debugging",function(e,t){t.addButton("Enable BulletML Tracing",function(){i.actionGlobals.setTracing(!0)}),t.addButton("Disable BulletML Tracing",function(){i.actionGlobals.setTracing(!1)})}).addSection("Spawn Upgrades",function(e,t){t.addButton("System Upgrade",function(){var e=[0,0];i.gameLogic.__ship.getRootComponent().getTranslation(e),i.gameLogic.__spawnUpgrade(e[0],Math.max(0,e[1]-500),Tt.SYSTEM_UPGRADE),t.close()}),t.addButton("Gold",function(){var e=[0,0];i.gameLogic.__ship.getRootComponent().getTranslation(e),i.gameLogic.__spawnGold(10,e[0],Math.max(0,e[1]-500)),t.close()})}).addSection("Energy",function(e,t){var n=t.addLabel("Infinite Energy Disabled");t.addButton("Toggle",function(){var e=i.gameLogic.getInfiniteEnergyEnabled();e?i.gameLogic.setInfiniteEnergyEnabled(!1):i.gameLogic.setInfiniteEnergyEnabled(!0),n.innerHTML="Infinite Energy "+(e?"Disabled":"Enabled")}),t.addButton("Get 2000",function(){i.gameLogic.__addToEnergy(2e3),t.close()})}).addSection("Game State Debugging",function(e,t){t.addLabel("Game State Debugging"),t.addButton("Dump Entities",function(){var e=i.entityManager.__entitiesById;console.log("Entity count: "+Object.keys(e).length);for(var t in e){var n=e[t];console.log("  "+t+" - Root: "+n.getRootComponent().getType());for(var r=n.getComponents(),s=0;s<r.length;++s){var o=r[s];console.log("    "+o.getType())}}}),t.addButton("Dump Entities Summary",function(){function e(e){var t=0;if(0===e.length)return t;for(var i,n=0,r=e.length;n<r;n++)i=e.charCodeAt(n),t=(t<<5)-t+i,t|=0;return t}function t(t){var i=5;i=59*i+e("Root: "+t.getRootComponent().getType())|0;for(var n=t.getComponents(),r=0;r<n.length;++r){i=59*i+e(n[r].getType())|0}return i}var n=i.entityManager.__entitiesById;console.log("Entity count: "+Object.keys(n).length);var r={};for(var s in n){var o=n[s],a=t(o);r[a]?r[a]++:r[a]=1}for(var _=Object.keys(r).sort(function(e,t){return r[e]-r[t]}),l=0,h=_.length;l<h;l++){var u,a=0|_[l],c=r[a];for(var s in n){var o=n[s];if(t(o)===a){u=o;break}}console.log("  "+c+" of Root: "+u.getRootComponent().getType()+" (hash `"+a+"`)");for(var d=u.getComponents(),g=0;g<d.length;++g){var p=d[g];console.log("    "+p.getType())}}}),t.addButton("Enable Event Tracing",function(){i.eventManager.setEventTracing(!0)}),t.addButton("Disable Event Tracing",function(){i.eventManager.setEventTracing(!1)}),t.addButton("Dump Game State",function(){console.log("Game state: "+i.gameLogic.__fsm.getCurrentState()),i.gameLogic.__friends&&console.log("Loaded friends list: "+i.gameLogic.__friends.length)}),t.addButton("Facebook Quit",function(){FBInstant.quit()})}).addSection("Debug",function(e,t){t.addButton("Remove debug overlays",function(){t.remove(),_.getInstance().destroy(),i.__fpsMeter&&(i.__fpsMeter.destroy(),i.__fpsMeter=null)});var n=t.addLabel("Health Logging Disabled");t.addButton("Toggle",function(){var e=!i.gameLogic.__logHealth;i.gameLogic.__logHealth=e,n.innerHTML="Health Logging "+(e?"Enabled":"Disabled")})}),this.__debugOverlay.addSection("Gold",function(e,t){function n(e){a.innerHTML=i.playerManager.getPlayerParts()+" Parts"}var r=i.playerManager.getPlayerGold(),s=t.addLabel(r+" Gold");t.addButton("Refresh Gold",function(){s.innerHTML=i.playerManager.getPlayerGold()+" Gold"}),t.addButton("Add 1000 Gold",function(){function e(e){s.innerHTML=i.playerManager.getPlayerGold()+" Gold"}i.playerManager.addGold(1e3).then(e)}),t.addButton("Wipe Gold",function(){function e(e){s.innerHTML=i.playerManager.getPlayerGold()+" Gold"}i.playerManager.spendGold(i.playerManager.getPlayerGold(),"debug_wipe").then(e)});var o=i.playerManager.getPlayerParts(),a=t.addLabel(o+" Parts");t.addButton("Refresh Parts",function(){n()}),t.addButton("Add 1000 Parts",function(){i.playerManager.adjustPlayerParts(1e3).then(n)}),t.addButton("Wipe Parts",function(){i.playerManager.adjustPlayerParts(-i.playerManager.getPlayerParts()).then(n)})}),this.__debugOverlay.addSection("Tokens",function(e,t){var n=i.playerManager.getPlayerTokens(),r=t.addLabel(n+" Tokens");t.addButton("Refresh Tokens",function(){r.innerHTML=i.playerManager.getPlayerTokens()+" Tokens"}),t.addButton("Add 1000 Tokens",function(){function e(e){r.innerHTML=i.playerManager.getPlayerTokens()+" Tokens"}i.playerManager.addTokens(1e3).then(e)}),t.addButton("Wipe Tokens",function(){function e(e){r.innerHTML=i.playerManager.getPlayerTokens()+" Tokens"}i.playerManager.spendTokens(i.playerManager.getPlayerTokens()).then(e)})}),this.__debugOverlay.addSection("XP",function(e,t){t.addButton("Add XP",function(){var e=+window.prompt("How much XP to add?","0");i.playerManager.addXP(e).then(function(e){for(var n=[],r=0,a=e.length;r<a;r++){var _=e[r];s.debug("Level gain: ",_);var l=_.rewards;if(o.isArray(l))for(var h=0,u=l.length;h<u;h++)n.push(l[h])}if(n.length>0){var c=i.eventManager.getNewEvent(z);c.setArrRewards(n),i.eventManager.queueEvent(c)}t.close()})}),t.addButton("Show Level Up",function(){var e=+window.prompt("Level?","1");if(e<2||e>15)return void window.alert("Specify a valid lavel");var n=i.playerManager.getLevelRewards(e),r=i.eventManager.getNewEvent(z);r.setArrRewards(n),i.eventManager.queueEvent(r),t.close()})}),this.__debugOverlay.addSection("Mission",function(t,i){function n(t){var n=vt.getMissionManager(),r=vt.getStorageManager(),s=n.getMissionSet(),o=Date.now()+t-1e3*Mt.MISSION_DELAY_SECONDS;s.setCompletedEpochMS(o);var a={};s.appendToWire(a),r.setDataAsync(a).then(function(){e("Mission Timing Reset","Please restart your game for this to take effect.")()}).catch(function(e){console.error("ERROR: "+e),d.showModal("Reset Failed","The reset failed.","","Ok",function(){})}).then(function(){i.close()})}i.addButton("New Missions",function(){var t=vt.getPlayerManager().getPlayerLevel();vt.getMissionManager().getMissionSet().advance(t,!1).then(function(){e("New Mission Set","Please restart your game for this to take effect.")(),i.close()})}),i.addButton("Dump Loaded Missions",function(){vt.getMissionManager().dumpMissions()}),i.addButton("Show Mission Set",function(){var e={__completedEpochMS:1,__completedSets:1,__level:1,__pool:1,__current:1,__active:1,__completed:1},t=vt.getMissionManager().getMissionSet(),n={};for(var r in t)r in e&&(n[r]=t[r]);var s=JSON.stringify(n),o=''+encodeURI(s)+'">Send mission set dump.\n\n'+s;d.showMessageModal("Mission set dump",o),i.close()}),i.addButton("15 Seconds Left",n.bind(null,15e3)),i.addButton("1 Minute Left",n.bind(null,6e4)),i.addButton("1 Hour Left",n.bind(null,36e5)),i.addButton("4 Hour Left",n.bind(null,144e5))}),this.__debugOverlay.addSection("Gift",function(e,t){function n(e){i.giftManager.setTimeRemaining(e).then(function(){t.close()})}t.addButton("Reset Seqeuence",function(){i.giftManager.debugResetSequence()}),t.addButton("0 seconds",n.bind(null,0)),t.addButton("5 seconds",n.bind(null,5)),t.addButton("30 seconds",n.bind(null,30)),t.addButton("1 minute",n.bind(null,60)),t.addButton("1 hour",n.bind(null,3600))}),this.__debugOverlay.addSection("Player Data",function(t,n){n.addButton("Reset All",function(){i.playerManager.resetAllData().then(function(){e("All Player Data Reset","Please restart your game for this to take effect.")()}).catch(function(e){console.error("ERROR: "+e),d.showModal("Reset Failed","The reset failed.","","Ok",function(){})})}),n.addButton("Reset Purchased Ships/Skins",function(){i.playerManager.resetShipPurchases().then(function(){e("Ship Skin Purchases Reset","Please restart your game for this to take effect.")()}).catch(function(e){console.error("ERROR: "+e),d.showModal("Reset Failed","The reset failed.","","Ok",function(){})})}),n.addButton("Reset Player",function(){i.playerManager.resetPlayer().then(function(){e("Player Reset","Please restart your game for this to take effect.")()}).catch(function(e){console.error("ERROR: "+e),d.showModal("Reset Failed","The reset failed.","","Ok",function(){})})}),n.addButton("Reset Achievements",function(){i.playerManager.resetAchievements().then(function(){e("Achievements Reset","Please restart your game for this to take effect.")()}).catch(function(e){console.error("ERROR: "+e),d.showModal("Reset Failed","The reset failed.","","Ok",function(){})})}),n.addButton("Reset Gifts",function(){i.playerManager.resetGifts().then(function(){e("Gifts Reset","Please restart your game for this to take effect.")()}).catch(function(e){console.error("ERROR: "+e),d.showModal("Reset Failed","The reset failed.","","Ok",function(){})})}),n.addButton("Reset Missions",function(){i.playerManager.resetMissions().then(function(){e("Missions Reset","Please restart your game for this to take effect.")()}).catch(function(e){console.error("ERROR: "+e),d.showModal("Reset Failed","The reset failed.","","Ok",function(){})})}),n.addButton("Reset Gacha Bag",function(){i.playerManager.resetGachaBag().then(function(){e("Gacha Bag Reset","Please restart your game for this to take effect.")()}).catch(function(e){console.error("ERROR: "+e),d.showModal("Reset Failed","The reset failed.","","Ok",function(){})})});var r=i.playerManager.getTestingGroup(),s=n.addLabel(r+" Testing Group");n.addButton("Set Testing Group",function(){for(var t=[],o=0;o<ut.NUM_TEST_GROUPS;o++)t.push(""+o);n.close(),d.showDropDownModal("Choose Testing Group","Please choose your new testing group.","Choose",t,function(t){var n=+t;i.playerManager.setTestingGroup(n).then(function(){r=n,s.innerHTML=r+" Testing Group",e("Set Testing Group","Please restart your game for this to take full effect.")()}).catch(function(e){console.error("ERROR: "+e),d.showModal("Set Failed","Could not set testing group.","","Ok",function(){})})})});var o=i.playerManager.canSkipFue();n.addLabel("Skipping FUE: "+o);n.addButton("Toggle Skipping FUE Elements",function(){i.playerManager.toggleCanSkipFue().then(function(){e("Skipping FUE Elements: "+i.playerManager.canSkipFue(),"Please restart your game for this to take effect.")()})}),n.addButton("Give Rebalance Gift",function(){i.playerManager.enableRebalanceGift().then(function(){n.close(),e("Rebalance Gift Restart","Must restart to take effect.")()})})}),this.__debugOverlay.addSection("Game Over",function(e,t){t.addButton("Die",function(){if(!i.gameLogic.isPlaying())return d.showMessageModal("lul","You can't die if you aren't playing"),void t.close();var e=i.gameLogic.getPlayerShip(),n=e.getComponent("ResourceComponent").getResource(yt.HEALTH);t.close(),i.gameLogic._changePlayerHealth(-n)}),t.addButton("Reset Game",function(){i.gameLogic.resetGame(),t.close()})}),this.__debugOverlay.addSection("Gacha",function(e,t){t.addButton("Open Gacha",function(){var e=i.playerManager.getPlayerLevel(),t=i.gachaManager.getCurrentGachaLevel();s.debug("Opening gacha back, player level: "+e+", gacha bag level: "+t),i.playerManager.purchaseGacha(!0).then(function(){var e=i.gachaManager.getLastReward();s.debug("Gacha rewards: ",e)})}),t.addButton("Open Gacha At Level",function(){var e=+window.prompt("Level","1");if(isNaN(e))return s.error("Level has to be a number"),void d.showMessageModal("Invalid Input","Level has to be a number");var t=new bt(i.gachaManager,i.playerManager,new u,i.gameLogic),n=i.gachaManager.getGachaByLevel(e);if(!n)return s.error("Invalid gacha level "+e),void d.showMessageModal("Invalid Gacha Level","Level "+e+" has no gacha entries");s.debug("=== Gacha Level "+e+" ==="),s.debug("\tMin/Max Parts: "+n.minParts+" / "+n.maxParts),s.debug("\tCards Drawn: "+n.numCards),t.setGacha(n),t.refillUndrawnCards(!1);var r=t.__undrawnCards;s.debug("=== Created Gacha Bag at level "+e+" ==="),s.debug("\tCards: ",r);for(var o=n.numCards;r.length>0;){var a=t.__drawCards(r,o);s.debug("=== Performed Draw ==="),s.debug("\tCards Drawn",a),s.debug("\tCards Remaining: "+r.length)}})}),this.__debugOverlay.addSection("Benchmark",function(e,t){t.addButton("BulletML",function(){var e=i.resourceManager.getAllResourceNamesByType("bulletml"),t=e.map(function(e){return i.resourceManager.get(g.RESOURCE_TYPE,e)}),n=t.length,r=window.performance.now();console.profile("BulletML Parse");for(var s=0;s<10;++s)for(var o=0;o<n;++o){var a=t[o];new ie(a)}var _=window.performance.now();console.profileEnd(),console.warn("BulletML benchmark took "+~~(_-r)+"ms")})}),this.__debugOverlay.addSection("Facebook",function(e,t){t.addButton("Show Facebook Data",function(){var e;if(window.isFacebook()){e="ID: "+FBInstant.player.getID()+"\nName: "+FBInstant.player.getName()+"\n Context ID: "+FBInstant.context.getID()}else e="Not On Facebook";d.showMessageModal("Facebook Info",e),t.close()}),t.addButton("Show Score Screenshot",function(){var e=+window.prompt("Score To Show","1337");t.close(),xt.showScreenshot(e)})}),this.__debugOverlay.addSection("Replays",function(e,t){t.addButton("Show Loaded Replay Ranks",function(){for(var e=i.replayManager.getReplays(),n=[],r=0,s=e.length;r<s;r++){var o=e[r];n.push(o.rank+1)}var a=i.replayManager.getPlayerRank(),_="[ "+n.join(" , ")+" ], player: "+(a+1);d.showMessageModal("Loaded Replay Ranks",_),t.close()}),t.addButton("Save Next Replay Locally",function(){d.showInputModal("Replay Name","Set the next replay name.","Ok","name",function(e){i.replayManager.setNextReplayLocalName(e),d.showMessageModal("Save Initiated","Next replay will be saved locally as `"+e+"`")}),t.close()}),t.addButton("Clear Local Replays",function(){i.replayManager.clearLocalReplays(),d.showMessageModal("Cleared","All local replays have been cleared."),t.close()}),t.addButton("Setup Tournament Replays",function(){
function e(t){if(0===t)return void s();d.showDropDownModal("Choose Replay","Choose the replay you would like to add.","Choose",_,function(i){p.push(i),_.splice(_.indexOf(i),1),e(t-1)})}function n(e){for(var t=parseInt(e.split(" ",2)[1]),i=0,n=a.length;i<n;i++){var r=a[i];if(r.id===t)return void f.push(r)}}function r(e){var t=e.substr(7),n=i.replayManager.loadLocalReplay(t);f.push(n)}function s(){for(var e=0,t=p.length;e<t;e++){var s=p[e];0===s.indexOf("Server:")?n(s):r(s)}i.replayManager.setReplays(f),d.showMessageModal("Replays Set","The selected replays have been set. Please begin your game.")}for(var o=i.replayManager.getLocalReplayNames(),a=i.replayManager.getReplays(),_=[],l=0,h=a.length;l<h;l++){var u=a[l];_.push("Server: "+u.id+" - rank "+(u.rank+1))}for(var l=0,c=o.length;l<c;l++)_.push("Local: "+o[l]);t.close();var g=Math.min(_.length,3);if(0===g)return void d.showMessageModal("Not Enough Replays","There are no replays available.");for(var p=[],m=[],l=0;l<=g;l++)m.push(l);d.showDropDownModal("Num Replays","Choose the amount of replays.","Choose",m,function(t){var i=+t;if(i===_.length)return p=_,void s();e(i)});var f=[]})}),this.__debugOverlay.addSection("Raids",function(e,t){t.addButton("Leaderboard",function(){i.raidManager.debugGetLeaderboard().then(function(e){console.log(e)})}),t.addButton("End",function(){var e={};[0,5,30,60,300,900,1800,3600].forEach(function(t){e[m.getTimeDisplayString(t,"0","abbreviated")]=t}),d.showDropDownModal("Raid","End raid in:","End",Object.keys(e),function(t){var n=e[t];i.raidManager.debugEnd(n)}),t.close()}),t.addButton("Type",function(){var e=Object.keys(i.raidManager.__specByType).map(function(e){return It.nameFromValue(+e)}),n={};e.forEach(function(e){n[m.snakeToCapitalCase(e)]=e}),d.showDropDownModal("Raid","Change type to","OK",Object.keys(n),function(e){var t=n[e],r=It[t];i.raidManager.debugSetType(r)}),t.close()}),t.addButton("Contribute",function(){i.raidManager.debugGetLeaderboard().then(function(e){var n=e.map(function(e){return e.playerId});t.close(),d.showDropDownModal("Contribute","as","OK",n.concat(["Custom"]),function(e){function t(e){d.showInputModal("Contribute","amount","OK","1",function(t){var n=+t;if(!o.isNumber(n))return void d.showModal("Error","Contribution contribution amount must be a number","OK",function(){});i.raidManager.debugContribute(e,n,1,1)})}"Custom"===e?d.showInputModal("Contribute","as","OK",i.playerManager.getFacebookId(),t):t(e)})})})}),this.__debugOverlay.addSection("FUE Debug",function(t,n){n.addButton("Show Checkpoint",function(){d.showMessageModal("Current Checkpoint",i.playerManager.getFueCheckpoint().toString()),n.close()}),n.addButton("Set Checkpoint",function(){for(var t=[],r=1;r<=ct.MAX_FUE_CHECKPOINT;r++)t.push(""+r);n.close(),d.showDropDownModal("Choose Checkpoint","Please choose your new checkpoint.","Choose",t,function(t){var n=+t;i.playerManager.setFueCheckpoint(n).then(function(){e("Chose checkpoint "+t,"Please restart your game for this to take full effect.")()}).catch(function(e){console.error("ERROR: "+e),d.showModal("Set Failed","Could not set checkpoint.","","Ok",function(){})})})})}),this.__debugOverlayContextTypeLabel=null,this.__debugOverlay.addSection("About",function(e,t){t.addLabel("Version: "+window.VERSION),t.addLabel("Platform at launch: "+i.platform),t.addLabel("Platform after loading: "+FBInstant.getPlatform()),i.__debugOverlayContextTypeLabel=t.addLabel("Context type: (not loaded)")})}})}),define("app",["require","exports","module","thor/compatibility/Promise","thor/config/Config","thor/util/Alert","thor/util/StringUtil","thor/debug/PerformanceOverlay","thor/platforms/Google","thor/platforms/Facebook","thor/core/Device","thor/core/Scheduler","thor/graphics/Surface","thor/ui/InputProvider","thor/ui/UiRoot","thor/ui/Widget","thor/audio/SoundManager","thor/event/EventManager","thor/resources/ResourceManager","thor/entity/World","thor/entity/EntityManager","thor/entity/SceneComponent","thor/entity/InputComponent","ProjectV","Constants"],function(e,t,i){function n(e){H.style.width=g.cssViewportWidth+"px",H.style.height=g.cssViewportHeight+"px",e.style.width=g.cssViewportWidth+"px",e.style.height=g.cssViewportHeight+"px",e.width=g.canvasWidth,e.height=g.canvasHeight,(g.hacks[g.HACKS.STATUS_BAR_OVERLAY]||window.innerHeight<=g.cssViewportHeight||g.features[g.FEATURES.SCALE_TO_FIT]&&g.isLandscape)&&(H.style.marginTop="auto",e.style.marginTop="auto")}function r(){n(B),q.sendGameBoundsEvent()}function s(e,t){t=Math.min(t,50),t*=q.gameLogic.getSlowMotionMultiplier(t),D.update(t),q.preUpdate(t),q.collisionManager.update(t),C.MULTIVERSE.forEach(function(i){i.updateScene(e,t)}),k.onFrameStart(),O.draw(k),k.onFrameEnd(),N.dispatchEvents(),q.postUpdate(t)}function o(e,t){p.addAnimationTask(c.getInstance().addInstrumentedTask("Frame Time",s,1e3,16,33))}function a(){"SAFARI"===g.browserName&&h.installErrorHandler(),g.features[g.FEATURES.AUDIO_REQUIRES_INPUT]&&E.installUserInputHandler(F),q.start(),o(O,q)}function _(e){var t=document.getElementById("container");t.style.webkitTransform=e?"rotate("+-window.orientation+"deg) scale(1.6)":"";var i=document.getElementById("forceLandscapeModal");!i&&e?(i=document.createElement("div"),i.style.color="white",i.style.fontSize="30px",i.style.position="absolute",i.style.height="100%",i.style.width="100%",i.style.top=0,i.style.left=0,i.style.zIndex=1e4,i.style.background="rgba(20, 20, 20, 0.9)",i.style.textAlign="center",i.style.paddingTop="25%",i.id="forceLandscapeModal",i.innerHTML="Portrait orientation only! Please rotate your device.",t.parentNode.insertBefore(i,t)):i&&!e&&t.parentNode.removeChild(i)}e("thor/compatibility/Promise");var l=e("thor/config/Config"),h=e("thor/util/Alert"),u=e("thor/util/StringUtil"),c=e("thor/debug/PerformanceOverlay"),d=e("thor/platforms/Google"),g=(e("thor/platforms/Facebook"),e("thor/core/Device")),p=e("thor/core/Scheduler"),m=e("thor/graphics/Surface"),f=e("thor/ui/InputProvider"),v=e("thor/ui/UiRoot"),y=e("thor/ui/Widget"),E=e("thor/audio/SoundManager"),S=e("thor/event/EventManager"),T=e("thor/resources/ResourceManager"),C=e("thor/entity/World"),I=e("thor/entity/EntityManager"),w=e("thor/entity/SceneComponent"),b=e("thor/entity/InputComponent"),M=e("ProjectV");e("Constants");if(g.debugFeatures[g.DEBUG_FEATURES.FPS_METER]){var x=new c;x.toggleVisibility(),x.__overlay.style.top="0",x.__overlay.style.bottom="auto",x.__overlay.style.padding="5px",x.__overlay.childNodes[0].style.fontSize="0.7rem"}var R=u.getUrlParams();!l.ENABLE_DEBUG_OVERLAY||"dev"!==R.mode&&"autoTest"!==R.mode||document.addEventListener("keydown",function(e){68===e.which&&(O.__debugDraw=!O.__debugDraw)}),window.SESSION_ID=u.guid(),d.loadSDK({playerLevel:1,testingGroup:2,gold:3,parts:4,cardId1:5,cardId2:6,cardId3:7,missionType:8,minFps:9,meanFps:10,cardType:11,skinId:12,distance:13,score:14,bruisersKilled:15,frigatesKilled:16,destroyersKilled:17,bossesKilled:18,coinsCollected:19,fuelCollected:20},{sessionId:1,screenName:2,interactionName:3,contextId:4,version:5});var P=FBInstant.player.getID()||"web_player",A=FBInstant.context.getID()||"0";ga("set","transport","beacon"),ga("set","userId",P),d.setDimension("sessionId",window.SESSION_ID),d.setDimension("contextId",A),d.setDimension("version",""+window.VERSION),"SAFARI"!==g.browserName&&h.installErrorHandler(),g.setMinimumAspectRatio(9/16),g.setMaximumAspectRatio(.75);var N=new S(100),D=new I(N,1500);D.registerComponentType("SceneComponent",w,[],1e3),D.registerComponentType("InputComponent",b,[],1);var L=new T,O=new v("Root",g.canvasWidth,g.canvasHeight,y.NULL_WIDGET);O.__debugDraw=!1;var V,B=document.getElementById("foreground");try{V=new m(B)}catch(e){return void h.showMessageModal("Your browser doesn't support WebGL",'Unfortunately your browser doesn\'t support WebGL, which is needed to run GalatronVS. You can go to <a href="http://get.webgl.org/">http://get.webgl.org/</a> for more information on how to upgrade.')}var k=V.getRenderer(),W=new C(V,D,N),F=new f(B,O),U=D.createEntity(),G=D.addComponent(U,"SceneComponent",!1);D.addComponent(U,"InputComponent",!1);U.setRootComponent(G),W.setScene(U),window.WEB_SERVER_HOST=(window.WEB_SERVER_HOST||".")+"/",B.style["pointer-events"]="auto",g.features[g.FEATURES.ONSCREEN_KEYBOARD]&&(B.style.bottom="auto");var H=document.getElementById("container");n(B),g.addViewportResizeDelegate({onViewportResized:function(e,t){r()}});var q=new M(D,N,W,O,L);window.addEventListener("orientationchange",function(){switch(window.orientation){case 90:case-90:_(!0);break;default:_(!1)}}),g.isMobileDevice&&g.isLandscape&&_(!0);var Y={load:function(){return q.load().then(function(){g.forceResize(),q.init()}).catch(function(e){h.uncaughtError(e)})},run:function(){a()}};i.exports=Y,window.GALATRONVS_DEMO_MODE||Y.load().then(function(){Y.run()})});const ASSERTIONS=!0;define("../../build/constants",function(){});